# 上涨占比0自动策略使用指南

## 📋 策略概述

本文档介绍两个基于**上涨占比=0**触发条件的自动开单策略，用于在市场全面下跌时自动执行开仓操作。

---

## 🎯 策略A：上涨占比0-涨幅前8名（多单）

### 策略说明
- **策略名称**: 上涨占比0-涨幅前8名策略
- **策略类型**: 追涨策略（看多反弹）
- **策略颜色**: 蓝色卡片

### 触发条件
1. **上涨占比 = 0%**（27个币种全部下跌）
2. **当前时间不在 0:00-0:30**（北京时间）

### 开单逻辑
1. 从⭐**常用币**（15个）中获取实时涨跌幅数据
2. 按涨跌幅**降序排列**，选择**涨幅前8名**
3. 每个币种开仓金额 = **可用余额 × 1.5%**
4. 统一使用**10倍杠杆**
5. 统一开**多单**（做多，buy方向）

### 策略逻辑
虽然市场全部下跌，但选择跌幅最小的8个币种开多单，预期它们更可能率先反弹。

### 使用方法
1. 打开 `https://9002-iou7okyaq15h840cyuitp-c07dda5e.sandbox.novita.ai/okx-trading`
2. 滚动到右侧面板
3. 找到 **"📈 上涨占比0-涨幅前8名"** 卡片（蓝色）
4. 点击开关 **"🚀 启用自动开单"**
5. 系统每60秒检查一次触发条件
6. 满足条件时自动执行，执行后开关自动关闭

---

## 🎯 策略B：上涨占比0-涨幅后8名（多单）

### 策略说明
- **策略名称**: 上涨占比0-涨幅后8名策略
- **策略类型**: 抄底策略（高风险）
- **策略颜色**: 红色卡片

### 触发条件
1. **上涨占比 = 0%**（27个币种全部下跌）
2. **当前时间不在 0:00-0:30**（北京时间）

### 开单逻辑
1. 从⭐**常用币**（15个）中获取实时涨跌幅数据
2. 按涨跌幅**升序排列**，选择**涨幅后8名**（跌幅最大）
3. 每个币种开仓金额 = **可用余额 × 1.5%**
4. 统一使用**10倍杠杆**
5. 统一开**多单**（做多，buy方向）

### 策略逻辑
市场全部下跌时，选择跌幅最大的8个币种开多单，预期超跌反弹。**风险极高！**

### 使用方法
1. 打开 `https://9002-iou7okyaq15h840cyuitp-c07dda5e.sandbox.novita.ai/okx-trading`
2. 滚动到右侧面板
3. 找到 **"📉 上涨占比0-涨幅后8名"** 卡片（红色）
4. 点击开关 **"🚀 启用自动开单"**
5. 系统每60秒检查一次触发条件
6. 满足条件时自动执行，执行后开关自动关闭

---

## 📊 数据来源

### 上涨占比数据
- **API端点**: `/api/coin-change-tracker/latest`
- **数据字段**: `up_ratio`（百分比）
- **计算方式**: 27个币种中上涨币种数量占比
- **示例**:
  - `up_ratio = 100` → 全部上涨
  - `up_ratio = 0` → 全部下跌（触发条件）
  - `up_ratio = 50` → 一半上涨一半下跌

### 涨跌幅数据
- **API端点**: `/api/coin-change-tracker/latest`
- **数据字段**: `changes[币种].change_pct`
- **基准时间**: 每日0:00（北京时间）重置
- **示例**:
```json
{
  "up_ratio": 0,
  "changes": {
    "BTC": {"change_pct": -2.5},
    "ETH": {"change_pct": -3.1},
    "SOL": {"change_pct": -5.2},
    ...
  }
}
```

---

## ⚙️ 策略配置

### 常用币列表
1. 策略依赖于⭐**常用币**（15个）
2. 确保已收藏至少15个币种
3. 点击左侧币种列表的⭐图标可添加/移除常用币
4. 常用币列表全局共享

### 仓位计算
- **每币仓位**: 可用余额 × 1.5% = 单币开仓金额
- **实际占用保证金**: 单币开仓金额 ÷ 10（10倍杠杆）
- **总占用保证金**: 单币保证金 × 8 = 可用余额 × 1.5% × 8 ÷ 10 = **可用余额 × 1.2%**

### 示例计算
假设可用余额 = 1000 USDT：
- 单币开仓金额 = 1000 × 1.5% = **15 USDT**
- 单币占用保证金 = 15 ÷ 10 = **1.5 USDT**
- 总开仓金额 = 15 × 8 = **120 USDT**
- 总占用保证金 = 1.5 × 8 = **12 USDT**

---

## ⚠️ 风险提示

### 策略A风险（涨幅前8名）
- **风险等级**: 中等
- **适用场景**: 市场全面下跌后的反弹行情
- **风险点**: 跌幅小不代表一定反弹

### 策略B风险（涨幅后8名）
- **风险等级**: 极高⚠️
- **适用场景**: 预期超跌反弹
- **风险点**: 跌幅大的币种可能继续下跌

### 共同风险
1. ⚠️ **杠杆风险**: 10倍杠杆放大盈亏
2. ⚠️ **滑点风险**: 市场波动大时可能有滑点
3. ⚠️ **流动性风险**: 部分币种流动性差
4. ⚠️ **时间风险**: 排除0:00-0:30可能错过机会

---

## 🛡️ 防重复下单机制

### 执行锁机制
1. **全局执行锁**: `strategyExecuting` 变量
2. 任一策略执行时，其他策略自动等待
3. 执行完成后自动释放锁

### 自动关闭开关
- 执行成功后，开关**自动关闭**
- 防止短时间内重复执行
- 如需再次执行，需手动重新开启

### 时间排除
- 每天**0:00-0:30（北京时间）**不执行
- 避免基准重置时段的数据不稳定

---

## 📝 执行流程

### 检查流程
```
每60秒检查一次
  ↓
检查开关是否开启
  ↓
检查当前时间（排除0:00-0:30）
  ↓
获取上涨占比数据
  ↓
判断 up_ratio === 0 ?
  ↓ Yes
设置执行锁
  ↓
获取常用币列表（15个）
  ↓
获取涨跌幅数据
  ↓
排序并选择前8/后8名
  ↓
获取账户余额
  ↓
计算每币开仓金额（1.5%）
  ↓
逐个下多单（10倍杠杆）
  ↓
更新状态显示
  ↓
自动关闭开关
  ↓
释放执行锁
  ↓
显示执行结果
```

### 下单间隔
- 每次下单后等待**500ms**
- 避免频繁请求OKX API
- 减少被限流风险

---

## 📈 实时监控

### 卡片显示内容
1. **当前上涨占比**: 实时更新
2. **策略状态**: 未启用/监控中/已执行
3. **上次执行时间**: 显示最后一次执行的时间
4. **触发条件说明**: 详细的策略逻辑

### 状态颜色
- **灰色**: up_ratio ≠ 0（未触发）
- **红色**: up_ratio = 0（触发条件满足）

---

## 🔔 执行通知

### 执行完成提示
- ✅ **弹窗提示**: 显示执行结果
- 🔊 **音效提醒**: 播放提示音
- 📊 **详细信息**: 成功/失败币种列表

### 提示信息内容
```
✅ 上涨占比0-涨幅前8名策略执行完成！

触发条件：上涨占比 = 0%
成功开单：7/8 个币种
成功币种：BTC, ETH, SOL, DOGE, XRP, LTC, LINK
失败币种：HBAR

策略已自动关闭，如需再次执行请重新开启。
```

---

## 🛠️ 技术实现

### 核心函数
1. **`checkAndExecuteUpRatio0Top8()`**: 检查涨幅前8名策略
2. **`checkAndExecuteUpRatio0Bottom8()`**: 检查涨幅后8名策略
3. **`getUpRatio()`**: 获取当前上涨占比
4. **`executeUpRatio0Strategy(account, upRatio, strategyType)`**: 通用执行函数

### API接口
- **涨跌幅数据**: `GET /api/coin-change-tracker/latest`
- **账户余额**: `POST /api/okx-trading/account-balance`
- **下单接口**: `POST /api/okx-trading/place-order`

### 执行参数
```javascript
{
  "symbol": "BTC-USDT-SWAP",
  "side": "buy",           // 多单
  "amount": 15,            // 开仓金额（USDT）
  "leverage": 10,          // 10倍杠杆
  "orderType": "market"    // 市价单
}
```

---

## 📊 使用场景

### 适合使用的场景
1. ✅ 市场全面下跌后预期反弹
2. ✅ 想要自动化执行抄底策略
3. ✅ 愿意承担杠杆交易风险
4. ✅ 有足够的常用币种（≥15个）

### 不适合使用的场景
1. ❌ 市场趋势不明确
2. ❌ 不了解杠杆交易风险
3. ❌ 常用币列表不足15个
4. ❌ 账户余额不足（< 100 USDT）

---

## 🔧 故障排查

### 策略未执行
1. 检查开关是否开启
2. 检查上涨占比是否为0
3. 检查当前时间（避开0:00-0:30）
4. 检查常用币列表（≥15个）
5. 检查账户余额是否充足

### 下单失败
1. 检查API凭证是否正确
2. 检查网络连接
3. 检查币种名称格式（如 BTC-USDT-SWAP）
4. 检查OKX API限流状态

### 执行锁未释放
- 刷新页面重置状态
- 检查控制台日志
- 联系技术支持

---

## 📞 支持与反馈

如有问题或建议，请联系技术支持团队。

---

## 📄 更新日志

### v1.0.0 (2026-02-17)
- ✅ 初始版本
- ✅ 实现涨幅前8名策略
- ✅ 实现涨幅后8名策略
- ✅ 添加时间排除机制（0:00-0:30）
- ✅ 添加执行锁防重复
- ✅ 添加实时监控显示

---

**策略链接**: https://9002-iou7okyaq15h840cyuitp-c07dda5e.sandbox.novita.ai/okx-trading

**注意**: 本策略仅供参考，不构成投资建议。请根据自身风险承受能力谨慎使用。
