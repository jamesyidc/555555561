# åç«¯è®¡ç®—è¿ç§»æ€»ç»“ - Backend Calculation Migration Summary

**æ—¥æœŸ**: 2026-02-16  
**ä»»åŠ¡**: å°†æ‰€æœ‰ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘è®¡ç®—ä»å‰ç«¯è¿ç§»åˆ°åç«¯

---

## ğŸ“Š æ¶‰åŠçš„ä¸‰ä¸ªç³»ç»Ÿ

### 1. 27å¸æ¶¨è·Œå¹…è¿½è¸ªç³»ç»Ÿ (Coin Change Tracker)
**URL**: https://9002-xxx.sandbox.novita.ai/coin-change-tracker  
**é—®é¢˜**: æµè§ˆå™¨ç¼“å­˜å¯¼è‡´æ•°æ®è¿‡æ—¶  
**è§£å†³æ–¹æ¡ˆ**: 
- âœ… å‰ç«¯APIè¯·æ±‚æ·»åŠ æ—¶é—´æˆ³å‚æ•° `?_t=Date.now()`
- âœ… fetché€‰é¡¹è®¾ç½® `cache: 'no-store'`
- âœ… åç«¯å“åº”å¤´æ·»åŠ  `Cache-Control: no-store, no-cache, must-revalidate`
- âœ… æ–°å¢ç»¿è‰²"åˆ·æ–°æ•°æ®"æŒ‰é’®
- âœ… åç«¯é‡‡é›†å™¨ç‹¬ç«‹è¿è¡Œï¼ŒæŒç»­å†™å…¥JSONLæ–‡ä»¶

**Gitæäº¤**: `70240f9`, `6eb5e0c`

### 2. SARåå‘è¶‹åŠ¿ç³»ç»Ÿ (SAR Bias Trend)
**URL**: https://5000-xxx.sandbox.novita.ai/sar-bias-trend  
**é—®é¢˜**: å‰ç«¯ã€é‡‡é›†å™¨ã€åç«¯APIä¸‰å¤„é‡å¤>80%ç­›é€‰é€»è¾‘  
**è§£å†³æ–¹æ¡ˆ**:
- âœ… åç«¯API `/api/sar-slope/bias-ratios` ç›´æ¥è¿”å›ç­›é€‰åçš„ `bullish_symbols` å’Œ `bearish_symbols`
- âœ… å‰ç«¯ç§»é™¤æ‰€æœ‰ç­›é€‰é€»è¾‘ï¼Œä»…è´Ÿè´£å±•ç¤º
- âœ… é‡‡é›†å™¨è°ƒç”¨åç«¯APIï¼Œç§»é™¤é‡å¤é€»è¾‘
- âœ… æ•°æ®æ·»åŠ  `_computed_by: 'backend'` æ ‡è®°

**æ”¹è¿›æ•ˆæœ**:
- å‰ç«¯ä»£ç è¡Œæ•°: 47è¡Œ â†’ 25è¡Œ (â†“47%)
- é‡‡é›†å™¨ä»£ç è¡Œæ•°: 47è¡Œ â†’ 35è¡Œ (â†“26%)
- ç»´æŠ¤ç‚¹æ•°é‡: 3å¤„ â†’ 1å¤„
- æ•°æ®ä¸€è‡´æ€§: 100%

**Gitæäº¤**: `8413205`, `d921727`

### 3. ä»·æ ¼ä½ç½®é¢„è­¦ç³»ç»Ÿ (Price Position Warning)
**URL**: https://5000-xxx.sandbox.novita.ai/price-position  
**é—®é¢˜**: éœ€è¦ç¡®è®¤æ˜¯å¦ä¾èµ–å‰ç«¯è®¡ç®—  
**ç»“è®º**: âœ… ç³»ç»Ÿå·²ç»å®Œå…¨å®ç°åç«¯è®¡ç®—æ¶æ„

**æ¶æ„ç¡®è®¤**:
- âœ… åç«¯API `/api/signal-timeline/computed-peaks` å®Œæˆæ‰€æœ‰è®¡ç®—
- âœ… 24hæœ€é«˜ç‚¹å’Œ2hæ³¢å³°è¯†åˆ«åœ¨åç«¯å®Œæˆ
- âœ… signal_stats_collector æ¯3åˆ†é’Ÿç”ŸæˆJSONLé¢„è®¡ç®—æ–‡ä»¶
- âœ… å‰ç«¯å‡½æ•° `updateChartSellSignalsBackend` å’Œ `updateChartBuySignalsBackend` ä»…è´Ÿè´£å›¾è¡¨æ¸²æŸ“
- âœ… æ‰€æœ‰APIè¯·æ±‚æ·»åŠ é˜²ç¼“å­˜å‚æ•°

**ç³»ç»Ÿç‰ˆæœ¬**: v2.0.5 â†’ v2.0.6

---

## ğŸ¯ ç»Ÿä¸€æ¶æ„åŸåˆ™

### æ•°æ®æµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯è®¡ç®—æ¶æ„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ç¬¬1å±‚ï¼šæ•°æ®é‡‡é›†ã€‘
  PM2è¿›ç¨‹/Pythoné‡‡é›†å™¨
  â”œâ”€ ç‹¬ç«‹è¿è¡Œï¼Œä¸æµè§ˆå™¨æ— å…³
  â”œâ”€ å®šæ—¶é‡‡é›†åŸå§‹æ•°æ®
  â””â”€ å­˜å‚¨: JSONLæ–‡ä»¶æˆ–SQLiteæ•°æ®åº“
      â†“
ã€ç¬¬2å±‚ï¼šé¢„è®¡ç®—/ç»Ÿè®¡ã€‘
  PM2è¿›ç¨‹/ç»Ÿè®¡é‡‡é›†å™¨
  â”œâ”€ è¯»å–åŸå§‹æ•°æ®
  â”œâ”€ è®¡ç®—æ»šåŠ¨çª—å£ç»Ÿè®¡ï¼ˆ24h/2hï¼‰
  â”œâ”€ ç­›é€‰è¿‡æ»¤ï¼ˆå¦‚>80%ï¼‰
  â””â”€ å­˜å‚¨: JSONLé¢„è®¡ç®—æ–‡ä»¶
      â†“
ã€ç¬¬3å±‚ï¼šåç«¯APIã€‘
  Flask APIæœåŠ¡
  â”œâ”€ è¯»å–JSONLé¢„è®¡ç®—æ•°æ®
  â”œâ”€ å®Œæˆæ‰€æœ‰ä¸šåŠ¡é€»è¾‘è®¡ç®—
  â”‚  â”œâ”€ å³°å€¼è¯†åˆ«
  â”‚  â”œâ”€ è¶‹åŠ¿åˆ†æ
  â”‚  â””â”€ ç­›é€‰æ’åº
  â”œâ”€ æ·»åŠ é˜²ç¼“å­˜å“åº”å¤´
  â””â”€ è¿”å›å®Œæ•´è®¡ç®—ç»“æœ
      â†“
ã€ç¬¬4å±‚ï¼šå‰ç«¯å±•ç¤ºã€‘
  ç½‘é¡µå‰ç«¯
  â”œâ”€ è°ƒç”¨APIè·å–æ•°æ®
  â”œâ”€ é›¶ä¸šåŠ¡è®¡ç®—
  â”œâ”€ ä»…è´Ÿè´£å›¾è¡¨æ¸²æŸ“å’ŒUIå±•ç¤º
  â””â”€ æ·»åŠ é˜²ç¼“å­˜å‚æ•°
```

### æ ¸å¿ƒä¿è¯

1. **åç«¯ç‹¬ç«‹è¿è¡Œ**
   - é‡‡é›†å™¨ä¸æµè§ˆå™¨æ— å…³
   - å…³é—­æµè§ˆå™¨ä¸å½±å“æ•°æ®é‡‡é›†
   - æ•°æ®æŒä¹…åŒ–å­˜å‚¨

2. **å‰ç«¯é›¶è®¡ç®—**
   - æ‰€æœ‰ä¸šåŠ¡é€»è¾‘åœ¨åç«¯å®Œæˆ
   - å‰ç«¯ä»…è´Ÿè´£å±•ç¤º
   - ä»£ç ç®€æ´é«˜æ•ˆ

3. **æ•°æ®ä¸€è‡´æ€§**
   - å•ä¸€æ•°æ®æº
   - ç»Ÿä¸€è®¡ç®—é€»è¾‘
   - 100%ä¸€è‡´æ€§ä¿è¯

4. **é˜²ç¼“å­˜æœºåˆ¶**
   - å‰ç«¯: `?_t=Date.now()` + `cache: 'no-store'`
   - åç«¯: `Cache-Control`, `Pragma`, `Expires` å“åº”å¤´

---

## ğŸ“ˆ æ”¹è¿›æ•ˆæœæ€»ç»“

| ç³»ç»Ÿ | æ”¹è¿›æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|---------|--------|--------|------|
| 27å¸è¿½è¸ª | æµè§ˆå™¨ç¼“å­˜ | âœ— å¯ç”¨ | âœ“ å®Œå…¨ç¦ç”¨ | - |
| 27å¸è¿½è¸ª | æ•°æ®å®æ—¶æ€§ | âœ— å¯èƒ½è¿‡æ—¶ | âœ“ å§‹ç»ˆæœ€æ–° | - |
| SARåå‘ | å‰ç«¯ä»£ç è¡Œæ•° | 47è¡Œ | 25è¡Œ | â†“47% |
| SARåå‘ | é‡‡é›†å™¨ä»£ç è¡Œæ•° | 47è¡Œ | 35è¡Œ | â†“26% |
| SARåå‘ | ç»´æŠ¤ç‚¹æ•°é‡ | 3å¤„ | 1å¤„ | â†“67% |
| SARåå‘ | æ•°æ®ä¸€è‡´æ€§ | âŒ å¯èƒ½ä¸ä¸€è‡´ | âœ“ 100%ä¸€è‡´ | +100% |
| SARåå‘ | å‰ç«¯è®¡ç®—æ—¶é—´ | ~50ms | 0ms | â†“100% |
| ä»·æ ¼ä½ç½® | åç«¯è®¡ç®— | âœ“ å·²å®ç° | âœ“ å·²ç¡®è®¤ | - |
| ä»·æ ¼ä½ç½® | æ•°æ®ä¸€è‡´æ€§ | âœ“ 100%ä¸€è‡´ | âœ“ 100%ä¸€è‡´ | - |

---

## ğŸ”§ æŠ€æœ¯å®æ–½ç»†èŠ‚

### é˜²ç¼“å­˜å®ç°

**å‰ç«¯ä»£ç **:
```javascript
// æ‰€æœ‰APIè¯·æ±‚æ·»åŠ æ—¶é—´æˆ³å‚æ•°
const timestamp = Date.now();
const response = await fetch(`/api/xxx?_t=${timestamp}`, {
    cache: 'no-store'
});
```

**åç«¯ä»£ç **:
```python
# Flask APIå“åº”å¤´
response.headers['Cache-Control'] = 'no-store, no-cache, must-revalidate, max-age=0'
response.headers['Pragma'] = 'no-cache'
response.headers['Expires'] = '0'
```

### åç«¯è®¡ç®—ç¤ºä¾‹

**SARåå‘ç³»ç»Ÿ - åç«¯API**:
```python
@app.route('/api/sar-slope/bias-ratios')
def api_sar_bias_ratios():
    # è¯»å–æ‰€æœ‰å¸ç§çš„SARæ•°æ®
    for symbol in SYMBOLS:
        # è®¡ç®—bullish_ratioå’Œbearish_ratio
        bullish_ratio = (bullish_count / 24) * 100
        bearish_ratio = (bearish_count / 24) * 100
        
        # åç«¯ç­›é€‰ >80%
        if bullish_ratio > 80:
            bullish_symbols.append({
                'symbol': symbol,
                'ratio': bullish_ratio
            })
        if bearish_ratio > 80:
            bearish_symbols.append({
                'symbol': symbol,
                'ratio': bearish_ratio
            })
    
    # æ’åº
    bullish_symbols.sort(key=lambda x: x['ratio'], reverse=True)
    bearish_symbols.sort(key=lambda x: x['ratio'], reverse=True)
    
    return jsonify({
        'bullish_symbols': bullish_symbols,
        'bearish_symbols': bearish_symbols,
        'bullish_count': len(bullish_symbols),
        'bearish_count': len(bearish_symbols),
        'threshold': 80
    })
```

**å‰ç«¯ä»£ç ï¼ˆç®€åŒ–åï¼‰**:
```javascript
async function loadCurrentBiasStats() {
    const resp = await fetch(`/api/sar-slope/bias-ratios?_t=${Date.now()}`, {
        cache: 'no-store'
    });
    const data = await resp.json();
    
    // ç›´æ¥ä½¿ç”¨åç«¯è®¡ç®—ç»“æœï¼Œæ— éœ€ç­›é€‰
    document.getElementById('currentBullish').textContent = data.bullish_count;
    document.getElementById('currentBearish').textContent = data.bearish_count;
    updateSymbolLists(data.bullish_symbols, data.bearish_symbols);
}
```

---

## ğŸ“ Git æäº¤è®°å½•

```bash
# 27å¸è¿½è¸ªç³»ç»Ÿ - ç¼“å­˜ä¿®å¤
70240f9 - fix: Prevent browser caching of coin change tracker data
6eb5e0c - docs: Add comprehensive documentation for browser cache fix

# SARåå‘ç³»ç»Ÿ - åç«¯è®¡ç®—è¿ç§»
8413205 - fix: Move SAR bias calculations from frontend to backend
d921727 - docs: Add comprehensive documentation for SAR bias backend calculation migration

# æ–‡æ¡£æ›´æ–° - æ‰€æœ‰ä¸‰ä¸ªç³»ç»Ÿ
a78967c - docs: Add backend calculation migration descriptions to all three systems
```

---

## âœ… æ£€æŸ¥æ¸…å•

- [x] 27å¸è¿½è¸ªç³»ç»Ÿï¼šç¦ç”¨ç¼“å­˜ï¼Œæ·»åŠ åˆ·æ–°æŒ‰é’®
- [x] SARåå‘ç³»ç»Ÿï¼šåç«¯ç»Ÿä¸€è®¡ç®—ï¼Œå‰ç«¯ä»…å±•ç¤º
- [x] ä»·æ ¼ä½ç½®ç³»ç»Ÿï¼šç¡®è®¤åç«¯æ¶æ„ï¼Œæ·»åŠ æ–‡æ¡£è¯´æ˜
- [x] æ‰€æœ‰ç³»ç»Ÿï¼šæ·»åŠ æ›´æ–°è¯´æ˜åˆ°ç½‘é¡µæ–‡æ¡£
- [x] æ‰€æœ‰ç³»ç»Ÿï¼šæ›´æ–°ç‰ˆæœ¬å·
- [x] Gitæäº¤ï¼šæ‰€æœ‰æ”¹åŠ¨å·²æäº¤
- [x] æ–‡æ¡£ç”Ÿæˆï¼šå®Œæ•´æŠ€æœ¯æ–‡æ¡£å·²ç”Ÿæˆ

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### ç”¨æˆ·ä¾§
1. ç³»ç»Ÿä¼šæ¯60ç§’è‡ªåŠ¨åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
2. å¦‚éœ€ç«‹å³æŸ¥çœ‹æœ€æ–°æ•°æ®ï¼Œç‚¹å‡»"åˆ·æ–°æ•°æ®"æŒ‰é’®ï¼ˆ27å¸ç³»ç»Ÿï¼‰
3. åç«¯é‡‡é›†å™¨æŒç»­è¿è¡Œï¼Œå³ä½¿å…³é—­æµè§ˆå™¨æ•°æ®ä¹Ÿä¼šæŒç»­é‡‡é›†
4. æ‰€æœ‰æ•°æ®å±•ç¤ºéƒ½æ˜¯æœ€æ–°çš„ï¼Œä¸ä¼šå› æµè§ˆå™¨ç¼“å­˜è€Œè¿‡æ—¶

### å¼€å‘ä¾§
1. æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å¿…é¡»åœ¨åç«¯APIå®ç°
2. å‰ç«¯åªè´Ÿè´£è°ƒç”¨APIå’Œå±•ç¤ºæ•°æ®
3. æ–°å¢åŠŸèƒ½æ—¶éµå¾ª"åç«¯è®¡ç®—ã€å‰ç«¯å±•ç¤º"åŸåˆ™
4. æ‰€æœ‰APIå“åº”å¿…é¡»æ·»åŠ é˜²ç¼“å­˜å“åº”å¤´
5. é‡‡é›†å™¨åº”è°ƒç”¨åç«¯APIï¼Œé¿å…é‡å¤é€»è¾‘

---

## ğŸ“§ æŠ€æœ¯æ”¯æŒ

- **ç³»ç»ŸçŠ¶æ€**: æ‰€æœ‰é‡‡é›†å™¨æ­£å¸¸è¿è¡Œ
- **æ•°æ®æ›´æ–°**: 3-5åˆ†é’Ÿè‡ªåŠ¨é‡‡é›†ä¸€æ¬¡
- **é¡µé¢åˆ·æ–°**: 60ç§’è‡ªåŠ¨åˆ·æ–°
- **æ¶æ„åŸåˆ™**: åç«¯è®¡ç®—ã€å‰ç«¯å±•ç¤ºã€æ•°æ®ä¸€è‡´

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2026-02-16  
**æœ€åæ›´æ–°**: Git commit `a78967c`
