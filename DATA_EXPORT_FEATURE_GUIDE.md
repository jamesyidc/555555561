# 数据导出功能说明

**版本**: v6.1 (20260223-DATA-EXPORT)  
**日期**: 2026-02-23  
**功能**: 导出完整1天的27币涨跌幅数据

---

## 🎯 功能概述

在27币涨跌幅追踪系统中添加了**"导出数据"**按钮，可以一键导出当前查看日期的**完整1天数据**（从00:00到23:59）为CSV格式文件。

---

## 📍 按钮位置

位于页面顶部日期选择器旁边：

```
[← 前一天] [日期选择器] [后一天 →] [今天] [📥 导出数据]
```

**橙色按钮**，点击即可导出当前日期的完整数据。

---

## 📊 导出的数据内容

### 基础字段
- **时间**: 精确到秒（HH:MM:SS格式）
- **总涨跌幅(%)**: 27个币种涨跌幅之和
- **累计涨跌幅(%)**: 从当天0点开始的累计涨跌幅
- **上涨占比(%)**: 上涨币种占总数的百分比
- **上涨币种数**: 当前上涨的币种数量
- **下跌币种数**: 当前下跌的币种数量
- **币种数量**: 统计的总币种数（通常为27）

### 27个币种的详细数据
每个币种包含3个字段：
1. **{币种}_当前价**: 当前价格（USDT）
2. **{币种}_基准价**: 当天0点的基准价格
3. **{币种}_涨跌幅(%)**: 相对基准价的涨跌幅

**币种列表**（共27个）:
- BTC, ETH, BNB, XRP, DOGE
- SOL, DOT, MATIC, LTC, LINK
- HBAR, TAO, CFX, TRX, TON
- NEAR, LDO, CRO, ETC, XLM
- BCH, UNI, SUI, FIL, STX
- CRV, AAVE, APT

---

## 💾 文件格式

### 文件名
```
27币涨跌幅数据_2026-02-22.csv
```
格式：`27币涨跌幅数据_{日期}.csv`

### 文件编码
- **UTF-8 with BOM**: 确保Excel能正确显示中文
- **CSV格式**: 逗号分隔，可用Excel/Google Sheets直接打开

### 数据量
- **每天约1440条记录**（每分钟1条）
- **文件大小**: 约500KB-1MB（取决于数据量）
- **列数**: 7个基础列 + 27×3=81个币种列 = **88列**

---

## 📝 CSV表头示例

```csv
时间,总涨跌幅(%),累计涨跌幅(%),上涨占比(%),上涨币种数,下跌币种数,币种数量,BTC_当前价,BTC_基准价,BTC_涨跌幅(%),ETH_当前价,ETH_基准价,ETH_涨跌幅(%),...
00:00:23,-0.52,-0.52,44.4,12,15,27,67659.600000,67659.600000,0.00,1952.890000,1952.890000,0.00,...
00:01:45,-1.23,-1.23,40.7,11,16,27,67580.200000,67659.600000,-0.12,1948.500000,1952.890000,-0.22,...
...
```

---

## 🎯 使用场景

### 1. 数据分析
- 使用Excel/Python/R进行深度数据分析
- 绘制自定义图表
- 统计分析（均值、标准差、相关性等）

### 2. 历史回测
- 导出多天数据进行策略回测
- 分析历史趋势和规律
- 验证交易信号准确性

### 3. 机器学习
- 作为训练数据集
- 特征工程
- 模型验证

### 4. 报告生成
- 生成日报、周报、月报
- 数据可视化
- 投资决策支持

---

## 🚀 使用方法

### 步骤1: 选择日期
使用日期选择器或前一天/后一天按钮选择要导出的日期。

### 步骤2: 等待数据加载
确保页面已加载完成，图表正常显示。

### 步骤3: 点击导出
点击橙色的**"导出数据"**按钮。

### 步骤4: 保存文件
浏览器会自动下载CSV文件，保存到默认下载目录。

### 步骤5: 打开文件
使用Excel、Google Sheets或其他工具打开CSV文件。

---

## 📊 Excel打开示例

1. **双击打开** CSV文件（Excel会自动识别）
2. 或**导入数据**:
   - Excel → 数据 → 从文本/CSV → 选择文件
   - 编码选择：UTF-8
   - 分隔符：逗号

3. **数据验证**:
   - 检查列数：应为88列
   - 检查行数：应约为1440行（完整1天）
   - 检查中文：应正常显示（不乱码）

---

## ⚠️ 注意事项

### 数据完整性
- ✅ **导出的是当前页面加载的数据**
- ✅ 如果页面显示240条（4小时），需先加载完整数据
- ✅ 建议导出前确认页面已完全加载
- ✅ 查看历史日期时，会自动加载该日期的完整数据

### 数据质量
- **缺失数据**: 如果某个时间点数据缺失，对应行不会出现
- **异常值**: 数据直接来自API，未做过滤
- **时间戳**: 以北京时间（UTC+8）为准

### 性能建议
- **大量导出**: 如需导出多天数据，请分别导出
- **文件大小**: 单个文件约1MB，不会影响浏览器性能
- **导出频率**: 无限制，可随时导出

---

## 🔍 数据验证

### 验证方法
```python
import pandas as pd

# 读取CSV
df = pd.read_csv('27币涨跌幅数据_2026-02-22.csv', encoding='utf-8')

# 基本信息
print(f"记录数: {len(df)}")  # 应约为1440
print(f"列数: {len(df.columns)}")  # 应为88
print(f"时间范围: {df['时间'].min()} ~ {df['时间'].max()}")

# 检查数据完整性
print(f"缺失值: {df.isnull().sum().sum()}")
print(f"总涨跌幅范围: {df['总涨跌幅(%)'].min():.2f}% ~ {df['总涨跌幅(%)'].max():.2f}%")
```

---

## 📈 数据分析示例

### Python分析
```python
import pandas as pd
import matplotlib.pyplot as plt

# 读取数据
df = pd.read_csv('27币涨跌幅数据_2026-02-22.csv', encoding='utf-8')

# 绘制总涨跌幅曲线
plt.figure(figsize=(15, 6))
plt.plot(df['时间'], df['总涨跌幅(%)'], label='总涨跌幅')
plt.xlabel('时间')
plt.ylabel('涨跌幅 (%)')
plt.title('27币涨跌幅之和 - 2026-02-22')
plt.xticks(rotation=45)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# 统计分析
print(f"平均涨跌幅: {df['总涨跌幅(%)'].mean():.2f}%")
print(f"最大涨幅: {df['总涨跌幅(%)'].max():.2f}%")
print(f"最大跌幅: {df['总涨跌幅(%)'].min():.2f}%")
print(f"波动幅度: {df['总涨跌幅(%)'].std():.2f}%")
```

### Excel分析
1. **透视表**: 汇总每小时平均涨跌幅
2. **图表**: 插入折线图显示趋势
3. **条件格式**: 高亮显示涨跌幅>±5%的时刻
4. **筛选**: 筛选特定币种的数据

---

## 🛠️ 技术细节

### 前端实现
- **JavaScript函数**: `exportCurrentDayData()`
- **数据来源**: 全局变量 `historyData`（从API加载）
- **文件生成**: Blob API + 动态创建下载链接

### 数据格式
- **UTF-8 BOM**: `\uFEFF` 前缀，确保Excel识别
- **数字精度**: 
  - 价格：6位小数
  - 涨跌幅：2位小数
  - 占比：1位小数

### 错误处理
- 数据为空：提示"暂无数据可导出"
- 导出失败：显示错误信息
- 成功导出：按钮变绿2秒，显示"导出成功"

---

## 📞 常见问题

### Q1: 为什么导出的数据少于1440条？
**A**: 可能原因：
- 数据采集中断
- 该日期不是完整的一天
- 页面初始只加载了240条（4小时），需要加载完整数据

### Q2: Excel打开后中文乱码怎么办？
**A**: 
1. 文件已包含UTF-8 BOM，应该不会乱码
2. 如果乱码，请使用"数据 → 从文本导入"，选择UTF-8编码
3. 或使用Google Sheets打开（自动识别UTF-8）

### Q3: 可以导出多天数据吗？
**A**: 
- 单次只能导出当前查看的一天
- 如需多天，请切换日期后分别导出
- 然后在Excel中合并多个CSV文件

### Q4: 数据和页面显示的不一致？
**A**: 
- 确认已等待页面完全加载
- 检查是否选择了正确的日期
- 尝试刷新页面后重新导出

### Q5: 可以自定义导出的列吗？
**A**: 
- 当前版本导出全部列
- 可在Excel中删除不需要的列
- 或使用Python/R进行二次处理

---

## 🎉 总结

### 功能特点
- ✅ **一键导出**：无需手动复制粘贴
- ✅ **完整数据**：1天1440条记录全部导出
- ✅ **格式友好**：CSV格式，Excel直接打开
- ✅ **中文支持**：UTF-8 BOM，无乱码
- ✅ **数据丰富**：88列，包含所有关键信息
- ✅ **即时反馈**：导出成功有提示

### 适用场景
- 📊 数据分析与可视化
- 📈 历史回测与策略验证
- 🤖 机器学习模型训练
- 📄 报告生成与决策支持

---

**功能版本**: v6.1  
**更新时间**: 2026-02-23 21:30 UTC  
**访问地址**: https://9002-iqxevtl2lr766c6a5nrjk-d0b9e1e2.sandbox.novita.ai/coin-change-tracker
