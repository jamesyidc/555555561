<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ææ…Œæ¸…æ´—æŒ‡æ•° - åŠ å¯†è´§å¸æ•°æ®åˆ†æ v2.9-è‡ªå®šä¹‰æ ‡ç­¾</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #1e2139;
            color: #fff;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .top-nav {
            background: #2a2d47;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            justify-content: space-between;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .home-btn {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #fff;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }
        
        .home-btn:hover {
            background: linear-gradient(135deg, #0099ff 0%, #00d4ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }
        
        .nav-title {
            font-size: 18px;
            font-weight: 500;
            color: #fff;
        }
        
        /* å½“å‰æ•°æ®ç»Ÿè®¡æ  */
        .stats-bar {
            background: #2a2d47;
            padding: 15px 20px;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            border-bottom: 1px solid #3a3d5c;
            font-size: 13px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .stat-label {
            color: #8b92b8;
            font-size: 12px;
        }
        
        .stat-value {
            color: #fff;
            font-weight: 600;
            font-size: 20px;
        }
        
        .stat-value.green {
            color: #10b981;
        }
        
        .stat-value.yellow {
            color: #fbbf24;
        }
        
        .stat-value.red {
            color: #ef4444;
        }
        
        .stat-sublabel {
            color: #6b7280;
            font-size: 11px;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: #2a2d47;
            padding: 20px;
            margin: 0;
            border-bottom: 1px solid #3a3d5c;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 500;
            color: #fff;
        }
        
        /* åˆ†é¡µæ§åˆ¶å™¨ */
        .pagination-controls {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .page-btn {
            background: #3a3d5c;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #4a4d6c;
            transform: translateY(-2px);
        }
        
        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .page-info {
            color: #00d4ff;
            font-size: 13px;
            font-weight: 600;
            padding: 6px 12px;
            background: #1e2139;
            border-radius: 6px;
            border: 1px solid #3a3d5c;
        }
        
        .date-picker-input {
            color: #00d4ff;
            font-size: 13px;
            font-weight: 600;
            padding: 6px 12px;
            background: #1e2139;
            border-radius: 6px;
            border: 1px solid #3a3d5c;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 140px;
            text-align: center;
        }
        
        .date-picker-input:hover {
            background: #2a2d4a;
            border-color: #00d4ff;
        }
        
        .date-picker-input::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.8) sepia(1) saturate(5) hue-rotate(175deg);
        }
        
        #panicChart {
            width: 100%;
            height: 400px;
        }
        
        /* æ—¶é—´æŸ¥è¯¢å·¥å…· */
        .time-query-box {
            background: #1e2139;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .time-query-label {
            color: #8b92b8;
            font-size: 14px;
            font-weight: 500;
        }
        
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-input {
            background: #2a2d47;
            border: 1px solid #3a3d5c;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            min-width: 150px;
        }
        
        .time-input:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        .query-btn {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: #fff;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .query-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }
        
        .reset-btn {
            background: #3a3d5c;
            color: #fff;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .reset-btn:hover {
            background: #4a4d6c;
        }
        
        .query-result {
            color: #00d4ff;
            font-size: 14px;
            margin-left: 10px;
        }
        
        /* å†å²æ•°æ®è¡¨æ ¼ */
        .history-container {
            background: #2a2d47;
            padding: 20px;
            border-bottom: 1px solid #3a3d5c;
        }
        
        .history-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .history-table thead {
            background: #1e2139;
        }
        
        .history-table th {
            padding: 10px;
            text-align: left;
            color: #8b92b8;
            font-weight: 500;
            border-bottom: 1px solid #3a3d5c;
        }
        
        .history-table td {
            padding: 10px;
            border-bottom: 1px solid #3a3d5c;
        }
        
        .history-table tbody tr:hover {
            background: #1e2139;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #8b92b8;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .stats-bar {
                gap: 15px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            #panicChart {
                height: 300px;
            }
        }
        
        /* æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ */
        .time-range-select {
            background: #1e2139;
            color: #fff;
            border: 1px solid #3a3d5c;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-range-select:hover {
            border-color: #00d4ff;
            background: #2a2d47;
        }
        
        .time-range-select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }
        
        /* åˆ·æ–°æŒ‡ç¤ºå™¨åŠ¨ç”» */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="top-nav">
            <div class="nav-left">
                <a href="/" class="home-btn">
                    <span>ğŸ </span>
                    <span>è¿”å›é¦–é¡µ</span>
                </a>
                <div class="nav-title">âš¡ ææ…Œæ¸…æ´—æŒ‡æ•°</div>
            </div>
        </div>
        
        <!-- å½“å‰æ•°æ®ç»Ÿè®¡æ  -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-label">ææ…Œæ¸…æ´—æŒ‡æ•°</div>
                <div class="stat-value" id="currentIndex">--</div>
                <div class="stat-sublabel" id="currentLevel">--</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">1å°æ—¶çˆ†ä»“é‡‘é¢</div>
                <div class="stat-value" id="hour1Amount">--</div>
                <div class="stat-sublabel">ä¸‡ç¾å…ƒ</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">24å°æ—¶çˆ†ä»“é‡‘é¢</div>
                <div class="stat-value" id="hour24Amount">--</div>
                <div class="stat-sublabel">ä¸‡ç¾å…ƒ</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">24å°æ—¶çˆ†ä»“äººæ•°</div>
                <div class="stat-value" id="currentPeople">--</div>
                <div class="stat-sublabel">ä¸‡äºº</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">å…¨ç½‘æŒä»“é‡</div>
                <div class="stat-value" id="currentPosition">--</div>
                <div class="stat-sublabel">äº¿ç¾å…ƒ</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">æœ€åæ›´æ–°</div>
                <div class="stat-value" id="updateTime" style="font-size: 16px;">--</div>
                <div class="stat-sublabel" style="display: flex; align-items: center; gap: 5px;">
                    <span>æ¯1åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°</span>
                    <span id="refreshIndicator" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #4ade80;"></span>
                </div>
            </div>
        </div>
        
        <!-- ç³»ç»Ÿè¯´æ˜æ–‡æ¡£é¢æ¿ -->
        <div style="max-width: 100%; margin: 0 auto 20px; background: #2a2d47; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px; cursor: pointer;" onclick="togglePanicDocPanel()">
                <h2 style="font-size: 20px; font-weight: 700; color: #fff; display: flex; align-items: center; justify-content: space-between; margin: 0;">
                    <span>
                        <i class="fas fa-book" style="margin-right: 8px;"></i>
                        ğŸ“– ææ…Œæ¸…æ´—æŒ‡æ•°ç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£
                    </span>
                    <i class="fas fa-chevron-down" style="transition: transform 0.3s;" id="panicDocPanelIcon"></i>
                </h2>
            </div>
            <div style="display: none; padding: 24px; background: #1e2139;" id="panicDocPanelContent">
                <div style="display: flex; flex-direction: column; gap: 24px;">
                    
                    <!-- ç³»ç»Ÿæ¦‚è¿° -->
                    <div style="background: #2a2d47; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                            <i class="fas fa-info-circle" style="color: #667eea; margin-right: 8px;"></i>
                            ç³»ç»Ÿæ¦‚è¿°
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 12px; font-size: 14px; color: #d1d5db;">
                            <p><strong style="color: #fff;">ç³»ç»Ÿåç§°ï¼š</strong>ææ…Œæ¸…æ´—æŒ‡æ•° (Panic Wash Index)</p>
                            <p><strong style="color: #fff;">ç³»ç»Ÿç‰ˆæœ¬ï¼š</strong>V2.9 (è‡ªå®šä¹‰æ ‡ç­¾ç‰ˆ)</p>
                            <p><strong style="color: #fff;">æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>å®æ—¶ç›‘æ§åŠ å¯†è´§å¸å¸‚åœºçš„çˆ†ä»“æ•°æ®å’Œææ…ŒæŒ‡æ•°</p>
                            <p><strong style="color: #fff;">æ•°æ®æºï¼š</strong>BTC126.com API (çœŸå®çˆ†ä»“æ•°æ® + æŒä»“é‡)</p>
                            <p><strong style="color: #fff;">æ›´æ–°é¢‘ç‡ï¼š</strong>æ¯2åˆ†é’Ÿè‡ªåŠ¨é‡‡é›†ä¸€æ¬¡çˆ†ä»“æ•°æ®</p>
                            <p><strong style="color: #fff;">é¡µé¢åˆ·æ–°ï¼š</strong>æ¯1åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°æ˜¾ç¤º</p>
                            <p><strong style="color: #fff;">ç›‘æ§å¸ç§ï¼š</strong>BTC, ETH, BNB, XRP, SOL (ä¸»è¦å¸ç§) + å…¨ç½‘æ•°æ®</p>
                        </div>
                    </div>

                    <!-- è¿è¡Œé€»è¾‘ä¸æµç¨‹ -->
                    <div style="background: #2a2d47; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; border-bottom: 2px solid #10b981; padding-bottom: 8px;">
                            <i class="fas fa-cogs" style="color: #10b981; margin-right: 8px;"></i>
                            è¿è¡Œé€»è¾‘ä¸æµç¨‹
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 16px; font-size: 14px; color: #d1d5db;">
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid #667eea;">
                                <h4 style="font-weight: 700; color: #667eea; margin-bottom: 8px;">ğŸ”„ æ•°æ®é‡‡é›†æµç¨‹ (æ¯2åˆ†é’Ÿ)</h4>
                                <ol style="list-style: decimal; padding-left: 24px; margin: 8px 0; line-height: 1.8;">
                                    <li><strong style="color: #fff;">è·å–çˆ†ä»“æ•°æ®ï¼š</strong>è°ƒç”¨ BTC126 API è·å– 1h/24h çˆ†ä»“é‡‘é¢å’Œäººæ•°</li>
                                    <li><strong style="color: #fff;">è·å–æŒä»“é‡ï¼š</strong>è°ƒç”¨ BTC126 API è·å–å…¨ç½‘æŒä»“é‡ (äº¿ç¾å…ƒ)</li>
                                    <li><strong style="color: #fff;">è·å–å¸ä»·æ•°æ®ï¼š</strong>ä» OKX API è·å– BTC/ETH/BNB/XRP/SOL å®æ—¶ä»·æ ¼å’Œæ¶¨è·Œå¹…</li>
                                    <li><strong style="color: #fff;">è®¡ç®—ææ…ŒæŒ‡æ•°ï¼š</strong>ç»¼åˆçˆ†ä»“é‡‘é¢ã€æŒä»“é‡ã€å¸‚åœºæ³¢åŠ¨è®¡ç®—ææ…ŒæŒ‡æ•° (0-1)</li>
                                    <li><strong style="color: #fff;">åˆ¤å®šé£é™©ç­‰çº§ï¼š</strong>æ ¹æ®æŒ‡æ•°åˆ’åˆ† low/medium/high/extreme å››ä¸ªç­‰çº§</li>
                                    <li><strong style="color: #fff;">å†™å…¥JSONLï¼š</strong>è¿½åŠ ä¸€è¡ŒJSONåˆ° <code>panic_wash_index.jsonl</code></li>
                                    <li><strong style="color: #fff;">ç­‰å¾…ä¸‹ä¸€è½®ï¼š</strong>ä¼‘çœ 2åˆ†é’Ÿåé‡å¤ä¸Šè¿°æµç¨‹</li>
                                </ol>
                            </div>
                            
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid #10b981;">
                                <h4 style="font-weight: 700; color: #10b981; margin-bottom: 8px;">ğŸ“Š å‰ç«¯æ˜¾ç¤ºæµç¨‹</h4>
                                <ol style="list-style: decimal; padding-left: 24px; margin: 8px 0; line-height: 1.8;">
                                    <li><strong style="color: #fff;">åˆå§‹åŠ è½½ï¼š</strong>è°ƒç”¨ <code>/api/panic/history</code> è·å–æœ€è¿‘æ•°æ® (é»˜è®¤500æ¡)</li>
                                    <li><strong style="color: #fff;">åˆ†é¡µå±•ç¤ºï¼š</strong>æŒ‰æ—¶é—´å€’åºåˆ†é¡µæ˜¾ç¤º (æ¯é¡µ100æ¡ï¼Œçº¦3.3å°æ—¶)</li>
                                    <li><strong style="color: #fff;">å›¾è¡¨æ¸²æŸ“ï¼š</strong>ECharts 5.4.3 ç»˜åˆ¶ææ…ŒæŒ‡æ•°å’Œçˆ†ä»“é‡‘é¢åŒæ›²çº¿</li>
                                    <li><strong style="color: #fff;">è‡ªåŠ¨åˆ·æ–°ï¼š</strong>æ¯60ç§’è°ƒç”¨ API æ›´æ–°æœ€æ–°æ•°æ®ç‚¹</li>
                                    <li><strong style="color: #fff;">è‡ªå®šä¹‰æ ‡ç­¾ï¼š</strong>ç”¨æˆ·å¯åœ¨å›¾è¡¨ä¸Šæ·»åŠ /ç¼–è¾‘/åˆ é™¤æ–‡å­—æ ‡æ³¨</li>
                                    <li><strong style="color: #fff;">LocalStorage æŒä¹…åŒ–ï¼š</strong>æ ‡ç­¾æ•°æ®ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨</li>
                                </ol>
                            </div>
                            
                            <div style="background: rgba(251, 191, 36, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid #fbbf24;">
                                <h4 style="font-weight: 700; color: #fbbf24; margin-bottom: 8px;">ğŸ§® ææ…ŒæŒ‡æ•°è®¡ç®—å…¬å¼</h4>
                                <div style="background: #1e2139; padding: 12px; border-radius: 6px; border: 1px solid #3a3d5c; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;">
                                    <p><strong style="color: #fff;">å…¬å¼ï¼š</strong></p>
                                    <p style="margin-left: 16px;">panic_index = (liquidation_1h / 10000) Ã— (liquidation_24h / 1000000) Ã— adjustment_factor</p>
                                    <p style="margin-top: 8px;"><strong style="color: #fff;">é£é™©ç­‰çº§åˆ’åˆ†ï¼š</strong></p>
                                    <p style="margin-left: 16px;">â€¢ panic_index < 0.3 â†’ <span style="color: #10b981;">low (ä½é£é™©)</span></p>
                                    <p style="margin-left: 16px;">â€¢ 0.3 â‰¤ panic_index < 0.6 â†’ <span style="color: #fbbf24;">medium (ä¸­é£é™©)</span></p>
                                    <p style="margin-left: 16px;">â€¢ 0.6 â‰¤ panic_index < 0.85 â†’ <span style="color: #f97316;">high (é«˜é£é™©)</span></p>
                                    <p style="margin-left: 16px;">â€¢ panic_index â‰¥ 0.85 â†’ <span style="color: #ef4444;">extreme (æç«¯é£é™©)</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- JSONLæ•°æ®æ ¼å¼ -->
                    <div style="background: #2a2d47; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; border-bottom: 2px solid #8b5cf6; padding-bottom: 8px;">
                            <i class="fas fa-database" style="color: #8b5cf6; margin-right: 8px;"></i>
                            JSONL æ•°æ®å­˜å‚¨æ ¼å¼
                        </h3>
                        
                        <div style="display: flex; flex-direction: column; gap: 16px; font-size: 14px;">
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #fff; margin-bottom: 8px;">ğŸ“‚ å­˜å‚¨è·¯å¾„</h4>
                                <div style="background: #1e2139; padding: 12px; border-radius: 6px; border: 1px solid #3a3d5c; font-family: 'Courier New', monospace; font-size: 12px; color: #d1d5db;">
                                    <p><strong>æ•°æ®ç›®å½•ï¼š</strong>/home/user/webapp/data/panic_jsonl/</p>
                                    <p><strong>æ•°æ®æ–‡ä»¶ï¼š</strong>panic_wash_index.jsonl (å•æ–‡ä»¶æŒç»­è¿½åŠ )</p>
                                    <p><strong>å¤‡ä»½æ–‡ä»¶ï¼š</strong>panic_wash_index.jsonl.backup_YYYYMMDD_HHMMSS</p>
                                    <p><strong>ç¤ºä¾‹ï¼š</strong>panic_wash_index.jsonl, panic_wash_index.jsonl.backup_20260211_083959</p>
                                </div>
                            </div>
                            
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #fff; margin-bottom: 8px;">ğŸ“‹ æ•°æ®æ ¼å¼ (panic_wash_index.jsonl)</h4>
                                <div style="color: #d1d5db; margin-bottom: 8px;">
                                    <p><strong>æ ¼å¼ï¼š</strong>JSONL (æ¯è¡Œä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡)</p>
                                    <p><strong>å­—æ®µè¯´æ˜ï¼š</strong></p>
                                </div>
                                <div style="background: #1e2139; padding: 12px; border-radius: 6px; border: 1px solid #3a3d5c; font-family: 'Courier New', monospace; font-size: 12px; overflow-x: auto; color: #d1d5db;">
                                    <pre style="margin: 0; white-space: pre-wrap;">{
  "timestamp": 1769908320000,                 // Unixæ—¶é—´æˆ³ (æ¯«ç§’)
  "beijing_time": "2026-02-01 09:12:00",     // åŒ—äº¬æ—¶é—´å­—ç¬¦ä¸²
  "panic_index": 0.3123970628475203,         // ææ…ŒæŒ‡æ•° (0-1)
  "level": "medium",                          // é£é™©ç­‰çº§: low/medium/high/extreme
  "liquidation_data": {                       // çˆ†ä»“ç›¸å…³æ•°æ®
    "liquidation_1h": 674.87,                // 1å°æ—¶çˆ†ä»“é‡‘é¢ (ä¸‡ç¾å…ƒ)
    "liquidation_24h": 79361.15,             // 24å°æ—¶çˆ†ä»“é‡‘é¢ (ä¸‡ç¾å…ƒ)
    "liquidation_count_24h": 23.54,          // 24å°æ—¶çˆ†ä»“äººæ•° (ä¸‡äºº)
    "open_interest": 75.37                   // å…¨ç½‘æŒä»“é‡ (äº¿ç¾å…ƒ)
  }
}</pre>
                                </div>
                            </div>
                            
                            <div style="background: rgba(239, 68, 68, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid #ef4444;">
                                <h4 style="font-weight: 700; color: #ef4444; margin-bottom: 8px;">âš ï¸ æ•°æ®å¤‡ä»½ä¸æ¸…ç†</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li><strong style="color: #fff;">è‡ªåŠ¨å¤‡ä»½ï¼š</strong>ç³»ç»Ÿåœ¨é‡è¦æ“ä½œå‰è‡ªåŠ¨åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„å¤‡ä»½æ–‡ä»¶</li>
                                    <li><strong style="color: #fff;">æ‰‹åŠ¨å¤‡ä»½ï¼š</strong>å®šæœŸå¤‡ä»½ <code>data/panic_jsonl/</code> ç›®å½•åˆ° <code>/mnt/aidrive/panic_history_backup/</code></li>
                                    <li><strong style="color: #fff;">æ–‡ä»¶å¤§å°ï¼š</strong>æ¯å¤©çº¦ç”Ÿæˆ 720æ¡è®°å½• Ã— 2åˆ†é’Ÿ/æ¡ â‰ˆ 200KB</li>
                                    <li><strong style="color: #fff;">æ•°æ®æ¸…ç†ï¼š</strong>ä¸è‡ªåŠ¨æ¸…ç†ï¼Œæ‰€æœ‰å†å²æ•°æ®æ°¸ä¹…ä¿ç•™</li>
                                    <li><strong style="color: #fff;">å†å²æŸ¥è¯¢ï¼š</strong>å‰ç«¯æ”¯æŒåˆ†é¡µå’Œæ—¥æœŸèŒƒå›´æŸ¥è¯¢</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ç³»ç»ŸåŠŸèƒ½è¯¦è§£ -->
                    <div style="background: #2a2d47; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; border-bottom: 2px solid #fbbf24; padding-bottom: 8px;">
                            <i class="fas fa-star" style="color: #fbbf24; margin-right: 8px;"></i>
                            ç³»ç»ŸåŠŸèƒ½è¯¦è§£
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; font-size: 14px;">
                            <div style="background: rgba(102, 126, 234, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #667eea; margin-bottom: 8px;">ğŸ“Š åŒæ›²çº¿å›¾è¡¨å¯è§†åŒ–</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>ææ…ŒæŒ‡æ•°æ›²çº¿ (0-1åŒºé—´)</li>
                                    <li>1å°æ—¶çˆ†ä»“é‡‘é¢æ›²çº¿ (ä¸‡ç¾å…ƒ)</li>
                                    <li>åŠ¨æ€é¢œè‰²åŒºåŸŸåˆ’åˆ† (é£é™©ç­‰çº§)</li>
                                    <li>é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†æ•°æ®</li>
                                    <li>æ—¶é—´è½´è‡ªåŠ¨é€‚é… (2åˆ†é’Ÿé—´éš”)</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #10b981; margin-bottom: 8px;">ğŸ“ è‡ªå®šä¹‰æ ‡ç­¾ç³»ç»Ÿ</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>ç‚¹å‡»å›¾è¡¨ä»»æ„ä½ç½®æ·»åŠ æ ‡æ³¨</li>
                                    <li>åŒå‡»æ ‡ç­¾ç¼–è¾‘æ–‡å­—å†…å®¹</li>
                                    <li>æ‹–æ‹½æ ‡ç­¾è°ƒæ•´ä½ç½®</li>
                                    <li>å³é”®åˆ é™¤ä¸éœ€è¦çš„æ ‡ç­¾</li>
                                    <li>LocalStorage æœ¬åœ°æŒä¹…åŒ–</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(251, 191, 36, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #fbbf24; margin-bottom: 8px;">ğŸ”„ åˆ†é¡µä¸å¯¼èˆª</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>ææ…ŒæŒ‡æ•°åˆ†é¡µ (æ¯é¡µ100æ¡)</li>
                                    <li>çˆ†ä»“é‡‘é¢æ—¥æœŸå¯¼èˆª (å‰ä¸€å¤©/åä¸€å¤©)</li>
                                    <li>å¿«é€Ÿè¿”å›ä»Šå¤©æŒ‰é’®</li>
                                    <li>å½“å‰é¡µç å’Œæ€»é¡µæ•°æç¤º</li>
                                    <li>åŠ è½½çŠ¶æ€å‹å¥½æç¤º</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(239, 68, 68, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #ef4444; margin-bottom: 8px;">âš¡ å®æ—¶æ•°æ®ç»Ÿè®¡</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>å½“å‰ææ…ŒæŒ‡æ•° + é£é™©ç­‰çº§</li>
                                    <li>1å°æ—¶çˆ†ä»“é‡‘é¢ (ä¸‡ç¾å…ƒ)</li>
                                    <li>24å°æ—¶çˆ†ä»“é‡‘é¢ (ä¸‡ç¾å…ƒ)</li>
                                    <li>24å°æ—¶çˆ†ä»“äººæ•° (ä¸‡äºº)</li>
                                    <li>å…¨ç½‘æŒä»“é‡ (äº¿ç¾å…ƒ)</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #8b5cf6; margin-bottom: 8px;">ğŸ¯ æ€§èƒ½ä¼˜åŒ–</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>å¢é‡æ•°æ®æ›´æ–° (ä»…åŠ è½½æ–°æ•°æ®)</li>
                                    <li>åˆ†é¡µåŠ è½½é¿å…å¡é¡¿</li>
                                    <li>Canvas æ¸²æŸ“é«˜æ€§èƒ½å›¾è¡¨</li>
                                    <li>æœ¬åœ°ç¼“å­˜å‡å°‘ API è°ƒç”¨</li>
                                    <li>é˜²æŠ–èŠ‚æµä¼˜åŒ–äº¤äº’</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(236, 72, 153, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #ec4899; margin-bottom: 8px;">ğŸŒ å¤šç»´åº¦æ•°æ®å±•ç¤º</h4>
                                <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>ææ…ŒæŒ‡æ•°å†å²è¶‹åŠ¿</li>
                                    <li>1å°æ—¶çˆ†ä»“é‡‘é¢å†å²æ›²çº¿</li>
                                    <li>å¤šä¸ªå¸ç§ä»·æ ¼ç›‘æ§ (BTC/ETHç­‰)</li>
                                    <li>å…¨ç½‘æŒä»“é‡å˜åŒ–ç›‘æ§</li>
                                    <li>é£é™©ç­‰çº§é¢œè‰²æ ‡è¯†</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- PM2 è¿›ç¨‹ä¸è·¯ç”± API -->
                    <div style="background: #2a2d47; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; border-bottom: 2px solid #06b6d4; padding-bottom: 8px;">
                            <i class="fas fa-server" style="color: #06b6d4; margin-right: 8px;"></i>
                            PM2 è¿›ç¨‹ä¸è·¯ç”± API
                        </h3>
                        
                        <div style="display: flex; flex-direction: column; gap: 16px; font-size: 14px;">
                            <div style="background: rgba(6, 182, 212, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #fff; margin-bottom: 8px;">ğŸ”§ PM2 è¿›ç¨‹é…ç½®</h4>
                                <div style="background: #1e2139; padding: 12px; border-radius: 6px; border: 1px solid #3a3d5c; font-family: 'Courier New', monospace; font-size: 12px; color: #d1d5db;">
                                    <p><strong>è¿›ç¨‹åï¼š</strong>panic-collector</p>
                                    <p><strong>è„šæœ¬è·¯å¾„ï¼š</strong>source_code/panic_wash_collector.py</p>
                                    <p><strong>Pythonç‰ˆæœ¬ï¼š</strong>python3</p>
                                    <p><strong>å·¥ä½œç›®å½•ï¼š</strong>/home/user/webapp</p>
                                    <p><strong>è‡ªåŠ¨é‡å¯ï¼š</strong>true</p>
                                    <p><strong>å†…å­˜é™åˆ¶ï¼š</strong>200M</p>
                                    <p><strong>æ—¥å¿—ä½ç½®ï¼š</strong></p>
                                    <p style="margin-left: 16px;">â€¢ é”™è¯¯æ—¥å¿—: logs/panic-collector-error.log</p>
                                    <p style="margin-left: 16px;">â€¢ è¾“å‡ºæ—¥å¿—: logs/panic-collector-out.log</p>
                                </div>
                                <div style="margin-top: 12px; background: #1e2139; padding: 12px; border-radius: 6px; border: 1px solid #3a3d5c;">
                                    <p style="color: #fff; font-weight: 700; margin-bottom: 8px;">PM2 ç®¡ç†å‘½ä»¤ï¼š</p>
                                    <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #d1d5db; line-height: 1.8;">
                                        <p>â€¢ æŸ¥çœ‹çŠ¶æ€: <code>pm2 status panic-collector</code></p>
                                        <p>â€¢ æŸ¥çœ‹æ—¥å¿—: <code>pm2 logs panic-collector --lines 50</code></p>
                                        <p>â€¢ é‡å¯è¿›ç¨‹: <code>pm2 restart panic-collector</code></p>
                                        <p>â€¢ åœæ­¢è¿›ç¨‹: <code>pm2 stop panic-collector</code></p>
                                        <p>â€¢ å¯åŠ¨è¿›ç¨‹: <code>pm2 start ecosystem.config.js --only panic-collector</code></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: rgba(6, 182, 212, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #fff; margin-bottom: 8px;">ğŸŒ Flask API è·¯ç”±</h4>
                                <div style="background: #1e2139; padding: 12px; border-radius: 6px; border: 1px solid #3a3d5c; font-family: 'Courier New', monospace; font-size: 12px; color: #d1d5db; line-height: 1.8;">
                                    <p><strong style="color: #10b981;">GET</strong> /api/panic/latest</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">è·å–æœ€æ–°çš„ææ…ŒæŒ‡æ•°æ•°æ®ç‚¹</p>
                                    
                                    <p style="margin-top: 8px;"><strong style="color: #10b981;">GET</strong> /api/panic/history</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">è·å–å†å²æ•°æ® (é»˜è®¤æœ€è¿‘500æ¡)</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">å‚æ•°: ?limit=500&offset=0</p>
                                    
                                    <p style="margin-top: 8px;"><strong style="color: #10b981;">GET</strong> /api/panic/history-range</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">è·å–æŒ‡å®šæ—¥æœŸèŒƒå›´çš„æ•°æ®</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">å‚æ•°: ?start=2026-02-01&end=2026-02-11</p>
                                    
                                    <p style="margin-top: 8px;"><strong style="color: #10b981;">GET</strong> /api/panic/hour1-curve</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">è·å–1å°æ—¶çˆ†ä»“é‡‘é¢æ›²çº¿æ•°æ®</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">å‚æ•°: ?date=2026-02-11 (å¯é€‰)</p>
                                    
                                    <p style="margin-top: 8px;"><strong style="color: #10b981;">GET</strong> /api/panic/30d-stats</p>
                                    <p style="margin-left: 16px; color: #9ca3af;">è·å–æœ€è¿‘30å¤©ç»Ÿè®¡æ•°æ®</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç³»ç»Ÿä¾èµ–ä¸éƒ¨ç½² -->
                    <div style="background: #2a2d47; border-radius: 8px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; border-bottom: 2px solid #f97316; padding-bottom: 8px;">
                            <i class="fas fa-cube" style="color: #f97316; margin-right: 8px;"></i>
                            ç³»ç»Ÿä¾èµ–ä¸éƒ¨ç½²
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; font-size: 14px;">
                            <div style="background: rgba(249, 115, 22, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #f97316; margin-bottom: 8px;">ğŸ Python ä¾èµ–</h4>
                                <ul style="list-style: none; padding-left: 0; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>â€¢ Python 3.8+</li>
                                    <li>â€¢ requests (HTTPå®¢æˆ·ç«¯)</li>
                                    <li>â€¢ pytz (æ—¶åŒºå¤„ç†)</li>
                                    <li>â€¢ Flask 3.1.2 (Webæ¡†æ¶)</li>
                                    <li>â€¢ pathlib (è·¯å¾„æ“ä½œ)</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(249, 115, 22, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #f97316; margin-bottom: 8px;">ğŸ“¦ ç³»ç»ŸæœåŠ¡</h4>
                                <ul style="list-style: none; padding-left: 0; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li><strong style="color: #fff;">Flask APIï¼š</strong>ç«¯å£ 5000</li>
                                    <li><strong style="color: #fff;">æ•°æ®é‡‡é›†ï¼š</strong>Python å®šæ—¶è„šæœ¬ (PM2 å®ˆæŠ¤)</li>
                                    <li><strong style="color: #fff;">æ•°æ®å­˜å‚¨ï¼š</strong>JSONL æ–‡ä»¶ç³»ç»Ÿ</li>
                                    <li><strong style="color: #fff;">å‰ç«¯æ¡†æ¶ï¼š</strong>ECharts 5.4.3</li>
                                    <li><strong style="color: #fff;">è¿›ç¨‹ç®¡ç†ï¼š</strong>PM2 (è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†)</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(249, 115, 22, 0.1); padding: 16px; border-radius: 8px;">
                                <h4 style="font-weight: 700; color: #f97316; margin-bottom: 8px;">ğŸš€ éƒ¨ç½²æ£€æŸ¥æ¸…å•</h4>
                                <ul style="list-style: none; padding-left: 0; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                    <li>âœ… PM2 è¿›ç¨‹è¿è¡Œæ­£å¸¸</li>
                                    <li>âœ… Flask API 5000ç«¯å£å¯è®¿é—®</li>
                                    <li>âœ… æ•°æ®ç›®å½•æƒé™æ­£ç¡®</li>
                                    <li>âœ… JSONL æ–‡ä»¶å¯å†™å…¥</li>
                                    <li>âœ… BTC126 API å¯è®¿é—®</li>
                                    <li>âœ… æ—¥å¿—æ–‡ä»¶æ­£å¸¸è¾“å‡º</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div style="margin-top: 16px; background: rgba(239, 68, 68, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid #ef4444;">
                            <h4 style="font-weight: 700; color: #ef4444; margin-bottom: 8px;">âš ï¸ æ•…éšœæ’æŸ¥æŒ‡å—</h4>
                            <ul style="list-style: disc; padding-left: 24px; margin: 8px 0; line-height: 1.8; color: #d1d5db;">
                                <li>æ•°æ®ä¸æ›´æ–° â†’ æ£€æŸ¥ PM2 è¿›ç¨‹çŠ¶æ€: <code>pm2 status panic-collector</code></li>
                                <li>APIè¿”å›é”™è¯¯ â†’ æŸ¥çœ‹ Flask æ—¥å¿—: <code>pm2 logs flask-app</code></li>
                                <li>å›¾è¡¨ä¸æ˜¾ç¤º â†’ å¼ºåˆ¶åˆ·æ–°é¡µé¢: Ctrl+F5 æˆ– Cmd+Shift+R</li>
                                <li>çˆ†ä»“æ•°æ®ä¸º0 â†’ BTC126 APIå¯èƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œç­‰å¾…è‡ªåŠ¨æ¢å¤</li>
                                <li>æ ‡ç­¾ä¸¢å¤± â†’ æ£€æŸ¥æµè§ˆå™¨ LocalStorage æ˜¯å¦è¢«æ¸…é™¤</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        
        <script>
        function togglePanicDocPanel() {
            const content = document.getElementById('panicDocPanelContent');
            const icon = document.getElementById('panicDocPanelIcon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                localStorage.setItem('panicDocPanelOpen', 'true');
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                localStorage.setItem('panicDocPanelOpen', 'false');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ¢å¤é¢æ¿çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            const isOpen = localStorage.getItem('panicDocPanelOpen');
            if (isOpen === 'true') {
                const content = document.getElementById('panicDocPanelContent');
                const icon = document.getElementById('panicDocPanelIcon');
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            }
        });
        </script>
        
        <!-- æ›²çº¿å›¾ -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">ğŸ“ˆ ææ…Œæ¸…æ´—æŒ‡æ•°è¶‹åŠ¿ <span style="font-size: 12px; color: #00d4ff;">[v2.1]</span></div>
                
                <!-- åˆ†é¡µæ§åˆ¶å™¨ï¼ˆå³ä¸Šè§’ï¼‰ -->
                <div class="pagination-controls">
                    <button class="page-btn" id="prevPageBtn" onclick="loadPreviousPage()" title="æŸ¥çœ‹æ›´æ—©çš„æ•°æ®">
                        <span>â—€</span>
                    </button>
                    <div class="page-info" id="pageInfo">åŠ è½½ä¸­...</div>
                    <button class="page-btn" id="nextPageBtn" onclick="loadNextPage()" title="æŸ¥çœ‹æ›´æ–°çš„æ•°æ®">
                        <span>â–¶</span>
                    </button>
                </div>
            </div>
            
            <div id="panicChart"></div>
            <div id="debugInfo" style="font-size: 11px; color: #6b7280; margin-top: 10px; text-align: center;">
                æ­£åœ¨åŠ è½½æ•°æ®...
            </div>
        </div>
        
        <!-- 1å°æ—¶çˆ†ä»“é‡‘é¢æ›²çº¿å›¾ -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">ğŸ’¥ 1å°æ—¶çˆ†ä»“é‡‘é¢æ›²çº¿å›¾ <span style="font-size: 12px; color: #fbbf24;">[å®æ—¶è¿½è¸ª]</span></div>
                
                <!-- æ—¥æœŸå¯¼èˆªæ§åˆ¶å™¨ -->
                <div class="pagination-controls">
                    <button class="page-btn" id="liqPrevPageBtn" onclick="loadLiquidationPreviousDate()" title="å‰ä¸€å¤©">
                        <span>â—€ å‰ä¸€å¤©</span>
                    </button>
                    <input type="date" id="liqDatePicker" class="date-picker-input" 
                           min="2026-02-01" 
                           onchange="loadLiquidationByDatePicker()" 
                           title="ç‚¹å‡»é€‰æ‹©æ—¥æœŸ (å¯é€‰èŒƒå›´: 2026-02-01 è‡³ä»Š)">
                    <div class="page-info" id="liqDateDisplay" style="display: none;">2æœˆ11æ—¥</div>
                    <button class="page-btn" id="liqNextPageBtn" onclick="loadLiquidationNextDate()" title="åä¸€å¤©">
                        <span>åä¸€å¤© â–¶</span>
                    </button>
                    <button class="page-btn" onclick="loadLiquidationToday()" title="å›åˆ°ä»Šå¤©" style="margin-left: 10px;">
                        <span>ä»Šå¤©</span>
                    </button>
                </div>
            </div>
            <div style="position: relative; width: 100%; height: 400px;">
                <div id="liquidation1hChart" style="width: 100%; height: 100%;"></div>
                <!-- è‡ªå®šä¹‰çˆ†ä»“é‡‘é¢æ ‡ç­¾ -->
                <div id="customMarkPointLabel" style="
                    position: absolute;
                    display: none;
                    background: #fbbf24;
                    color: #000000;
                    font-size: 20px;
                    font-weight: bold;
                    padding: 10px 15px;
                    border-radius: 8px;
                    border: 3px solid #000000;
                    box-shadow: 3px 3px 10px rgba(0,0,0,0.4);
                    z-index: 1000;
                    pointer-events: none;
                    white-space: nowrap;
                "></div>
            </div>
            <div style="font-size: 11px; color: #6b7280; margin-top: 10px; text-align: center;">
                æ•°æ®é‡‡é›†é¢‘ç‡: æ¯3åˆ†é’Ÿä¸€æ¬¡ | æ•°æ®æ¥æº: BTC126 API | å•ä½: ä¸‡ç¾å…ƒ | æŒ‰æ—¥æœŸæ˜¾ç¤º | æ”¯æŒå·¦å³ç¿»é¡µ
            </div>
        </div>
        

        <!-- å†å²æ•°æ®è¡¨æ ¼ -->
        <div class="history-container">
            <div class="history-title">ğŸ“‹ ææ…ŒæŒ‡æ•°å†å²è®°å½•</div>
            
            <!-- æ—¶é—´æŸ¥è¯¢å·¥å…· -->
            <div class="time-query-box">
                <span class="time-query-label">ğŸ” æ—¶é—´æŸ¥è¯¢ï¼š</span>
                <div class="time-input-group">
                    <input type="datetime-local" id="queryDateTime" class="time-input" placeholder="é€‰æ‹©æ—¥æœŸæ—¶é—´">
                    <button onclick="queryHistoryByTime()" class="query-btn">æŸ¥è¯¢</button>
                    <button onclick="resetQuery()" class="reset-btn">é‡ç½®</button>
                    <span id="queryResult" class="query-result"></span>
                </div>
            </div>
            
            <div id="loadingHistory" class="loading">æ­£åœ¨åŠ è½½å†å²æ•°æ®...</div>
            <table class="history-table" id="historyTable" style="display: none;">
                <thead>
                    <tr>
                        <th>è®°å½•æ—¶é—´</th>
                        <th>1hçˆ†ä»“ (ä¸‡$)</th>
                        <th>24hçˆ†ä»“ (äº¿$)</th>
                        <th>ææ…ŒæŒ‡æ•°</th>
                        <th>ç­‰çº§</th>
                        <th>çˆ†ä»“äººæ•° (ä¸‡äºº)</th>
                        <th>å…¨ç½‘æŒä»“ (äº¿$)</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
        
        <!-- 30æ—¥çˆ†ä»“æ•°æ®æ—¥å† -->
        <div class="history-container">
            <div class="history-title">ğŸ“… 30æ—¥çˆ†ä»“æ•°æ®æ—¥å†</div>
            <div id="loading30Days" class="loading">æ­£åœ¨åŠ è½½30æ—¥çˆ†ä»“æ•°æ®...</div>
            <table class="history-table" id="liquidation30Table" style="display: none;">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>å¤šå•çˆ†ä»“</th>
                        <th>ç©ºå•çˆ†ä»“</th>
                        <th>æ€»çˆ†ä»“</th>
                    </tr>
                </thead>
                <tbody id="liquidation30Body">
                </tbody>
            </table>
            <div class="stat-sublabel" id="liquidation30UpdateTime" style="margin-top: 10px; text-align: right;"></div>
        </div>
    </div>
    
    <script>
        let chart = null;
        let currentPage = 0;  // å½“å‰é¡µç ï¼ˆ0=æœ€æ–°æ—¥æœŸï¼‰
        let allData = [];     // æ‰€æœ‰å†å²æ•°æ®
        let dateGroups = [];  // æŒ‰æ—¥æœŸåˆ†ç»„çš„æ•°æ® [{date: '2026-02-11', records: [...]}]
        
        // æŒ‰æ—¥æœŸåˆ†ç»„æ•°æ®
        function groupDataByDate(data) {
            if (!data || data.length === 0) return [];
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const groups = {};
            data.forEach(item => {
                const date = item.record_time.split(' ')[0]; // YYYY-MM-DD
                if (!groups[date]) {
                    groups[date] = {
                        date: date,
                        records: []
                    };
                }
                groups[date].records.push(item);
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ—¥æœŸå€’åºæ’åˆ—ï¼ˆæœ€æ–°æ—¥æœŸåœ¨å‰ï¼‰
            const sortedGroups = Object.values(groups).sort((a, b) => {
                return b.date.localeCompare(a.date);
            });
            
            console.log(`ğŸ“… æŒ‰æ—¥æœŸåˆ†ç»„å®Œæˆ: å…±${sortedGroups.length}å¤©æ•°æ®`);
            sortedGroups.forEach(g => {
                console.log(`   ${g.date}: ${g.records.length}æ¡è®°å½•`);
            });
            
            return sortedGroups;
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const chartDom = document.getElementById('panicChart');
            chart = echarts.init(chartDom);
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: '#2a2d47',
                    borderColor: '#3a3d5c',
                    textStyle: {
                        color: '#fff'
                    },
                    formatter: function(params) {
                        let html = params[0].axisValue + '<br/>';
                        params.forEach(param => {
                            if (param.seriesName === 'ææ…Œæ¸…æ´—æŒ‡æ•°') {
                                html += param.marker + param.seriesName + ': ' + param.value.toFixed(2) + '%<br/>';
                            } else if (param.seriesName === 'å…¨ç½‘æŒä»“é‡') {
                                // æ ¼å¼åŒ–ä¸ºåˆç†çš„äº¿å•ä½æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
                                let valueInYi = param.value;
                                html += param.marker + param.seriesName + ': $' + valueInYi.toFixed(2) + 'äº¿<br/>';
                            }
                        });
                        return html;
                    }
                },
                legend: {
                    data: ['ææ…Œæ¸…æ´—æŒ‡æ•°', 'å…¨ç½‘æŒä»“é‡'],
                    top: 10,
                    textStyle: {
                        color: '#8b92b8'
                    }
                },
                grid: {
                    left: '3%',
                    right: '5%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: {
                        lineStyle: {
                            color: '#3a3d5c'
                        }
                    },
                    axisLabel: {
                        color: '#8b92b8',
                        rotate: 45,
                        fontSize: 10
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'ææ…ŒæŒ‡æ•° (%)',
                        position: 'left',
                        min: 9,
                        max: 13,
                        interval: 1,
                        nameTextStyle: {
                            color: '#3b7dff'
                        },
                        axisLine: {
                            lineStyle: {
                                color: '#3a3d5c'
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: '#3a3d5c'
                            }
                        },
                        axisLabel: {
                            color: '#3b7dff',
                            formatter: '{value}%'
                        }
                    },
                    {
                        type: 'value',
                        name: 'å…¨ç½‘æŒä»“ (äº¿$)',
                        position: 'right',
                        min: 90,
                        max: 100,
                        interval: 2,
                        nameTextStyle: {
                            color: '#10b981'
                        },
                        axisLine: {
                            lineStyle: {
                                color: '#3a3d5c'
                            }
                        },
                        axisLabel: {
                            color: '#10b981',
                            formatter: '${value}äº¿'
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                series: [
                    {
                        name: 'ææ…Œæ¸…æ´—æŒ‡æ•°',
                        type: 'line',
                        yAxisIndex: 0,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        data: [],
                        lineStyle: {
                            width: 2,
                            color: '#3b7dff'
                        },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [
                                    {
                                        offset: 0,
                                        color: 'rgba(59, 125, 255, 0.3)'
                                    },
                                    {
                                        offset: 1,
                                        color: 'rgba(59, 125, 255, 0.05)'
                                    }
                                ]
                            }
                        }
                    },
                    {
                        name: 'å…¨ç½‘æŒä»“é‡',
                        type: 'line',
                        yAxisIndex: 1,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        data: [],
                        lineStyle: {
                            width: 2,
                            color: '#10b981'
                        }
                    }
                ]
            };
            
            chart.setOption(option);
        }
        
        // åŠ è½½å½“å‰æ•°æ®
        async function loadCurrentData() {
            // æ˜¾ç¤ºåˆ·æ–°åŠ¨ç”»
            const indicator = document.getElementById('refreshIndicator');
            if (indicator) {
                indicator.style.background = '#fbbf24';  // é»„è‰²è¡¨ç¤ºæ­£åœ¨åˆ·æ–°
                indicator.style.animation = 'pulse 0.5s ease-in-out infinite';
            }
            
            try {
                const response = await fetch('/api/panic/latest?_=' + Date.now());
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // æ›´æ–°ç»Ÿè®¡æ 
                    const indexEl = document.getElementById('currentIndex');
                    indexEl.textContent = (data.panic_index * 100).toFixed(2) + '%';
                    
                    // è®¾ç½®é¢œè‰²
                    indexEl.className = 'stat-value ' + (data.level_color || 'green');
                    
                    document.getElementById('currentLevel').textContent = data.panic_level || '--';
                    // 1å°æ—¶çˆ†ä»“é‡‘é¢ï¼šä¸‡ç¾å…ƒ
                    document.getElementById('hour1Amount').textContent = '$' + data.hour_1_amount.toFixed(2);
                    // 24å°æ—¶çˆ†ä»“é‡‘é¢ï¼šä¸‡ç¾å…ƒ
                    document.getElementById('hour24Amount').textContent = '$' + data.hour_24_amount.toFixed(2);
                    // 24å°æ—¶çˆ†ä»“äººæ•°ï¼šä¸‡äºº
                    document.getElementById('currentPeople').textContent = data.hour_24_people.toFixed(2);
                    // å…¨ç½‘æŒä»“é‡ï¼šäº¿ç¾å…ƒ
                    document.getElementById('currentPosition').textContent = '$' + data.total_position.toFixed(2);
                    document.getElementById('updateTime').textContent = data.record_time.split(' ')[1];
                    
                    // åˆ·æ–°æˆåŠŸï¼Œæ˜¾ç¤ºç»¿è‰²
                    if (indicator) {
                        indicator.style.background = '#4ade80';  // ç»¿è‰²
                        indicator.style.animation = 'none';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å½“å‰æ•°æ®å¤±è´¥:', error);
                // åˆ·æ–°å¤±è´¥ï¼Œæ˜¾ç¤ºçº¢è‰²
                if (indicator) {
                    indicator.style.background = '#f87171';  // çº¢è‰²
                    indicator.style.animation = 'none';
                }
            }
        }
        
        // åŠ è½½å…¨éƒ¨å†å²æ•°æ®
        async function loadAllHistoryData() {
            try {
                // åŠ è½½å…¨éƒ¨å†å²æ•°æ®ï¼ˆå–æ¶ˆé™åˆ¶ä»¥æ”¯æŒæ‰€æœ‰å†å²æ—¥æœŸé€‰æ‹©ï¼‰
                const conn = await fetch('/api/panic/history?limit=10000&_=' + Date.now());
                const result = await conn.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    // è¿‡æ»¤æ‰åŒ…å«0å€¼çš„å¼‚å¸¸æ•°æ®ï¼ˆAPIå·²æŒ‰æ—¶é—´DESCæ’åºï¼Œæœ€æ–°çš„åœ¨å‰ï¼‰
                    allData = result.data.filter(item => {
                        return item.hour_1_amount > 0 && 
                               item.hour_24_amount > 0 && 
                               item.hour_24_people > 0 && 
                               item.total_position > 0;
                    }); // ä¿æŒAPIè¿”å›çš„é¡ºåºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                    
                    // æŒ‰æ—¥æœŸåˆ†ç»„
                    dateGroups = groupDataByDate(allData);
                    
                    const debugMsg = `æ•°æ®è¿‡æ»¤å®Œæˆ: æ€»æ•°æ®${result.data.length}æ¡, æœ‰æ•ˆæ•°æ®${allData.length}æ¡, æ—¥æœŸæ•°${dateGroups.length}å¤©`;
                    console.log(debugMsg);
                    document.getElementById('debugInfo').textContent = debugMsg + ' | é¡µé¢ç‰ˆæœ¬: v2.1';
                    document.getElementById('debugInfo').style.color = '#10b981';
                    
                    if (allData.length === 0) {
                        document.getElementById('debugInfo').textContent = 'âš ï¸ è­¦å‘Š: è¿‡æ»¤åæ— æœ‰æ•ˆæ•°æ®ï¼è¯·æ£€æŸ¥æ•°æ®é‡‡é›†ã€‚';
                        document.getElementById('debugInfo').style.color = '#ef4444';
                        console.error('No valid data after filtering!');
                        return;
                    }
                    
                    updateChartForCurrentPage();
                    updatePageInfo();
                } else {
                    document.getElementById('debugInfo').textContent = 'âŒ æ•°æ®åŠ è½½å¤±è´¥æˆ–æ— æ•°æ®';
                    document.getElementById('debugInfo').style.color = '#ef4444';
                }
            } catch (error) {
                console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', error);
                document.getElementById('debugInfo').textContent = 'âŒ åŠ è½½å¤±è´¥: ' + error.message;
                document.getElementById('debugInfo').style.color = '#ef4444';
            }
        }
        
        // æ›´æ–°å›¾è¡¨æ˜¾ç¤ºå½“å‰é¡µæ•°æ®ï¼ˆæŒ‰æ—¥æœŸï¼‰
        function updateChartForCurrentPage() {
            if (dateGroups.length === 0) return;
            
            // ç¡®ä¿é¡µç æœ‰æ•ˆ
            if (currentPage >= dateGroups.length) {
                currentPage = 0;
            }
            if (currentPage < 0) {
                currentPage = dateGroups.length - 1;
            }
            
            // è·å–å½“å‰æ—¥æœŸçš„æ‰€æœ‰æ•°æ®
            const currentGroup = dateGroups[currentPage];
            const pageData = currentGroup.records.sort((a, b) => {
                // æŒ‰æ—¶é—´å‡åºæ’åˆ—ï¼ˆä»æ—©åˆ°æ™šï¼‰
                return a.record_time.localeCompare(b.record_time);
            });
            
            console.log(`ğŸ“Š æ˜¾ç¤º ${currentGroup.date} çš„æ•°æ®ï¼Œå…± ${pageData.length} æ¡è®°å½•`);
            
            if (pageData.length === 0) return;
            
            // æå–å›¾è¡¨æ•°æ®
            const times = pageData.map(item => {
                const parts = item.record_time.split(' ');
                return parts[1].substring(0, 5); // HH:MM
            });
            const panicValues = pageData.map(item => parseFloat((item.panic_index * 100).toFixed(2)));
            const positionValues = pageData.map(item => parseFloat(item.total_position.toFixed(2)));
                    
            // å•æ—¥æ•°æ®ä¸éœ€è¦æ—¥æœŸè¾¹ç•Œçº¿
            const dateBoundaries = [];
            
            // åŠ¨æ€è®¡ç®—ææ…ŒæŒ‡æ•°Yè½´èŒƒå›´ï¼šæœ€ä½-1%ï¼Œæœ€é«˜+1%
            const panicNumbers = pageData.map(item => item.panic_index);
            const panicMin = Math.min(...panicNumbers);
            const panicMax = Math.max(...panicNumbers);
                    
            // ææ…ŒæŒ‡æ•°ï¼šæœ€ä½-1%ï¼Œæœ€é«˜+1%ï¼Œä¿ç•™å°æ•°
            const yAxisMin = (Math.floor(panicMin * 10) / 10) - 1;
            const yAxisMax = (Math.ceil(panicMax * 10) / 10) + 1;
            const yAxisInterval = 0.5;  // å›ºå®š0.5%åˆ»åº¦é—´éš”
            
            // Yè½´æ ‡ç­¾æ ¼å¼åŒ–ï¼Œä¿ç•™2ä½å°æ•°
            const yAxisFormatter = (value) => value.toFixed(2) + '%';
            
            // åŠ¨æ€è®¡ç®—å…¨ç½‘æŒä»“Yè½´èŒƒå›´ï¼šæœ€ä½-1äº¿ï¼Œæœ€é«˜+1äº¿
            const positionNumbers = pageData.map(item => item.total_position);
            const positionMin = Math.min(...positionNumbers);
            const positionMax = Math.max(...positionNumbers);
                    
            // å…¨ç½‘æŒä»“ï¼šæœ€ä½-1äº¿ï¼Œæœ€é«˜+1äº¿ï¼Œä¿ç•™å°æ•°
            const positionYMin = (Math.floor(positionMin * 10) / 10) - 1;
            const positionYMax = (Math.ceil(positionMax * 10) / 10) + 1;
            const positionYInterval = 0.5;  // å›ºå®š0.5äº¿åˆ»åº¦é—´éš”
            
            // Yè½´æ ‡ç­¾æ ¼å¼åŒ–ï¼Œä¿ç•™2ä½å°æ•°
            const positionYFormatter = (value) => value.toFixed(2) + 'äº¿';
            
            chart.setOption({
                xAxis: {
                    data: times
                },
                // æ·»åŠ æ—¥æœŸè¾¹ç•Œæ ‡è®°çº¿
                markLine: dateBoundaries.length > 0 ? {
                    silent: true,
                    data: dateBoundaries
                } : undefined,
                        yAxis: [
                            {
                                type: 'value',
                                name: 'ææ…ŒæŒ‡æ•° (%)',
                                position: 'left',
                                min: yAxisMin,
                                max: yAxisMax,
                                interval: yAxisInterval,
                                nameTextStyle: {
                                    color: '#3b7dff'
                                },
                                axisLine: {
                                    lineStyle: {
                                        color: '#3a3d5c'
                                    }
                                },
                                splitLine: {
                                    lineStyle: {
                                        color: '#3a3d5c'
                                    }
                                },
                                axisLabel: {
                                    color: '#3b7dff',
                                    formatter: function(value) {
                                        return value.toFixed(2) + '%';
                                    }
                                }
                            },
                            {
                                type: 'value',
                                name: 'å…¨ç½‘æŒä»“ (äº¿$)',
                                position: 'right',
                                min: positionYMin,
                                max: positionYMax,
                                interval: positionYInterval,
                                nameTextStyle: {
                                    color: '#10b981'
                                },
                                axisLine: {
                                    lineStyle: {
                                        color: '#3a3d5c'
                                    }
                                },
                                axisLabel: {
                                    color: '#10b981',
                                    formatter: function(value) {
                                        return '$' + value.toFixed(2) + 'äº¿';
                                    }
                                },
                                splitLine: {
                                    show: false
                                }
                            }
                        ],
                series: [
                    {
                        name: 'ææ…Œæ¸…æ´—æŒ‡æ•°',
                        data: panicValues,
                        markLine: dateBoundaries.length > 0 ? {
                            silent: true,
                            symbol: 'none',
                            data: dateBoundaries
                        } : undefined
                    },
                    {
                        name: 'å…¨ç½‘æŒä»“é‡',
                        data: positionValues
                    }
                ]
            });
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯ï¼ˆæ˜¾ç¤ºæ—¥æœŸï¼‰
        function updatePageInfo() {
            if (dateGroups.length === 0) {
                document.getElementById('pageInfo').textContent = 'æš‚æ— æ•°æ®';
                return;
            }
            
            // ç¡®ä¿é¡µç æœ‰æ•ˆ
            if (currentPage >= dateGroups.length) {
                currentPage = 0;
            }
            
            const currentGroup = dateGroups[currentPage];
            document.getElementById('pageInfo').textContent = `${currentGroup.date} (ç¬¬${currentPage + 1}/${dateGroups.length}å¤©)`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('prevPageBtn').disabled = (currentPage >= dateGroups.length - 1);
            document.getElementById('nextPageBtn').disabled = (currentPage <= 0);
        }
        
        // åŠ è½½ä¸Šä¸€é¡µï¼ˆæ›´æ—©çš„æ—¥æœŸï¼‰
        function loadPreviousPage() {
            if (currentPage < dateGroups.length - 1) {
                currentPage++;
                updateChartForCurrentPage();
                updatePageInfo();
            }
        }
        
        // åŠ è½½ä¸‹ä¸€é¡µï¼ˆæ›´æ–°çš„æ—¥æœŸï¼‰
        function loadNextPage() {
            if (currentPage > 0) {
                currentPage--;
                updateChartForCurrentPage();
                updatePageInfo();
            }
        }
        
        // åŠ è½½å†å²æ•°æ®å¹¶æ›´æ–°å›¾è¡¨ï¼ˆä¿ç•™ç”¨äºè¡¨æ ¼æ˜¾ç¤ºï¼‰
        async function loadHistoryData() {
            try {
                const conn = await fetch('/api/panic/history?limit=50');
                const result = await conn.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    // APIå·²æŒ‰æ—¶é—´DESCæ’åºï¼Œæœ€æ–°çš„åœ¨å‰ï¼Œç›´æ¥ä½¿ç”¨
                    const data = result.data;
                    
                    // æ›´æ–°è¡¨æ ¼
                    const tbody = document.getElementById('historyTableBody');
                    tbody.innerHTML = '';
                    
                    data.forEach(item => {
                        const tr = document.createElement('tr');
                        
                        let levelColor = 'green';
                        if (item.panic_index >= 5) levelColor = 'red';
                        else if (item.panic_index >= 2) levelColor = 'yellow';
                        
                        let levelText = 'ä½ææ…Œ';
                        if (item.panic_index >= 5) levelText = 'é«˜åº¦ææ…Œ';
                        else if (item.panic_index >= 2) levelText = 'ä¸­åº¦ææ…Œ';
                        
                        tr.innerHTML = `
                            <td>${item.record_time}</td>
                            <td>$${item.hour_1_amount.toFixed(2)}ä¸‡</td>
                            <td>$${item.hour_24_amount.toFixed(2)}ä¸‡</td>
                            <td><span class="${levelColor}" style="font-weight: 600;">${(item.panic_index * 100).toFixed(2)}%</span></td>
                            <td><span class="${levelColor}">${levelText}</span></td>
                            <td>${item.hour_24_people.toFixed(2)}ä¸‡äºº</td>
                            <td>${item.total_position.toFixed(2)}äº¿ç¾å…ƒ</td>
                        `;
                        
                        tbody.appendChild(tr);
                    });
                    
                    document.getElementById('loadingHistory').style.display = 'none';
                    document.getElementById('historyTable').style.display = 'table';
                }
            } catch (error) {
                console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', error);
                document.getElementById('loadingHistory').textContent = 'âŒ åŠ è½½å¤±è´¥: ' + error.message;
            }
        }
        
        // æ—¶é—´æŸ¥è¯¢åŠŸèƒ½
        let allHistoryData = [];  // å­˜å‚¨æ‰€æœ‰å†å²æ•°æ®
        
        async function queryHistoryByTime() {
            const dateTimeInput = document.getElementById('queryDateTime');
            const resultSpan = document.getElementById('queryResult');
            
            if (!dateTimeInput.value) {
                resultSpan.textContent = 'âš ï¸ è¯·é€‰æ‹©æŸ¥è¯¢æ—¶é—´';
                resultSpan.style.color = '#fbbf24';
                return;
            }
            
            // è½¬æ¢é€‰æ‹©çš„æ—¶é—´ä¸ºæŸ¥è¯¢æ ¼å¼
            const selectedDate = new Date(dateTimeInput.value);
            const queryTime = selectedDate.toISOString().slice(0, 16).replace('T', ' ');
            
            try {
                resultSpan.textContent = 'ğŸ” æŸ¥è¯¢ä¸­...';
                resultSpan.style.color = '#00d4ff';
                
                // æŸ¥è¯¢æŒ‡å®šæ—¶é—´é™„è¿‘çš„æ•°æ®ï¼ˆå‰å10æ¡ï¼‰
                const response = await fetch(`/api/panic/history?time=${encodeURIComponent(queryTime)}&limit=20`);
                const result = await response.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    // æ‰¾åˆ°æœ€æ¥è¿‘çš„è®°å½•
                    let closestRecord = result.data[0];
                    let minDiff = Math.abs(new Date(closestRecord.record_time) - selectedDate);
                    
                    result.data.forEach(item => {
                        const diff = Math.abs(new Date(item.record_time) - selectedDate);
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestRecord = item;
                        }
                    });
                    
                    // æ›´æ–°è¡¨æ ¼ï¼Œé«˜äº®åŒ¹é…çš„è®°å½•
                    const tbody = document.getElementById('historyTableBody');
                    tbody.innerHTML = '';
                    
                    result.data.forEach(item => {
                        const tr = document.createElement('tr');
                        const isMatch = item.record_time === closestRecord.record_time;
                        
                        let levelColor = 'green';
                        if (item.panic_index >= 5) levelColor = 'red';
                        else if (item.panic_index >= 2) levelColor = 'yellow';
                        
                        let levelText = 'ä½ææ…Œ';
                        if (item.panic_index >= 5) levelText = 'é«˜åº¦ææ…Œ';
                        else if (item.panic_index >= 2) levelText = 'ä¸­åº¦ææ…Œ';
                        
                        tr.innerHTML = `
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2); font-weight: 600;"' : ''}>${item.record_time}</td>
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2);"' : ''}>$${item.hour_1_amount.toFixed(2)}ä¸‡</td>
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2);"' : ''}>$${item.hour_24_amount.toFixed(2)}ä¸‡</td>
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2);"' : ''}><span class="${levelColor}" style="font-weight: 600;">${(item.panic_index * 100).toFixed(2)}%</span></td>
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2);"' : ''}><span class="${levelColor}">${levelText}</span></td>
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2);"' : ''}>${item.hour_24_people.toFixed(2)}ä¸‡äºº</td>
                            <td${isMatch ? ' style="background: rgba(0, 212, 255, 0.2);"' : ''}>${item.total_position.toFixed(2)}äº¿ç¾å…ƒ</td>
                        `;
                        
                        tbody.appendChild(tr);
                    });
                    
                    // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
                    const timeDiff = Math.abs(minDiff / 1000 / 60); // è½¬æ¢ä¸ºåˆ†é’Ÿ
                    if (timeDiff < 5) {
                        resultSpan.textContent = `âœ… æ‰¾åˆ°ç²¾ç¡®åŒ¹é…: ${closestRecord.record_time}`;
                        resultSpan.style.color = '#10b981';
                    } else {
                        resultSpan.textContent = `âœ… æ‰¾åˆ°æœ€è¿‘è®°å½•: ${closestRecord.record_time} (ç›¸å·®${timeDiff.toFixed(0)}åˆ†é’Ÿ)`;
                        resultSpan.style.color = '#fbbf24';
                    }
                    
                    // æ»šåŠ¨åˆ°åŒ¹é…çš„è®°å½•
                    document.getElementById('historyTable').scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    resultSpan.textContent = 'âŒ æœªæ‰¾åˆ°ç›¸å…³æ•°æ®';
                    resultSpan.style.color = '#ef4444';
                }
            } catch (error) {
                console.error('æŸ¥è¯¢å¤±è´¥:', error);
                resultSpan.textContent = 'âŒ æŸ¥è¯¢å¤±è´¥: ' + error.message;
                resultSpan.style.color = '#ef4444';
            }
        }
        
        // é‡ç½®æŸ¥è¯¢
        function resetQuery() {
            document.getElementById('queryDateTime').value = '';
            document.getElementById('queryResult').textContent = '';
            loadHistoryData();  // é‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®
        }
        
        // åŠ è½½30æ—¥çˆ†ä»“æ•°æ®
        async function load30DaysLiquidation() {
            try {
                const response = await fetch('/api/liquidation/30days');
                const result = await response.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    const tbody = document.getElementById('liquidation30Body');
                    tbody.innerHTML = '';
                    
                    result.data.forEach(item => {
                        const tr = document.createElement('tr');
                        
                        tr.innerHTML = `
                            <td>${item.date}</td>
                            <td style="color: #10b981;">$${item.long_amount}äº¿</td>
                            <td style="color: #ef4444;">$${item.short_amount}äº¿</td>
                            <td style="font-weight: 600;">$${item.total_amount}äº¿</td>
                        `;
                        
                        tbody.appendChild(tr);
                    });
                    
                    // æ˜¾ç¤ºæ›´æ–°æ—¶é—´
                    if (result.data[0].updated_at) {
                        document.getElementById('liquidation30UpdateTime').textContent = 
                            'æœ€åæ›´æ–°: ' + result.data[0].updated_at + ' (æ¯1å°æ—¶æ›´æ–°)';
                    }
                    
                    document.getElementById('loading30Days').style.display = 'none';
                    document.getElementById('liquidation30Table').style.display = 'table';
                } else {
                    document.getElementById('loading30Days').textContent = 'âŒ æš‚æ— 30æ—¥çˆ†ä»“æ•°æ®';
                }
            } catch (error) {
                console.error('åŠ è½½30æ—¥çˆ†ä»“æ•°æ®å¤±è´¥:', error);
                document.getElementById('loading30Days').textContent = 'âŒ åŠ è½½å¤±è´¥: ' + error.message;
            }
        }
        
        
        // ==================== 1å°æ—¶çˆ†ä»“é‡‘é¢å›¾è¡¨ï¼ˆä¿®æ”¹ç‰ˆï¼šæŒ‰æ—¥æœŸç¿»é¡µï¼‰ ====================
let liquidation1hChart = null;
let currentDate = new Date();  // å½“å‰æŸ¥çœ‹çš„æ—¥æœŸï¼ˆé»˜è®¤ä»Šå¤©ï¼‰
let liqAllData = [];  // å½“å¤©çš„æ‰€æœ‰æ•°æ®

function initLiquidation1hChart() {
    const chartDom = document.getElementById('liquidation1hChart');
    liquidation1hChart = echarts.init(chartDom);
    loadDataForCurrentDate();
}

// åŠ è½½å½“å‰æ—¥æœŸçš„æ•°æ®
async function loadDataForCurrentDate() {
    try {
        const dateStr = formatDateStr(currentDate);  // YYYY-MM-DD
        
        console.log(`ğŸ“Š åŠ è½½ ${dateStr} çš„1å°æ—¶çˆ†ä»“æ•°æ®...`);
        
        // ç»Ÿä¸€ä½¿ç”¨å†å²èŒƒå›´APIï¼ˆæ”¯æŒæ‰€æœ‰æ—¥æœŸï¼ŒåŒ…æ‹¬ä»Šå¤©ï¼‰
        console.log('  ä½¿ç”¨API: /api/panic/history-range');
        const response = await fetch(`/api/panic/history-range?start_date=${dateStr}&end_date=${dateStr}`);
        const result = await response.json();
        
        if (!result.success || !result.data || result.data.length === 0) {
            console.warn(`âš ï¸ ${dateStr} æš‚æ— æ•°æ®`);
            liquidation1hChart.setOption({
                title: {
                    text: `âš ï¸ ${dateStr} æš‚æ— æ•°æ®`,
                    left: 'center',
                    top: 'middle',
                    textStyle: {
                        color: '#6b7280',
                        fontSize: 16
                    }
                }
            });
            updateDateDisplay();
            return;
        }
        
        liqAllData = result.data;
        console.log(`âœ… åŠ è½½æˆåŠŸ: ${liqAllData.length}æ¡è®°å½•`);
        
        // æ›´æ–°å›¾è¡¨
        updateLiquidation1hChart();
        // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
        updateDateDisplay();
        
    } catch (error) {
        console.error('âŒ åŠ è½½1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®å¤±è´¥:', error);
    }
}

// æ›´æ–°å›¾è¡¨
function updateLiquidation1hChart() {
    if (!liqAllData || liqAllData.length === 0) {
        console.warn('âš ï¸ æ²¡æœ‰æ•°æ®å¯æ˜¾ç¤º');
        return;
    }
    
    // æå–æ—¶é—´å’Œé‡‘é¢
    const times = liqAllData.map(d => {
        // æå–æ—¶é—´éƒ¨åˆ† HH:MM
        const time = d.record_time.split(' ')[1];
        return time.substring(0, 5);
    });
    
    // 1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®
    const amounts = liqAllData.map(d => d.hour_1_amount);
    
    // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    const avgAmount = (amounts.reduce((a, b) => a + b, 0) / amounts.length).toFixed(2);
    const maxAmount = Math.max(...amounts);
    const minAmount = Math.min(...amounts);
    const maxIndex = amounts.indexOf(maxAmount);
    const maxTime = times[maxIndex];
    
    // æ—¥æœŸå­—ç¬¦ä¸²
    const dateStr = formatDateDisplay(currentDate);  // 2æœˆ11æ—¥
    
    // å›¾è¡¨é…ç½®
    const option = {
        backgroundColor: 'transparent',
        title: {
            text: `1å°æ—¶çˆ†ä»“é‡‘é¢èµ°åŠ¿ - ${dateStr}`,
            left: 'center',
            top: 10,
            textStyle: {
                color: '#e5e7eb',
                fontSize: 20,
                fontWeight: 'bold'
            },
            subtext: `å…±${liqAllData.length}æ¡æ•°æ® | å¹³å‡${avgAmount}ä¸‡ç¾å…ƒ | å³°å€¼${maxAmount.toFixed(2)}ä¸‡ç¾å…ƒ (${maxTime})`,
            subtextStyle: {
                color: '#9ca3af',
                fontSize: 14
            }
        },
        tooltip: {
            trigger: 'axis',
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            borderColor: '#00d4ff',
            textStyle: { color: '#fff', fontSize: 12 },
            formatter: function(params) {
                const p = params[0];
                return `
                    <div style="padding:8px;">
                        <div style="color:#00d4ff;font-weight:bold;margin-bottom:8px;font-size:14px;">${p.name}</div>
                        <div style="font-size:16px;">1hçˆ†ä»“: <span style="color:#fbbf24;font-weight:bold;">${p.value.toFixed(2)}ä¸‡ç¾å…ƒ</span></div>
                        <div style="font-size:13px;color:#9ca3af;margin-top:5px;">å¹³å‡: ${avgAmount}ä¸‡ç¾å…ƒ</div>
                    </div>
                `;
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '8%',
            top: '15%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: times,
            axisLabel: {
                color: '#e5e7eb',
                fontSize: 12,
                rotate: 45,
                interval: Math.floor(times.length / 20)  // æ˜¾ç¤ºçº¦20ä¸ªæ ‡ç­¾
            },
            axisLine: {
                lineStyle: { color: '#374151' }
            }
        },
        yAxis: {
            type: 'value',
            name: '1hçˆ†ä»“(ä¸‡ç¾å…ƒ)',
            min: 0,
            // è‡ªåŠ¨ç¼©æ”¾ï¼Œä¸å¼ºåˆ¶å›ºå®šæœ€å¤§å€¼
            nameTextStyle: {
                color: '#fbbf24',
                fontSize: 15,
                fontWeight: 'bold'
            },
            axisLabel: {
                color: '#e5e7eb',
                fontSize: 13,
                formatter: '{value}'
            },
            splitLine: {
                lineStyle: {
                    color: '#374151',
                    type: 'dashed'
                }
            }
        },
        series: [{
            name: '1å°æ—¶çˆ†ä»“é‡‘é¢',
            type: 'line',
            data: amounts,
            smooth: true,
            lineStyle: {
                width: 2,
                color: '#fbbf24'
            },
            itemStyle: {
                color: '#fbbf24'
            },
            areaStyle: {
                color: {
                    type: 'linear',
                    x: 0, y: 0, x2: 0, y2: 1,
                    colorStops: [
                        { offset: 0, color: 'rgba(251, 191, 36, 0.4)' },
                        { offset: 1, color: 'rgba(251, 191, 36, 0.05)' }
                    ]
                }
            },
            showSymbol: false,
            markPoint: {
                data: [
                    { 
                        type: 'max', 
                        name: 'å³°å€¼', 
                        itemStyle: { 
                            color: '#ef4444',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: function(params) {
                                return 'ğŸ”¥ ' + params.value.toFixed(2) + 'ä¸‡ç¾å…ƒ';
                            },
                            color: '#fff',
                            fontSize: 14,
                            fontWeight: 'bold',
                            backgroundColor: 'rgba(239, 68, 68, 0.9)',
                            padding: [8, 12],
                            borderRadius: 6,
                            borderColor: '#fff',
                            borderWidth: 2
                        }
                    }
                ]
            },
            markLine: {
                silent: true,
                data: (function() {
                    const lines = [];
                    
                    // å¹³å‡çº¿
                    lines.push({
                        yAxis: avgAmount,
                        lineStyle: {
                            color: '#10b981',
                            type: 'dashed',
                            width: 1
                        },
                        label: {
                            formatter: 'å¹³å‡: {c}ä¸‡ç¾å…ƒ',
                            position: 'insideEndTop',
                            color: '#10b981',
                            fontSize: 11
                        }
                    });
                    
                    // åŠ¨æ€æ·»åŠ å‚è€ƒçº¿ï¼ˆåªæ·»åŠ åœ¨æ•°æ®èŒƒå›´å†…çš„ï¼‰
                    const referenceLines = [
                        { value: 5000, label: '5000ä¸‡', color: '#6b7280' },   // ç°è‰²
                        { value: 10000, label: '10000ä¸‡', color: '#6b7280' }, // ç°è‰²
                        { value: 15000, label: '15000ä¸‡', color: '#6b7280' }  // ç°è‰²
                    ];
                    
                    // åªæ·»åŠ å°äºç­‰äºæœ€å¤§å€¼çš„å‚è€ƒçº¿
                    referenceLines.forEach(ref => {
                        if (ref.value <= maxAmount * 1.1) {  // ç•™10%ä½™é‡
                            lines.push({
                                yAxis: ref.value,
                                lineStyle: {
                                    color: ref.color,
                                    type: 'dashed',  // è™šçº¿
                                    width: 1,        // ç»†çº¿
                                    opacity: 0.5     // åŠé€æ˜
                                },
                                label: {
                                    formatter: ref.label,
                                    position: 'insideEndTop',
                                    color: ref.color,
                                    fontSize: 10,
                                    opacity: 0.7
                                }
                            });
                        }
                    });
                    
                    return lines;
                })()
            }
        }]
    };
    
    liquidation1hChart.setOption(option);
}

// å‰ä¸€å¤©
async function loadLiquidationPreviousDate() {
    // æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘å‰ç¿»ï¼ˆæœ€æ—©2026-02-01ï¼‰
    const minDate = new Date('2026-02-01T00:00:00');
    const prevDate = new Date(currentDate);
    prevDate.setDate(prevDate.getDate() - 1);
    
    if (prevDate < minDate) {
        alert('å·²ç»æ˜¯æœ€æ—©æ—¥æœŸäº†ï¼ˆ2026-02-01ï¼‰');
        return;
    }
    
    currentDate = prevDate;
    await loadDataForCurrentDate();
    updateNavigationButtons();
}

// åä¸€å¤©
async function loadLiquidationNextDate() {
    // è·å–æœåŠ¡å™¨å½“å‰æ—¥æœŸ
    let today = new Date();
    try {
        const response = await fetch('/api/server-date');
        const data = await response.json();
        if (data.success) {
            today = new Date(data.date + 'T00:00:00');
        }
    } catch (error) {
        console.error('è·å–æœåŠ¡å™¨æ—¥æœŸå¤±è´¥');
    }
    
    const nextDate = new Date(currentDate);
    nextDate.setDate(nextDate.getDate() + 1);
    
    // ä¸èƒ½è¶…è¿‡ä»Šå¤©
    if (nextDate <= today) {
        currentDate = nextDate;
        await loadDataForCurrentDate();
        updateNavigationButtons();
    } else {
        alert('å·²ç»æ˜¯æœ€æ–°æ—¥æœŸäº†');
    }
}

// å›åˆ°ä»Šå¤©
async function loadLiquidationToday() {
    await initCurrentDate();  // é‡æ–°è·å–æœåŠ¡å™¨æ—¥æœŸ
    await loadDataForCurrentDate();
    updateNavigationButtons();
}

// é€šè¿‡æ—¥æœŸé€‰æ‹©å™¨åŠ è½½æ•°æ®
async function loadLiquidationByDatePicker() {
    const datePickerValue = document.getElementById('liqDatePicker').value;
    if (!datePickerValue) return;
    
    // è·å–æœåŠ¡å™¨å½“å‰æ—¥æœŸ
    let today = new Date();
    try {
        const response = await fetch('/api/server-date');
        const data = await response.json();
        if (data.success) {
            today = new Date(data.date + 'T00:00:00');
        }
    } catch (error) {
        console.error('è·å–æœåŠ¡å™¨æ—¥æœŸå¤±è´¥');
    }
    
    const selectedDate = new Date(datePickerValue + 'T00:00:00');
    const minDate = new Date('2026-02-01T00:00:00');
    
    // éªŒè¯æ—¥æœŸèŒƒå›´
    if (selectedDate > today) {
        alert('ä¸èƒ½é€‰æ‹©æœªæ¥æ—¥æœŸ');
        // é‡ç½®ä¸ºå½“å‰æ—¥æœŸ
        document.getElementById('liqDatePicker').value = formatDateStr(currentDate);
        return;
    }
    
    if (selectedDate < minDate) {
        alert('ä¸èƒ½é€‰æ‹©2026-02-01ä¹‹å‰çš„æ—¥æœŸ');
        document.getElementById('liqDatePicker').value = formatDateStr(currentDate);
        return;
    }
    
    // æ›´æ–°å½“å‰æ—¥æœŸå¹¶åŠ è½½æ•°æ®
    currentDate = selectedDate;
    await loadDataForCurrentDate();
    updateNavigationButtons();
}

// æ›´æ–°æ—¥æœŸæ˜¾ç¤º
function updateDateDisplay() {
    const dateStr = formatDateDisplay(currentDate);
    document.getElementById('liqDateDisplay').textContent = dateStr;
    
    // åŒæ—¶æ›´æ–°æ—¥æœŸé€‰æ‹©å™¨çš„å€¼
    const datePickerValue = formatDateStr(currentDate);
    document.getElementById('liqDatePicker').value = datePickerValue;
}

// æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
async function updateNavigationButtons() {
    const minDate = new Date('2026-02-01T00:00:00');
    
    // è·å–æœåŠ¡å™¨å½“å‰æ—¥æœŸä½œä¸ºæœ€å¤§æ—¥æœŸ
    let maxDate = new Date();
    try {
        const response = await fetch('/api/server-date');
        const data = await response.json();
        if (data.success) {
            maxDate = new Date(data.date + 'T00:00:00');
        }
    } catch (error) {
        console.error('è·å–æœåŠ¡å™¨æ—¥æœŸå¤±è´¥');
    }
    
    const prevBtn = document.getElementById('liqPrevPageBtn');
    const nextBtn = document.getElementById('liqNextPageBtn');
    
    // æ£€æŸ¥å‰ä¸€å¤©æŒ‰é’®æ˜¯å¦åº”è¯¥ç¦ç”¨
    const prevDate = new Date(currentDate);
    prevDate.setDate(prevDate.getDate() - 1);
    if (prevDate < minDate) {
        prevBtn.disabled = true;
        prevBtn.style.opacity = '0.5';
        prevBtn.style.cursor = 'not-allowed';
    } else {
        prevBtn.disabled = false;
        prevBtn.style.opacity = '1';
        prevBtn.style.cursor = 'pointer';
    }
    
    // æ£€æŸ¥åä¸€å¤©æŒ‰é’®æ˜¯å¦åº”è¯¥ç¦ç”¨
    const nextDate = new Date(currentDate);
    nextDate.setDate(nextDate.getDate() + 1);
    if (nextDate > maxDate) {
        nextBtn.disabled = true;
        nextBtn.style.opacity = '0.5';
        nextBtn.style.cursor = 'not-allowed';
    } else {
        nextBtn.disabled = false;
        nextBtn.style.opacity = '1';
        nextBtn.style.cursor = 'pointer';
    }
}

// æ ¼å¼åŒ–æ—¥æœŸï¼šYYYY-MM-DD
function formatDateStr(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

// æ ¼å¼åŒ–æ˜¾ç¤ºï¼š2æœˆ11æ—¥
function formatDateDisplay(date) {
    const month = date.getMonth() + 1;
    const day = date.getDate();
    return `${month}æœˆ${day}æ—¥`;
}

// ä»æœåŠ¡å™¨è·å–å½“å‰æ—¥æœŸï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
async function initCurrentDate() {
    try {
        const response = await fetch('/api/server-date');
        const data = await response.json();
        if (data.success) {
            currentDate = new Date(data.date);
            console.log(`âœ“ æœåŠ¡å™¨å½“å‰æ—¥æœŸï¼ˆåŒ—äº¬æ—¶é—´ï¼‰: ${data.date}`);
            
            // è®¾ç½®æ—¥æœŸé€‰æ‹©å™¨çš„maxå±æ€§ä¸ºä»Šå¤©
            const datePickerEl = document.getElementById('liqDatePicker');
            if (datePickerEl) {
                datePickerEl.max = data.date;
            }
        }
    } catch (error) {
        console.error('è·å–æœåŠ¡å™¨æ—¥æœŸå¤±è´¥ï¼Œä½¿ç”¨æµè§ˆå™¨æ—¶é—´:', error);
        currentDate = new Date();
    }
}

        window.onload = async function() {
            await initCurrentDate();  // å…ˆè·å–æœåŠ¡å™¨æ—¥æœŸ
            initChart();
            initLiquidation1hChart();  // åˆå§‹åŒ–1å°æ—¶çˆ†ä»“é‡‘é¢å›¾è¡¨
            loadCurrentData();
            loadAllHistoryData();  // åŠ è½½å…¨éƒ¨æ•°æ®ç”¨äºå›¾è¡¨åˆ†é¡µ
            loadHistoryData();      // åŠ è½½æœ€è¿‘50æ¡ç”¨äºè¡¨æ ¼
            load30DaysLiquidation();
            await loadDataForCurrentDate();  // åŠ è½½ä»Šå¤©çš„1å°æ—¶çˆ†ä»“æ•°æ®
            await updateNavigationButtons();  // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            
            // æ¯1åˆ†é’Ÿåˆ·æ–°æ‰€æœ‰æ•°æ®
            setInterval(async () => {
                console.log('[Auto Refresh] åˆ·æ–°æ•°æ®ä¸­... ' + new Date().toLocaleTimeString());
                
                // æ£€æµ‹æ˜¯å¦è·¨æ—¥ - è·å–æœ€æ–°çš„æœåŠ¡å™¨æ—¥æœŸ
                const oldDate = formatDateStr(currentDate);
                try {
                    const response = await fetch('/api/server-date');
                    const data = await response.json();
                    if (data.success) {
                        const newDate = data.date;  // YYYY-MM-DD æ ¼å¼
                        
                        // å¦‚æœæ—¥æœŸä¸åŒï¼Œè¯´æ˜è·¨æ—¥äº†
                        if (oldDate !== newDate) {
                            console.log(`ğŸ”„ æ£€æµ‹åˆ°è·¨æ—¥: ${oldDate} -> ${newDate}ï¼Œè‡ªåŠ¨è·³è½¬åˆ°æœ€æ–°æ—¥æœŸ`);
                            currentDate = new Date(newDate);
                            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                            const dateDisplay = document.getElementById('liqDateDisplay');
                            if (dateDisplay) {
                                dateDisplay.style.background = 'rgba(34, 197, 94, 0.2)';
                                dateDisplay.style.transition = 'all 0.5s';
                                setTimeout(() => {
                                    dateDisplay.style.background = '';
                                }, 2000);
                            }
                        }
                    }
                } catch (error) {
                    console.error('æ£€æµ‹è·¨æ—¥å¤±è´¥:', error);
                }
                
                loadCurrentData();
                loadAllHistoryData();
                loadHistoryData();
                await loadDataForCurrentDate();  // åˆ·æ–°1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®
                await updateNavigationButtons();  // åˆ·æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            }, 60000);  // 60ç§’ = 1åˆ†é’Ÿ
            
            // å“åº”çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', () => {
                if (chart) chart.resize();
                if (liquidation1hChart) liquidation1hChart.resize();
            });
        };
    </script>
</body>
</html>
