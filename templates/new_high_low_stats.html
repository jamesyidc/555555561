<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>åˆ›æ–°é«˜åˆ›æ–°ä½ç»Ÿè®¡ - ä»·æ ¼ä½ç½®é¢„è­¦ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: rgba(26, 26, 46, 0.8);
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #a0a0a0;
            font-size: 0.95em;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: #667eea;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #667eea;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .back-link:hover {
            background: #667eea;
            color: #fff;
        }
        
        .backup-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .backup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        .backup-btn:active {
            transform: translateY(0);
        }
        
        .backup-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(26, 26, 46, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        .stat-card h2 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #a0a0a0;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .stat-value.high {
            color: #10b981;
        }
        
        .stat-value.low {
            color: #ef4444;
        }
        
        .chart-container {
            background: rgba(26, 26, 46, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            margin-bottom: 30px;
        }
        
        .chart {
            width: 100%;
            height: 400px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 12px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            font-weight: 600;
        }
        
        .event-new-high {
            color: #10b981;
        }
        
        .event-new-low {
            color: #ef4444;
        }
        
        .status-ok {
            color: #10b981;
        }
        
        .status-error {
            color: #ef4444;
        }
        
        .time-elapsed {
            color: #a0a0a0;
            font-size: 0.9em;
        }
        
        .price-high {
            color: #10b981;
            font-weight: 600;
        }
        
        .price-low {
            color: #ef4444;
            font-weight: 600;
        }
        
        .coin-symbol {
            font-weight: 700;
            color: #667eea;
        }
        
        details {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        
        details summary {
            padding: 5px;
            outline: none;
        }
        
        details[open] summary {
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.3);
            padding-bottom: 10px;
        }
        
        code {
            background: rgba(102, 126, 234, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #10b981;
        }
        
        table {
            font-size: 0.9em;
        }
        
        .info-box {
            background: rgba(26, 26, 46, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            margin-top: 30px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            padding-left: 20px;
            line-height: 1.8;
        }
        
        .info-box li {
            color: #a0a0a0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="/price-position" class="back-link">â† è¿”å›ä»·æ ¼ä½ç½®é¢„è­¦</a>
            <h1>ğŸ¯ åˆ›æ–°é«˜åˆ›æ–°ä½ç»Ÿè®¡</h1>
            <p class="subtitle">
                åŸºäºå†å²æœ€é«˜ä»·å’Œæœ€ä½ä»·çš„åˆ›æ–°é«˜/åˆ›æ–°ä½äº‹ä»¶ç»Ÿè®¡ | 
                æ•°æ®æ›´æ–°: <span id="update-time">--</span> | 
                è¿½è¸ªå¸ç§: <span id="coin-count">--</span> ä¸ª | 
                çŠ¶æ€: <span id="status" class="status-ok">æ­£å¸¸</span>
            </p>
            <div style="margin-top: 15px;">
                <button id="backup-btn" class="backup-btn" onclick="backupData()">
                    ğŸ’¾ å¤‡ä»½æ•°æ®
                </button>
                <span id="backup-status" style="margin-left: 10px; color: #a0a0a0;"></span>
            </div>
        </header>

        <!-- ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£ -->
        <div class="info-box">
            <h3 style="cursor: pointer; user-select: none;" onclick="toggleTechDoc()">
                ğŸ“š ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£ 
                <span id="tech-doc-toggle" style="float: right; color: #667eea;">â–¼ å±•å¼€</span>
            </h3>
            <div id="tech-doc-content" style="display: none; margin-top: 15px;">
                
                <!-- ç³»ç»Ÿè¿è¡Œé€»è¾‘ -->
                <details open>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">ğŸ”„ ç³»ç»Ÿè¿è¡Œé€»è¾‘</summary>
                    <div style="padding-left: 20px; line-height: 1.8; color: #a0a0a0;">
                        <p><strong>1. æ•°æ®é‡‡é›†å±‚ï¼ˆBackend Collectorï¼‰</strong></p>
                        <ul>
                            <li>PM2å®ˆæŠ¤è¿›ç¨‹ <code>new-high-low-collector</code> æ¯3åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</li>
                            <li>è¯»å–ä»·æ ¼ä½ç½®æ•°æ®æº: <code>/data/price_position/price_position_YYYYMMDD.jsonl</code></li>
                            <li>æå–æœ€æ–°å¿«ç…§çš„28ä¸ªå¸ç§ä»·æ ¼</li>
                            <li>é€ä¸ªå¸ç§æ¯”è¾ƒå½“å‰ä»·æ ¼ä¸å†å²æœ€é«˜ä»·/æœ€ä½ä»·</li>
                            <li>æ£€æµ‹åˆ°åˆ›æ–°é«˜/ä½æ—¶:
                                <ul>
                                    <li>è®°å½•äº‹ä»¶åˆ°JSONL: <code>/data/new_high_low/new_high_low_events_YYYYMMDD.jsonl</code></li>
                                    <li>æ›´æ–°çŠ¶æ€æ–‡ä»¶: <code>/data/new_high_low/coin_highs_lows_state.json</code></li>
                                    <li>æ‰“å°æ—¥å¿—: ğŸ”¥ åˆ›æ–°é«˜ / â„ï¸ åˆ›æ–°ä½</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <p><strong>2. APIæ¥å£å±‚ï¼ˆFlask Backendï¼‰</strong></p>
                        <ul>
                            <li>è·¯ç”±: <code>GET /api/price-position/new-high-low-stats</code></li>
                            <li>è¯»å–çŠ¶æ€æ–‡ä»¶è·å–å½“å‰æœ€é«˜/ä½ä»·</li>
                            <li>è¯»å–è¿‡å»8å¤©çš„äº‹ä»¶JSONLæ–‡ä»¶</li>
                            <li>æŒ‰æ—¶é—´èŒƒå›´ç»Ÿè®¡: ä»Šå¤©ã€æ˜¨å¤©ã€3å¤©ã€7å¤©</li>
                            <li>è¿”å›JSONå“åº”ï¼ˆ<50msï¼‰</li>
                            <li>æ·»åŠ é˜²ç¼“å­˜å“åº”å¤´ï¼ˆCache-Control: no-storeï¼‰</li>
                        </ul>
                        
                        <p><strong>3. å‰ç«¯å±•ç¤ºå±‚ï¼ˆHTML + EChartsï¼‰</strong></p>
                        <ul>
                            <li>é¡µé¢è·¯ç”±: <code>/new-high-low-stats</code></li>
                            <li>æ¯60ç§’è‡ªåŠ¨è°ƒç”¨APIåˆ·æ–°æ•°æ®</li>
                            <li>æ¸²æŸ“4ä¸ªç»Ÿè®¡å¡ç‰‡ã€2ä¸ªEChartså›¾è¡¨ã€2ä¸ªæ•°æ®è¡¨æ ¼</li>
                            <li>è®¡ç®—è·ä»Šæ—¶é•¿ï¼ˆgetTimeElapsedå‡½æ•°ï¼‰</li>
                            <li>çº¯å±•ç¤ºé€»è¾‘ï¼Œé›¶ä¸šåŠ¡è®¡ç®—</li>
                        </ul>
                    </div>
                </details>
                
                <!-- æ•°æ®æµç¨‹å›¾ -->
                <details>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">ğŸ“Š æ•°æ®æµç¨‹å›¾</summary>
                    <div style="padding-left: 20px;">
                        <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; overflow-x: auto; color: #e0e0e0; line-height: 1.6;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä»·æ ¼ä½ç½®é¢„è­¦ç³»ç»Ÿ                              â”‚
â”‚            /data/price_position/price_position_*.jsonl          â”‚
â”‚  (price-position-collector æ¯5åˆ†é’Ÿé‡‡é›†OKX APIä»·æ ¼æ•°æ®)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ è¯»å–æœ€æ–°å¿«ç…§
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åˆ›æ–°é«˜åˆ›æ–°ä½é‡‡é›†å™¨ (PM2 å®ˆæŠ¤è¿›ç¨‹)                    â”‚
â”‚          source_code/new_high_low_collector.py                  â”‚
â”‚                    æ¯3åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  for æ¯ä¸ªå¸ç§:                                                   â”‚
â”‚    if å½“å‰ä»·æ ¼ > coin_state[symbol].highest_price:               â”‚
â”‚        è§¦å‘åˆ›æ–°é«˜äº‹ä»¶ â†’ è®°å½•åˆ°JSONL                              â”‚
â”‚        æ›´æ–° highest_price å’Œ highest_time                        â”‚
â”‚    if å½“å‰ä»·æ ¼ < coin_state[symbol].lowest_price:                â”‚
â”‚        è§¦å‘åˆ›æ–°ä½äº‹ä»¶ â†’ è®°å½•åˆ°JSONL                              â”‚
â”‚        æ›´æ–° lowest_price å’Œ lowest_time                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ å†™å…¥æ–‡ä»¶
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æŒä¹…åŒ–                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [çŠ¶æ€æ–‡ä»¶] coin_highs_lows_state.json                           â”‚
â”‚     â””â”€ æ¯ä¸ªå¸ç§çš„å½“å‰æœ€é«˜ä»·ã€æœ€ä½ä»·åŠæ—¶é—´                         â”‚
â”‚  [äº‹ä»¶æ—¥å¿—] new_high_low_events_YYYYMMDD.jsonl                   â”‚
â”‚     â””â”€ æ¯è¡Œè®°å½•ä¸€æ¬¡åˆ›æ–°é«˜/ä½äº‹ä»¶                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ APIè¯»å–
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flask API æ¥å£                                â”‚
â”‚        /api/price-position/new-high-low-stats                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. è¯»å– coin_highs_lows_state.json                             â”‚
â”‚  2. è¯»å–è¿‡å»8å¤©çš„ new_high_low_events_*.jsonl                    â”‚
â”‚  3. æŒ‰æ—¶é—´èŒƒå›´ç»Ÿè®¡: today/yesterday/3days/7days                  â”‚
â”‚  4. è®¡ç®— by_symbol ç»Ÿè®¡ï¼ˆæ¯ä¸ªå¸ç§çš„äº‹ä»¶æ•°ï¼‰                      â”‚
â”‚  5. è¿”å›JSONå“åº” + é˜²ç¼“å­˜å¤´                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP GET (æ¯60ç§’)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯é¡µé¢ (HTML)                               â”‚
â”‚              /new-high-low-stats                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç»Ÿè®¡å¡ç‰‡] ä»Šå¤©ã€æ˜¨å¤©ã€3å¤©ã€7å¤©çš„åˆ›æ–°é«˜/ä½æ¬¡æ•°                   â”‚
â”‚  [è¶‹åŠ¿å›¾è¡¨] EChartsæŸ±çŠ¶å›¾å¯¹æ¯”å„æ—¶æ®µæ•°æ®                          â”‚
â”‚  [å¸ç§å›¾è¡¨] Top 15æ´»è·ƒå¸ç§æ¨ªå‘æŸ±çŠ¶å›¾                             â”‚
â”‚  [çŠ¶æ€è¡¨æ ¼] 28ä¸ªå¸ç§çš„æœ€é«˜/ä½ä»·ã€æ—¶é—´ã€è·ä»Šæ—¶é•¿                   â”‚
â”‚  [äº‹ä»¶åˆ—è¡¨] æœ€è¿‘100æ¡åˆ›æ–°é«˜/ä½äº‹ä»¶æ˜ç»†                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                    </div>
                </details>
                
                <!-- JSONLæ–‡ä»¶æ ¼å¼ -->
                <details>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">ğŸ“„ JSONLæ–‡ä»¶æ ¼å¼è¯¦è§£</summary>
                    <div style="padding-left: 20px; color: #a0a0a0;">
                        
                        <p><strong>1. çŠ¶æ€æ–‡ä»¶: coin_highs_lows_state.json</strong></p>
                        <p>è·¯å¾„: <code>/home/user/webapp/data/new_high_low/coin_highs_lows_state.json</code></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; overflow-x: auto; color: #e0e0e0;">
{
  "BTC": {
    "highest_price": 68589.1,           // å†å²æœ€é«˜ä»·
    "highest_time": "2026-02-16 22:22:26",  // åˆ›å»ºæœ€é«˜ä»·çš„æ—¶é—´
    "lowest_price": 68409.8,            // å†å²æœ€ä½ä»·
    "lowest_time": "2026-02-16 22:19:01"    // åˆ›å»ºæœ€ä½ä»·çš„æ—¶é—´
  },
  "ETH": { ... },
  ... (å…±28ä¸ªå¸ç§)
}</pre>
                        
                        <p><strong>2. äº‹ä»¶æ—¥å¿—: new_high_low_events_YYYYMMDD.jsonl</strong></p>
                        <p>è·¯å¾„: <code>/home/user/webapp/data/new_high_low/new_high_low_events_20260216.jsonl</code></p>
                        <p>æ ¼å¼: æ¯è¡Œä¸€ä¸ªJSONå¯¹è±¡ï¼ˆJSONLæ ¼å¼ï¼Œä¾¿äºè¿½åŠ å’Œæµå¼è¯»å–ï¼‰</p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; overflow-x: auto; color: #e0e0e0;">
// åˆ›æ–°é«˜äº‹ä»¶
{
  "time": "2026-02-16 22:22:26",       // äº‹ä»¶å‘ç”Ÿæ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
  "timestamp": 1771251746.0,           // Unixæ—¶é—´æˆ³
  "symbol": "BTC",                     // å¸ç§ä»£ç 
  "event_type": "new_high",            // äº‹ä»¶ç±»å‹: new_high | new_low
  "price": 68589.1,                    // å½“å‰ä»·æ ¼ï¼ˆåˆ›æ–°é«˜ï¼‰
  "previous_high": 68500.0,            // å‰ä¸€æ¬¡æœ€é«˜ä»·
  "previous_time": "2026-02-16 20:15:00"  // å‰é«˜åˆ›å»ºæ—¶é—´
}

// åˆ›æ–°ä½äº‹ä»¶
{
  "time": "2026-02-16 22:29:24",
  "timestamp": 1771252164.0,
  "symbol": "TAO",
  "event_type": "new_low",             // åˆ›æ–°ä½
  "price": 188.1,                      // å½“å‰ä»·æ ¼ï¼ˆåˆ›æ–°ä½ï¼‰
  "previous_low": 189.9,               // å‰ä¸€æ¬¡æœ€ä½ä»·
  "previous_time": "2026-02-16 22:25:50"  // å‰ä½åˆ›å»ºæ—¶é—´
}</pre>
                        
                        <p><strong>3. æºæ•°æ®: price_position_YYYYMMDD.jsonl</strong></p>
                        <p>è·¯å¾„: <code>/home/user/webapp/data/price_position/price_position_20260216.jsonl</code></p>
                        <p>ç”± price-position-collector æ¯5åˆ†é’Ÿé‡‡é›†OKX APIç”Ÿæˆ</p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; overflow-x: auto; color: #e0e0e0;">
{
  "snapshot_time": "2026-02-16 22:30:00",
  "positions": [
    {
      "inst_id": "BTC-USDT-SWAP",
      "current_price": 68550.0,
      "high_48h": 70929.0,
      "low_48h": 68409.8,
      "high_7d": 72276.0,
      "low_7d": 65080.0,
      "position_48h": 45.2,    // åœ¨48håŒºé—´çš„ä½ç½®ç™¾åˆ†æ¯”
      "position_7d": 62.8      // åœ¨7dåŒºé—´çš„ä½ç½®ç™¾åˆ†æ¯”
    },
    ... (å…±28ä¸ªå¸ç§)
  ]
}</pre>
                    </div>
                </details>
                
                <!-- æ ¸å¿ƒåŠŸèƒ½ -->
                <details>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">âš™ï¸ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£</summary>
                    <div style="padding-left: 20px; line-height: 1.8; color: #a0a0a0;">
                        
                        <p><strong>åŠŸèƒ½1: åˆ›æ–°é«˜/ä½æ£€æµ‹</strong></p>
                        <ul>
                            <li><strong>è§¦å‘æ¡ä»¶</strong>:
                                <ul>
                                    <li>åˆ›æ–°é«˜: <code>current_price > coin_state[symbol].highest_price</code></li>
                                    <li>åˆ›æ–°ä½: <code>current_price < coin_state[symbol].lowest_price</code></li>
                                </ul>
                            </li>
                            <li><strong>æ‰§è¡Œæ“ä½œ</strong>:
                                <ul>
                                    <li>è®°å½•äº‹ä»¶åˆ°JSONLï¼ˆæ—¶é—´ã€å¸ç§ã€ä»·æ ¼ã€å‰å€¼ï¼‰</li>
                                    <li>æ›´æ–°çŠ¶æ€æ–‡ä»¶ä¸­çš„æœ€é«˜/ä½ä»·å’Œæ—¶é—´</li>
                                    <li>æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°ï¼ˆPM2æ—¥å¿—ï¼‰</li>
                                </ul>
                            </li>
                            <li><strong>çŠ¶æ€æŒä¹…åŒ–</strong>: æ¯æ¬¡é‡‡é›†åä¿å­˜çŠ¶æ€æ–‡ä»¶ï¼Œç¡®ä¿æœåŠ¡é‡å¯åæ•°æ®ä¸ä¸¢å¤±</li>
                        </ul>
                        
                        <p><strong>åŠŸèƒ½2: å¤šæ—¶æ®µç»Ÿè®¡</strong></p>
                        <ul>
                            <li><strong>ä»Šå¤©</strong>: è¿‡å»24å°æ—¶çš„äº‹ä»¶ï¼ˆnow - 1å¤© ~ nowï¼‰</li>
                            <li><strong>æ˜¨å¤©</strong>: 24-48å°æ—¶å‰çš„äº‹ä»¶ï¼ˆnow - 2å¤© ~ now - 1å¤©ï¼‰</li>
                            <li><strong>æœ€è¿‘3å¤©</strong>: è¿‡å»72å°æ—¶çš„äº‹ä»¶ï¼ˆnow - 3å¤© ~ nowï¼‰</li>
                            <li><strong>æœ€è¿‘7å¤©</strong>: è¿‡å»168å°æ—¶çš„äº‹ä»¶ï¼ˆnow - 7å¤© ~ nowï¼‰</li>
                            <li>ä½¿ç”¨åŒ—äº¬æ—¶åŒºï¼ˆpytz.timezone('Asia/Shanghai')ï¼‰</li>
                        </ul>
                        
                        <p><strong>åŠŸèƒ½3: æŒ‰å¸ç§ç»Ÿè®¡</strong></p>
                        <ul>
                            <li>ä¸ºæ¯ä¸ªæ—¶æ®µè®¡ç®— <code>by_symbol</code> å­—å…¸</li>
                            <li>ç»Ÿè®¡æ¯ä¸ªå¸ç§çš„åˆ›æ–°é«˜æ¬¡æ•°å’Œåˆ›æ–°ä½æ¬¡æ•°</li>
                            <li>ç”¨äºç”ŸæˆTop 15å¸ç§å›¾è¡¨</li>
                        </ul>
                        
                        <p><strong>åŠŸèƒ½4: å®æ—¶è·ä»Šæ—¶é•¿è®¡ç®—</strong></p>
                        <ul>
                            <li>å‰ç«¯JavaScriptå‡½æ•° <code>getTimeElapsed()</code></li>
                            <li>è®¡ç®—æœ€é«˜/ä½ä»·åˆ›å»ºæ—¶é—´è·å½“å‰çš„æ—¶é•¿</li>
                            <li>æ˜¾ç¤ºæ ¼å¼: "Xå¤©Xå°æ—¶å‰" / "Xå°æ—¶Xåˆ†é’Ÿå‰" / "Xåˆ†é’Ÿå‰" / "åˆšåˆš"</li>
                            <li>æ¯60ç§’éšé¡µé¢åˆ·æ–°è‡ªåŠ¨æ›´æ–°</li>
                        </ul>
                        
                        <p><strong>åŠŸèƒ½5: é˜²æµè§ˆå™¨ç¼“å­˜</strong></p>
                        <ul>
                            <li>APIå“åº”å¤´: <code>Cache-Control: no-store, no-cache, must-revalidate</code></li>
                            <li>å‰ç«¯è¯·æ±‚: URLæ·»åŠ æ—¶é—´æˆ³ <code>?_t=Date.now()</code></li>
                            <li>Fetché€‰é¡¹: <code>cache: 'no-store'</code></li>
                            <li>ç¡®ä¿æ•°æ®æ°¸è¿œæ˜¯æœ€æ–°çš„ï¼Œä¸å—æµè§ˆå™¨ç¼“å­˜å½±å“</li>
                        </ul>
                    </div>
                </details>
                
                <!-- ç³»ç»Ÿä¾èµ– -->
                <details>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">ğŸ”§ ç³»ç»Ÿä¾èµ–æ¸…å•</summary>
                    <div style="padding-left: 20px; line-height: 1.8; color: #a0a0a0;">
                        
                        <p><strong>1. PM2å®ˆæŠ¤è¿›ç¨‹</strong></p>
                        <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                            <tr style="background: rgba(102, 126, 234, 0.2);">
                                <th style="padding: 8px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">è¿›ç¨‹åç§°</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">è„šæœ¬è·¯å¾„</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">ä½œç”¨</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);"><code>new-high-low-collector</code></td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">source_code/new_high_low_collector.py</td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">åˆ›æ–°é«˜ä½é‡‡é›†å™¨ï¼ˆæ¯3åˆ†é’Ÿï¼‰</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);"><code>price-position-collector</code></td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">source_code/price_position_collector.py</td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">ä»·æ ¼ä½ç½®æ•°æ®æºï¼ˆæ¯5åˆ†é’Ÿï¼‰</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);"><code>flask-app</code></td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">app.py</td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Flask WebæœåŠ¡å™¨ï¼ˆç«¯å£9002ï¼‰</td>
                            </tr>
                        </table>
                        
                        <p><strong>2. Pythonä¾èµ–åŒ…</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
flask>=2.0.0              # Webæ¡†æ¶
pytz                      # æ—¶åŒºå¤„ç†ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
requests                  # HTTPè¯·æ±‚ï¼ˆè°ƒç”¨OKX APIï¼‰
sqlite3                   # æ•°æ®åº“ï¼ˆå†…ç½®ï¼Œç”¨äºsignal_timelineï¼‰
json                      # JSONè§£æï¼ˆå†…ç½®ï¼‰
datetime                  # æ—¥æœŸæ—¶é—´å¤„ç†ï¼ˆå†…ç½®ï¼‰
pathlib                   # è·¯å¾„æ“ä½œï¼ˆå†…ç½®ï¼‰
collections.defaultdict   # ç»Ÿè®¡æ•°æ®ç»“æ„ï¼ˆå†…ç½®ï¼‰</pre>
                        
                        <p><strong>3. Flask APIè·¯ç”±</strong></p>
                        <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                            <tr style="background: rgba(102, 126, 234, 0.2);">
                                <th style="padding: 8px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">è·¯ç”±</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">æ–¹æ³•</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">åŠŸèƒ½</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);"><code>/new-high-low-stats</code></td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">GET</td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">æ¸²æŸ“å‰ç«¯HTMLé¡µé¢</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);"><code>/api/price-position/new-high-low-stats</code></td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">GET</td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">è¿”å›ç»Ÿè®¡æ•°æ®JSON</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);"><code>/price-position</code></td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">GET</td>
                                <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">ä»·æ ¼ä½ç½®é¢„è­¦ä¸»é¡µ</td>
                            </tr>
                        </table>
                        
                        <p><strong>4. å‰ç«¯ä¾èµ–</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
ECharts 5.x               # å›¾è¡¨åº“ï¼ˆCDN: jsdelivr.netï¼‰
  â””â”€ ç”¨äºæ¸²æŸ“è¶‹åŠ¿å¯¹æ¯”å›¾å’Œå¸ç§ç»Ÿè®¡å›¾

JavaScript ES6+           # åŸç”ŸJavaScript
  â”œâ”€ Fetch API           # HTTPè¯·æ±‚ï¼ˆæ›¿ä»£AJAXï¼‰
  â”œâ”€ async/await         # å¼‚æ­¥å¤„ç†
  â””â”€ setInterval         # 60ç§’è‡ªåŠ¨åˆ·æ–°

HTML5 + CSS3             # é¡µé¢ç»“æ„å’Œæ ·å¼
  â”œâ”€ Gridå¸ƒå±€            # å“åº”å¼å¡ç‰‡ç½‘æ ¼
  â”œâ”€ Flexbox             # å…ƒç´ å¯¹é½
  â””â”€ CSSå˜é‡             # ä¸»é¢˜é¢œè‰²</pre>
                        
                        <p><strong>5. æ•°æ®ç›®å½•ç»“æ„</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0; font-family: monospace;">
/home/user/webapp/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ new_high_low/                    # åˆ›æ–°é«˜ä½ç³»ç»Ÿæ•°æ®
â”‚   â”‚   â”œâ”€â”€ coin_highs_lows_state.json   # çŠ¶æ€æ–‡ä»¶ï¼ˆ4.3KBï¼‰
â”‚   â”‚   â””â”€â”€ new_high_low_events_*.jsonl  # äº‹ä»¶æ—¥å¿—ï¼ˆæŒ‰æ—¥æœŸï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ price_position/                  # ä»·æ ¼ä½ç½®æ•°æ®æº
â”‚       â””â”€â”€ price_position_*.jsonl       # æºæ•°æ®ï¼ˆæŒ‰æ—¥æœŸï¼‰
â”‚
â”œâ”€â”€ source_code/
â”‚   â””â”€â”€ new_high_low_collector.py        # é‡‡é›†å™¨è„šæœ¬
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ new_high_low_stats.html          # å‰ç«¯é¡µé¢
â”‚
â””â”€â”€ app.py                                # Flaskä¸»ç¨‹åº</pre>
                        
                        <p><strong>6. ç¯å¢ƒå˜é‡</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
TZ=Asia/Shanghai          # ç³»ç»Ÿæ—¶åŒºï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
FLASK_ENV=production      # Flaskè¿è¡Œæ¨¡å¼
FLASK_PORT=9002           # Flaskç›‘å¬ç«¯å£</pre>
                        
                        <p><strong>7. ç³»ç»Ÿè¦æ±‚</strong></p>
                        <ul>
                            <li>Python 3.8+</li>
                            <li>PM2 (Node.jsè¿›ç¨‹ç®¡ç†å™¨)</li>
                            <li>ç£ç›˜ç©ºé—´: ~10MB/å¤©ï¼ˆäº‹ä»¶æ—¥å¿—å¢é•¿é€Ÿåº¦ï¼‰</li>
                            <li>å†…å­˜: é‡‡é›†å™¨ ~12MBï¼ŒFlask ~200MB</li>
                            <li>ç½‘ç»œ: éœ€è®¿é—®OKX APIï¼ˆprice-position-collectorä¾èµ–ï¼‰</li>
                        </ul>
                    </div>
                </details>
                
                <!-- ç»´æŠ¤æŒ‡å— -->
                <details>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">ğŸ”¨ ç»´æŠ¤æŒ‡å—</summary>
                    <div style="padding-left: 20px; line-height: 1.8; color: #a0a0a0;">
                        
                        <p><strong>æŸ¥çœ‹PM2è¿›ç¨‹çŠ¶æ€</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
pm2 list                              # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 show new-high-low-collector       # æŸ¥çœ‹é‡‡é›†å™¨è¯¦æƒ…
pm2 logs new-high-low-collector       # æŸ¥çœ‹å®æ—¶æ—¥å¿—</pre>
                        
                        <p><strong>é‡å¯æœåŠ¡</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
pm2 restart new-high-low-collector    # é‡å¯é‡‡é›†å™¨
pm2 restart flask-app                 # é‡å¯FlaskæœåŠ¡
pm2 restart all                       # é‡å¯æ‰€æœ‰æœåŠ¡</pre>
                        
                        <p><strong>æ•°æ®å¤‡ä»½</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
# å¤‡ä»½çŠ¶æ€æ–‡ä»¶ï¼ˆæœ€é‡è¦ï¼‰
cp data/new_high_low/coin_highs_lows_state.json ~/backup/

# å¤‡ä»½äº‹ä»¶æ—¥å¿—
tar -czf new_high_low_backup_$(date +%Y%m%d).tar.gz data/new_high_low/</pre>
                        
                        <p><strong>æ•°æ®æ¢å¤</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
# æ¢å¤çŠ¶æ€æ–‡ä»¶
cp ~/backup/coin_highs_lows_state.json data/new_high_low/

# é‡å¯é‡‡é›†å™¨ç”Ÿæ•ˆ
pm2 restart new-high-low-collector</pre>
                        
                        <p><strong>æ¸…ç†å†å²æ•°æ®</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
# åˆ é™¤30å¤©å‰çš„äº‹ä»¶æ—¥å¿—
find data/new_high_low/ -name "new_high_low_events_*.jsonl" -mtime +30 -delete</pre>
                        
                        <p><strong>æ‰‹åŠ¨è§¦å‘é‡‡é›†ï¼ˆæµ‹è¯•ç”¨ï¼‰</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
python3 source_code/new_high_low_collector.py
# æŒ‰ Ctrl+C åœæ­¢</pre>
                        
                        <p><strong>APIæµ‹è¯•</strong></p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; color: #e0e0e0;">
curl -s http://127.0.0.1:9002/api/price-position/new-high-low-stats | jq</pre>
                    </div>
                </details>
                
                <!-- Gitæäº¤è®°å½• -->
                <details>
                    <summary style="color: #10b981; font-weight: 600; margin: 15px 0; cursor: pointer;">ğŸ“ Gitæäº¤è®°å½•</summary>
                    <div style="padding-left: 20px; color: #a0a0a0;">
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; overflow-x: auto; color: #e0e0e0; line-height: 1.6;">
911a42f - feat: Add coin states table with highest/lowest prices and time elapsed
cb6f097 - Implement correct new high/low statistics system  
7e30be7 - refactor: Move new high/low calculations to backend collector
cf6d1dd - feat: Add new high/new low statistics page</pre>
                    </div>
                </details>
                
            </div>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h2>ğŸ“… ä»Šå¤©</h2>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°é«˜</span>
                    <span class="stat-value high" id="today-high">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°ä½</span>
                    <span class="stat-value low" id="today-low">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æ€»äº‹ä»¶</span>
                    <span class="stat-value" id="today-total">0</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h2>ğŸ“Š æ˜¨å¤©</h2>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°é«˜</span>
                    <span class="stat-value high" id="yesterday-high">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°ä½</span>
                    <span class="stat-value low" id="yesterday-low">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æ€»äº‹ä»¶</span>
                    <span class="stat-value" id="yesterday-total">0</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h2>ğŸ“ˆ æœ€è¿‘3å¤©</h2>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°é«˜</span>
                    <span class="stat-value high" id="3days-high">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°ä½</span>
                    <span class="stat-value low" id="3days-low">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æ€»äº‹ä»¶</span>
                    <span class="stat-value" id="3days-total">0</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h2>ğŸ“Š æœ€è¿‘7å¤©</h2>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°é«˜</span>
                    <span class="stat-value high" id="7days-high">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">åˆ›æ–°ä½</span>
                    <span class="stat-value low" id="7days-low">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æ€»äº‹ä»¶</span>
                    <span class="stat-value" id="7days-total">0</span>
                </div>
            </div>
        </div>
        
        <!-- è¶‹åŠ¿å¯¹æ¯”å›¾è¡¨ -->
        <div class="chart-container">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š äº‹ä»¶è¶‹åŠ¿å¯¹æ¯”</h2>
            <div id="comparison-chart" class="chart"></div>
        </div>
        
        <!-- å¸ç§ç»Ÿè®¡å›¾è¡¨ -->
        <div class="chart-container">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ’° å¸ç§äº‹ä»¶ç»Ÿè®¡ (Top 15)</h2>
            <div id="symbol-chart" class="chart"></div>
        </div>
        
        <!-- æ‰€æœ‰å¸ç§è¯¦ç»†ä¿¡æ¯è¡¨ -->
        <div class="chart-container">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“Š æ‰€æœ‰å¸ç§æœ€é«˜ä»·/æœ€ä½ä»·è¯¦æƒ…</h2>
            <div style="overflow-x: auto;">
                <table id="coin-states-table">
                    <thead>
                        <tr>
                            <th>å¸ç§</th>
                            <th>å†å²æœ€é«˜ä»·</th>
                            <th>æœ€é«˜ä»·æ—¶é—´</th>
                            <th>è·ä»Šæ—¶é•¿</th>
                            <th>å†å²æœ€ä½ä»·</th>
                            <th>æœ€ä½ä»·æ—¶é—´</th>
                            <th>è·ä»Šæ—¶é•¿</th>
                        </tr>
                    </thead>
                    <tbody id="coin-states-tbody">
                        <tr><td colspan="7" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- æœ€è¿‘äº‹ä»¶åˆ—è¡¨ -->
        <div class="chart-container">
            <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ• æœ€è¿‘äº‹ä»¶ (æœ€å¤š100æ¡)</h2>
            <div style="overflow-x: auto;">
                <table id="events-table">
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>å¸ç§</th>
                            <th>äº‹ä»¶ç±»å‹</th>
                            <th>ä»·æ ¼</th>
                            <th>å‰å€¼</th>
                        </tr>
                    </thead>
                    <tbody id="events-tbody">
                        <tr><td colspan="5" style="text-align: center;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- è¯´æ˜ä¿¡æ¯ -->
        <div class="info-box">
            <h3>â„¹ï¸ ç»Ÿè®¡è¯´æ˜</h3>
            <ul>
                <li><strong>åˆ›æ–°é«˜</strong>: å½“å‰ä»·æ ¼è¶…è¿‡è¯¥å¸ç§çš„å†å²æœ€é«˜ä»·</li>
                <li><strong>åˆ›æ–°ä½</strong>: å½“å‰ä»·æ ¼ä½äºè¯¥å¸ç§çš„å†å²æœ€ä½ä»·</li>
                <li>æ¯ä¸ªå¸ç§ç»´æŠ¤ç‹¬ç«‹çš„å†å²æœ€é«˜ä»·å’Œæœ€ä½ä»·è®°å½•</li>
                <li>æ•°æ®æ¯3åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œé¡µé¢æ¯60ç§’è‡ªåŠ¨åˆ·æ–°</li>
                <li>è¿½è¸ªå¸ç§åŒ…æ‹¬: BTC, ETH, SOL, BNB, XRP, ADA, DOGE, TRX, DOT, LTC, BCH, LINK, UNI, FIL, ETC, AAVE, CRV, NEAR, APT, STX, LDO, OKB, CRO, HBAR, TON, TAO, SUI, XLM å…±28ä¸ª</li>
            </ul>
        </div>
        
    </div>
    
    <script>
        const comparisonChart = echarts.init(document.getElementById('comparison-chart'));
        const symbolChart = echarts.init(document.getElementById('symbol-chart'));
        
        // æŠ€æœ¯æ–‡æ¡£æŠ˜å æ§åˆ¶
        function toggleTechDoc() {
            const content = document.getElementById('tech-doc-content');
            const toggle = document.getElementById('tech-doc-toggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–² æ”¶èµ·';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¼ å±•å¼€';
            }
        }
        
        // æ•°æ®å¤‡ä»½åŠŸèƒ½
        async function backupData() {
            const btn = document.getElementById('backup-btn');
            const status = document.getElementById('backup-status');
            
            // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            btn.disabled = true;
            btn.textContent = 'â³ å¤‡ä»½ä¸­...';
            status.textContent = '';
            
            try {
                const response = await fetch('/api/price-position/backup-new-high-low-data', {
                    method: 'POST',
                    cache: 'no-store'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    status.style.color = '#10b981';
                    status.textContent = `âœ… ${data.message || 'å¤‡ä»½æˆåŠŸ'}`;
                    
                    // æ˜¾ç¤ºå¤‡ä»½æ–‡ä»¶ä¿¡æ¯
                    if (data.backup_file) {
                        setTimeout(() => {
                            status.textContent = `âœ… å·²å¤‡ä»½: ${data.backup_file} (${data.file_size || '--'})`;
                        }, 1000);
                    }
                } else {
                    throw new Error(data.error || 'å¤‡ä»½å¤±è´¥');
                }
            } catch (error) {
                console.error('å¤‡ä»½å¤±è´¥:', error);
                status.style.color = '#ef4444';
                status.textContent = `âŒ å¤‡ä»½å¤±è´¥: ${error.message}`;
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'ğŸ’¾ å¤‡ä»½æ•°æ®';
                }, 2000);
            }
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const response = await fetch(`/api/price-position/new-high-low-stats?_t=${Date.now()}`, {
                    cache: 'no-store'
                });
                
                if (!response.ok) {
                    throw new Error('APIè¯·æ±‚å¤±è´¥');
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'æ•°æ®åŠ è½½å¤±è´¥');
                }
                
                // æ›´æ–°åŸºæœ¬ä¿¡æ¯
                document.getElementById('update-time').textContent = data.timestamp || '--';
                document.getElementById('coin-count').textContent = data.coin_count || '--';
                document.getElementById('status').textContent = 'æ­£å¸¸';
                document.getElementById('status').className = 'status-ok';
                
                // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
                updateStatCard('today', data.today || {});
                updateStatCard('yesterday', data.yesterday || {});
                updateStatCard('3days', data['3days'] || {});
                updateStatCard('7days', data['7days'] || {});
                
                // æ›´æ–°å›¾è¡¨
                updateComparisonChart(data);
                updateSymbolStatsChart(data['7days'].by_symbol || {});
                
                // æ›´æ–°å¸ç§çŠ¶æ€è¡¨æ ¼
                updateCoinStatesTable(data.coin_states || {}, data.timestamp);
                
                // æ›´æ–°äº‹ä»¶åˆ—è¡¨
                updateEventsTable(data.today.events || []);
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                document.getElementById('status').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('status').className = 'status-error';
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStatCard(period, stats) {
            document.getElementById(`${period}-high`).textContent = stats.new_high || 0;
            document.getElementById(`${period}-low`).textContent = stats.new_low || 0;
            document.getElementById(`${period}-total`).textContent = stats.total_events || 0;
        }
        
        // æ›´æ–°è¶‹åŠ¿å¯¹æ¯”å›¾è¡¨
        function updateComparisonChart(data) {
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#667eea',
                    textStyle: {
                        color: '#e0e0e0'
                    }
                },
                legend: {
                    data: ['åˆ›æ–°é«˜', 'åˆ›æ–°ä½'],
                    textStyle: {
                        color: '#e0e0e0'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['ä»Šå¤©', 'æ˜¨å¤©', 'æœ€è¿‘3å¤©', 'æœ€è¿‘7å¤©'],
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    axisLabel: {
                        color: '#e0e0e0'
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    axisLabel: {
                        color: '#e0e0e0'
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                series: [
                    {
                        name: 'åˆ›æ–°é«˜',
                        type: 'bar',
                        data: [
                            data.today.new_high || 0,
                            data.yesterday.new_high || 0,
                            data['3days'].new_high || 0,
                            data['7days'].new_high || 0
                        ],
                        itemStyle: {
                            color: '#10b981'
                        }
                    },
                    {
                        name: 'åˆ›æ–°ä½',
                        type: 'bar',
                        data: [
                            data.today.new_low || 0,
                            data.yesterday.new_low || 0,
                            data['3days'].new_low || 0,
                            data['7days'].new_low || 0
                        ],
                        itemStyle: {
                            color: '#ef4444'
                        }
                    }
                ]
            };
            
            comparisonChart.setOption(option);
        }
        
        // æ›´æ–°å¸ç§ç»Ÿè®¡å›¾è¡¨
        function updateSymbolStatsChart(bySymbol) {
            const symbols = Object.keys(bySymbol);
            const data = symbols.map(symbol => {
                const stats = bySymbol[symbol];
                return {
                    name: symbol,
                    value: (stats.new_high || 0) + (stats.new_low || 0)
                };
            }).filter(item => item.value > 0).sort((a, b) => b.value - a.value).slice(0, 15);
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#667eea',
                    textStyle: {
                        color: '#e0e0e0'
                    },
                    formatter: function(params) {
                        const symbol = params[0].name;
                        const stats = bySymbol[symbol];
                        return `
                            <strong>${symbol}</strong><br/>
                            åˆ›æ–°é«˜: <span style="color:#10b981">${stats.new_high || 0}</span><br/>
                            åˆ›æ–°ä½: <span style="color:#ef4444">${stats.new_low || 0}</span><br/>
                            æ€»è®¡: ${params[0].value}
                        `;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value',
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    axisLabel: {
                        color: '#e0e0e0'
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                yAxis: {
                    type: 'category',
                    data: data.map(item => item.name),
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    axisLabel: {
                        color: '#e0e0e0'
                    }
                },
                series: [{
                    type: 'bar',
                    data: data.map(item => item.value),
                    itemStyle: {
                        color: '#667eea'
                    }
                }]
            };
            
            symbolChart.setOption(option);
        }
        
        // è®¡ç®—æ—¶é—´å·®
        function getTimeElapsed(timeStr, currentTimeStr) {
            try {
                const targetTime = new Date(timeStr.replace(' ', 'T'));
                const currentTime = new Date(currentTimeStr.replace(' ', 'T'));
                const diffMs = currentTime - targetTime;
                
                if (diffMs < 0) return 'åˆšåˆš';
                
                const diffMinutes = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffDays > 0) {
                    return `${diffDays}å¤©${diffHours % 24}å°æ—¶å‰`;
                } else if (diffHours > 0) {
                    return `${diffHours}å°æ—¶${diffMinutes % 60}åˆ†é’Ÿå‰`;
                } else if (diffMinutes > 0) {
                    return `${diffMinutes}åˆ†é’Ÿå‰`;
                } else {
                    return 'åˆšåˆš';
                }
            } catch (e) {
                return '--';
            }
        }
        
        // æ›´æ–°å¸ç§çŠ¶æ€è¡¨æ ¼
        function updateCoinStatesTable(coinStates, currentTime) {
            const tbody = document.getElementById('coin-states-tbody');
            
            if (Object.keys(coinStates).length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            // æŒ‰å¸ç§åç§°æ’åº
            const sortedCoins = Object.keys(coinStates).sort();
            
            const rows = sortedCoins.map(symbol => {
                const state = coinStates[symbol];
                const highElapsed = getTimeElapsed(state.highest_time, currentTime);
                const lowElapsed = getTimeElapsed(state.lowest_time, currentTime);
                
                return `
                    <tr>
                        <td><span class="coin-symbol">${symbol}</span></td>
                        <td class="price-high">$${state.highest_price.toFixed(6)}</td>
                        <td>${state.highest_time}</td>
                        <td class="time-elapsed">${highElapsed}</td>
                        <td class="price-low">$${state.lowest_price.toFixed(6)}</td>
                        <td>${state.lowest_time}</td>
                        <td class="time-elapsed">${lowElapsed}</td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = rows;
        }
        
        // æ›´æ–°äº‹ä»¶åˆ—è¡¨
        function updateEventsTable(events) {
            const tbody = document.getElementById('events-tbody');
            
            if (events.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">æš‚æ— äº‹ä»¶</td></tr>';
                return;
            }
            
            const rows = events.slice(0, 100).map(event => {
                const eventClass = event.type === 'new_high' || event.event_type === 'new_high' ? 'event-new-high' : 'event-new-low';
                const eventName = event.type === 'new_high' || event.event_type === 'new_high' ? 'åˆ›æ–°é«˜' : 'åˆ›æ–°ä½';
                const previousLabel = event.type === 'new_high' || event.event_type === 'new_high' ? 'å‰é«˜' : 'å‰ä½';
                const previousValue = event.previous_high || event.previous_low || '--';
                
                return `
                    <tr>
                        <td>${event.time}</td>
                        <td><strong>${event.symbol}</strong></td>
                        <td class="${eventClass}">${eventName}</td>
                        <td>${event.price}</td>
                        <td>${previousValue}</td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = rows;
        }
        
        // åˆå§‹åŠ è½½
        loadData();
        
        // æ¯60ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(loadData, 60000);
        
        // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', () => {
            comparisonChart.resize();
            symbolChart.resize();
        });
    </script>
</body>
</html>
