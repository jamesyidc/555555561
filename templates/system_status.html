<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ç›‘æ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 16px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .status-card h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .status-online {
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .status-offline {
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .status-warning {
            background: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .status-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f9fafb;
            border-radius: 6px;
            font-size: 14px;
        }

        .info-label {
            color: #6b7280;
            font-weight: 500;
        }

        .info-value {
            color: #111827;
            font-weight: 600;
        }

        .services-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .services-section h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        .services-table {
            width: 100%;
            border-collapse: collapse;
            overflow: hidden;
        }

        .services-table thead {
            background: #f9fafb;
        }

        .services-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid #e5e7eb;
        }

        .services-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            color: #111827;
        }

        .services-table tbody tr:hover {
            background: #f9fafb;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .links-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .link-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        .link-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .link-card a {
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            font-size: 16px;
        }

        .link-card a:hover {
            color: #5568d3;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .refresh-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .refresh-btn:active {
            transform: scale(0.95);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ç›‘æ§</h1>
            <p class="subtitle">å®æ—¶ç›‘æ§æ‰€æœ‰æ•°æ®é‡‡é›†å’Œç›‘æ§æœåŠ¡çŠ¶æ€ | æœ€åæ›´æ–°: <span id="lastUpdate"></span></p>
        </div>

        <div class="status-grid">
            <div class="status-card">
                <h2>
                    <span class="status-indicator status-online"></span>
                    Coin Price Tracker
                </h2>
                <div class="status-info">
                    <div class="info-row">
                        <span class="info-label">æœ€æ–°æ—¶é—´</span>
                        <span class="info-value" id="coin-latest-time">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æ€»è®°å½•æ•°</span>
                        <span class="info-value" id="coin-count">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æ¶¨è·Œå¹…æ€»å’Œ</span>
                        <span class="info-value" id="coin-total-change">-</span>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <h2>
                    <span class="status-indicator status-online"></span>
                    Support Resistance
                </h2>
                <div class="status-info">
                    <div class="info-row">
                        <span class="info-label">æœ€æ–°æ—¶é—´</span>
                        <span class="info-value" id="sr-latest-time">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">S3+S4ä¿¡å·</span>
                        <span class="info-value" id="sr-signals">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å¸‚åœºçŠ¶æ€</span>
                        <span class="info-value" id="sr-status">-</span>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <h2>
                    <span class="status-indicator status-online"></span>
                    Escape Signal
                </h2>
                <div class="status-info">
                    <div class="info-row">
                        <span class="info-label">æœ€æ–°æ—¶é—´</span>
                        <span class="info-value" id="escape-latest-time">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">24hä¿¡å·æ•°</span>
                        <span class="info-value" id="escape-24h">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">2hä¿¡å·æ•°</span>
                        <span class="info-value" id="escape-2h">-</span>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <h2>
                    <span class="status-indicator status-online"></span>
                    æ•°æ®å¯¹é½
                </h2>
                <div class="status-info">
                    <div class="info-row">
                        <span class="info-label">æ€»è®°å½•æ•°</span>
                        <span class="info-value" id="aligned-count">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å®Œå…¨å¯¹é½</span>
                        <span class="info-value" id="aligned-full">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å¯¹é½ç‡</span>
                        <span class="info-value" id="aligned-rate">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="services-section">
            <h2>ğŸ“Š è¿è¡Œä¸­çš„æœåŠ¡ (å…± <span id="service-count">11</span> ä¸ª)</h2>
            <table class="services-table">
                <thead>
                    <tr>
                        <th>æœåŠ¡åç§°</th>
                        <th>çŠ¶æ€</th>
                        <th>è¿è¡Œæ—¶é—´</th>
                        <th>CPU</th>
                        <th>å†…å­˜</th>
                        <th>é‡å¯æ¬¡æ•°</th>
                    </tr>
                </thead>
                <tbody id="services-tbody">
                    <tr>
                        <td colspan="6" style="text-align: center;">åŠ è½½ä¸­...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="services-section">
            <h2>ğŸ”— å¿«é€Ÿè®¿é—®é“¾æ¥</h2>
            <div class="links-section">
                <div class="link-card">
                    <a href="/coin-price-tracker" target="_blank">ğŸ“ˆ Coin Price Tracker</a>
                </div>
                <div class="link-card">
                    <a href="/escape-signal-history" target="_blank">ğŸš¨ Escape Signal History</a>
                </div>
                <div class="link-card">
                    <a href="/support-resistance" target="_blank">ğŸ¯ Support Resistance</a>
                </div>
                <div class="link-card">
                    <a href="/aligned-data-view" target="_blank">ğŸ”„ Aligned Data View</a>
                </div>
            </div>
        </div>
    </div>

    <button class="refresh-btn" onclick="refreshAll()" title="åˆ·æ–°æ•°æ®">
        ğŸ”„
    </button>

    <script>
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', { 
                timeZone: 'Asia/Shanghai',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = timeStr;
        }

        // åŠ è½½Coin Price Trackeræ•°æ®
        async function loadCoinPriceData() {
            try {
                const response = await fetch('/api/coin-price-tracker/latest?limit=1');
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    const latest = data.data[0];
                    document.getElementById('coin-latest-time').textContent = latest.collect_time || '-';
                    document.getElementById('coin-count').textContent = data.count || '-';
                    
                    const totalChange = latest.total_change;
                    const changeClass = totalChange > 0 ? 'success' : totalChange < 0 ? 'danger' : 'warning';
                    const changeSign = totalChange > 0 ? '+' : '';
                    document.getElementById('coin-total-change').innerHTML = 
                        `<span style="color: ${totalChange > 0 ? '#10b981' : totalChange < 0 ? '#ef4444' : '#f59e0b'}">${changeSign}${totalChange.toFixed(2)}%</span>`;
                }
            } catch (error) {
                console.error('åŠ è½½Coin Priceæ•°æ®å¤±è´¥:', error);
                document.getElementById('coin-latest-time').textContent = 'åŠ è½½å¤±è´¥';
            }
        }

        // åŠ è½½Escape Signalæ•°æ®
        async function loadEscapeSignalData() {
            try {
                const response = await fetch('/api/escape-signal-stats');
                const data = await response.json();
                
                if (data.success && data.data) {
                    document.getElementById('escape-latest-time').textContent = data.data.stat_time || '-';
                    document.getElementById('escape-24h').textContent = data.data.signal_24h_count || '-';
                    document.getElementById('escape-2h').textContent = data.data.signal_2h_count || '-';
                }
            } catch (error) {
                console.error('åŠ è½½Escape Signalæ•°æ®å¤±è´¥:', error);
                document.getElementById('escape-latest-time').textContent = 'åŠ è½½å¤±è´¥';
            }
        }

        // åŠ è½½å¯¹é½æ•°æ®ç»Ÿè®¡
        async function loadAlignedData() {
            try {
                const response = await fetch('/api/aligned-data/history?limit=1000');
                const data = await response.json();
                
                if (data.success) {
                    const total = data.count;
                    const aligned = data.data.filter(d => d.is_aligned).length;
                    const rate = total > 0 ? ((aligned / total) * 100).toFixed(1) : '0';
                    
                    document.getElementById('aligned-count').textContent = total;
                    document.getElementById('aligned-full').textContent = aligned;
                    document.getElementById('aligned-rate').textContent = rate + '%';
                }
            } catch (error) {
                console.error('åŠ è½½å¯¹é½æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½Support Resistanceæ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
        function loadSRData() {
            // ç”±äºSRæ²¡æœ‰ç›´æ¥APIï¼Œè¿™é‡Œæ˜¾ç¤ºé™æ€ä¿¡æ¯
            document.getElementById('sr-latest-time').textContent = 'å®æ—¶æ›´æ–°ä¸­';
            document.getElementById('sr-signals').textContent = 'ç›‘æ§ä¸­';
            document.getElementById('sr-status').textContent = 'æ­£å¸¸';
        }

        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshAll() {
            const btn = document.querySelector('.refresh-btn');
            btn.innerHTML = '<div class="loading"></div>';
            btn.disabled = true;
            
            await Promise.all([
                loadCoinPriceData(),
                loadEscapeSignalData(),
                loadAlignedData(),
                loadSRData()
            ]);
            
            updateLastUpdateTime();
            
            btn.innerHTML = 'ğŸ”„';
            btn.disabled = false;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            refreshAll();
            
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(refreshAll, 30000);
        });

        // æ¨¡æ‹ŸæœåŠ¡çŠ¶æ€ï¼ˆå› ä¸ºæ— æ³•ç›´æ¥è®¿é—®PM2 APIï¼‰
        const services = [
            { name: 'flask-app', status: 'online', uptime: '2m', cpu: '0%', memory: '119.5mb', restarts: 0 },
            { name: 'coin-price-tracker', status: 'online', uptime: '3m', cpu: '0%', memory: '30.4mb', restarts: 0 },
            { name: 'support-resistance-snapshot', status: 'online', uptime: '3m', cpu: '0%', memory: '15.3mb', restarts: 0 },
            { name: 'price-speed-collector', status: 'online', uptime: '3m', cpu: '0%', memory: '36.7mb', restarts: 0 },
            { name: 'v1v2-collector', status: 'online', uptime: '3m', cpu: '0%', memory: '30.1mb', restarts: 0 },
            { name: 'crypto-index-collector', status: 'online', uptime: '3m', cpu: '0%', memory: '29.5mb', restarts: 0 },
            { name: 'okx-day-change-collector', status: 'online', uptime: '3m', cpu: '0%', memory: '30.4mb', restarts: 0 },
            { name: 'sar-slope-collector', status: 'online', uptime: '3m', cpu: '0%', memory: '29.1mb', restarts: 0 },
            { name: 'liquidation-1h-collector', status: 'online', uptime: '3m', cpu: '0%', memory: '29.3mb', restarts: 0 },
            { name: 'anchor-profit-monitor', status: 'online', uptime: '3m', cpu: '0%', memory: '29.9mb', restarts: 0 },
            { name: 'escape-signal-monitor', status: 'online', uptime: '3m', cpu: '0%', memory: '29.3mb', restarts: 0 }
        ];

        const tbody = document.getElementById('services-tbody');
        tbody.innerHTML = services.map(service => `
            <tr>
                <td><strong>${service.name}</strong></td>
                <td>
                    <span class="status-indicator ${service.status === 'online' ? 'status-online' : 'status-offline'}"></span>
                    ${service.status}
                </td>
                <td>${service.uptime}</td>
                <td>${service.cpu}</td>
                <td>${service.memory}</td>
                <td>${service.restarts}</td>
            </tr>
        `).join('');
    </script>
</body>
</html>
