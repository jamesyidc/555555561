<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ç¦ç”¨ç¼“å­˜ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Version: 2.0.2026-01-02-extreme-margin-fix -->
    <title>ğŸ”´ å®ç›˜é”šç‚¹ç³»ç»Ÿ - OKExæŒä»“ç›‘æ§ v2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .subtitle {
            color: #718096;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #2d3748;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
        }

        .stat-subvalue {
            font-size: 14px;
            color: #a0aec0;
            margin-top: 5px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 100%;
            margin-bottom: 30px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            height: 350px;
        }

        .table-container {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f7fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 13px;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            color: #2d3748;
        }

        tr:hover {
            background: #f7fafc;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-profit {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-loss {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-short {
            background: #feebc8;
            color: #7c2d12;
        }

        .badge-long {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge-sent {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-pending {
            background: #e2e8f0;
            color: #4a5568;
        }

        .badge-normal {
            background: #e6fffa;
            color: #234e52;
        }

        .alert-list {
            max-height: 350px;
            overflow-y: auto;
        }

        .alert-item {
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f7fafc;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .alert-item.profit {
            border-left-color: #48bb78;
        }

        .alert-item.loss {
            border-left-color: #f56565;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            color: #2d3748;
        }

        .alert-time {
            color: #a0aec0;
            font-size: 12px;
        }

        .alert-details {
            font-size: 13px;
            color: #4a5568;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }

        /* é¢„è­¦æ ·å¼ */
        .warning-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .warning-badge.critical {
            background: #fed7d7;
            color: #c53030;
        }

        .warning-badge.warning {
            background: #feebc8;
            color: #dd6b20;
        }

        .warning-badge.info {
            background: #bee3f8;
            color: #2c5282;
        }

        .profit-rate.warning-level {
            color: #dd6b20;
            font-weight: 600;
        }

        .profit-rate.critical-level {
            color: #c53030;
            font-weight: 600;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }


        
        /* é¡µé¢åŠ è½½æŒ‡ç¤ºå™¨ */
        #loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            flex-direction: column;
        }
        
        #loading-indicator.hidden {
            display: none;
        }
        
        .loading-progress {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 600px;
            max-width: 90vw;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-title {
            font-size: 20px;
            font-weight: bold;
            color: #2d3748;
        }

        .progress-percentage {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .progress-step.active {
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
        }

        .progress-step.completed {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid #10b981;
        }

        .step-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
        }

        .step-content {
            flex: 1;
        }

        .step-name {
            font-size: 15px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 2px;
        }

        .step-detail {
            font-size: 12px;
            color: #718096;
        }

        .step-time {
            font-size: 12px;
            color: #a0aec0;
            min-width: 60px;
            text-align: right;
        }
        
        /* 1å°æ—¶çˆ†ä»“å›¾è¡¨æ ·å¼ */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-info {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            min-width: 150px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- é¡µé¢åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading-indicator">
        <div class="loading-progress">
            <div class="progress-header">
                <div class="progress-title">ğŸš€ æ­£åœ¨åŠ è½½æ•°æ®</div>
                <div class="progress-percentage" id="progressPercentage">0%</div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-steps" id="progressSteps">
                <!-- æ­¥éª¤1: åŸºç¡€é…ç½® -->
                <div class="progress-step" data-step="1">
                    <div class="step-icon">â³</div>
                    <div class="step-content">
                        <div class="step-name">åŠ è½½åŸºç¡€é…ç½®</div>
                        <div class="step-detail">å­è´¦æˆ·é…ç½®ã€è‡ªåŠ¨ç»´æŠ¤è®¾ç½®</div>
                    </div>
                    <div class="step-time" id="step1Time">--</div>
                </div>
                <!-- æ­¥éª¤2: ç³»ç»ŸçŠ¶æ€ -->
                <div class="progress-step" data-step="2">
                    <div class="step-icon">â³</div>
                    <div class="step-content">
                        <div class="step-name">è·å–ç³»ç»ŸçŠ¶æ€</div>
                        <div class="step-detail">é”šç‚¹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€</div>
                    </div>
                    <div class="step-time" id="step2Time">--</div>
                </div>
                <!-- æ­¥éª¤3: æŒä»“æ•°æ® -->
                <div class="progress-step" data-step="3">
                    <div class="step-icon">â³</div>
                    <div class="step-content">
                        <div class="step-name">åŠ è½½æŒä»“æ•°æ®</div>
                        <div class="step-detail">ä¸»è´¦æˆ·ã€å­è´¦æˆ·æŒä»“ä¿¡æ¯</div>
                    </div>
                    <div class="step-time" id="step3Time">--</div>
                </div>
                <!-- æ­¥éª¤4: é¢„è­¦æ•°æ® -->
                <div class="progress-step" data-step="4">
                    <div class="step-icon">â³</div>
                    <div class="step-content">
                        <div class="step-name">åŠ è½½é¢„è­¦ä¿¡æ¯</div>
                        <div class="step-detail">æŒä»“é¢„è­¦ã€å¸‚åœºæŒ‡æ ‡</div>
                    </div>
                    <div class="step-time" id="step4Time">--</div>
                </div>
                <!-- æ­¥éª¤5: æ¬¡è¦æ•°æ® -->
                <div class="progress-step" data-step="5">
                    <div class="step-icon">â³</div>
                    <div class="step-content">
                        <div class="step-name">åŠ è½½æ¬¡è¦æ•°æ®</div>
                        <div class="step-detail">ç›‘æ§è®°å½•ã€å‘Šè­¦ã€ç›ˆåˆ©è®°å½•</div>
                    </div>
                    <div class="step-time" id="step5Time">--</div>
                </div>
                <!-- æ­¥éª¤6: ç»Ÿè®¡å›¾è¡¨ -->
                <div class="progress-step" data-step="6">
                    <div class="step-icon">â³</div>
                    <div class="step-content">
                        <div class="step-name">æ¸²æŸ“ç»Ÿè®¡å›¾è¡¨</div>
                        <div class="step-detail">ç›ˆåˆ©ç»Ÿè®¡ã€å¸‚åœºè¶‹åŠ¿</div>
                    </div>
                    <div class="step-time" id="step6Time">--</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- ç‰ˆæœ¬æ£€æµ‹æ ‡è®° -->
        <div id="page-version" data-version="2025-12-29-v2" style="display: none;"></div>
        
        <div class="header">
            <h1>
                <span>ğŸ”´</span>
                å®ç›˜é”šç‚¹ç³»ç»Ÿ
            </h1>
            <div class="subtitle">
                <span>OKExå®ç›˜æŒä»“ç›‘æ§ï¼ˆReal Tradingï¼‰</span>
                <span>â€¢</span>
                <span id="updateTime">--</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="refreshData()">
                    <span>ğŸ”„</span>
                    åˆ·æ–°æ•°æ®
                </button>
                <button class="btn btn-primary" id="pairProtectionBtn" onclick="togglePairProtection()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <span>ğŸ›¡ï¸</span>
                    <span id="protectionBtnText">å¯åŠ¨äº¤æ˜“å¯¹ä¿æŠ¤</span>
                </button>
                <a href="/" class="btn btn-secondary" style="text-decoration: none;">
                    <span>ğŸ </span>
                    è¿”å›é¦–é¡µ
                </a>
            </div>
        </div>

        <!-- ç©ºå•ç›ˆåˆ©ç»Ÿè®¡å›¾è¡¨ -->
        <div class="card" style="margin-bottom: 30px;">
            <div class="card-header">
                <div class="card-title">
                    <span>ğŸ’°</span>
                    å¤šç©ºå•ç›ˆåˆ©ç»Ÿè®¡
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="update-time" id="profitStatsUpdateTime" style="font-size: 14px; color: #718096;">
                        æœ€åæ›´æ–°: --
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="changeProfitStatsPage(-1)" 
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                       color: white; border: none; padding: 8px 16px; 
                                       border-radius: 8px; cursor: pointer; font-size: 14px; 
                                       font-weight: 600; transition: all 0.3s; display: flex; 
                                       align-items: center; gap: 5px;">
                            â† å‰ä¸€å¤©
                        </button>
                        <button onclick="changeProfitStatsPage(1)" 
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                       color: white; border: none; padding: 8px 16px; 
                                       border-radius: 8px; cursor: pointer; font-size: 14px; 
                                       font-weight: 600; transition: all 0.3s; display: flex; 
                                       align-items: center; gap: 5px;">
                            åä¸€å¤© â†’
                        </button>
                    </div>
                </div>
            </div>
            <div class="chart-container" id="profitStatsChart" style="height: 500px; width: 100%; background: white; border-radius: 0 0 15px 15px;"></div>
        </div>

        <!-- æŒä»“æ‘˜è¦å¡ç‰‡ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <!-- ä¸»è´¦æˆ·æŒä»“ -->
            <div style="background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%); border-radius: 15px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="font-size: 36px;">ğŸ’¼</div>
                    <div style="color: #2d5016; font-size: 14px; font-weight: 600;">ä¸»è´¦æˆ·æŒä»“</div>
                </div>
                <div style="color: #2d5016; font-size: 48px; font-weight: 800; margin-bottom: 10px;" id="mainAccountCount">--</div>
                <div style="color: #4a7c30; font-size: 13px;">
                    <span>å¤šå•: <span id="mainLongCount" style="font-weight: 600;">--</span></span>
                    <span style="margin: 0 8px;">|</span>
                    <span>ç©ºå•: <span id="mainShortCount" style="font-weight: 600;">--</span></span>
                </div>
            </div>

            <!-- ä¸»è´¦æˆ·ç›ˆäº -->
            <div style="background: linear-gradient(135deg, #c8e6c9 0%, #e8f5e9 100%); border-radius: 15px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="font-size: 36px;">ğŸ“ˆ</div>
                    <div style="color: #1b5e20; font-size: 14px; font-weight: 600;">ä¸»è´¦æˆ·ç›ˆäº</div>
                </div>
                <div style="font-size: 48px; font-weight: 800; margin-bottom: 10px;" id="mainAccountPnl">--</div>
                <div style="color: #388e3c; font-size: 13px;">
                    <span>å¹³å‡æ”¶ç›Šç‡: <span id="mainAvgProfitRate" style="font-weight: 600;">--</span></span>
                </div>
            </div>

            <!-- å­è´¦æˆ·æŒä»“ -->
            <div style="background: linear-gradient(135deg, #a8d8ea 0%, #d0e8f2 100%); border-radius: 15px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="font-size: 36px;">ğŸ‘¥</div>
                    <div style="color: #1e4d6b; font-size: 14px; font-weight: 600;">å­è´¦æˆ·æŒä»“</div>
                </div>
                <div style="color: #1e4d6b; font-size: 48px; font-weight: 800; margin-bottom: 10px;" id="subAccountCount">--</div>
                <div style="color: #2c5f7d; font-size: 13px;">
                    <span>è´¦æˆ·æ•°: <span id="subAccountNum" style="font-weight: 600;">--</span></span>
                    <span style="margin: 0 8px;">|</span>
                    <span>æŒä»“: <span id="subAccountPositions" style="font-weight: 600;">--</span></span>
                </div>
            </div>

            <!-- å­è´¦æˆ·ç›ˆäº -->
            <div style="background: linear-gradient(135deg, #b3d9ff 0%, #e0f2ff 100%); border-radius: 15px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="font-size: 36px;">ğŸ’°</div>
                    <div style="color: #0d47a1; font-size: 14px; font-weight: 600;">å­è´¦æˆ·ç›ˆäº</div>
                </div>
                <div style="font-size: 48px; font-weight: 800; margin-bottom: 10px;" id="subAccountPnl">--</div>
                <div style="color: #1976d2; font-size: 13px;">
                    <span>å¹³å‡æ”¶ç›Šç‡: <span id="subAvgProfitRate" style="font-weight: 600;">--</span></span>
                </div>
            </div>
            
            <!-- å¸‚åœºæ ¸å¿ƒæŒ‡æ ‡ - æ¨ªå‘ç®€æ´æ˜¾ç¤º -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- ææ…Œæ¸…æ´—æŒ‡æ•° -->
                <div style="background: linear-gradient(135deg, #a78bfa 0%, #c4b5fd 100%); border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(167, 139, 250, 0.25);">
                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                        <div style="font-size: 20px;">ğŸ˜±</div>
                        <div style="color: #5b21b6; font-size: 11px; font-weight: 600;">ææ…Œæ¸…æ´—æŒ‡æ•°</div>
                    </div>
                    <div style="color: #5b21b6; font-size: 32px; font-weight: 800; margin-bottom: 5px;" id="panicWashIndex">--</div>
                    <div style="color: #6d28d9; font-size: 10px;">
                        <span>çŠ¶æ€: <span id="panicWashStatus" style="font-weight: 600;">--</span></span>
                    </div>
                </div>
                
                <!-- å…¨ç½‘æŒä»“é‡ -->
                <div style="background: linear-gradient(135deg, #34d399 0%, #10b981 100%); border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(16, 185, 129, 0.25);">
                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                        <div style="font-size: 20px;">ğŸ’°</div>
                        <div style="color: #064e3b; font-size: 11px; font-weight: 600;">å…¨ç½‘æŒä»“é‡</div>
                    </div>
                    <div style="color: #064e3b; font-size: 32px; font-weight: 800; margin-bottom: 5px;" id="totalPosition">--</div>
                    <div style="color: #065f46; font-size: 10px;">
                        <span>å•ä½: <span style="font-weight: 600;">äº¿ç¾å…ƒ</span></span>
                    </div>
                </div>
                
                <!-- 1å°æ—¶çˆ†ä»“é‡‘é¢ -->
                <div style="background: linear-gradient(135deg, #fb923c 0%, #f97316 100%); border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(249, 115, 22, 0.25);">
                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                        <div style="font-size: 20px;">ğŸ’¥</div>
                        <div style="color: #7c2d12; font-size: 11px; font-weight: 600;">1å°æ—¶çˆ†ä»“é‡‘é¢</div>
                    </div>
                    <div style="color: #7c2d12; font-size: 32px; font-weight: 800; margin-bottom: 5px;" id="hourLiquidation">--</div>
                    <div style="color: #9a3412; font-size: 10px;">
                        <span>å•ä½: <span style="font-weight: 600;">ä¸‡ç¾å…ƒ</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- äº¤æ˜“å¯¹ä¿æŠ¤çŠ¶æ€é¢æ¿ -->
        <div id="pairProtectionPanel" style="display: none; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 15px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 48px;">ğŸ›¡ï¸</div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: white;">äº¤æ˜“å¯¹ä¿æŠ¤ç³»ç»Ÿ</div>
                        <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9);">è‡ªåŠ¨ç›‘æ§å¹¶ä¿æŠ¤ä¸»è´¦æˆ·äº¤æ˜“å¯¹æ•°é‡</div>
                    </div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.2); padding: 15px 25px; border-radius: 10px;">
                    <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9); margin-bottom: 5px;">ç³»ç»ŸçŠ¶æ€</div>
                    <div style="font-size: 24px; font-weight: 700; color: white;" id="protectionStatus">è¿è¡Œä¸­...</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 10px;">
                    <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">å—ä¿æŠ¤äº¤æ˜“å¯¹</div>
                    <div style="font-size: 32px; font-weight: 700; color: white;" id="protectedPairsCount">--</div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 10px;">
                    <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">å½“å‰æŒä»“æ•°</div>
                    <div style="font-size: 32px; font-weight: 700; color: white;" id="currentPairsCount">--</div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 10px;">
                    <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">æœ€åæ£€æŸ¥æ—¶é—´</div>
                    <div style="font-size: 14px; font-weight: 600; color: white;" id="lastCheckTime">--</div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 10px;">
                    <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;">è‡ªåŠ¨è¡¥ä»“æ¬¡æ•°</div>
                    <div style="font-size: 32px; font-weight: 700; color: white;" id="autoFillCount">0</div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                <div style="font-size: 14px; color: rgba(255, 255, 255, 0.9); margin-bottom: 10px;">ğŸ›¡ï¸ ä¿æŠ¤è§„åˆ™</div>
                <div style="font-size: 13px; color: white; line-height: 1.8;">
                    â€¢ æ¯60ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡æŒä»“äº¤æ˜“å¯¹<br>
                    â€¢ å‘ç°äº¤æ˜“å¯¹ç¼ºå¤±æ—¶ï¼Œç«‹å³è¡¥ä»“1Uä¿è¯é‡‘<br>
                    â€¢ ä¿è¯ä¸»è´¦æˆ·äº¤æ˜“å¯¹æ•°é‡ä¸å‡å°‘
                </div>
            </div>
        </div>

        <!-- è®¡æ¬¡ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card" style="border: 2px solid #f59e0b; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                <div class="stat-icon">ğŸ”¢</div>
                <div class="stat-label" style="color: #92400e;">å½“å‰è®¡æ¬¡</div>
                <div class="stat-value" id="currentCount" style="color: #b45309; font-size: 48px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #92400e;">è®¡æ¬¡å¾—åˆ†: <span id="countScore" style="font-weight: 700;">--</span></div>
            </div>
            <div class="stat-card" style="border: 2px solid #0ea5e9; background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);">
                <div class="stat-icon">ğŸŒ™</div>
                <div class="stat-label" style="color: #075985;">å‡Œæ™¨2ç‚¹è®¡æ¬¡</div>
                <div class="stat-value" id="am2Count" style="color: #0369a1; font-size: 48px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #075985;">æ¯æ—¥åŸºå‡†: <span id="am2Time" style="font-weight: 700;">--</span></div>
            </div>
        </div>

        <!-- 1å°æ—¶çˆ†ä»“é‡‘é¢æ›²çº¿å›¾ -->
        <div class="chart-container" style="margin-top: 20px;">
            <div class="chart-header">
                <div class="chart-title">ğŸ’¥ 1å°æ—¶çˆ†ä»“é‡‘é¢æ›²çº¿å›¾ <span style="font-size: 12px; color: #fbbf24;">[å®æ—¶è¿½è¸ª]</span></div>
                
                <!-- åˆ†é¡µæ§åˆ¶å™¨ -->
                <div class="pagination-controls">
                    <button class="page-btn" id="liqPrevPageBtn" onclick="loadLiquidationPreviousPage()" title="æŸ¥çœ‹æ›´æ—©çš„æ•°æ®">
                        <span>â—€</span>
                    </button>
                    <div class="page-info" id="liqPageInfo">åŠ è½½ä¸­...</div>
                    <button class="page-btn" id="liqNextPageBtn" onclick="loadLiquidationNextPage()" title="æŸ¥çœ‹æ›´æ–°çš„æ•°æ®">
                        <span>â–¶</span>
                    </button>
                </div>
            </div>
            <div id="liquidation1hChart" style="width: 100%; height: 400px; background: rgba(30, 27, 75, 0.5); border-radius: 15px; border: 1px solid rgba(245, 158, 11, 0.2);"></div>
            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-top: 10px; text-align: center;">
                æ•°æ®é‡‡é›†é¢‘ç‡: æ¯åˆ†é’Ÿä¸€æ¬¡ | æ•°æ®æ¥æº: OKX API | å•ä½: ä¸‡ç¾å…ƒ | æ¯é¡µæ˜¾ç¤º12å°æ—¶
            </div>
        </div>



        <!-- SARæ–œç‡ç³»ç»Ÿ -->
        <div class="stats-grid" style="margin-top: 20px;">
            <!-- åå¤šæ¯”å¡ç‰‡ -->
            <div class="stat-card" style="border: 2px solid #10b981; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); display: flex; align-items: stretch; padding: 0;">
                <!-- å·¦ä¾§ï¼šæ•°å­—åŒºåŸŸ -->
                <div style="flex: 0 0 35%; padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 2px solid #10b981;">
                    <div class="stat-icon" style="font-size: 48px; margin-bottom: 10px;">ğŸ“ˆ</div>
                    <div class="stat-label" style="color: #065f46; font-size: 16px; font-weight: 600; margin-bottom: 10px;">åå¤šæ¯” > 80%</div>
                    <div class="stat-value" id="sarBullishCount" style="color: #059669; font-size: 64px; font-weight: 800; line-height: 1;">--</div>
                    <div style="color: #065f46; font-size: 11px; margin-top: 8px; opacity: 0.7;" id="sarUpdateTime">æ›´æ–°æ—¶é—´: --</div>
                </div>
                <!-- å³ä¾§ï¼šå¸ç§åˆ—è¡¨åŒºåŸŸ -->
                <div style="flex: 1; padding: 20px; overflow-y: auto; max-height: 200px;">
                    <div id="sarBullishCoins" style="display: flex; flex-wrap: wrap; gap: 8px; font-size: 14px;">
                        <span style="color: #065f46; opacity: 0.6;">ç­‰å¾…æ•°æ®...</span>
                    </div>
                </div>
            </div>
            
            <!-- åç©ºæ¯”å¡ç‰‡ -->
            <div class="stat-card" style="border: 2px solid #ef4444; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); display: flex; align-items: stretch; padding: 0;">
                <!-- å·¦ä¾§ï¼šæ•°å­—åŒºåŸŸ -->
                <div style="flex: 0 0 35%; padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 2px solid #ef4444;">
                    <div class="stat-icon" style="font-size: 48px; margin-bottom: 10px;">ğŸ“‰</div>
                    <div class="stat-label" style="color: #7f1d1d; font-size: 16px; font-weight: 600; margin-bottom: 10px;">åç©ºæ¯” > 80%</div>
                    <div class="stat-value" id="sarBearishCount" style="color: #dc2626; font-size: 64px; font-weight: 800; line-height: 1;">--</div>
                </div>
                <!-- å³ä¾§ï¼šå¸ç§åˆ—è¡¨åŒºåŸŸ -->
                <div style="flex: 1; padding: 20px; overflow-y: auto; max-height: 200px;">
                    <div id="sarBearishCoins" style="display: flex; flex-wrap: wrap; gap: 8px; font-size: 14px;">
                        <span style="color: #7f1d1d; opacity: 0.6;">ç­‰å¾…æ•°æ®...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- é€ƒé¡¶ä¿¡å·è¶‹åŠ¿å›¾ -->
        <div style="margin-top: 20px; background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%); border: 2px solid #e5e7eb; border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 20px; font-weight: 700; color: #1f2937; margin: 0;">
                    ğŸ“Š é€ƒé¡¶ä¿¡å·è¶‹åŠ¿å›¾
                </h2>
                <div style="font-size: 12px; color: #6b7280;">
                    <span id="escapeChartUpdateTime">æ›´æ–°æ—¶é—´: --</span>
                </div>
            </div>
            <div id="escapeSignalChart" style="width: 100%; height: 350px;"></div>
        </div>

        <!-- ç©ºå•æé«˜ç›ˆåˆ©ç»Ÿè®¡ (â‰¥150%) -->
        <div class="stats-grid" style="margin-top: 20px;">
            <!-- ç©ºå•ç›ˆåˆ©â‰¥300% -->
            <div class="stat-card" style="border: 2px solid #a855f7; background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%);">
                <div class="stat-icon" style="font-size: 48px;">ğŸ†</div>
                <div class="stat-label" style="color: #6b21a8; font-size: 16px; font-weight: 600;">ç©ºå•ç›ˆåˆ©â‰¥300%</div>
                <div class="stat-value" id="short300" style="color: #7c3aed; font-size: 64px; font-weight: 800;">0</div>
                <div class="stat-subvalue" style="color: #6b21a8;">1å°æ—¶å†…: <span id="short300_1h" style="font-weight: 700;">0</span></div>
            </div>

            <!-- ç©ºå•ç›ˆåˆ©â‰¥250% -->
            <div class="stat-card" style="border: 2px solid #ec4899; background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);">
                <div class="stat-icon" style="font-size: 48px;">â­</div>
                <div class="stat-label" style="color: #831843; font-size: 16px; font-weight: 600;">ç©ºå•ç›ˆåˆ©â‰¥250%</div>
                <div class="stat-value" id="short250" style="color: #db2777; font-size: 64px; font-weight: 800;">0</div>
                <div class="stat-subvalue" style="color: #831843;">1å°æ—¶å†…: <span id="short250_1h" style="font-weight: 700;">0</span></div>
            </div>

            <!-- ç©ºå•ç›ˆåˆ©â‰¥200% -->
            <div class="stat-card" style="border: 2px solid #f97316; background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);">
                <div class="stat-icon" style="font-size: 48px;">ğŸ”¥</div>
                <div class="stat-label" style="color: #7c2d12; font-size: 16px; font-weight: 600;">ç©ºå•ç›ˆåˆ©â‰¥200%</div>
                <div class="stat-value" id="short200" style="color: #ea580c; font-size: 64px; font-weight: 800;">0</div>
                <div class="stat-subvalue" style="color: #7c2d12;">1å°æ—¶å†…: <span id="short200_1h" style="font-weight: 700;">0</span></div>
            </div>

            <!-- ç©ºå•ç›ˆåˆ©â‰¥150% -->
            <div class="stat-card" style="border: 2px solid #22c55e; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                <div class="stat-icon" style="font-size: 48px;">âœ…</div>
                <div class="stat-label" style="color: #14532d; font-size: 16px; font-weight: 600;">ç©ºå•ç›ˆåˆ©â‰¥150%</div>
                <div class="stat-value" id="short150" style="color: #16a34a; font-size: 64px; font-weight: 800;">0</div>
                <div class="stat-subvalue" style="color: #14532d;">1å°æ—¶å†…: <span id="short150_1h" style="font-weight: 700;">0</span></div>
            </div>
        </div>

        <!-- ç©ºå•è¶…é«˜ç›ˆåˆ©ç»Ÿè®¡ -->
        <div class="stats-grid" style="margin-top: 20px;">
            <div class="stat-card" style="border: 2px solid #9333ea; background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);">
                <div class="stat-icon">ğŸ’</div>
                <div class="stat-label" style="color: #581c87;">ç©ºå•ç›ˆåˆ©â‰¥120%</div>
                <div class="stat-value" id="profit120Plus" style="color: #9333ea; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #581c87;" id="profit120Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #7c3aed; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);">
                <div class="stat-icon">ğŸ‘‘</div>
                <div class="stat-label" style="color: #5b21b6;">ç©ºå•ç›ˆåˆ©â‰¥110%</div>
                <div class="stat-value" id="profit110Plus" style="color: #7c3aed; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #5b21b6;" id="profit110Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #8b5cf6; background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%);">
                <div class="stat-icon">ğŸŒŸ</div>
                <div class="stat-label" style="color: #6b21a8;">ç©ºå•ç›ˆåˆ©â‰¥100%</div>
                <div class="stat-value" id="profit100Plus" style="color: #8b5cf6; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #6b21a8;" id="profit100Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #a855f7; background: linear-gradient(135deg, #fae8ff 0%, #f5d0fe 100%);">
                <div class="stat-icon">â­</div>
                <div class="stat-label" style="color: #86198f;">ç©ºå•ç›ˆåˆ©â‰¥90%</div>
                <div class="stat-value" id="profit90Plus" style="color: #a855f7; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #86198f;" id="profit90Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #c026d3; background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%);">
                <div class="stat-icon">ğŸ†</div>
                <div class="stat-label" style="color: #a21caf;">ç©ºå•ç›ˆåˆ©â‰¥80%</div>
                <div class="stat-value" id="profit80Plus" style="color: #c026d3; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #a21caf;" id="profit80Increase">1å°æ—¶å†…: --</div>
            </div>
        </div>

        <!-- ç©ºå•ç›ˆåˆ©åˆ†çº§ç»Ÿè®¡ -->
        <div class="stats-grid" style="margin-top: 20px;">
            <div class="stat-card" style="border: 2px solid #dc2626; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">
                <div class="stat-icon">ğŸ”¥</div>
                <div class="stat-label" style="color: #991b1b;">ç©ºå•ç›ˆåˆ©â‰¥70%</div>
                <div class="stat-value" id="profit70Plus" style="color: #dc2626; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #991b1b;" id="profit70Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #ea580c; background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);">
                <div class="stat-icon">âš¡</div>
                <div class="stat-label" style="color: #9a3412;">ç©ºå•ç›ˆåˆ©â‰¥60%</div>
                <div class="stat-value" id="profit60Plus" style="color: #ea580c; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #9a3412;" id="profit60Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #f59e0b; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                <div class="stat-icon">ğŸ’«</div>
                <div class="stat-label" style="color: #92400e;">ç©ºå•ç›ˆåˆ©â‰¥50%</div>
                <div class="stat-value" id="profit50Plus" style="color: #f59e0b; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #92400e;" id="profit50Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #10b981; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                <div class="stat-icon">âœ¨</div>
                <div class="stat-label" style="color: #065f46;">ç©ºå•ç›ˆåˆ©â‰¥40%</div>
                <div class="stat-value" id="profit40Plus" style="color: #10b981; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #065f46;" id="profit40Increase">1å°æ—¶å†…: --</div>
            </div>
        </div>

        <!-- ç©ºå•ä½ç›ˆåˆ©/äºæŸç»Ÿè®¡ -->
        <div class="stats-grid" style="margin-top: 20px;">
            <div class="stat-card" style="border: 2px solid #a78bfa; background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-label" style="color: #6b21a8;">ç©ºå•ç›ˆåˆ©â‰¤40%</div>
                <div class="stat-value" id="profitBelow40" style="color: #a78bfa; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #6b21a8;" id="profitBelow40Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #9333ea; background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);">
                <div class="stat-icon">ğŸ“‰</div>
                <div class="stat-label" style="color: #6b21a8;">ç©ºå•ç›ˆåˆ©â‰¤30%</div>
                <div class="stat-value" id="profitBelow30" style="color: #9333ea; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #6b21a8;" id="profitBelow30Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #8b5cf6; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);">
                <div class="stat-icon">ğŸ“‰</div>
                <div class="stat-label" style="color: #5b21b6;">ç©ºå•ç›ˆåˆ©â‰¤20%</div>
                <div class="stat-value" id="profitBelow20" style="color: #8b5cf6; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #5b21b6;" id="profitBelow20Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #6366f1; background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-label" style="color: #3730a3;">ç©ºå•ç›ˆåˆ©â‰¤10%</div>
                <div class="stat-value" id="profitBelow10" style="color: #6366f1; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #3730a3;" id="profitBelow10Increase">1å°æ—¶å†…: --</div>
            </div>
            <div class="stat-card" style="border: 2px solid #ef4444; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">
                <div class="stat-icon">âŒ</div>
                <div class="stat-label" style="color: #991b1b;">ç©ºå•äºæŸ</div>
                <div class="stat-value" id="lossCount" style="color: #ef4444; font-size: 42px; font-weight: 800;">--</div>
                <div class="stat-subvalue" style="color: #991b1b;" id="lossCountIncrease">1å°æ—¶å†…: --</div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div class="main-grid">
            <!-- æ”¶ç›Šç‡è¶‹åŠ¿å›¾ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>ğŸ“ˆ</span>
                        æ”¶ç›Šç‡è¶‹åŠ¿
                    </div>
                </div>
                <div class="chart-container" id="profitChart"></div>
            </div>

            <!-- æœ€æ–°å‘Šè­¦ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>ğŸ””</span>
                        æœ€æ–°å‘Šè­¦
                    </div>
                </div>
                <div class="alert-list" id="alertList">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- å½“å‰é¢„è­¦ -->
        <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>âš ï¸</span>
                        å½“å‰é¢„è­¦ (äºæŸ >= -8%)
                    </div>
                    <div class="update-time" id="warningsUpdateTime" style="font-size: 14px; color: #718096;">
                        æœ€åæ›´æ–°: --
                    </div>
                </div>
                <div class="table-container">
                    <table id="warningsTable">
                        <thead>
                            <tr>
                                <th>å¸ç§</th>
                                <th>æ–¹å‘</th>
                                <th>å¼€ä»“ä»·</th>
                                <th>å½“å‰ä»·</th>
                                <th>ç›ˆäºç‡</th>
                                <th>æŒä»“é‡</th>
                                <th>é¢„è­¦çº§åˆ«</th>
                                <th>é¢„è­¦æ¶ˆæ¯</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody id="warningsBody">
                            <tr><td colspan="9" class="loading">åŠ è½½ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        <!-- å¸‚åœºä¸‹è·Œç­‰çº§åˆ†æ -->
        <div class="card" id="marketDropAnalysis" style="margin-bottom: 30px;">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-title" style="color: white;">
                    <span>ğŸ“Š</span>
                    å¸‚åœºä¸‹è·Œç­‰çº§åˆ†æ
                </div>
                <div class="update-time" style="font-size: 14px; color: rgba(255,255,255,0.9);">
                    æœ€åæ›´æ–°: <span id="dropAnalysisTime">--</span>
                </div>
            </div>
            <div style="padding: 20px;">
                <!-- ä¸‹è·Œç­‰çº§æ˜¾ç¤º -->
                <div id="dropLevelDisplay" style="text-align: center; padding: 30px; border-radius: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <div style="font-size: 48px; margin-bottom: 10px;">
                        <span id="dropLevelIcon">ğŸ”¥</span>
                    </div>
                    <div style="font-size: 32px; font-weight: 700; margin-bottom: 10px;">
                        <span id="dropLevelText">ä¸‹è·Œç­‰çº§4 - è¶…é«˜å¼ºåº¦ä¸‹è·Œ</span>
                    </div>
                    <div style="font-size: 18px; opacity: 0.9;">
                        <span id="dropLevelDesc">äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº90%</span>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡è¯¦æƒ… -->
                <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥100%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop100Count">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥90%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop90Count">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥80%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop80Count">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥70%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop70Count">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥60%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop60Count">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥50%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop50Count">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">â‰¥40%</div>
                        <div style="font-size: 28px; font-weight: 700; color: #8b5cf6;" id="drop40Count">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¸‚åœºä¸Šæ¶¨ç­‰çº§åˆ†æ -->
        <div class="card" id="marketRiseAnalysis" style="margin-bottom: 30px;">
            <div class="card-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <div class="card-title" style="color: white;">
                    <span>ğŸ“ˆ</span>
                    å¸‚åœºä¸Šæ¶¨ç­‰çº§åˆ†æ
                </div>
                <div class="update-time" style="font-size: 14px; color: rgba(255,255,255,0.9);">
                    æœ€åæ›´æ–°: <span id="riseAnalysisTime">--</span>
                </div>
            </div>
            <div style="padding: 20px;">
                <!-- ä¸Šæ¶¨ç­‰çº§æ˜¾ç¤º -->
                <div id="riseLevelDisplay" style="text-align: center; padding: 30px; border-radius: 15px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <div style="font-size: 48px; margin-bottom: 10px;">
                        <span id="riseLevelIcon">âœ…</span>
                    </div>
                    <div style="font-size: 32px; font-weight: 700; margin-bottom: 10px;">
                        <span id="riseLevelText">å¸‚åœºæ­£å¸¸</span>
                    </div>
                    <div style="font-size: 18px; opacity: 0.9;">
                        <span id="riseLevelDesc">ç©ºå•äºæŸ<2ä¸ªï¼Œæ— æ˜æ˜¾ä¸Šæ¶¨</span>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡è¯¦æƒ… -->
                <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">ç©ºå•äºæŸ</div>
                        <div style="font-size: 28px; font-weight: 700; color: #10b981;" id="riseLossCount">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">ä¸Šæ¶¨ç­‰çº§</div>
                        <div style="font-size: 28px; font-weight: 700; color: #10b981;" id="riseLevel">0</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 10px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">ç©ºå•ç›ˆåˆ©</div>
                        <div style="font-size: 28px; font-weight: 700; color: #10b981;" id="riseShortProfit">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 27å¸å®æ—¶æ¶¨è·Œ -->
        <div class="card" id="coinsDataCard" style="display: none;">
            <div class="card-header">
                <div class="card-title">
                    <span>ğŸ“Š</span>
                    27å¸å®æ—¶æ¶¨è·Œ
                    <span id="coinsDataTime" style="margin-left: 15px; font-size: 14px; font-weight: normal; color: #718096;"></span>
                </div>
            </div>
            
            <!-- æ€»æ¶¨è·Œå¹… -->
            <div style="padding: 15px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0 20px 15px 20px; border-radius: 12px;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="color: white; font-size: 16px; font-weight: 600;">27å¸æ€»æ¶¨è·Œ</span>
                    <span id="coinsTotalChange" style="color: white; font-size: 24px; font-weight: 700;">--</span>
                </div>
            </div>
            
            <!-- å¸ç§ç½‘æ ¼ -->
            <div style="padding: 0 20px 20px 20px;">
                <div id="coinsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                    <!-- å¸ç§å¡ç‰‡å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- å†å²æå€¼è®°å½• -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <span>ğŸ†</span>
                    å†å²æå€¼è®°å½•
                    <span id="hourlyStatsUpdateTime" style="margin-left: 15px; font-size: 14px; font-weight: normal; color: #718096;">
                        <!-- æ›´æ–°æ—¶é—´å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </span>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡å›¾ä¾‹è¯´æ˜å’Œ1å°æ—¶å†…ç»Ÿè®¡ -->
            <div style="padding: 12px 20px; background: linear-gradient(135deg, #f6f8fb 0%, #f0f4f8 100%); border-radius: 12px; margin: 0 20px 15px 20px;">
                <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap; justify-content: space-between;">
                    <div style="font-size: 16px; font-weight: 700; color: #2d3748;">
                        ğŸ“Š å†å²æå€¼è®°å½•
                    </div>
                    
                    <!-- 1å°æ—¶å†…ç»Ÿè®¡å¡ç‰‡ -->
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; flex: 1; justify-content: flex-end;">
                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: #48bb78;"></div>
                            <span style="font-size: 13px; color: #4a5568;">å¤šå•ç›ˆåˆ©</span>
                            <span style="font-size: 16px; font-weight: 700; color: #48bb78; margin-left: 5px;" id="hourlyLongProfit">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: #f56565;"></div>
                            <span style="font-size: 13px; color: #4a5568;">å¤šå•äºæŸ</span>
                            <span style="font-size: 16px; font-weight: 700; color: #f56565; margin-left: 5px;" id="hourlyLongLoss">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: #48bb78;"></div>
                            <span style="font-size: 13px; color: #4a5568;">ç©ºå•ç›ˆåˆ©</span>
                            <span style="font-size: 16px; font-weight: 700; color: #48bb78; margin-left: 5px;" id="hourlyShortProfit">0</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: #f56565;"></div>
                            <span style="font-size: 13px; color: #4a5568;">ç©ºå•äºæŸ</span>
                            <span style="font-size: 16px; font-weight: 700; color: #f56565; margin-left: 5px;" id="hourlyShortLoss">0</span>
                        </div>
                        <div style="font-size: 12px; color: #718096; padding: 8px;" id="hourlyStatsLegend">
                            (æœ€è¿‘1å°æ—¶å†…)
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table id="recordsTable">
                    <thead>
                        <tr>
                            <th>ç¼–å·</th>
                            <th>å¸ç§</th>
                            <th>æ–¹å‘</th>
                            <th>ç±»å‹</th>
                            <th>æ”¶ç›Šç‡</th>
                            <th>æŒä»“é‡</th>
                            <th>å¼€ä»“ä»·</th>
                            <th>æ ‡è®°ä»·</th>
                            <th>æ—¶é—´</th>
                            <th>æŒç»­æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                        <tr><td colspan="10" class="loading">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ“ä½œæç¤ºçŠ¶æ€æ  -->
        <div id="operationStatusBar" style="display: none; margin-bottom: 20px; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                <div style="font-size: 32px;" id="statusIcon">ğŸ“Š</div>
                <div style="text-align: left;">
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px;" id="statusTitle">--</div>
                    <div style="font-size: 16px; font-weight: 600;" id="statusHint">--</div>
                </div>
            </div>
        </div>

        <!-- å½“å‰æŒä»“æƒ…å†µ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <span>ğŸ’¼</span>
                    å½“å‰æŒä»“æƒ…å†µ
                    <span id="positionStats" style="margin-left: 15px; font-size: 14px; font-weight: normal; color: #718096;">
                        <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
                    </span>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <label style="font-size: 13px; color: #718096; display: flex; align-items: center; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="autoMaintainLong" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸŸ¢ è‡ªåŠ¨ç»´æŠ¤å¤šå•-10%</span>
                        </label>
                        <label style="font-size: 13px; color: #718096; display: flex; align-items: center; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="autoMaintainShort" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸ”´ è‡ªåŠ¨ç»´æŠ¤ç©ºå•-10%</span>
                        </label>
                        <label style="font-size: 13px; color: #ff6b35; display: flex; align-items: center; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="superMaintainLong" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸš€ è¶…çº§ç»´æŠ¤å¤šå•-10%</span>
                        </label>
                        <label style="font-size: 13px; color: #ff6b35; display: flex; align-items: center; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="superMaintainShort" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸš€ è¶…çº§ç»´æŠ¤ç©ºå•-10%</span>
                        </label>
                    </div>
                    <div class="update-time" id="currentPositionTime" style="font-size: 14px; color: #718096;">
                        æœ€åæ›´æ–°: --
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table id="currentPositionTable">
                    <thead>
                        <tr>
                            <th>ç¼–å·</th>
                            <th>å¸ç§</th>
                            <th>æ–¹å‘</th>
                            <th>æŒä»“é‡</th>
                            <th>å¼€ä»“å‡ä»·</th>
                            <th>æ ‡è®°ä»·æ ¼</th>
                            <th>æ æ†</th>
                            <th>æœªå®ç°ç›ˆäº</th>
                            <th>ä¿è¯é‡‘</th>
                            <th>æ”¶ç›Šç‡</th>
                            <th>æå€¼</th>
                            <th>çŠ¶æ€</th>
                            <th>ä»Šæ—¥ç»´æŠ¤</th>
                            <th>æ¸…é›¶</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="currentPositionBody">
                        <tr><td colspan="15" class="loading">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- å­è´¦æˆ·æŒä»“æƒ…å†µ -->
        <div class="card" style="border: 2px solid #667eea;">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-title" style="color: white;">
                    <span>ğŸ‘¥</span>
                    å­è´¦æˆ·æŒä»“æƒ…å†µ
                    <span id="subAccountStats" style="margin-left: 15px; font-size: 14px; font-weight: normal; opacity: 0.9;">
                        <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
                    </span>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <label style="font-size: 13px; color: white; display: flex; align-items: center; cursor: pointer; user-select: none; opacity: 0.9;">
                            <input type="checkbox" id="followShortLoss" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸ“Š è·Ÿç©ºå•äºæŸå¼€å•</span>
                        </label>
                        <label style="font-size: 13px; color: white; display: flex; align-items: center; cursor: pointer; user-select: none; opacity: 0.9;">
                            <input type="checkbox" id="followLongLoss" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸ“Š è·Ÿå¤šå•äºæŸå¼€å•</span>
                        </label>
                        <label style="font-size: 13px; color: white; display: flex; align-items: center; cursor: pointer; user-select: none; opacity: 0.9;">
                            <input type="checkbox" id="subSuperMaintainLong" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸš€ è¶…çº§ç»´æŠ¤å¤šå•-10%</span>
                        </label>
                        <label style="font-size: 13px; color: white; display: flex; align-items: center; cursor: pointer; user-select: none; opacity: 0.9;">
                            <input type="checkbox" id="subSuperMaintainShort" style="margin-right: 5px; cursor: pointer; width: 16px; height: 16px;">
                            <span>ğŸš€ è¶…çº§ç»´æŠ¤ç©ºå•-10%</span>
                        </label>
                    </div>
                    <button id="closeAllSubAccountPositions" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)'">
                        ğŸš¨ ä¸€é”®å…¨éƒ¨å¹³ä»“
                    </button>
                    <div style="font-size: 13px; opacity: 0.9;">
                        è´¦æˆ·æ•°é‡: <strong id="subAccountCount">--</strong>
                    </div>
                    <div class="update-time" id="subAccountPositionTime" style="font-size: 14px; opacity: 0.9; color: white;">
                        æœ€åæ›´æ–°: --
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table id="subAccountPositionTable" style="width: 100%; table-layout: fixed;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #000;">
                            <th style="color: #000; width: 7%;">è´¦æˆ·å</th>
                            <th style="color: #000; width: 4%;">ç¼–å·</th>
                            <th style="color: #000; width: 10%;">å¸ç§</th>
                            <th style="color: #000; width: 5%;">æ–¹å‘</th>
                            <th style="color: #000; width: 7%;">æŒä»“é‡</th>
                            <th style="color: #000; width: 8%;">å¼€ä»“å‡ä»·</th>
                            <th style="color: #000; width: 8%;">æ ‡è®°ä»·æ ¼</th>
                            <th style="color: #000; width: 4%;">æ æ†</th>
                            <th style="color: #000; width: 10%;">æœªå®ç°ç›ˆäº</th>
                            <th style="color: #000; width: 9%;">ä¿è¯é‡‘</th>
                            <th style="color: #000; width: 7%;">æ”¶ç›Šç‡</th>
                            <th style="color: #000; width: 7%;">ä»Šæ—¥ç»´æŠ¤</th>
                            <th style="color: #000; width: 5%;">æ¸…é›¶</th>
                            <th style="color: #000; width: 6%;">çŠ¶æ€</th>
                            <th style="color: #000; width: 8%;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="subAccountPositionBody">
                        <tr><td colspan="15" class="loading">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>


        <!-- å†å²ç›‘æ§è®°å½• -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <span>ğŸ“‹</span>
                    å†å²ç›‘æ§è®°å½•
                </div>
            </div>
            <div class="table-container">
                <table id="monitorTable">
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>å¸ç§</th>
                            <th>æ–¹å‘</th>
                            <th>æŒä»“é‡</th>
                            <th>å¼€ä»“å‡ä»·</th>
                            <th>æ ‡è®°ä»·æ ¼</th>
                            <th>æ æ†</th>
                            <th>æ”¶ç›Šç‡</th>
                            <th>å‘Šè­¦ç±»å‹</th>
                            <th>é€šçŸ¥çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="monitorBody">
                        <tr><td colspan="10" class="loading">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // å›¾è¡¨å®ä¾‹ï¼ˆå»¶è¿Ÿåˆå§‹åŒ–ï¼‰
        let profitChart = null;
        let profitStatsChart = null;

        // å›¾è¡¨ç¿»é¡µç›¸å…³å˜é‡
        let currentPage = 0; // 0è¡¨ç¤ºä»Šå¤©ï¼Œ-1è¡¨ç¤ºæ˜¨å¤©ï¼Œ-2è¡¨ç¤ºå‰å¤©
        let allHistoryData = []; // å­˜å‚¨æ‰€æœ‰å†å²æ•°æ®
        
        // åˆå§‹åŒ–å›¾è¡¨ï¼ˆç¡®ä¿DOMå·²åŠ è½½ï¼‰
        function initCharts() {
            if (!profitChart) {
                const profitChartDom = document.getElementById('profitChart');
                if (profitChartDom) {
                    profitChart = echarts.init(profitChartDom);
                    console.log('âœ… profitChart åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    console.error('âŒ profitChart å®¹å™¨æœªæ‰¾åˆ°');
                }
            }
            
            if (!profitStatsChart) {
                const profitStatsChartDom = document.getElementById('profitStatsChart');
                if (profitStatsChartDom) {
                    profitStatsChart = echarts.init(profitStatsChartDom);
                    console.log('âœ… profitStatsChart åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    console.error('âŒ profitStatsChart å®¹å™¨æœªæ‰¾åˆ°');
                }
            }
        }
        
        // åŠ è½½ç©ºå•ç›ˆåˆ©ç»Ÿè®¡æ•°æ®ï¼ˆåŠ è½½å…¨éƒ¨æ•°æ®ï¼‰
        async function loadProfitStats() {
            console.log('ğŸš€ å¼€å§‹åŠ è½½ç©ºå•ç›ˆåˆ©ç»Ÿè®¡æ•°æ®...');
            
            // ç¡®ä¿å›¾è¡¨å·²åˆå§‹åŒ–
            initCharts();
            
            try {
                // åŠ è½½æœ€è¿‘7å¤©çš„æ•°æ®ï¼ˆ24å°æ—¶Ã—60åˆ†é’ŸÃ—7å¤© = 10080æ¡ï¼‰
                const response = await fetch('/api/anchor-profit/history?limit=2880');  // é™åˆ¶åˆ°æœ€è¿‘2å¤©æ•°æ®ï¼ˆ2880åˆ†é’Ÿï¼‰
                const result = await response.json();
                
                console.log('ğŸ“Š APIè¿”å›ç»“æœ:', result);
                
                if (result.success && result.data && result.data.length > 0) {
                    allHistoryData = result.data;
                    
                    // æ‰¾åˆ°æœ€æ–°æœ‰æ•°æ®çš„æ—¥æœŸ
                    const latestData = result.data[result.data.length - 1];
                    const latestDate = new Date(latestData.timestamp * 1000);
                    const today = new Date();
                    
                    // è®¡ç®—æ—¥æœŸå·®ï¼ˆå¤©æ•°ï¼‰- ä½¿ç”¨æ–°çš„Dateå¯¹è±¡é¿å…ä¿®æ”¹åŸå¯¹è±¡
                    const todayMidnight = new Date(today);
                    todayMidnight.setHours(0, 0, 0, 0);
                    const latestMidnight = new Date(latestDate);
                    latestMidnight.setHours(0, 0, 0, 0);
                    const daysDiff = Math.floor((todayMidnight.getTime() - latestMidnight.getTime()) / (1000*60*60*24));
                    
                    console.log(`ğŸ“… æœ€æ–°æ•°æ®æ—¥æœŸ: ${latestData.datetime.substring(0, 10)}, ä¸ä»Šå¤©ç›¸å·®: ${daysDiff}å¤©`);
                    
                    // å¦‚æœä»Šå¤©æ²¡æ•°æ®ï¼Œè‡ªåŠ¨æ˜¾ç¤ºæœ€æ–°æœ‰æ•°æ®çš„æ—¥æœŸ
                    if (daysDiff > 0) {
                        currentPage = -daysDiff;
                        console.log(`âš ï¸ ä»Šå¤©æš‚æ— æ•°æ®ï¼Œè‡ªåŠ¨æ˜¾ç¤º ${-daysDiff} å¤©å‰çš„æ•°æ®`);
                    }
                    
                    renderProfitStatsChart(currentPage);
                    
                    // æ›´æ–°æ—¶é—´
                    document.getElementById('profitStatsUpdateTime').textContent = 
                        `æœ€åæ›´æ–°: ${latestData.datetime}`;
                    console.log('âœ… ç©ºå•ç›ˆåˆ©ç»Ÿè®¡åŠ è½½æˆåŠŸï¼Œæ€»æ•°æ®æ¡æ•°:', result.data.length);
                } else {
                    console.warn('âš ï¸ ç©ºå•ç›ˆåˆ©ç»Ÿè®¡æš‚æ— æ•°æ®');
                }
            } catch (error) {
                console.error('âŒ åŠ è½½ç©ºå•ç›ˆåˆ©ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // ç¿»é¡µå‡½æ•°
        function changeProfitStatsPage(direction) {
            currentPage += direction;
            
            // é™åˆ¶ç¿»é¡µèŒƒå›´ï¼ˆæœ€å¤šå¾€å‰ç¿»7å¤©ï¼‰
            if (currentPage < -6) {
                currentPage = -6;
                alert('âš ï¸ æœ€å¤šåªèƒ½æŸ¥çœ‹7å¤©å†…çš„æ•°æ®');
                return;
            }
            if (currentPage > 0) {
                currentPage = 0;
                alert('âš ï¸ å·²ç»æ˜¯æœ€æ–°æ•°æ®äº†');
                return;
            }
            
            renderProfitStatsChart(currentPage);
        }

        // æ¸²æŸ“å¤šç©ºå•ç›ˆåˆ©ç»Ÿè®¡å›¾è¡¨
        function renderProfitStatsChart(pageOffset) {
            console.log(`ğŸ“ˆ æ¸²æŸ“å›¾è¡¨ï¼Œé¡µç åç§»: ${pageOffset}å¤©`);
            
            // ç¡®ä¿å›¾è¡¨å·²åˆå§‹åŒ–
            if (!profitStatsChart) {
                console.error('âŒ profitStatsChart æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°åˆå§‹åŒ–...');
                initCharts();
                if (!profitStatsChart) {
                    console.error('âŒ profitStatsChart åˆå§‹åŒ–å¤±è´¥ï¼Œæ— æ³•æ¸²æŸ“å›¾è¡¨');
                    return;
                }
            }
            
            // è®¡ç®—æ—¥æœŸèŒƒå›´ï¼ˆæ˜¾ç¤º24å°æ—¶æ•°æ®ï¼‰- ä½¿ç”¨UTC+8åŒ—äº¬æ—¶é—´
            const now = new Date();
            // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
            const beijingOffset = 8 * 60; // åŒ—äº¬æ—¶é—´æ¯”UTCå¿«8å°æ—¶
            const localOffset = now.getTimezoneOffset(); // æœ¬åœ°æ—¶åŒºåç§»ï¼ˆåˆ†é’Ÿï¼Œè´Ÿæ•°è¡¨ç¤ºä¸œæ—¶åŒºï¼‰
            const offsetDiff = beijingOffset + localOffset; // è®¡ç®—å·®å¼‚
            
            const beijingNow = new Date(now.getTime() + offsetDiff * 60 * 1000);
            const targetDate = new Date(beijingNow);
            targetDate.setDate(targetDate.getDate() + pageOffset);
            
            // è®¾ç½®ä¸ºç›®æ ‡æ—¥æœŸçš„00:00:00ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
            const startOfDay = new Date(targetDate);
            startOfDay.setHours(0, 0, 0, 0);
            // è½¬å›UTCæ—¶é—´æˆ³
            const startTimestamp = Math.floor((startOfDay.getTime() - offsetDiff * 60 * 1000) / 1000);
            
            // è®¾ç½®ä¸ºç›®æ ‡æ—¥æœŸçš„23:59:59ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
            const endOfDay = new Date(targetDate);
            endOfDay.setHours(23, 59, 59, 999);
            // è½¬å›UTCæ—¶é—´æˆ³
            const endTimestamp = Math.floor((endOfDay.getTime() - offsetDiff * 60 * 1000) / 1000);
            
            console.log(`ğŸ• æ—¶åŒºä¿¡æ¯: æœ¬åœ°=${localOffset}åˆ†é’Ÿ, åŒ—äº¬=+480åˆ†é’Ÿ, å·®å¼‚=${offsetDiff}åˆ†é’Ÿ`);
            console.log(`ğŸ“… æ—¥æœŸèŒƒå›´: ${new Date(startTimestamp * 1000).toISOString()} ~ ${new Date(endTimestamp * 1000).toISOString()}`);
            
            // è¿‡æ»¤å‡º24å°æ—¶å†…çš„æ•°æ®
            const dataList = allHistoryData.filter(d => {
                return d.timestamp >= startTimestamp && d.timestamp <= endTimestamp;
            });
            
            console.log(`ğŸ“Š ${targetDate.toLocaleDateString()} çš„æ•°æ®æ¡æ•°:`, dataList.length);
            
            if (dataList.length === 0) {
                console.warn('âš ï¸ è¯¥æ—¥æœŸæš‚æ— æ•°æ®');
                // æ˜¾ç¤ºç©ºç™½å›¾è¡¨å¹¶æç¤º
                profitStatsChart.setOption({
                    title: {
                        text: `âš ï¸ ${targetDate.toLocaleDateString()} æš‚æ— æ•°æ®`,
                        left: 'center',
                        top: 'middle',
                        textStyle: {
                            color: '#999',
                            fontSize: 20
                        }
                    },
                    xAxis: { data: [] },
                    yAxis: {},
                    series: []
                });
                return;
            }
            
            const times = dataList.map(d => {
                const dt = new Date(d.timestamp * 1000);
                return `${dt.getHours().toString().padStart(2, '0')}:${dt.getMinutes().toString().padStart(2, '0')}`;
            });
            
            // å¤šå¤´æ•°æ®ï¼ˆç»¿è‰²ç³»ï¼‰
            const long_lte40Data = dataList.map(d => d.stats?.long?.lte_40 || 0);
            const long_lossData = dataList.map(d => d.stats?.long?.loss || 0);
            const long_gte80Data = dataList.map(d => d.stats?.long?.gte_80 || 0);
            const long_gte120Data = dataList.map(d => d.stats?.long?.gte_120 || 0);
            
            // ç©ºå•æ•°æ®ï¼ˆçº¢è‰²ç³»ï¼‰
            const short_lte40Data = dataList.map(d => d.stats?.short?.lte_40 || d.stats?.lte_40 || 0);
            const short_lossData = dataList.map(d => d.stats?.short?.loss || d.stats?.loss || 0);
            const short_gte80Data = dataList.map(d => d.stats?.short?.gte_80 || d.stats?.gte_80 || 0);
            const short_gte120Data = dataList.map(d => d.stats?.short?.gte_120 || d.stats?.gte_120 || 0);
            
            // 2å°æ—¶é€ƒé¡¶ä¿¡å·ï¼ˆæ©™è‰²ï¼‰
            const escape2hData = dataList.map(d => d.escape_signal_2h || 0);
            
            console.log('ğŸ“Š å›¾è¡¨æ•°æ®é•¿åº¦:', {
                times: times.length,
                long_lte40: long_lte40Data.length,
                long_loss: long_lossData.length,
                long_gte80: long_gte80Data.length,
                long_gte120: long_gte120Data.length,
                short_lte40: short_lte40Data.length,
                short_loss: short_lossData.length,
                short_gte80: short_gte80Data.length,
                short_gte120: short_gte120Data.length,
                escape2h: escape2hData.length
            });
            console.log('ğŸ“Š å‰3ä¸ªæ•°æ®æ ·æœ¬:', {
                times: times.slice(0, 3),
                short_gte120: short_gte120Data.slice(0, 3),
                escape2h: escape2hData.slice(0, 3)
            });
            
            // è®¡ç®—ç©ºå•ç›ˆåˆ©â‰¥120%å’Œç©ºå•äºæŸçš„æ ‡è®°ç‚¹
            const shortProfitMarks = [];
            const shortLossMarks = [];
            let lastShortProfitHour = null;
            let lastShortLossHour = null;
            
            dataList.forEach((d, index) => {
                const dt = new Date(d.datetime);
                const hour = `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')} ${String(dt.getHours()).padStart(2,'0')}`;
                
                const shortProfit120 = d.stats?.short?.gte_120 || 0;
                const shortLoss = d.stats?.short?.loss || 0;
                
                // ç©ºå•ç›ˆåˆ©â‰¥120%æ•°é‡â‰¥3ï¼Œæ¯å°æ—¶åªæ ‡è®°ä¸€æ¬¡
                if (shortProfit120 >= 3 && hour !== lastShortProfitHour) {
                    shortProfitMarks.push({
                        coord: [index, shortProfit120],
                        value: shortProfit120,
                        itemStyle: {
                            color: '#dc2626',  // çº¢è‰²
                            borderColor: '#fff',
                            borderWidth: 3
                        },
                        label: {
                            show: true,
                            formatter: 'ğŸ”´ ' + shortProfit120,
                            position: 'top',
                            color: '#dc2626',
                            fontSize: 14,
                            fontWeight: 'bold'
                        }
                    });
                    lastShortProfitHour = hour;
                    console.log(`ğŸ”´ æ ‡è®°ç©ºå•ç›ˆåˆ©â‰¥120%: ${d.datetime} - ${shortProfit120}ä¸ª`);
                }
                
                // ç©ºå•äºæŸæ•°é‡â‰¥3ï¼Œæ¯å°æ—¶åªæ ‡è®°ä¸€æ¬¡
                if (shortLoss >= 3 && hour !== lastShortLossHour) {
                    shortLossMarks.push({
                        coord: [index, shortLoss],
                        value: shortLoss,
                        itemStyle: {
                            color: '#10b981',  // ç»¿è‰²
                            borderColor: '#fff',
                            borderWidth: 3
                        },
                        label: {
                            show: true,
                            formatter: 'ğŸŸ¢ ' + shortLoss,
                            position: 'top',
                            color: '#10b981',
                            fontSize: 14,
                            fontWeight: 'bold'
                        }
                    });
                    lastShortLossHour = hour;
                    console.log(`ğŸŸ¢ æ ‡è®°ç©ºå•äºæŸ: ${d.datetime} - ${shortLoss}ä¸ª`);
                }
            });
            
            console.log(`ğŸ“ ç©ºå•ç›ˆåˆ©â‰¥120%æ ‡è®°æ•°: ${shortProfitMarks.length}, ç©ºå•äºæŸæ ‡è®°æ•°: ${shortLossMarks.length}`);
            
            // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
            const dateStr = targetDate.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
            const dayLabel = pageOffset === 0 ? 'ä»Šå¤©' : 
                           pageOffset === -1 ? 'æ˜¨å¤©' : 
                           pageOffset === -2 ? 'å‰å¤©' : 
                           `${Math.abs(pageOffset)}å¤©å‰`;
            
            const option = {
                title: {
                    text: `å¤šç©ºå•ç›ˆåˆ©åˆ†å¸ƒè¶‹åŠ¿ï¼ˆ${dateStr} ${dayLabel}ï¼‰`,
                    left: 'center',
                    textStyle: {
                        color: '#2d3748',
                        fontSize: 16
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        let result = params[0].axisValue + '<br/>';
                        params.forEach(param => {
                            result += `${param.marker} ${param.seriesName}: ${param.value} ä¸ª<br/>`;
                        });
                        return result;
                    }
                },
                legend: {
                    data: [
                        {name: 'ã€å¤šå¤´æŒ‡æ ‡ã€‘', textStyle: {fontWeight: 'bold', color: '#10b981'}},
                        'ğŸŸ¢ ç©ºå•ç›ˆåˆ©â‰¤40%',
                        'ğŸŸ¢ ç©ºå•äºæŸ',
                        {name: 'ã€ç©ºå¤´æŒ‡æ ‡ã€‘', textStyle: {fontWeight: 'bold', color: '#ef4444'}},
                        'ğŸ”´ ç©ºå•ç›ˆåˆ©â‰¥80%',
                        'ğŸ”´ ç©ºå•ç›ˆåˆ©â‰¥120%',
                        {name: 'ã€é€ƒé¡¶ä¿¡å·ã€‘', textStyle: {fontWeight: 'bold', color: '#f97316'}},
                        'âš¡ 2hé€ƒé¡¶ä¿¡å·'
                    ],
                    top: 35,
                    textStyle: {
                        color: '#2d3748',
                        fontSize: 11
                    }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '3%',
                    top: 95,
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: times,
                    axisLabel: {
                        rotate: 45,
                        color: '#718096',
                        fontSize: 10
                    }
                },
                yAxis: [
                    {
                        // å·¦Yè½´ï¼š2å°æ—¶é€ƒé¡¶ä¿¡å·æ•°é‡ï¼ˆæ©™è‰²ï¼‰
                        type: 'value',
                        name: '2hé€ƒé¡¶ä¿¡å·',
                        position: 'left',
                        minInterval: 1,
                        axisLabel: {
                            color: '#f97316',
                            formatter: '{value}'
                        },
                        axisLine: {
                            show: true,
                            lineStyle: {
                                color: '#f97316'
                            }
                        },
                        splitLine: {
                            show: true,
                            lineStyle: {
                                color: '#e5e7eb',
                                type: 'dashed'
                            }
                        }
                    },
                    {
                        // å³Yè½´ï¼šç©ºå•æ•°é‡ï¼ˆå¤šå¤´+ç©ºå¤´æŒ‡æ ‡ï¼‰
                        type: 'value',
                        name: 'ç©ºå•æ•°é‡',
                        position: 'right',
                        minInterval: 1,
                        axisLabel: {
                            color: '#4b5563',
                            formatter: '{value}'
                        },
                        axisLine: {
                            show: true,
                            lineStyle: {
                                color: '#4b5563'
                            }
                        },
                        splitLine: {
                            show: false
                        }
                    }
                ],
                series: [
                    // 2å°æ—¶é€ƒé¡¶ä¿¡å·ï¼ˆæ©™è‰²ï¼‰- ä½¿ç”¨å·¦Yè½´
                    {
                        name: 'âš¡ 2hé€ƒé¡¶ä¿¡å·',
                        type: 'line',
                        yAxisIndex: 0,  // ä½¿ç”¨å·¦Yè½´
                        data: escape2hData,
                        smooth: true,
                        itemStyle: { color: '#f97316' },
                        lineStyle: { width: 3, color: '#f97316', type: 'solid' },
                        symbol: 'diamond',
                        symbolSize: 7,
                        emphasis: {
                            focus: 'series',
                            itemStyle: {
                                borderColor: '#f97316',
                                borderWidth: 2
                            }
                        }
                    },
                    // å¤šå¤´æŒ‡æ ‡ï¼ˆç»¿è‰²ç³»ï¼‰- ç©ºå•ç›ˆåˆ©ä½çš„æƒ…å†µ - ä½¿ç”¨å³Yè½´
                    {
                        name: 'ğŸŸ¢ ç©ºå•ç›ˆåˆ©â‰¤40%',
                        type: 'line',
                        yAxisIndex: 1,  // ä½¿ç”¨å³Yè½´
                        data: short_lte40Data,
                        smooth: true,
                        itemStyle: { color: '#10b981' },
                        lineStyle: { width: 3, color: '#10b981' },
                        symbol: 'circle',
                        symbolSize: 6
                    },
                    {
                        name: 'ğŸŸ¢ ç©ºå•äºæŸ',
                        type: 'line',
                        yAxisIndex: 1,  // ä½¿ç”¨å³Yè½´
                        data: short_lossData,
                        smooth: true,
                        itemStyle: { color: '#059669' },
                        lineStyle: { width: 3, color: '#059669' },
                        symbol: 'circle',
                        symbolSize: 6,
                        markPoint: {
                            symbol: 'pin',
                            symbolSize: 60,
                            data: shortLossMarks
                        }
                    },
                    // ç©ºå¤´æŒ‡æ ‡ï¼ˆçº¢è‰²ç³»ï¼‰- ç©ºå•ç›ˆåˆ©é«˜çš„æƒ…å†µ - ä½¿ç”¨å³Yè½´
                    {
                        name: 'ğŸ”´ ç©ºå•ç›ˆåˆ©â‰¥80%',
                        type: 'line',
                        yAxisIndex: 1,  // ä½¿ç”¨å³Yè½´
                        data: short_gte80Data,
                        smooth: true,
                        itemStyle: { color: '#ef4444' },
                        lineStyle: { width: 3, color: '#ef4444' },
                        symbol: 'circle',
                        symbolSize: 6
                    },
                    {
                        name: 'ğŸ”´ ç©ºå•ç›ˆåˆ©â‰¥120%',
                        type: 'line',
                        yAxisIndex: 1,  // ä½¿ç”¨å³Yè½´
                        data: short_gte120Data,
                        smooth: true,
                        itemStyle: { color: '#991b1b' },
                        lineStyle: { width: 3, color: '#991b1b' },
                        symbol: 'circle',
                        symbolSize: 6,
                        markPoint: {
                            symbol: 'pin',
                            symbolSize: 60,
                            data: shortProfitMarks
                        }
                    }
                ]
            };
            
            profitStatsChart.setOption(option);
            
            // å¼ºåˆ¶åˆ·æ–°å›¾è¡¨å°ºå¯¸å¹¶éªŒè¯æ¸²æŸ“
            setTimeout(() => {
                profitStatsChart.resize();
                console.log('ğŸ”„ å›¾è¡¨å°ºå¯¸å·²åˆ·æ–°');
                console.log('ğŸ“ å›¾è¡¨å®¹å™¨é«˜åº¦:', document.getElementById('profitStatsChart').offsetHeight);
                console.log('ğŸ“Š Xè½´æ•°æ®ç‚¹æ•°:', times.length);
                console.log('ğŸ“Š ç©ºå•ç›ˆåˆ©â‰¥120%æ•°æ®ç‚¹æ•°:', short_gte120Data.length);
            }, 100);
            
            console.log('âœ… å¤šç©ºå•ç›ˆåˆ©ç»Ÿè®¡å›¾è¡¨æ¸²æŸ“å®Œæˆ');
        }

        // åŠ è½½ç©ºå•ç›ˆåˆ©ç»Ÿè®¡
        async function loadShortProfitStats() {
            try {
                const response = await fetch('/api/coin-change-tracker/latest');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const shortStats = result.data.short_stats || {};
                    
                    // æ›´æ–°ç©ºå•ç›ˆåˆ©â‰¥300%
                    document.getElementById('short300').textContent = shortStats.gte_300 || 0;
                    document.getElementById('short300_1h').textContent = shortStats.gte_300_1h || 0;
                    
                    // æ›´æ–°ç©ºå•ç›ˆåˆ©â‰¥250%
                    document.getElementById('short250').textContent = shortStats.gte_250 || 0;
                    document.getElementById('short250_1h').textContent = shortStats.gte_250_1h || 0;
                    
                    // æ›´æ–°ç©ºå•ç›ˆåˆ©â‰¥200%
                    document.getElementById('short200').textContent = shortStats.gte_200 || 0;
                    document.getElementById('short200_1h').textContent = shortStats.gte_200_1h || 0;
                    
                    // æ›´æ–°ç©ºå•ç›ˆåˆ©â‰¥150%
                    document.getElementById('short150').textContent = shortStats.gte_150 || 0;
                    document.getElementById('short150_1h').textContent = shortStats.gte_150_1h || 0;
                    
                    console.log('âœ… ç©ºå•ç›ˆåˆ©ç»Ÿè®¡æ›´æ–°å®Œæˆ:', shortStats);
                } else {
                    console.warn('âš ï¸ ç©ºå•ç›ˆåˆ©æ•°æ®æ ¼å¼ä¸æ­£ç¡®:', result);
                }
            } catch (error) {
                console.error('âŒ æ›´æ–°ç©ºå•ç›ˆåˆ©ç»Ÿè®¡å¼‚å¸¸:', error);
            }
        }

        // åŠ è½½SARæ–œç‡æ•°æ®
        async function loadSarSlopeData() {
            try {
                // è·å–æ‰€æœ‰å¸ç§åˆ—è¡¨
                const symbols = [
                    'BTC', 'ETH', 'XRP', 'BNB', 'SOL', 'LTC', 'DOGE', 'SUI', 
                    'TRX', 'TON', 'ETC', 'BCH', 'HBAR', 'XLM', 'FIL', 'LINK', 
                    'CRO', 'DOT', 'AAVE', 'UNI', 'NEAR', 'APT', 'CFX', 'CRV', 
                    'STX', 'LDO', 'TAO'
                ];
                
                // æ›´æ–°æ—¶é—´
                const now = new Date();
                const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                document.getElementById('sarUpdateTime').textContent = `æ›´æ–°æ—¶é—´: ${timeStr}`;
                
                // å¹¶å‘åŠ è½½æ‰€æœ‰å¸ç§çš„åå‘ç»Ÿè®¡
                const bullishSymbols = [];
                const bearishSymbols = [];
                
                const promises = symbols.map(symbol => 
                    fetch(`/api/sar-slope/current-cycle/${symbol}`)
                        .then(r => r.json())
                        .then(data => {
                            if (data.success && data.bias_statistics) {
                                const bullishRatio = data.bias_statistics.bullish_ratio || 0;
                                const bearishRatio = data.bias_statistics.bearish_ratio || 0;
                                
                                // åå¤šå æ¯” > 80%
                                if (bullishRatio > 80) {
                                    bullishSymbols.push({
                                        symbol: symbol,
                                        ratio: bullishRatio
                                    });
                                }
                                
                                // åç©ºå æ¯” > 80%
                                if (bearishRatio > 80) {
                                    bearishSymbols.push({
                                        symbol: symbol,
                                        ratio: bearishRatio
                                    });
                                }
                            }
                        })
                        .catch(e => console.warn(`${symbol} åŠ è½½å¤±è´¥:`, e))
                );
                
                await Promise.all(promises);
                
                // æ›´æ–°åå¤šæ¯” > 80%
                document.getElementById('sarBullishCount').textContent = bullishSymbols.length;
                if (bullishSymbols.length > 0) {
                    const coinList = bullishSymbols.map(c => 
                        `<div style="display: inline-block; margin: 6px; padding: 10px 16px; background: rgba(16, 185, 129, 0.25); border: 1.5px solid #10b981; border-radius: 8px; color: #065f46; font-weight: 600; font-size: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <span style="font-weight: 800; color: #059669;">${c.symbol}</span>
                            <span style="margin-left: 8px; color: #10b981; font-size: 14px;">${c.ratio.toFixed(1)}%</span>
                        </div>`
                    ).join('');
                    document.getElementById('sarBullishCoins').innerHTML = coinList;
                } else {
                    document.getElementById('sarBullishCoins').textContent = 'æš‚æ— ç¬¦åˆæ¡ä»¶çš„å¸ç§';
                }
                
                // æ›´æ–°åç©ºæ¯” > 80%
                document.getElementById('sarBearishCount').textContent = bearishSymbols.length;
                if (bearishSymbols.length > 0) {
                    const coinList = bearishSymbols.map(c => 
                        `<div style="display: inline-block; margin: 6px; padding: 10px 16px; background: rgba(239, 68, 68, 0.25); border: 1.5px solid #ef4444; border-radius: 8px; color: #7f1d1d; font-weight: 600; font-size: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <span style="font-weight: 800; color: #dc2626;">${c.symbol}</span>
                            <span style="margin-left: 8px; color: #ef4444; font-size: 14px;">${c.ratio.toFixed(1)}%</span>
                        </div>`
                    ).join('');
                    document.getElementById('sarBearishCoins').innerHTML = coinList;
                } else {
                    document.getElementById('sarBearishCoins').textContent = 'æš‚æ— ç¬¦åˆæ¡ä»¶çš„å¸ç§';
                }
                
                console.log('âœ… SARæ–œç‡æ•°æ®åŠ è½½å®Œæˆ', { bullish: bullishSymbols.length, bearish: bearishSymbols.length });
                
            } catch (error) {
                console.error('âŒ SARæ–œç‡æ•°æ®åŠ è½½å¤±è´¥:', error);
                document.getElementById('sarBullishCount').textContent = '--';
                document.getElementById('sarBearishCount').textContent = '--';
                document.getElementById('sarBullishCoins').innerHTML = '<span style="color: #dc2626;">âŒ åŠ è½½å¤±è´¥</span>';
                document.getElementById('sarBearishCoins').innerHTML = '<span style="color: #dc2626;">âŒ åŠ è½½å¤±è´¥</span>';
                document.getElementById('sarUpdateTime').textContent = `æ›´æ–°æ—¶é—´: å¤±è´¥`;
            }
        }

        // é€ƒé¡¶ä¿¡å·å›¾è¡¨
        let escapeSignalChart = null;
        
        // åˆå§‹åŒ–é€ƒé¡¶ä¿¡å·å›¾è¡¨ï¼ˆå®Œå…¨å¤åˆ¶escape-signal-historyçš„é…ç½®ï¼‰
        function initEscapeSignalChart() {
            const chartDom = document.getElementById('escapeSignalChart');
            if (!chartDom) {
                console.error('âŒ æ‰¾ä¸åˆ°escapeSignalChartå…ƒç´ ');
                return;
            }
            
            escapeSignalChart = echarts.init(chartDom);
            
            const option = {
                backgroundColor: '#ffffff',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(0,0,0,0.2)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['24å°æ—¶ä¿¡å·æ•°', '2å°æ—¶ä¿¡å·æ•°'],
                    textStyle: { color: '#000' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLine: { lineStyle: { color: 'rgba(0,0,0,0.3)' } },
                    axisLabel: { color: '#000', rotate: 45 }
                },
                yAxis: {
                    type: 'value',
                    name: 'ä¿¡å·æ•°é‡',
                    nameTextStyle: { color: '#000' },
                    axisLine: { lineStyle: { color: 'rgba(0,0,0,0.3)' } },
                    axisLabel: { color: '#000' },
                    splitLine: { lineStyle: { color: 'rgba(0,0,0,0.1)' } }
                },
                series: [
                    {
                        name: '24å°æ—¶ä¿¡å·æ•°',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#ef4444', width: 2 },
                        itemStyle: { color: '#ef4444' },
                        areaStyle: { color: 'rgba(239, 68, 68, 0.2)' }
                    },
                    {
                        name: '2å°æ—¶ä¿¡å·æ•°',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#f59e0b', width: 2 },
                        itemStyle: { color: '#f59e0b' },
                        areaStyle: { color: 'rgba(245, 158, 11, 0.2)' }
                    }
                ]
            };
            
            escapeSignalChart.setOption(option);
            console.log('âœ… é€ƒé¡¶ä¿¡å·å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®ï¼ˆå¹¶è¡ŒåŠ è½½OKXæ•°æ®ï¼‰
        function loadEscapeSignalData() {
            console.log('ğŸ” å¼€å§‹åŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®...');
            
            // å¹¶è¡ŒåŠ è½½é€ƒé¡¶ä¿¡å·æ•°æ®å’ŒOKXæ•°æ®
            Promise.all([
                fetch('/api/escape-signal-stats?limit=10080&v=' + Date.now()).then(r => r.json()),
                fetch('/api/okx-day-change/latest?limit=7200&v=' + Date.now()).then(r => r.json())
            ])
                .then(([escapeResult, okxResult]) => {
                    console.log('ğŸ“¡ æ•°æ®åŠ è½½å®Œæˆ');
                    const result = escapeResult;
                    console.log('ğŸ“Š é€ƒé¡¶ä¿¡å·æ•°æ®è§£æ:', {
                        success: result.success,
                        recent_data_count: result.recent_data ? result.recent_data.length : 0,
                        total_count: result.total_count
                    });
                    
                    // æ›´æ–°æ—¶é—´
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    document.getElementById('escapeChartUpdateTime').textContent = `æ›´æ–°æ—¶é—´: ${timeStr}`;
                    
                    if (!result.success) {
                        console.error('âŒ é€ƒé¡¶ä¿¡å·APIè¿”å›å¤±è´¥');
                        return;
                    }
                    
                    if (!result.recent_data || result.recent_data.length === 0) {
                        console.warn('âš ï¸ é€ƒé¡¶ä¿¡å·æš‚æ— æ•°æ®');
                        return;
                    }
                    
                    // æ›´æ–°å›¾è¡¨ - ä½¿ç”¨å…¨éƒ¨æ•°æ®ï¼ˆä¸escape-signal-historyä¸€è‡´ï¼‰
                    const times = result.recent_data.map(d => d.stat_time.substring(5, 16)); // MM-DD HH:MM
                    const signal24h = result.recent_data.map(d => d.signal_24h_count);
                    const signal2h = result.recent_data.map(d => d.signal_2h_count);
                    
                    // ç»Ÿè®¡ä¿¡æ¯
                    const max24h = Math.max(...signal24h);
                    const max2h = Math.max(...signal2h);
                    const nonZero24h = signal24h.filter(v => v > 0).length;
                    const nonZero2h = signal2h.filter(v => v > 0).length;
                    
                    console.log('ğŸ“ˆ æ•°æ®ç»Ÿè®¡:', {
                        æ€»ç‚¹æ•°: times.length,
                        æ—¶é—´èŒƒå›´: `${result.recent_data[0]?.stat_time} ~ ${result.recent_data[result.recent_data.length-1]?.stat_time}`,
                        '24hæœ€å¤§': max24h,
                        '2hæœ€å¤§': max2h,
                        '24héé›¶ç‚¹': nonZero24h,
                        '2héé›¶ç‚¹': nonZero2h
                    });
                    
                    // è®¡ç®—æ¯ä¸ªè‡ªç„¶æ—¥çš„2hæœ€é«˜ç‚¹ï¼ˆä»…æ ‡è®°>50çš„ï¼‰
                    const dailyPeaks = {};
                    result.recent_data.forEach((d, index) => {
                        const date = d.stat_time.substring(0, 10); // YYYY-MM-DD
                        const value = d.signal_2h_count;
                        
                        if (value > 50) {
                            if (!dailyPeaks[date] || value > dailyPeaks[date].value) {
                                dailyPeaks[date] = {
                                    index: index,
                                    value: value,
                                    time: d.stat_time
                                };
                            }
                        }
                    });
                    
                    // è®¡ç®—24å°æ—¶ä¿¡å·çš„48å°æ—¶çª—å£æœ€å¤§å€¼ï¼ˆä»…æ ‡è®°>200çš„ï¼‰
                    const window48hPeaks = [];
                    const windowSize = 48 * 60; // 48å°æ—¶ï¼Œå‡è®¾æ¯åˆ†é’Ÿä¸€ä¸ªæ•°æ®ç‚¹
                    
                    for (let i = 0; i < result.recent_data.length; i++) {
                        // æ‰¾åˆ°å½“å‰ä½ç½®å‰å48å°æ—¶å†…çš„æœ€å¤§å€¼
                        const startIndex = Math.max(0, i - windowSize / 2);
                        const endIndex = Math.min(result.recent_data.length - 1, i + windowSize / 2);
                        
                        let maxValue = 0;
                        let maxIndex = i;
                        
                        for (let j = startIndex; j <= endIndex; j++) {
                            const value = result.recent_data[j].signal_24h_count;
                            if (value > maxValue) {
                                maxValue = value;
                                maxIndex = j;
                            }
                        }
                        
                        // å¦‚æœå½“å‰ç‚¹æ˜¯çª—å£å†…çš„æœ€å¤§å€¼ï¼Œä¸”å¤§äº200ï¼Œåˆ™æ ‡è®°
                        if (maxIndex === i && maxValue > 200) {
                            // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨é™„è¿‘æ ‡è®°è¿‡ï¼ˆé¿å…é‡å¤æ ‡è®°ï¼‰
                            const isDuplicate = window48hPeaks.some(p => Math.abs(p.index - i) < windowSize / 4);
                            if (!isDuplicate) {
                                window48hPeaks.push({
                                    index: i,
                                    value: maxValue,
                                    time: result.recent_data[i].stat_time
                                });
                            }
                        }
                    }
                    
                    // æ„å»º2hä¿¡å·æ ‡è®°ç‚¹æ•°æ®ï¼ˆçº¢è‰²æ°”çƒæ ‡è®°ï¼‰
                    const markPointData2h = Object.values(dailyPeaks).map(peak => ({
                        coord: [peak.index, peak.value],
                        value: peak.value,
                        symbol: 'pin',
                        symbolSize: 60,
                        symbolOffset: [0, '-50%'],
                        itemStyle: {
                            color: '#ef4444',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: function(params) {
                                return 'ğŸ”¥ ' + params.value;
                            },
                            position: 'inside',
                            color: '#fff',
                            fontSize: 11,
                            fontWeight: 'bold',
                            offset: [0, 10]
                        }
                    }));
                    
                    // æ„å»º24hä¿¡å·48å°æ—¶å³°å€¼æ ‡è®°ç‚¹æ•°æ®ï¼ˆç´«è‰²æ°”çƒæ ‡è®°ï¼‰
                    const markPointData24h = window48hPeaks.map(peak => ({
                        coord: [peak.index, peak.value],
                        value: peak.value,
                        symbol: 'pin',
                        symbolSize: 70,
                        symbolOffset: [0, '-50%'],
                        itemStyle: {
                            color: '#8b5cf6',
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: function(params) {
                                return 'â­ ' + params.value;
                            },
                            position: 'inside',
                            color: '#fff',
                            fontSize: 12,
                            fontWeight: 'bold',
                            offset: [0, 12]
                        }
                    }));
                    
                    console.log('ğŸ“ æ¯æ—¥2hæœ€é«˜ç‚¹æ ‡è®°:', markPointData2h.length, 'ä¸ª');
                    console.log('â­ 24hä¿¡å·48å°æ—¶å³°å€¼æ ‡è®°:', markPointData24h.length, 'ä¸ª');
                    
                    // æç«¯å¸‚åœºæ ‡è®°æ•°ç»„
                    let extremeHighMarks = [];
                    let extremeLowMarks = [];
                    
                    // å¤„ç†OKXæ¶¨è·Œæ•°æ® - ä½¿ç”¨æœ€è¿‘é‚»æ’å€¼ï¼ˆä¸escape-signal-historyä¸€è‡´ï¼‰
                    let okxChangeData = [];
                    if (okxResult && okxResult.success && okxResult.data && okxResult.data.length > 0) {
                        // å°†OKXæ•°æ®è½¬æ¢ä¸ºå¸¦æ—¶é—´æˆ³çš„æ•°ç»„
                        const okxDataArray = okxResult.data.map(d => ({
                            timestamp: new Date(d.record_time).getTime(),
                            value: d.total_change
                        })).sort((a, b) => a.timestamp - b.timestamp);
                        
                        // å¯¹æ¯ä¸ªé€ƒé¡¶ä¿¡å·æ—¶é—´ç‚¹ï¼Œæ‰¾åˆ°æœ€è¿‘çš„OKXæ•°æ®
                        result.recent_data.forEach(d => {
                            const targetTime = new Date(d.stat_time).getTime();
                            
                            // æ‰¾åˆ°æœ€è¿‘çš„OKXæ•°æ®ç‚¹ï¼ˆä½¿ç”¨æœ€è¿‘é‚»æ’å€¼ï¼‰
                            let closestData = null;
                            let minDiff = Infinity;
                            
                            for (const okxPoint of okxDataArray) {
                                const diff = Math.abs(okxPoint.timestamp - targetTime);
                                // åªä½¿ç”¨30åˆ†é’Ÿå†…çš„æ•°æ®ç‚¹
                                if (diff < 30 * 60 * 1000 && diff < minDiff) {
                                    minDiff = diff;
                                    closestData = okxPoint.value;
                                }
                            }
                            
                            okxChangeData.push(closestData);
                        });
                        
                        console.log('ğŸ“Š OKXæ¶¨è·Œæ•°æ®å·²å¯¹é½:', okxChangeData.filter(v => v !== null).length, 'ä¸ªç‚¹');
                        
                        // æ£€æµ‹æç«¯å¸‚åœºæƒ…å†µï¼ˆ>=100% æˆ– <=-80%ï¼‰ï¼Œ1å°æ—¶å†…åªæ ‡è®°ä¸€æ¬¡
                        let lastExtremeHighHour = null;
                        let lastExtremeLowHour = null;
                        
                        okxChangeData.forEach((value, index) => {
                            if (value === null) return;
                            
                            const numValue = value;
                            const record = result.recent_data[index];
                            const statTime = new Date(record.stat_time);
                            const hourKey = `${statTime.getFullYear()}-${statTime.getMonth()+1}-${statTime.getDate()}-${statTime.getHours()}`;
                            
                            // æ£€æµ‹æç«¯ä¸Šæ¶¨ (>=100%)
                            if (numValue >= 100.0 && hourKey !== lastExtremeHighHour) {
                                extremeHighMarks.push({
                                    coord: [index, numValue],
                                    value: numValue.toFixed(2),
                                    symbol: 'pin',
                                    symbolSize: 90,
                                    symbolOffset: [0, '-50%'],
                                    itemStyle: {
                                        color: '#ff0000',
                                        borderColor: '#fff',
                                        borderWidth: 3
                                    },
                                    label: {
                                        show: true,
                                        position: 'inside',
                                        formatter: 'ğŸ’¥ ' + numValue.toFixed(1) + '%',
                                        color: '#fff',
                                        fontSize: 16,
                                        fontWeight: 'bold',
                                        offset: [0, 15]
                                    }
                                });
                                lastExtremeHighHour = hourKey;
                            }
                            
                            // æ£€æµ‹æç«¯æš´è·Œ (<=-80%)
                            if (numValue <= -80.0 && hourKey !== lastExtremeLowHour) {
                                extremeLowMarks.push({
                                    coord: [index, numValue],
                                    value: numValue.toFixed(2),
                                    symbol: 'pin',
                                    symbolSize: 90,
                                    symbolOffset: [0, '-50%'],
                                    itemStyle: {
                                        color: '#000000',
                                        borderColor: '#fff',
                                        borderWidth: 3
                                    },
                                    label: {
                                        show: true,
                                        position: 'inside',
                                        formatter: 'ğŸ’€ ' + numValue.toFixed(1) + '%',
                                        color: '#fff',
                                        fontSize: 16,
                                        fontWeight: 'bold',
                                        offset: [0, 15]
                                    }
                                });
                                lastExtremeLowHour = hourKey;
                            }
                        });
                        
                        console.log('ğŸ’¥ æç«¯ä¸Šæ¶¨æ ‡è®° (>=100%):', extremeHighMarks.length, 'ä¸ª');
                        console.log('ğŸ’€ æç«¯æš´è·Œæ ‡è®° (<=-80%):', extremeLowMarks.length, 'ä¸ª');
                    }
                    
                    // å§‹ç»ˆè¾“å‡ºæç«¯æ ‡è®°ç»Ÿè®¡ï¼ˆå³ä½¿ä¸º0ï¼‰
                    console.log('ğŸ’¥ æç«¯ä¸Šæ¶¨æ ‡è®° (>=100%):', extremeHighMarks.length, 'ä¸ª');
                    console.log('ğŸ’€ æç«¯æš´è·Œæ ‡è®° (<=-80%):', extremeLowMarks.length, 'ä¸ª');
                    
                    // æ›´æ–°å›¾è¡¨
                    if (escapeSignalChart) {
                        const series = [
                            { 
                                name: '24å°æ—¶ä¿¡å·æ•°',
                                type: 'line',
                                data: signal24h,
                                smooth: true,
                                lineStyle: { color: '#ef4444', width: 2 },
                                itemStyle: { color: '#ef4444' },
                                areaStyle: { color: 'rgba(239, 68, 68, 0.2)' },
                                markPoint: {
                                    data: markPointData24h
                                }
                            },
                            { 
                                name: '2å°æ—¶ä¿¡å·æ•°',
                                type: 'line',
                                data: signal2h,
                                smooth: true,
                                lineStyle: { color: '#f59e0b', width: 2 },
                                itemStyle: { color: '#f59e0b' },
                                areaStyle: { color: 'rgba(245, 158, 11, 0.2)' },
                                markPoint: {
                                    data: markPointData2h
                                }
                            }
                        ];
                        
                        // å¦‚æœæœ‰OKXæ•°æ®,æ·»åŠ ç¬¬ä¸‰æ¡æ›²çº¿
                        if (okxChangeData.length > 0 && okxChangeData.some(v => v !== null)) {
                            series.push({
                                name: 'OKX 27å¸ç§æ€»æ¶¨è·Œ%',
                                type: 'line',
                                yAxisIndex: 1,  // ä½¿ç”¨å³Yè½´
                                data: okxChangeData,
                                smooth: true,
                                itemStyle: { color: '#8b5cf6' },  // ç´«è‰²
                                lineStyle: { width: 3, color: '#8b5cf6' },
                                symbol: 'circle',
                                symbolSize: 6,
                                markPoint: {
                                    symbol: 'pin',
                                    symbolSize: 80,
                                    data: [...extremeHighMarks, ...extremeLowMarks]
                                }
                            });
                        }
                        
                        // è®¡ç®—OKXæ•°æ®çš„å®é™…èŒƒå›´ï¼ˆè‡ªé€‚åº”Yè½´ï¼‰
                        const validOkxData = okxChangeData.filter(v => v !== null && !isNaN(v));
                        let okxMin = 0, okxMax = 0;
                        if (validOkxData.length > 0) {
                            okxMin = Math.min(...validOkxData);
                            okxMax = Math.max(...validOkxData);
                            // æ·»åŠ 10%çš„è¾¹è·
                            const margin = Math.abs(okxMax - okxMin) * 0.1 || 5;
                            okxMin = okxMin - margin;
                            okxMax = okxMax + margin;
                        }
                        
                        console.log('ğŸ“Š OKXæ•°æ®èŒƒå›´:', { min: okxMin.toFixed(2), max: okxMax.toFixed(2), count: validOkxData.length });
                        
                        escapeSignalChart.setOption({
                            xAxis: { data: times },
                            legend: {
                                data: okxChangeData.length > 0 && okxChangeData.some(v => v !== null) 
                                    ? ['24å°æ—¶ä¿¡å·æ•°', '2å°æ—¶ä¿¡å·æ•°', 'OKX 27å¸ç§æ€»æ¶¨è·Œ%'] 
                                    : ['24å°æ—¶ä¿¡å·æ•°', '2å°æ—¶ä¿¡å·æ•°'],
                                textStyle: { color: '#000' },
                                top: 10
                            },
                            yAxis: [
                                {
                                    type: 'value',
                                    name: 'ä¿¡å·æ•°é‡',
                                    nameTextStyle: { color: '#000' },
                                    axisLine: { lineStyle: { color: 'rgba(0,0,0,0.3)' } },
                                    axisLabel: { color: '#000' },
                                    splitLine: { lineStyle: { color: 'rgba(0,0,0,0.1)' } }
                                },
                                {
                                    type: 'value',
                                    name: 'OKXæ€»æ¶¨è·Œ%',
                                    nameTextStyle: { color: '#8b5cf6' },
                                    position: 'right',
                                    min: okxMin,  // è‡ªé€‚åº”æœ€å°å€¼
                                    max: okxMax,  // è‡ªé€‚åº”æœ€å¤§å€¼
                                    axisLine: { 
                                        show: okxChangeData.length > 0 && okxChangeData.some(v => v !== null),
                                        lineStyle: { color: '#8b5cf6' } 
                                    },
                                    axisLabel: { 
                                        color: '#8b5cf6',
                                        formatter: '{value}%'
                                    },
                                    splitLine: { show: false }
                                }
                            ],
                            series: series
                        });
                        console.log('âœ… é€ƒé¡¶ä¿¡å·å›¾è¡¨æ›´æ–°å®Œæˆ(å«OKXæ¶¨è·Œæ›²çº¿)');
                    } else {
                        console.error('âŒ å›¾è¡¨å¯¹è±¡ä¸å­˜åœ¨');
                    }
                })
                .catch(error => {
                    console.error('âŒ é€ƒé¡¶ä¿¡å·æ•°æ®åŠ è½½å¤±è´¥:', error);
                    document.getElementById('escapeChartUpdateTime').textContent = `æ›´æ–°æ—¶é—´: å¤±è´¥`;
                });
        }

        // è¿›åº¦æ›´æ–°è¾…åŠ©å‡½æ•°
        function updateProgress(step, status = 'active', time = null) {
            console.log(`ğŸ“Š è¿›åº¦æ›´æ–°: æ­¥éª¤${step} - ${status} - ${time || '--'}ms`);
            const stepElement = document.querySelector(`.progress-step[data-step="${step}"]`);
            if (!stepElement) {
                console.warn(`âš ï¸ æ‰¾ä¸åˆ°æ­¥éª¤${step}çš„å…ƒç´ `);
                return;
            }
            
            // æ›´æ–°æ­¥éª¤çŠ¶æ€
            stepElement.classList.remove('active', 'completed');
            if (status === 'active') {
                stepElement.classList.add('active');
                stepElement.querySelector('.step-icon').textContent = 'â³';
            } else if (status === 'completed') {
                stepElement.classList.add('completed');
                stepElement.querySelector('.step-icon').textContent = 'âœ…';
            }
            
            // æ›´æ–°æ—¶é—´
            if (time !== null) {
                const timeElement = document.getElementById(`step${step}Time`);
                if (timeElement) {
                    timeElement.textContent = time + 'ms';
                }
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            const totalSteps = 6;
            const completedSteps = document.querySelectorAll('.progress-step.completed').length;
            const percentage = Math.round((completedSteps / totalSteps) * 100);
            console.log(`ğŸ“ˆ è¿›åº¦æ¡æ›´æ–°: ${completedSteps}/${totalSteps} = ${percentage}%`);
            document.getElementById('progressPercentage').textContent = percentage + '%';
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                console.log('â³ å¼€å§‹åŠ è½½ä¸»æ•°æ®...');
                const startTime = performance.now();
                
                // æ­¥éª¤1: åŠ è½½åŸºç¡€é…ç½®
                updateProgress(1, 'active');
                const configStartTime = performance.now();
                
                const [configRes, mainConfigRes] = await Promise.allSettled([
                    fetch('/api/sub-account/config'),
                    fetch('/api/anchor-system/auto-maintenance-config')
                ]);
                
                // å¤„ç†å­è´¦æˆ·é…ç½®
                try {
                    if (configRes.status === 'fulfilled' && configRes.value.ok) {
                        const configData = await configRes.value.json();
                        if (configData.success) {
                            const config = configData.config;
                            document.getElementById('followShortLoss').checked = config.follow_short_loss_enabled || false;
                            document.getElementById('followLongLoss').checked = config.follow_long_loss_enabled || false;
                            document.getElementById('subSuperMaintainLong').checked = config.super_maintain_long_enabled || false;
                            document.getElementById('subSuperMaintainShort').checked = config.super_maintain_short_enabled || false;
                            console.log('âœ… å­è´¦æˆ·é…ç½®å·²åŠ è½½:', config);
                        }
                    }
                } catch (error) {
                    console.error('åŠ è½½å­è´¦æˆ·é…ç½®å¤±è´¥:', error);
                }
                
                // å¤„ç†ä¸»è´¦æˆ·è‡ªåŠ¨ç»´æŠ¤é…ç½®
                try {
                    if (mainConfigRes.status === 'fulfilled' && mainConfigRes.value.ok) {
                        const mainConfigData = await mainConfigRes.value.json();
                        if (mainConfigData.success) {
                            const config = mainConfigData.config;
                            document.getElementById('autoMaintainLong').checked = config.auto_maintain_long_enabled || false;
                            document.getElementById('autoMaintainShort').checked = config.auto_maintain_short_enabled || false;
                            document.getElementById('superMaintainLong').checked = config.super_maintain_long_enabled || false;
                            document.getElementById('superMaintainShort').checked = config.super_maintain_short_enabled || false;
                            console.log('âœ… ä¸»è´¦æˆ·è‡ªåŠ¨ç»´æŠ¤é…ç½®å·²åŠ è½½:', config);
                        }
                    }
                } catch (error) {
                    console.error('åŠ è½½ä¸»è´¦æˆ·è‡ªåŠ¨ç»´æŠ¤é…ç½®å¤±è´¥:', error);
                }
                
                updateProgress(1, 'completed', (performance.now() - configStartTime).toFixed(0));
                
                // æ­¥éª¤2: è·å–ç³»ç»ŸçŠ¶æ€
                updateProgress(2, 'active');
                const statusStartTime = performance.now();
                
                const statusRes = await fetch('/api/anchor-system/status');
                
                // å¤„ç†çŠ¶æ€
                if (statusRes.ok) {
                    const statusData = await statusRes.json();
                    if (statusData.success) {
                        document.getElementById('totalMonitors').textContent = statusData.status.total_monitors;
                        document.getElementById('totalAlerts').textContent = statusData.status.total_alerts;
                        document.getElementById('profitTarget').textContent = '+' + statusData.status.config.profit_target + '%';
                        document.getElementById('lossLimit').textContent = statusData.status.config.loss_limit + '%';
                    }
                }
                
                updateProgress(2, 'completed', (performance.now() - statusStartTime).toFixed(0));
                
                // æ­¥éª¤3: åŠ è½½æŒä»“æ•°æ®
                updateProgress(3, 'active');
                const positionsStartTime = performance.now();
                
                const [positionsRes, subPositionsRes] = await Promise.allSettled([
                    fetch('/api/anchor-system/current-positions?trade_mode=real'),
                    fetch('/api/anchor-system/sub-account-positions?trade_mode=real')
                ]);
                
                // å¤„ç†å½“å‰æŒä»“æƒ…å†µ
                if (positionsRes.status === 'fulfilled' && positionsRes.value.ok) {
                    const positionsData = await positionsRes.value.json();
                    if (positionsData.success) {
                        renderCurrentPositions(positionsData.positions);
                        
                        const mainPositions = positionsData.positions || [];
                        const longCount = mainPositions.filter(p => p.pos_side === 'long').length;
                        const shortCount = mainPositions.filter(p => p.pos_side === 'short').length;
                        
                        document.getElementById('mainAccountCount').textContent = mainPositions.length;
                        document.getElementById('mainLongCount').textContent = longCount;
                        document.getElementById('mainShortCount').textContent = shortCount;
                        
                        const mainUpl = mainPositions.reduce((sum, p) => sum + (parseFloat(p.upl) || 0), 0);
                        const mainTotalProfitRate = mainPositions.reduce((sum, p) => sum + (parseFloat(p.profit_rate) || 0), 0);
                        const mainAvgRate = mainPositions.length > 0 ? (mainTotalProfitRate / mainPositions.length) : 0;
                        
                        const mainPnlElem = document.getElementById('mainAccountPnl');
                        mainPnlElem.textContent = (mainUpl >= 0 ? '+' : '') + mainUpl.toFixed(2);
                        mainPnlElem.style.color = mainUpl >= 0 ? '#2e7d32' : '#c62828';
                        
                        document.getElementById('mainAvgProfitRate').textContent = 
                            (mainAvgRate >= 0 ? '+' : '') + mainAvgRate.toFixed(2) + '%';
                    }
                }

                // å¤„ç†å­è´¦æˆ·æŒä»“æƒ…å†µ
                if (subPositionsRes.status === 'fulfilled' && subPositionsRes.value.ok) {
                    const subPositionsData = await subPositionsRes.value.json();
                    console.log('ğŸ‘¥ å­è´¦æˆ·æŒä»“æ•°æ®:', subPositionsData);
                    if (subPositionsData.success) {
                        renderSubAccountPositions(subPositionsData.positions);
                        
                        const subPositions = subPositionsData.positions || [];
                        const subAccounts = [...new Set(subPositions.map(p => p.account_name))];
                        
                        document.getElementById('subAccountCount').textContent = subPositions.length;
                        document.getElementById('subAccountNum').textContent = subAccounts.length;
                        document.getElementById('subAccountPositions').textContent = subPositions.length;
                        document.getElementById('subAccountPositionTime').textContent = 
                            `æœ€åæ›´æ–°: ${new Date().toLocaleString('zh-CN')}`;
                        
                        const subUpl = subPositions.reduce((sum, p) => sum + (parseFloat(p.upl) || 0), 0);
                        const subTotalProfitRate = subPositions.reduce((sum, p) => sum + (parseFloat(p.profit_rate) || 0), 0);
                        const subAvgRate = subPositions.length > 0 ? (subTotalProfitRate / subPositions.length) : 0;
                        
                        const subPnlElem = document.getElementById('subAccountPnl');
                        subPnlElem.textContent = (subUpl >= 0 ? '+' : '') + subUpl.toFixed(2);
                        subPnlElem.style.color = subUpl >= 0 ? '#1565c0' : '#c62828';
                        
                        document.getElementById('subAvgProfitRate').textContent = 
                            (subAvgRate >= 0 ? '+' : '') + subAvgRate.toFixed(2) + '%';
                    }
                }
                
                updateProgress(3, 'completed', (performance.now() - positionsStartTime).toFixed(0));
                
                // æ­¥éª¤4: åŠ è½½é¢„è­¦ä¿¡æ¯
                updateProgress(4, 'active');
                const warningsStartTime = performance.now();
                
                const [warningsRes, panicWashRes] = await Promise.allSettled([
                    fetch('/api/anchor-system/warnings?trade_mode=real'),
                    fetch('/api/panic/latest')
                ]);

                // å¤„ç†é¢„è­¦æ•°æ®
                if (warningsRes.status === 'fulfilled' && warningsRes.value.ok) {
                    const warningsData = await warningsRes.value.json();
                    console.log('ğŸš¨ é¢„è­¦æ•°æ®åŠ è½½:', warningsData);
                    if (warningsData.success) {
                        renderWarnings(warningsData.warnings);
                    }
                }
                
                // å¤„ç†ææ…Œæ¸…æ´—æŒ‡æ•°
                try {
                    if (panicWashRes.status === 'fulfilled' && panicWashRes.value.ok) {
                        const panicResponse = await panicWashRes.value.json();
                        console.log('ğŸ˜± ææ…Œæ¸…æ´—æŒ‡æ•°åŠ è½½:', panicResponse);
                        if (panicResponse && panicResponse.success && panicResponse.data) {
                            const panicData = panicResponse.data;
                            
                            // æ›´æ–°ææ…Œæ¸…æ´—æŒ‡æ•°ï¼ˆè½¬æ¢ä¸ºç™¾åˆ†æ¯”æ˜¾ç¤ºï¼‰
                            const panicIndex = (panicData.panic_index * 100).toFixed(2);
                            document.getElementById('panicWashIndex').textContent = panicIndex + '%';
                            
                            // æ ¹æ®æŒ‡æ•°æ˜¾ç¤ºçŠ¶æ€
                            let status = panicData.panic_level || 'æ­£å¸¸';
                            let color = panicData.level_color === 'red' ? '#dc2626' : 
                                       panicData.level_color === 'yellow' ? '#f59e0b' : '#10b981';
                            
                            const statusElem = document.getElementById('panicWashStatus');
                            statusElem.textContent = status;
                            statusElem.style.color = color;
                            
                            // æ›´æ–°å…¨ç½‘æŒä»“é‡
                            document.getElementById('totalPosition').textContent = panicData.total_position + ' äº¿';
                            
                            // æ›´æ–°1å°æ—¶çˆ†ä»“é‡‘é¢
                            document.getElementById('hourLiquidation').textContent = panicData.hour_1_amount + ' ä¸‡';
                            
                            console.log(`âœ… ææ…Œæ¸…æ´—æŒ‡æ•°: ${panicIndex}% (${status})`);
                            console.log(`âœ… å…¨ç½‘æŒä»“é‡: ${panicData.total_position}äº¿ç¾å…ƒ`);
                            console.log(`âœ… 1å°æ—¶çˆ†ä»“: ${panicData.hour_1_amount}ä¸‡ç¾å…ƒ`);
                        } else {
                            document.getElementById('panicWashIndex').textContent = '--';
                            document.getElementById('panicWashStatus').textContent = 'æš‚æ— æ•°æ®';
                            document.getElementById('totalPosition').textContent = '--';
                            document.getElementById('hourLiquidation').textContent = '--';
                        }
                    } else {
                        document.getElementById('panicWashIndex').textContent = '--';
                        document.getElementById('panicWashStatus').textContent = 'åŠ è½½å¤±è´¥';
                        document.getElementById('totalPosition').textContent = '--';
                        document.getElementById('hourLiquidation').textContent = '--';
                    }
                } catch (error) {
                    console.error('âŒ ææ…Œæ¸…æ´—æŒ‡æ•°åŠ è½½å¤±è´¥:', error);
                    document.getElementById('panicWashIndex').textContent = '--';
                    document.getElementById('panicWashStatus').textContent = 'é”™è¯¯';
                    document.getElementById('totalPosition').textContent = '--';
                    document.getElementById('hourLiquidation').textContent = '--';
                }
                
                updateProgress(4, 'completed', (performance.now() - warningsStartTime).toFixed(0));

                // æ›´æ–°æ—¶é—´
                const now = new Date();
                document.getElementById('updateTime').textContent = 
                    `æœ€åæ›´æ–°: ${now.toLocaleString('zh-CN')}`;
                document.getElementById('currentPositionTime').textContent = 
                    `æœ€åæ›´æ–°: ${now.toLocaleString('zh-CN')}`;
                
                console.log('âœ… å…³é”®æ•°æ®åŠ è½½å®Œæˆ');
                console.log(`âš¡ æ€»è€—æ—¶: ${(performance.now() - startTime).toFixed(0)}ms`);
                
                // æ­¥éª¤5: å»¶è¿ŸåŠ è½½æ¬¡è¦æ•°æ®ï¼ˆä¸é˜»å¡é¡µé¢æ˜¾ç¤ºï¼‰
                updateProgress(5, 'active');
                const secondaryStartTime = performance.now();
                
                setTimeout(async () => {
                    try {
                        const [
                            countRes,
                            monitorsRes,
                            alertsRes,
                            recordsRes
                        ] = await Promise.allSettled([
                            fetch('/api/latest'),
                            fetch('/api/anchor-system/monitors?limit=50'),
                            fetch('/api/anchor-system/alerts?limit=10'),
                            fetch('/api/anchor-system/profit-records-with-coins?trade_mode=real&limit=100')  // é™åˆ¶è¿”å›100æ¡
                        ]);
                        
                        // å¤„ç†è®¡æ¬¡æ•°æ®ï¼ˆä»/api/latestè·å–ï¼‰
                        if (countRes.status === 'fulfilled' && countRes.value.ok) {
                            const countData = await countRes.value.json();
                            // /api/latestè¿”å›çš„æ•°æ®åœ¨é¡¶å±‚ï¼Œä¸åœ¨dataå¯¹è±¡é‡Œ
                            const count = countData.count_aggregate || countData.count || 0;
                            const countScore = countData.count_score_display || '--';
                            document.getElementById('currentCount').textContent = count;
                            document.getElementById('countScore').textContent = countScore;
                            console.log('âœ… è®¡æ¬¡æ•°æ®åŠ è½½:', count, 'å¾—åˆ†:', countScore);
                        }
                        
                        // åŠ è½½å‡Œæ™¨2ç‚¹çš„è®¡æ¬¡æ•°æ®
                        try {
                            const am2Response = await fetch('/api/count/am2');
                            if (am2Response.ok) {
                                const am2Data = await am2Response.json();
                                if (am2Data.success) {
                                    document.getElementById('am2Count').textContent = am2Data.count || '--';
                                    document.getElementById('am2Time').textContent = am2Data.time || '--';
                                    console.log('âœ… å‡Œæ™¨2ç‚¹è®¡æ¬¡åŠ è½½:', am2Data.count, 'æ—¶é—´:', am2Data.time);
                                }
                            }
                        } catch (e) {
                            console.log('âš ï¸ å‡Œæ™¨2ç‚¹è®¡æ¬¡åŠ è½½å¤±è´¥:', e);
                        }
                        
                        // å¤„ç†ç›‘æ§è®°å½•
                        if (monitorsRes.status === 'fulfilled' && monitorsRes.value.ok) {
                            const monitorsData = await monitorsRes.value.json();
                            if (monitorsData.success) {
                                renderMonitorTable(monitorsData.data);
                                renderProfitChart(monitorsData.data);
                            }
                        }
                        
                        // å¤„ç†å‘Šè­¦è®°å½•
                        if (alertsRes.status === 'fulfilled' && alertsRes.value.ok) {
                            const alertsData = await alertsRes.value.json();
                            if (alertsData.success) {
                                renderAlerts(alertsData.data);
                            }
                        }
                        
                        // å¤„ç†å†å²æå€¼è®°å½• + 27å¸æ•°æ®
                        if (recordsRes.status === 'fulfilled' && recordsRes.value.ok) {
                            const recordsData = await recordsRes.value.json();
                            if (recordsData.success) {
                                renderRecordsTable(recordsData.records);
                                
                                // æ¸²æŸ“27å¸æ•°æ®
                                if (recordsData.coins_data) {
                                    renderCoinsData(recordsData.coins_data);
                                }
                            }
                        }
                        
                        updateProgress(5, 'completed', (performance.now() - secondaryStartTime).toFixed(0));
                        
                        // æ­¥éª¤6: æ¸²æŸ“ç»Ÿè®¡å›¾è¡¨
                        updateProgress(6, 'active');
                        const chartsStartTime = performance.now();
                        
                        // è¿™é‡Œå›¾è¡¨å·²ç»åœ¨ä¹‹å‰çš„æ­¥éª¤ä¸­æ¸²æŸ“äº†
                        // æ‰€ä»¥ç›´æ¥æ ‡è®°ä¸ºå®Œæˆ
                        updateProgress(6, 'completed', (performance.now() - chartsStartTime).toFixed(0));
                        
                        console.log(`âœ… æ¬¡è¦æ•°æ®åŠ è½½å®Œæˆï¼Œæ€»è€—æ—¶: ${(performance.now() - secondaryStartTime).toFixed(0)}ms`);
                        
                        // éšè—loadingç•Œé¢
                        setTimeout(() => {
                            document.getElementById('loading-indicator').classList.add('hidden');
                        }, 500);
                        
                    } catch (error) {
                        console.error('æ¬¡è¦æ•°æ®åŠ è½½å¤±è´¥:', error);
                        // å³ä½¿å¤±è´¥ä¹Ÿéšè—loading
                        document.getElementById('loading-indicator').classList.add('hidden');
                    }
                }, 100);

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                // å‡ºé”™æ—¶ä¹Ÿéšè—loading
                document.getElementById('loading-indicator').classList.add('hidden');
            }
        }

        // åŠ è½½æ”¯æ’‘é˜»åŠ›ä¿¡å·æ•°æ®
        // å…¨å±€å˜é‡ï¼šå­˜å‚¨å½“å‰è®°å½•æ•°æ®
        let currentRecordsData = [];

        // è®¡ç®—æŒç»­æ—¶é—´çš„å‡½æ•°ï¼ˆç‹¬ç«‹æŠ½å–ï¼Œæ–¹ä¾¿å®šæ—¶æ›´æ–°ï¼‰
        function calculateDuration(timestamp) {
            if (!timestamp) return '--';
            
            try {
                const now = new Date();
                const recordTime = new Date(timestamp.replace(' ', 'T') + '+08:00');
                const diffMs = now - recordTime;
                const totalHours = diffMs / (1000 * 60 * 60);
                
                if (totalHours < 0) {
                    return '<span style="color: #718096;">åˆšåˆš</span>';
                }
                
                const hours = Math.floor(totalHours);
                const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                const days = Math.floor(hours / 24);
                const remainHours = hours % 24;
                
                let color, text;
                
                if (hours < 1) {
                    color = '#10b981';
                    text = `${minutes}åˆ†é’Ÿ`;
                } else if (hours < 24) {
                    color = '#3b82f6';
                    text = `${hours}å°æ—¶${minutes}åˆ†`;
                } else if (days === 1) {
                    color = '#f59e0b';
                    text = `${days}å¤©${remainHours}å°æ—¶`;
                } else if (days === 2) {
                    color = '#f97316';
                    text = `${days}å¤©${remainHours}å°æ—¶`;
                } else {
                    color = '#ef4444';
                    text = `${days}å¤©${remainHours}å°æ—¶`;
                }
                
                return `<span style="color: ${color}; font-weight: 600;">${text}</span>`;
            } catch (e) {
                console.error('æ—¶é—´è§£æé”™è¯¯:', e, timestamp);
                return '--';
            }
        }

        // å­˜å‚¨å†å²ç›ˆåˆ©æ•°æ®ç”¨äºè®¡ç®—1å°æ—¶å†…å¢é‡
        let profitHistoryData = {
            profit120: [],
            profit110: [],
            profit100: [],
            profit90: [],
            profit80: [],
            profit70: [],
            profit60: [],
            profit50: [],
            profit40: [],
            profitBelow40: [],
            profitBelow30: [],
            profitBelow20: [],
            profitBelow10: [],
            lossCount: [],
            lastUpdate: null
        };

        // æ›´æ–°æ“ä½œæç¤ºçŠ¶æ€æ 
        function updateOperationStatusBar(stats) {
            const statusBar = document.getElementById('operationStatusBar');
            const statusIcon = document.getElementById('statusIcon');
            const statusTitle = document.getElementById('statusTitle');
            const statusHint = document.getElementById('statusHint');
            
            if (!statusBar || !statusIcon || !statusTitle || !statusHint) return;
            
            // å¸‚åœºä¸‹è·Œç­‰çº§åˆ†æï¼ˆåŸºäºç©ºå•ç›ˆåˆ©â‰¥40%çš„æ€»æ•°ï¼‰
            let marketDownLevel = 0;
            let marketDownLevelText = '';
            let marketDownIcon = '';
            
            if (stats.profit40 >= 10) {
                // 5çº§å’Œ4çº§ï¼šç©ºå•ç›ˆåˆ©â‰¥40%çš„æ€»æ•°å¤§äºç­‰äº10
                // éœ€è¦é¢å¤–åˆ¤æ–­æ¡ä»¶æ¥åŒºåˆ†5çº§å’Œ4çº§
                if (stats.profit50 >= 8 && stats.profit60 >= 5) {
                    marketDownLevel = 5;
                    marketDownLevelText = '5çº§ä¸‹è·Œ - æ·±åº¦ä¸‹è·Œ';
                    marketDownIcon = 'ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´';
                } else {
                    marketDownLevel = 4;
                    marketDownLevelText = '4çº§ä¸‹è·Œ - é‡åº¦ä¸‹è·Œ';
                    marketDownIcon = 'ğŸ”´ğŸ”´ğŸ”´ğŸ”´';
                }
            } else if (stats.profit40 >= 8) {
                marketDownLevel = 3;
                marketDownLevelText = '3çº§ä¸‹è·Œ - ä¸­åº¦ä¸‹è·Œ';
                marketDownIcon = 'ğŸ”´ğŸ”´ğŸ”´';
            } else if (stats.profit40 >= 5) {
                marketDownLevel = 2;
                marketDownLevelText = '2çº§ä¸‹è·Œ - è½»åº¦ä¸‹è·Œ';
                marketDownIcon = 'ğŸ”´ğŸ”´';
            }
            
            // æ–°çš„è§¦å‘è§„åˆ™
            // è§¦åº•åå¼¹ï¼šprofit70 >= 1 AND profit60 >= 2 AND profit50 >= 5 AND profit40 >= 8
            const isBottomRebound = stats.profit70 >= 1 && stats.profit60 >= 2 && stats.profit50 >= 5 && stats.profit40 >= 8;
            
            // å¤šè½¬ç©ºï¼šprofit70 == 0 AND profit50 >= 1 AND profit40 >= 3
            const isLongToShort = stats.profit70 === 0 && stats.profit50 >= 1 && stats.profit40 >= 3;
            
            // å¤šå¤´è¡Œæƒ…ï¼šprofitBelow20 >= 8 AND profitBelow10 >= 6 AND lossCount >= 2
            const isBullMarket = stats.profitBelow20 >= 8 && stats.profitBelow10 >= 6 && stats.lossCount >= 2;
            
            // ä¼˜å…ˆæ˜¾ç¤ºå¸‚åœºä¸‹è·Œç­‰çº§ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (marketDownLevel >= 2) {
                // æ˜¾ç¤ºå¸‚åœºä¸‹è·Œç­‰çº§
                statusBar.style.display = 'block';
                statusBar.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                statusBar.style.border = '3px solid #991b1b';
                statusIcon.textContent = marketDownIcon;
                statusTitle.textContent = `å¸‚åœºä¸‹è·Œç­‰çº§åˆ†æï¼š${marketDownLevelText}`;
                statusTitle.style.color = '#ffffff';
                statusHint.textContent = `ç©ºå•ç›ˆåˆ©â‰¥40%æ•°é‡: ${stats.profit40} | æ“ä½œæç¤ºï¼šæŒæœ‰ç©ºå•`;
                statusHint.style.color = '#fee2e2';
                console.log('ğŸ”´ çŠ¶æ€æ : å¸‚åœºä¸‹è·Œç­‰çº§', marketDownLevel, stats);
            } else if (isBullMarket) {
                // æ˜¾ç¤ºï¼šå¤šå¤´è¡Œæƒ… - é€‚åˆåšå¤š
                statusBar.style.display = 'block';
                statusBar.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                statusBar.style.border = '3px solid #1d4ed8';
                statusIcon.textContent = 'ğŸš€';
                statusTitle.textContent = 'å¤šå¤´è¡Œæƒ…';
                statusTitle.style.color = '#ffffff';
                statusHint.textContent = 'æ“ä½œæç¤ºï¼šé€‚åˆåšå¤š';
                statusHint.style.color = '#dbeafe';
                console.log('âœ… çŠ¶æ€æ : å¤šå¤´è¡Œæƒ…', stats);
            } else if (isBottomRebound) {
                // æ˜¾ç¤ºï¼šè§¦åº•åå¼¹ - ç¦æ­¢ç©ºå•
                statusBar.style.display = 'block';
                statusBar.style.background = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                statusBar.style.border = '3px solid #2f855a';
                statusIcon.textContent = 'ğŸ“ˆ';
                statusTitle.textContent = 'è§¦åº•åå¼¹';
                statusTitle.style.color = '#ffffff';
                statusHint.textContent = 'æ“ä½œæç¤ºï¼šç¦æ­¢ç©ºå•';
                statusHint.style.color = '#e6fffa';
                console.log('âœ… çŠ¶æ€æ : è§¦åº•åå¼¹', stats);
            } else if (isLongToShort) {
                // æ˜¾ç¤ºï¼šå¤šè½¬ç©º - ç¦æ­¢å¤šå•
                statusBar.style.display = 'block';
                statusBar.style.background = 'linear-gradient(135deg, #f56565 0%, #e53e3e 100%)';
                statusBar.style.border = '3px solid #c53030';
                statusIcon.textContent = 'ğŸ”„';
                statusTitle.textContent = 'å¤šè½¬ç©º';
                statusTitle.style.color = '#ffffff';
                statusHint.textContent = 'æ“ä½œæç¤ºï¼šç¦æ­¢å¤šå•';
                statusHint.style.color = '#fed7d7';
                console.log('âš ï¸ çŠ¶æ€æ : å¤šè½¬ç©º', stats);
            } else {
                // éšè—çŠ¶æ€æ 
                statusBar.style.display = 'none';
                console.log('â„¹ï¸ çŠ¶æ€æ éšè—', stats);
            }
        }

        // ä»…æ›´æ–°æŒç»­æ—¶é—´åˆ—ï¼ˆä¸é‡æ–°æ¸²æŸ“æ•´ä¸ªè¡¨æ ¼ï¼‰
        function updateDurations() {
            const tbody = document.getElementById('recordsBody');
            if (!tbody || currentRecordsData.length === 0) return;
            
            const rows = tbody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                if (index < currentRecordsData.length) {
                    const item = currentRecordsData[index];
                    const durationCell = row.querySelector('td:nth-child(9)'); // ç¬¬9åˆ—æ˜¯æŒç»­æ—¶é—´
                    if (durationCell && item.timestamp) {
                        durationCell.innerHTML = calculateDuration(item.timestamp);
                    }
                }
            });
            
            console.log('â° æŒç»­æ—¶é—´å·²æ›´æ–°');
        }

        // æ¸²æŸ“å†å²æå€¼è®°å½•è¡¨
        let showAllRecords = false; // æ˜¯å¦æ˜¾ç¤ºå…¨éƒ¨è®°å½•
        
        // ç¼“å­˜æ’åºæ˜ å°„ï¼Œé¿å…æ¯æ¬¡é‡æ–°åˆ›å»º
        const SORT_ORDER_MAP = (() => {
            // è‡ªå®šä¹‰æ’åºé¡ºåºï¼ˆæŒ‰ç”¨æˆ·æŒ‡å®šçš„é¡ºåºï¼‰
            const sortOrder = [
                // CFX
                ['CFX-USDT-SWAP', 'long', 'max_profit'],
                ['CFX-USDT-SWAP', 'long', 'max_loss'],
                ['CFX-USDT-SWAP', 'short', 'max_profit'],
                ['CFX-USDT-SWAP', 'short', 'max_loss'],
                // FIL
                ['FIL-USDT-SWAP', 'long', 'max_profit'],
                ['FIL-USDT-SWAP', 'long', 'max_loss'],
                ['FIL-USDT-SWAP', 'short', 'max_profit'],
                ['FIL-USDT-SWAP', 'short', 'max_loss'],
                // CRO
                ['CRO-USDT-SWAP', 'long', 'max_profit'],
                ['CRO-USDT-SWAP', 'long', 'max_loss'],
                ['CRO-USDT-SWAP', 'short', 'max_profit'],
                ['CRO-USDT-SWAP', 'short', 'max_loss'],
                // UNI
                ['UNI-USDT-SWAP', 'long', 'max_profit'],
                ['UNI-USDT-SWAP', 'long', 'max_loss'],
                ['UNI-USDT-SWAP', 'short', 'max_profit'],
                ['UNI-USDT-SWAP', 'short', 'max_loss'],
                // CRV
                ['CRV-USDT-SWAP', 'long', 'max_profit'],
                ['CRV-USDT-SWAP', 'long', 'max_loss'],
                ['CRV-USDT-SWAP', 'short', 'max_profit'],
                ['CRV-USDT-SWAP', 'short', 'max_loss'],
                // LDO
                ['LDO-USDT-SWAP', 'long', 'max_profit'],
                ['LDO-USDT-SWAP', 'long', 'max_loss'],
                ['LDO-USDT-SWAP', 'short', 'max_profit'],
                ['LDO-USDT-SWAP', 'short', 'max_loss'],
                // STX
                ['STX-USDT-SWAP', 'long', 'max_profit'],
                ['STX-USDT-SWAP', 'long', 'max_loss'],
                ['STX-USDT-SWAP', 'short', 'max_profit'],
                ['STX-USDT-SWAP', 'short', 'max_loss'],
                // BCH
                ['BCH-USDT-SWAP', 'long', 'max_profit'],
                ['BCH-USDT-SWAP', 'long', 'max_loss'],
                ['BCH-USDT-SWAP', 'short', 'max_profit'],
                ['BCH-USDT-SWAP', 'short', 'max_loss'],
                // SOL
                ['SOL-USDT-SWAP', 'long', 'max_profit'],
                ['SOL-USDT-SWAP', 'long', 'max_loss'],
                ['SOL-USDT-SWAP', 'short', 'max_profit'],
                ['SOL-USDT-SWAP', 'short', 'max_loss'],
                // XLM
                ['XLM-USDT-SWAP', 'long', 'max_profit'],
                ['XLM-USDT-SWAP', 'long', 'max_loss'],
                ['XLM-USDT-SWAP', 'short', 'max_profit'],
                ['XLM-USDT-SWAP', 'short', 'max_loss'],
                // TAO
                ['TAO-USDT-SWAP', 'long', 'max_profit'],
                ['TAO-USDT-SWAP', 'long', 'max_loss'],
                ['TAO-USDT-SWAP', 'short', 'max_profit'],
                ['TAO-USDT-SWAP', 'short', 'max_loss'],
                // APT
                ['APT-USDT-SWAP', 'long', 'max_profit'],
                ['APT-USDT-SWAP', 'long', 'max_loss'],
                ['APT-USDT-SWAP', 'short', 'max_profit'],
                ['APT-USDT-SWAP', 'short', 'max_loss'],
                // TON
                ['TON-USDT-SWAP', 'long', 'max_profit'],
                ['TON-USDT-SWAP', 'long', 'max_loss'],
                ['TON-USDT-SWAP', 'short', 'max_profit'],
                ['TON-USDT-SWAP', 'short', 'max_loss'],
                // HBAR
                ['HBAR-USDT-SWAP', 'long', 'max_profit'],
                ['HBAR-USDT-SWAP', 'long', 'max_loss'],
                ['HBAR-USDT-SWAP', 'short', 'max_profit'],
                ['HBAR-USDT-SWAP', 'short', 'max_loss'],
                // XRP
                ['XRP-USDT-SWAP', 'long', 'max_profit'],
                ['XRP-USDT-SWAP', 'long', 'max_loss'],
                ['XRP-USDT-SWAP', 'short', 'max_profit'],
                ['XRP-USDT-SWAP', 'short', 'max_loss'],
                // NEAR
                ['NEAR-USDT-SWAP', 'long', 'max_profit'],
                ['NEAR-USDT-SWAP', 'long', 'max_loss'],
                ['NEAR-USDT-SWAP', 'short', 'max_profit'],
                ['NEAR-USDT-SWAP', 'short', 'max_loss'],
                // TRX
                ['TRX-USDT-SWAP', 'long', 'max_profit'],
                ['TRX-USDT-SWAP', 'long', 'max_loss'],
                ['TRX-USDT-SWAP', 'short', 'max_profit'],
                ['TRX-USDT-SWAP', 'short', 'max_loss'],
                // DOT
                ['DOT-USDT-SWAP', 'long', 'max_profit'],
                ['DOT-USDT-SWAP', 'long', 'max_loss'],
                ['DOT-USDT-SWAP', 'short', 'max_profit'],
                ['DOT-USDT-SWAP', 'short', 'max_loss'],
                // BNB
                ['BNB-USDT-SWAP', 'long', 'max_profit'],
                ['BNB-USDT-SWAP', 'long', 'max_loss'],
                ['BNB-USDT-SWAP', 'short', 'max_profit'],
                ['BNB-USDT-SWAP', 'short', 'max_loss'],
                // LINK
                ['LINK-USDT-SWAP', 'long', 'max_profit'],
                ['LINK-USDT-SWAP', 'long', 'max_loss'],
                ['LINK-USDT-SWAP', 'short', 'max_profit'],
                ['LINK-USDT-SWAP', 'short', 'max_loss'],
                // DOGE
                ['DOGE-USDT-SWAP', 'long', 'max_profit'],
                ['DOGE-USDT-SWAP', 'long', 'max_loss'],
                ['DOGE-USDT-SWAP', 'short', 'max_profit'],
                ['DOGE-USDT-SWAP', 'short', 'max_loss'],
                // SUI
                ['SUI-USDT-SWAP', 'long', 'max_profit'],
                ['SUI-USDT-SWAP', 'long', 'max_loss'],
                ['SUI-USDT-SWAP', 'short', 'max_profit'],
                ['SUI-USDT-SWAP', 'short', 'max_loss'],
                // AAVE
                ['AAVE-USDT-SWAP', 'long', 'max_profit'],
                ['AAVE-USDT-SWAP', 'long', 'max_loss'],
                ['AAVE-USDT-SWAP', 'short', 'max_profit'],
                ['AAVE-USDT-SWAP', 'short', 'max_loss']
            ];
            
            const orderMap = {};
            sortOrder.forEach((item, index) => {
                const key = `${item[0]}_${item[1]}_${item[2]}`;
                orderMap[key] = index;
            });
            return orderMap;
        })();
        
        // æ¸²æŸ“27å¸å®æ—¶æ¶¨è·Œæ•°æ®
        function renderCoinsData(coinsData) {
            if (!coinsData || !coinsData.coins || coinsData.coins.length === 0) {
                document.getElementById('coinsDataCard').style.display = 'none';
                return;
            }
            
            // æ˜¾ç¤ºå¡ç‰‡
            document.getElementById('coinsDataCard').style.display = 'block';
            
            // æ›´æ–°æ—¶é—´
            if (coinsData.datetime) {
                document.getElementById('coinsDataTime').textContent = `æ›´æ–°æ—¶é—´: ${coinsData.datetime}`;
            }
            
            // æ›´æ–°æ€»æ¶¨è·Œ
            const totalChange = coinsData.total_change || 0;
            const totalChangeColor = totalChange >= 0 ? '#48bb78' : '#f56565';
            document.getElementById('coinsTotalChange').innerHTML = `
                <span style="color: ${totalChangeColor}">
                    ${totalChange >= 0 ? '+' : ''}${totalChange.toFixed(2)}%
                </span>
            `;
            
            // æ¸²æŸ“å¸ç§ç½‘æ ¼
            const grid = document.getElementById('coinsGrid');
            grid.innerHTML = '';
            
            coinsData.coins.forEach(coin => {
                const changePercent = coin.day_change_percent || 0;
                const changeColor = changePercent >= 0 ? '#48bb78' : '#f56565';
                const changeBg = changePercent >= 0 ? 'rgba(72, 187, 120, 0.1)' : 'rgba(245, 101, 101, 0.1)';
                
                const card = document.createElement('div');
                card.style.cssText = `
                    padding: 12px;
                    background: white;
                    border-radius: 8px;
                    border: 1px solid #e2e8f0;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                    transition: all 0.2s;
                `;
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                        <div style="font-weight: 700; color: #2d3748; font-size: 15px;">${coin.symbol}</div>
                        <div style="background: ${changeBg}; padding: 4px 8px; border-radius: 6px;">
                            <span style="color: ${changeColor}; font-weight: 600; font-size: 13px;">
                                ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%
                            </span>
                        </div>
                    </div>
                    <div style="color: #4a5568; font-size: 14px; font-weight: 600;">
                        $${coin.current_price.toFixed(4)}
                    </div>
                `;
                
                // é¼ æ ‡æ‚¬åœæ•ˆæœ
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-2px)';
                    card.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                    card.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                });
                
                grid.appendChild(card);
            });
            
            console.log('âœ… 27å¸æ•°æ®æ¸²æŸ“å®Œæˆ:', coinsData.coins.length, 'ä¸ªå¸ç§');
        }
        
        function renderRecordsTable(data, forceShowAll = false) {
            currentRecordsData = data; // ä¿å­˜æ•°æ®ä¾›æŒç»­æ—¶é—´æ›´æ–°ä½¿ç”¨
            const tbody = document.getElementById('recordsBody');
            
            console.log('ğŸ” renderRecordsTable è¢«è°ƒç”¨');
            console.log('  æ•°æ®ç±»å‹:', typeof data);
            console.log('  æ•°æ®é•¿åº¦:', data ? data.length : 'null');
            
            if (!data || data.length === 0) {
                console.log('âš ï¸ å†å²è®°å½•æ•°æ®ä¸ºç©º');
                tbody.innerHTML = '<tr><td colspan="10" class="empty">æš‚æ— å†å²è®°å½•</td></tr>';
                // æ¸…ç©ºç»Ÿè®¡
                document.getElementById('hourlyLongProfit').textContent = '0';
                document.getElementById('hourlyLongLoss').textContent = '0';
                document.getElementById('hourlyShortProfit').textContent = '0';
                document.getElementById('hourlyShortLoss').textContent = '0';
                return;
            }
            
            console.log('âœ… å¼€å§‹æ¸²æŸ“å†å²è®°å½•...');
            
            if (forceShowAll) {
                showAllRecords = true;
            }
            
            // è®¡ç®—1å°æ—¶å†…çš„ç»Ÿè®¡
            const oneHourAgo = Date.now() - 60 * 60 * 1000;
            let longProfit = 0, longLoss = 0, shortProfit = 0, shortLoss = 0;
            
            data.forEach(item => {
                const timestamp = new Date(item.timestamp).getTime();
                if (timestamp > oneHourAgo) {
                    const isLong = item.pos_side === 'long';
                    const isProfit = item.record_type === 'max_profit';
                    
                    if (isLong && isProfit) longProfit++;
                    else if (isLong && !isProfit) longLoss++;
                    else if (!isLong && isProfit) shortProfit++;
                    else if (!isLong && !isProfit) shortLoss++;
                }
            });
            
            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            document.getElementById('hourlyLongProfit').textContent = longProfit;
            document.getElementById('hourlyLongLoss').textContent = longLoss;
            document.getElementById('hourlyShortProfit').textContent = shortProfit;
            document.getElementById('hourlyShortLoss').textContent = shortLoss;
            
            console.log(`ğŸ“Š 1å°æ—¶å†…ç»Ÿè®¡: å¤šå•ç›ˆåˆ©${longProfit}, å¤šå•äºæŸ${longLoss}, ç©ºå•ç›ˆåˆ©${shortProfit}, ç©ºå•äºæŸ${shortLoss}`);
            
            // å¸ç§ç¼–å·æ˜ å°„ï¼ˆæŒ‰å¼€ä»“é¡ºåºï¼‰
            const coinNumbers = {
                'CFX-USDT-SWAP': 'NO.1',
                'FIL-USDT-SWAP': 'NO.2',
                'CRO-USDT-SWAP': 'NO.3',
                'UNI-USDT-SWAP': 'NO.4',
                'CRV-USDT-SWAP': 'NO.5',
                'LDO-USDT-SWAP': 'NO.6',
                'STX-USDT-SWAP': 'NO.7',
                'BCH-USDT-SWAP': 'NO.8',
                'SOL-USDT-SWAP': 'NO.9',
                'XLM-USDT-SWAP': 'NO.10',
                'TAO-USDT-SWAP': 'NO.11',
                'APT-USDT-SWAP': 'NO.12',
                'TON-USDT-SWAP': 'NO.13',
                'HBAR-USDT-SWAP': 'NO.14',
                'XRP-USDT-SWAP': 'NO.15',
                'NEAR-USDT-SWAP': 'NO.16',
                'TRX-USDT-SWAP': 'NO.17',
                'DOT-USDT-SWAP': 'NO.18',
                'BNB-USDT-SWAP': 'NO.19',
                'LINK-USDT-SWAP': 'NO.20',
                'DOGE-USDT-SWAP': 'NO.21',
                'SUI-USDT-SWAP': 'NO.22',
                'AAVE-USDT-SWAP': 'NO.23'
            };
            
            // å¯¹æ•°æ®è¿›è¡Œæ’åºï¼ˆä½¿ç”¨ç¼“å­˜çš„æ’åºæ˜ å°„ï¼‰
            const sortedData = [...data].sort((a, b) => {
                const keyA = `${a.inst_id}_${a.pos_side}_${a.record_type}`;
                const keyB = `${b.inst_id}_${b.pos_side}_${b.record_type}`;
                const orderA = SORT_ORDER_MAP[keyA] !== undefined ? SORT_ORDER_MAP[keyA] : 999999;
                const orderB = SORT_ORDER_MAP[keyB] !== undefined ? SORT_ORDER_MAP[keyB] : 999999;
                return orderA - orderB;
            });
            
            console.log('âœ… æ•°æ®å·²æŒ‰è‡ªå®šä¹‰é¡ºåºæ’åº');
            
            // åªæ˜¾ç¤ºå‰30æ¡è®°å½•ï¼ˆåˆå§‹åŠ è½½æ—¶ï¼‰ï¼Œç‚¹å‡»"æ˜¾ç¤ºå…¨éƒ¨"åæ˜¾ç¤ºæ‰€æœ‰
            const displayData = showAllRecords ? sortedData : sortedData.slice(0, 30);
            const hasMore = sortedData.length > 30 && !showAllRecords;
            
            try {
                // ä½¿ç”¨DocumentFragmentæé«˜æ€§èƒ½
                const fragment = document.createDocumentFragment();
                
                displayData.forEach(item => {
                    const tr = document.createElement('tr');
                    
                    // è®¡ç®—æŒç»­æ—¶é—´
                    const durationHtml = calculateDuration(item.timestamp);
                    // è·å–ç¼–å·
                    const coinNumber = coinNumbers[item.inst_id] || '--';
                    
                    tr.innerHTML = `
                        <td style="font-weight: 700; color: #667eea;">${coinNumber}</td>
                        <td>${item.inst_id || '--'}</td>
                        <td>
                            <span class="badge ${item.pos_side === 'short' ? 'badge-short' : 'badge-long'}">
                                ${item.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${item.record_type === 'max_profit' ? 'badge-profit' : 'badge-loss'}">
                                ${item.record_type === 'max_profit' ? 'ğŸ† æœ€é«˜ç›ˆåˆ©' : 'ğŸ“‰ æœ€å¤§äºæŸ'}
                            </span>
                        </td>
                        <td style="color: ${(item.profit_rate || 0) >= 0 ? '#48bb78' : '#f56565'}; font-weight: 700; font-size: 16px;">
                            ${(item.profit_rate || 0) >= 0 ? '+' : ''}${(item.profit_rate || 0).toFixed(2)}%
                        </td>
                        <td>${item.pos_size !== null && item.pos_size !== undefined ? Math.abs(parseFloat(item.pos_size)).toFixed(4) : '--'}</td>
                        <td>${item.avg_price !== null && item.avg_price !== undefined ? '$' + parseFloat(item.avg_price).toFixed(4) : '--'}</td>
                        <td>${item.mark_price !== null && item.mark_price !== undefined ? '$' + parseFloat(item.mark_price).toFixed(4) : '--'}</td>
                        <td>${item.timestamp || '--'}</td>
                        <td>${durationHtml}</td>
                    `;
                    
                    fragment.appendChild(tr);
                });
                
                // å¦‚æœæœ‰æ›´å¤šè®°å½•ï¼Œæ·»åŠ "æ˜¾ç¤ºå…¨éƒ¨"æŒ‰é’®
                if (hasMore) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td colspan="10" style="text-align: center; padding: 20px;">
                            <button onclick="renderRecordsTable(currentRecordsData, true)" 
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                           color: white; border: none; padding: 10px 30px; 
                                           border-radius: 8px; cursor: pointer; font-size: 14px; 
                                           font-weight: 600; transition: all 0.3s;">
                                ğŸ“‹ æ˜¾ç¤ºå…¨éƒ¨ ${sortedData.length} æ¡è®°å½•ï¼ˆå½“å‰æ˜¾ç¤º ${displayData.length} æ¡ï¼‰
                            </button>
                        </td>
                    `;
                    fragment.appendChild(tr);
                }
                
                // ä¸€æ¬¡æ€§æ¸…ç©ºå¹¶æ’å…¥æ‰€æœ‰è¡Œ
                tbody.innerHTML = '';
                tbody.appendChild(fragment);
                
                console.log(`âœ… å†å²è®°å½•æ¸²æŸ“å®Œæˆï¼Œæ˜¾ç¤º ${displayData.length}/${sortedData.length} æ¡`);
            } catch (error) {
                console.error('âŒ æ¸²æŸ“å†å²è®°å½•å¤±è´¥:', error);
                tbody.innerHTML = '<tr><td colspan="10" class="empty">æ¸²æŸ“å¤±è´¥ï¼Œè¯·æŸ¥çœ‹Console</td></tr>';
            }
        }

        // æ¸²æŸ“å½“å‰æŒä»“æƒ…å†µ
        function renderCurrentPositions(data) {
            const tbody = document.getElementById('currentPositionBody');
            const statsDiv = document.getElementById('positionStats');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="15" class="empty">å½“å‰æ— æŒä»“</td></tr>';
                statsDiv.innerHTML = '';
                // æ¸…ç©ºç›ˆåˆ©ç»Ÿè®¡æ˜¾ç¤º
                document.getElementById('profit120Plus').textContent = '0';
                document.getElementById('profit110Plus').textContent = '0';
                document.getElementById('profit100Plus').textContent = '0';
                document.getElementById('profit90Plus').textContent = '0';
                document.getElementById('profit80Plus').textContent = '0';
                document.getElementById('profit70Plus').textContent = '0';
                document.getElementById('profit60Plus').textContent = '0';
                document.getElementById('profit50Plus').textContent = '0';
                document.getElementById('profit40Plus').textContent = '0';
                document.getElementById('profitBelow40').textContent = '0';
                document.getElementById('profitBelow30').textContent = '0';
                document.getElementById('profitBelow20').textContent = '0';
                document.getElementById('profitBelow10').textContent = '0';
                document.getElementById('lossCount').textContent = '0';
                document.getElementById('profit120Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit110Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit100Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit90Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit80Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit70Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit60Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit50Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profit40Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profitBelow40Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profitBelow30Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profitBelow20Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('profitBelow10Increase').textContent = '1å°æ—¶å†…: --';
                document.getElementById('lossCountIncrease').textContent = '1å°æ—¶å†…: --';
                return;
            }

            // ç»Ÿè®¡åšç©ºæŒä»“å„ç›ˆåˆ©çº§åˆ«
            const shortPositions = data.filter(item => item.pos_side === 'short');
            const profit120 = shortPositions.filter(item => item.profit_rate >= 120).length;
            const profit110 = shortPositions.filter(item => item.profit_rate >= 110).length;
            const profit100 = shortPositions.filter(item => item.profit_rate >= 100).length;
            const profit90 = shortPositions.filter(item => item.profit_rate >= 90).length;
            const profit80 = shortPositions.filter(item => item.profit_rate >= 80).length;
            const profit70 = shortPositions.filter(item => item.profit_rate >= 70).length;
            const profit60 = shortPositions.filter(item => item.profit_rate >= 60).length;
            const profit50 = shortPositions.filter(item => item.profit_rate >= 50).length;
            const profit40 = shortPositions.filter(item => item.profit_rate >= 40).length;
            const profitBelow40 = shortPositions.filter(item => item.profit_rate > 0 && item.profit_rate <= 40).length;
            const profitBelow30 = shortPositions.filter(item => item.profit_rate > 0 && item.profit_rate <= 30).length;
            const profitBelow20 = shortPositions.filter(item => item.profit_rate > 0 && item.profit_rate <= 20).length;
            const profitBelow10 = shortPositions.filter(item => item.profit_rate > 0 && item.profit_rate <= 10).length;
            const lossCount = shortPositions.filter(item => item.profit_rate < 0).length;
            const lossBelow10 = shortPositions.filter(item => item.profit_rate <= -10).length;
            
            // æ›´æ–°é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡
            document.getElementById('profit120Plus').textContent = profit120;
            document.getElementById('profit110Plus').textContent = profit110;
            document.getElementById('profit100Plus').textContent = profit100;
            document.getElementById('profit90Plus').textContent = profit90;
            document.getElementById('profit80Plus').textContent = profit80;
            document.getElementById('profit70Plus').textContent = profit70;
            document.getElementById('profit60Plus').textContent = profit60;
            document.getElementById('profit50Plus').textContent = profit50;
            document.getElementById('profit40Plus').textContent = profit40;
            document.getElementById('profitBelow40').textContent = profitBelow40;
            document.getElementById('profitBelow30').textContent = profitBelow30;
            document.getElementById('profitBelow20').textContent = profitBelow20;
            document.getElementById('profitBelow10').textContent = profitBelow10;
            document.getElementById('lossCount').textContent = lossCount;
            
            // è®¡ç®—å¹¶æ›´æ–°å¸‚åœºä¸‹è·Œç­‰çº§
            updateDropLevel(profit100, profit90, profit80, profit70, profit60, profit50, profit40);
            
            // è®¡ç®—å¹¶æ›´æ–°å¸‚åœºä¸Šæ¶¨ç­‰çº§ï¼ˆåŸºäºç©ºå•äºæŸï¼‰
            const shortProfitCount = shortPositions.filter(item => item.profit_rate > 0).length;
            updateRiseLevel(lossCount, shortProfitCount);
            
            // è®¡ç®—1å°æ—¶å†…å¢é‡
            const now = Date.now();
            const oneHourAgo = now - 60 * 60 * 1000;
            
            // ä¿å­˜å½“å‰æ•°æ®åˆ°å†å²
            if (!profitHistoryData.lastUpdate || now - profitHistoryData.lastUpdate > 60000) {
                // æ¯åˆ†é’Ÿè®°å½•ä¸€æ¬¡
                profitHistoryData.profit120.push({ time: now, count: profit120 });
                profitHistoryData.profit110.push({ time: now, count: profit110 });
                profitHistoryData.profit100.push({ time: now, count: profit100 });
                profitHistoryData.profit90.push({ time: now, count: profit90 });
                profitHistoryData.profit80.push({ time: now, count: profit80 });
                profitHistoryData.profit70.push({ time: now, count: profit70 });
                profitHistoryData.profit60.push({ time: now, count: profit60 });
                profitHistoryData.profit50.push({ time: now, count: profit50 });
                profitHistoryData.profit40.push({ time: now, count: profit40 });
                profitHistoryData.profitBelow40.push({ time: now, count: profitBelow40 });
                profitHistoryData.profitBelow30.push({ time: now, count: profitBelow30 });
                profitHistoryData.profitBelow20.push({ time: now, count: profitBelow20 });
                profitHistoryData.profitBelow10.push({ time: now, count: profitBelow10 });
                profitHistoryData.lossCount.push({ time: now, count: lossCount });
                profitHistoryData.lastUpdate = now;
                
                // æ¸…ç†è¶…è¿‡1å°æ—¶çš„æ•°æ®
                profitHistoryData.profit120 = profitHistoryData.profit120.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit110 = profitHistoryData.profit110.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit100 = profitHistoryData.profit100.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit90 = profitHistoryData.profit90.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit80 = profitHistoryData.profit80.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit70 = profitHistoryData.profit70.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit60 = profitHistoryData.profit60.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit50 = profitHistoryData.profit50.filter(d => d.time > oneHourAgo);
                profitHistoryData.profit40 = profitHistoryData.profit40.filter(d => d.time > oneHourAgo);
                profitHistoryData.profitBelow40 = profitHistoryData.profitBelow40.filter(d => d.time > oneHourAgo);
                profitHistoryData.profitBelow30 = profitHistoryData.profitBelow30.filter(d => d.time > oneHourAgo);
                profitHistoryData.profitBelow20 = profitHistoryData.profitBelow20.filter(d => d.time > oneHourAgo);
                profitHistoryData.profitBelow10 = profitHistoryData.profitBelow10.filter(d => d.time > oneHourAgo);
                profitHistoryData.lossCount = profitHistoryData.lossCount.filter(d => d.time > oneHourAgo);
            }
            
            // è®¡ç®—å¸‚åœºä¸‹è·Œç­‰çº§
            function updateDropLevel(p100, p90, p80, p70, p60, p50, p40) {
                let level = 0;
                let levelText = '';
                let levelDesc = '';
                let levelIcon = '';
                let bgGradient = '';
                
                // ä¸‹è·Œç­‰çº§5ï¼šæç«¯ä¸‹è·Œ
                if (p100 >= 1 && p40 > 10) {
                    level = 5;
                    levelText = 'ä¸‹è·Œç­‰çº§5 - æç«¯ä¸‹è·Œ';
                    levelDesc = 'äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº100%';
                    levelIcon = 'ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #ff0844 0%, #cc0000 100%)';
                }
                // ä¸‹è·Œç­‰çº§4ï¼šè¶…é«˜å¼ºåº¦ä¸‹è·Œ
                else if (p100 === 0 && p90 >= 1 && p80 >= 1 && p40 > 10) {
                    level = 4;
                    levelText = 'ä¸‹è·Œç­‰çº§4 - è¶…é«˜å¼ºåº¦ä¸‹è·Œ';
                    levelDesc = 'äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº90%';
                    levelIcon = 'ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #f5576c 0%, #e53e3e 100%)';
                }
                // ä¸‹è·Œç­‰çº§3ï¼šé«˜å¼ºåº¦ä¸‹è·Œ
                else if (p100 === 0 && p90 === 0 && p80 === 0 && p70 >= 1 && p60 >= 2 && p40 > 8) {
                    level = 3;
                    levelText = 'ä¸‹è·Œç­‰çº§3 - é«˜å¼ºåº¦ä¸‹è·Œ';
                    levelDesc = 'äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº70%';
                    levelIcon = 'ğŸ”¥ğŸ”¥ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                }
                // ä¸‹è·Œç­‰çº§2ï¼šä¸­ç­‰å¼ºåº¦ä¸‹è·Œ
                else if (p100 === 0 && p90 === 0 && p80 === 0 && p70 === 0 && p60 >= 2 && p40 > 5) {
                    level = 2;
                    levelText = 'ä¸‹è·Œç­‰çº§2 - ä¸­ç­‰å¼ºåº¦ä¸‹è·Œ';
                    levelDesc = 'äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº60%';
                    levelIcon = 'ğŸ”¥ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                }
                // ä¸‹è·Œç­‰çº§1ï¼šè½»åº¦ä¸‹è·Œ
                else if (p100 === 0 && p90 === 0 && p80 === 0 && p70 === 0 && p60 === 0 && p50 === 0 && p40 >= 3) {
                    level = 1;
                    levelText = 'ä¸‹è·Œç­‰çº§1 - è½»åº¦ä¸‹è·Œ';
                    levelDesc = 'äº¤æ˜“å¯¹çš„ç©ºä»“ç›ˆåˆ©è¦å¤§äº40%';
                    levelIcon = 'ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%)';
                }
                // æ— æ˜æ˜¾ä¸‹è·Œ
                else {
                    level = 0;
                    levelText = 'å¸‚åœºæ­£å¸¸';
                    levelDesc = 'æ— æ˜æ˜¾ä¸‹è·Œè¶‹åŠ¿';
                    levelIcon = 'âœ…';
                    bgGradient = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                }
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('dropLevelIcon').textContent = levelIcon;
                document.getElementById('dropLevelText').textContent = levelText;
                document.getElementById('dropLevelDesc').textContent = levelDesc;
                document.getElementById('dropLevelDisplay').style.background = bgGradient;
                
                // æ›´æ–°ç»Ÿè®¡è®¡æ•°
                document.getElementById('drop100Count').textContent = p100;
                document.getElementById('drop90Count').textContent = p90;
                document.getElementById('drop80Count').textContent = p80;
                document.getElementById('drop70Count').textContent = p70;
                document.getElementById('drop60Count').textContent = p60;
                document.getElementById('drop50Count').textContent = p50;
                document.getElementById('drop40Count').textContent = p40;
                
                // æ›´æ–°æ—¶é—´
                const now = new Date();
                document.getElementById('dropAnalysisTime').textContent = now.toLocaleString('zh-CN');
                
                console.log(`ğŸ“Š å¸‚åœºä¸‹è·Œç­‰çº§åˆ†æ: Level ${level} - ${levelText}`);
            }
            
            // è®¡ç®—å¸‚åœºä¸Šæ¶¨ç­‰çº§ï¼ˆåŸºäºç©ºå•äºæŸæ•°é‡ï¼‰
            function updateRiseLevel(lossCount, shortProfitCount) {
                let level = 0;
                let levelText = '';
                let levelDesc = '';
                let levelIcon = '';
                let bgGradient = '';
                
                // ä¸Šæ¶¨ç­‰çº§åˆ¤æ–­
                if (lossCount === 0) {
                    level = 0;
                    levelText = 'å¸‚åœºæ­£å¸¸';
                    levelDesc = 'ç©ºå•äºæŸç­‰äº0ä¸ªï¼Œæ— æ˜æ˜¾ä¸Šæ¶¨';
                    levelIcon = 'âœ…';
                    bgGradient = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                }
                else if (lossCount < 2) {
                    level = 1;
                    levelText = 'ä¸Šæ¶¨å¼ºåº¦1çº§ - èµ·æ¶¨é˜¶æ®µ';
                    levelDesc = 'ç©ºå•äºæŸ<2ä¸ªï¼Œå¸‚åœºå¼€å§‹ä¸Šæ¶¨';
                    levelIcon = 'ğŸŸ¢';
                    bgGradient = 'linear-gradient(135deg, #34d399 0%, #10b981 100%)';
                }
                else if (lossCount < 4) {
                    level = 2;
                    levelText = 'ä¸Šæ¶¨å¼ºåº¦2çº§ - åŠ é€Ÿé˜¶æ®µ';
                    levelDesc = 'ç©ºå•äºæŸ<4ä¸ªï¼Œä¸Šæ¶¨åŠ é€Ÿ';
                    levelIcon = 'ğŸŸ¢ğŸŸ¢';
                    bgGradient = 'linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)';
                }
                else if (lossCount < 5) {
                    level = 3;
                    levelText = 'ä¸Šæ¶¨å¼ºåº¦3çº§ - é˜¶æ®µæ€§åŠ é€Ÿ';
                    levelDesc = 'ç©ºå•äºæŸ<5ä¸ªï¼Œé˜¶æ®µæ€§å¿«é€Ÿä¸Šæ¶¨';
                    levelIcon = 'ğŸŸ¢ğŸŸ¢ğŸŸ¢';
                    bgGradient = 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)';
                }
                else if (lossCount < 8) {
                    level = 4;
                    levelText = 'ä¸Šæ¶¨å¼ºåº¦4çº§ - åŠ é€Ÿèµ¶é¡¶';
                    levelDesc = 'ç©ºå•äºæŸ<8ä¸ªï¼Œå¿«é€Ÿèµ¶é¡¶é˜¶æ®µ';
                    levelIcon = 'ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #f97316 0%, #ea580c 100%)';
                }
                else if (lossCount < 10) {
                    level = 5;
                    levelText = 'ä¸Šæ¶¨å¼ºåº¦5çº§ - æç«¯é€¼ç©ºé˜¶æ®µ';
                    levelDesc = 'ç©ºå•äºæŸ<10ä¸ªï¼Œæç«¯é€¼ç©ºè¡Œæƒ…';
                    levelIcon = 'ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥';
                    bgGradient = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                }
                else {
                    level = 6;
                    levelText = 'æç«¯é€¼ç©º - è¶…çº§ä¸Šæ¶¨';
                    levelDesc = 'ç©ºå•äºæŸâ‰¥10ä¸ªï¼Œè¶…çº§é€¼ç©ºè¡Œæƒ…';
                    levelIcon = 'ğŸ’¥ğŸ’¥ğŸ’¥';
                    bgGradient = 'linear-gradient(135deg, #7c2d12 0%, #991b1b 100%)';
                }
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('riseLevelIcon').textContent = levelIcon;
                document.getElementById('riseLevelText').textContent = levelText;
                document.getElementById('riseLevelDesc').textContent = levelDesc;
                document.getElementById('riseLevelDisplay').style.background = bgGradient;
                
                // æ›´æ–°ç»Ÿè®¡
                document.getElementById('riseLossCount').textContent = lossCount;
                document.getElementById('riseLevel').textContent = level;
                document.getElementById('riseShortProfit').textContent = shortProfitCount;
                
                // æ›´æ–°æ—¶é—´
                const now = new Date();
                document.getElementById('riseAnalysisTime').textContent = now.toLocaleString('zh-CN');
                
                console.log(`ğŸ“ˆ å¸‚åœºä¸Šæ¶¨ç­‰çº§åˆ†æ: Level ${level} - ${levelText} (ç©ºå•äºæŸ: ${lossCount})`);
            }
            
            // è®¡ç®—å¢é‡
            function calcIncrease(historyArray, currentCount) {
                if (historyArray.length < 2) return '--';
                const oldestData = historyArray[0];
                const increase = currentCount - oldestData.count;
                if (increase > 0) {
                    return `+${increase}`;
                } else if (increase < 0) {
                    return `${increase}`;
                } else {
                    return '0';
                }
            }
            
            document.getElementById('profit120Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit120, profit120)}`;
            document.getElementById('profit110Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit110, profit110)}`;
            document.getElementById('profit100Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit100, profit100)}`;
            document.getElementById('profit90Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit90, profit90)}`;
            document.getElementById('profit80Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit80, profit80)}`;
            document.getElementById('profit70Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit70, profit70)}`;
            document.getElementById('profit60Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit60, profit60)}`;
            document.getElementById('profit50Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit50, profit50)}`;
            document.getElementById('profit40Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profit40, profit40)}`;
            document.getElementById('profitBelow40Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profitBelow40, profitBelow40)}`;
            document.getElementById('profitBelow30Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profitBelow30, profitBelow30)}`;
            document.getElementById('profitBelow20Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profitBelow20, profitBelow20)}`;
            document.getElementById('profitBelow10Increase').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.profitBelow10, profitBelow10)}`;
            document.getElementById('lossCountIncrease').textContent = `1å°æ—¶å†…: ${calcIncrease(profitHistoryData.lossCount, lossCount)}`;
            
            // æ›´æ–°æ“ä½œæç¤ºçŠ¶æ€æ ï¼ˆä½¿ç”¨æ–°è§„åˆ™ï¼‰
            updateOperationStatusBar({
                profit70: profit70,
                profit60: profit60,
                profit50: profit50,
                profit40: profit40,
                profitBelow20: profitBelow20,
                profitBelow10: profitBelow10,
                lossCount: lossCount
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            statsDiv.innerHTML = `
                <span style="display: inline-flex; align-items: center; gap: 15px;">
                    <span style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); 
                                 color: white; 
                                 padding: 4px 12px; 
                                 border-radius: 12px; 
                                 font-size: 13px;
                                 font-weight: 600;
                                 box-shadow: 0 2px 4px rgba(72, 187, 120, 0.3);">
                        ğŸ¯ ç›ˆåˆ©â‰¥40%: ${profit40}
                    </span>
                    <span style="background: linear-gradient(135deg, ${lossBelow10 > 0 ? '#f56565' : '#a0aec0'} 0%, ${lossBelow10 > 0 ? '#e53e3e' : '#718096'} 100%); 
                                 color: white; 
                                 padding: 4px 12px; 
                                 border-radius: 12px; 
                                 font-size: 13px;
                                 font-weight: 600;
                                 box-shadow: 0 2px 4px ${lossBelow10 > 0 ? 'rgba(245, 101, 101, 0.3)' : 'rgba(160, 174, 192, 0.3)'};">
                        âš ï¸ äºæŸâ‰¤-10%: ${lossBelow10}
                    </span>
                </span>
            `;

            // è°ƒè¯•æ—¥å¿—
            console.log('ğŸ” æ¸²æŸ“å½“å‰æŒä»“æ•°æ®:', data);
            console.log('ğŸ“Š åšç©ºç»Ÿè®¡: â‰¥70%:', profit70, 'â‰¥60%:', profit60, 'â‰¥50%:', profit50, 'â‰¥40%:', profit40, 
                        'â‰¤20%:', profitBelow20, 'â‰¤10%:', profitBelow10, 'äºæŸ:', lossCount, 'â‰¤-10%:', lossBelow10);
            if (data.length > 0) {
                console.log('ğŸ“Š ç¬¬ä¸€æ¡æ•°æ® pos_size:', data[0].pos_size, 'type:', typeof data[0].pos_size);
                // è°ƒè¯•ä¿è¯é‡‘å€¼
                console.log('ğŸ’° å‰3ä¸ªæŒä»“çš„ä¿è¯é‡‘å€¼:');
                for (let i = 0; i < Math.min(3, data.length); i++) {
                    console.log(`  ${i+1}. ${data[i].inst_id} ${data[i].pos_side}: margin=${data[i].margin}, type=${typeof data[i].margin}`);
                }
            }

            // å¸ç§ç¼–å·æ˜ å°„ï¼ˆæŒ‰å¼€ä»“é¡ºåºï¼‰
            const coinNumbers = {
                'CFX-USDT-SWAP': 'NO.1',
                'FIL-USDT-SWAP': 'NO.2',
                'CRO-USDT-SWAP': 'NO.3',
                'UNI-USDT-SWAP': 'NO.4',
                'CRV-USDT-SWAP': 'NO.5',
                'LDO-USDT-SWAP': 'NO.6',
                'XLM-USDT-SWAP': 'NO.7',
                'XRP-USDT-SWAP': 'NO.8',
                'TON-USDT-SWAP': 'NO.9',
                'HBAR-USDT-SWAP': 'NO.10',
                'TAO-USDT-SWAP': 'NO.11',
                'BNB-USDT-SWAP': 'NO.12',
                'AAVE-USDT-SWAP': 'NO.13',
                'DOT-USDT-SWAP': 'NO.14',
                'STX-USDT-SWAP': 'NO.15',
                'APT-USDT-SWAP': 'NO.16',
                'BCH-USDT-SWAP': 'NO.17',
                'LINK-USDT-SWAP': 'NO.18'
            };
            
            tbody.innerHTML = data.map(item => {
                const coinNumber = coinNumbers[item.inst_id] || '--';
                // æ ¼å¼åŒ–æå€¼æ˜¾ç¤º
                let extremeHtml = '--';
                if (item.max_profit_rate !== null && item.max_profit_rate !== undefined) {
                    const maxProfit = item.max_profit_rate.toFixed(2);
                    const maxLoss = (item.max_loss_rate || 0).toFixed(2);
                    extremeHtml = `<div style="font-size: 12px;">
                        <div style="color: #48bb78;">ğŸ† ${maxProfit}%</div>
                        <div style="color: #f56565;">ğŸ“‰ ${maxLoss}%</div>
                    </div>`;
                }
                
                return `
                <tr>
                    <td style="font-weight: 700; color: #667eea;">${coinNumber}</td>
                    <td style="font-weight: 600;">${item.inst_id || '--'}</td>
                    <td>
                        <span class="badge ${item.pos_side === 'short' ? 'badge-short' : 'badge-long'}">
                            ${item.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'}
                        </span>
                    </td>
                    <td>${(item.pos_size || 0).toFixed(4)}</td>
                    <td>${item.avg_price ? '$' + parseFloat(item.avg_price).toFixed(4) : '--'}</td>
                    <td>${item.mark_price ? '$' + parseFloat(item.mark_price).toFixed(4) : '--'}</td>
                    <td>${item.lever}x</td>
                    <td style="color: ${item.upl >= 0 ? '#48bb78' : '#f56565'}; font-weight: 600;">
                        ${item.upl >= 0 ? '+' : ''}${item.upl.toFixed(4)} USDT
                    </td>
                    <td>${item.margin.toFixed(4)} USDT</td>
                    <td style="color: ${item.profit_rate >= 0 ? '#48bb78' : '#f56565'}; font-weight: 700; font-size: 16px;">
                        ${item.profit_rate >= 0 ? '+' : ''}${item.profit_rate.toFixed(2)}%
                    </td>
                    <td>${extremeHtml}</td>
                    <td>
                        <span class="badge ${
                            item.status_class === 'profit' ? 'badge-profit' : 
                            item.status_class === 'loss' ? 'badge-loss' : 
                            'badge-normal'
                        }">
                            ${item.status}
                        </span>
                    </td>
                    <td>
                        <button onclick="showMaintenanceCount('${item.inst_id}', '${item.pos_side}')" 
                                style="padding: 8px 12px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; font-weight: 700;">
                            ${item.today_maintenance_count || 0}æ¬¡
                        </button>
                    </td>
                    <td>
                        <button onclick="resetMaintenanceCount('${item.inst_id}', '${item.pos_side}')" 
                                style="padding: 5px 10px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            ğŸ”„ æ¸…é›¶
                        </button>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                            <button onclick="manualMaintainPosition('${item.inst_id}', '${item.pos_side}', ${item.pos_size})" 
                                    style="padding: 5px 10px; background: #f97316; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                ğŸ”§ ç»´æŠ¤é”šç‚¹å•
                            </button>
                            <button onclick="checkAndFixAnchorPosition('${item.inst_id}', '${item.pos_side}', ${item.margin || 0})" 
                                    style="padding: 5px 10px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                ğŸ” çº é”™
                            </button>
                        </div>
                    </td>
                </tr>
            `;
            }).join('');
        }

        // æ˜¾ç¤ºä»Šæ—¥ç»´æŠ¤æ¬¡æ•°
        async function showMaintenanceCount(instId, posSide) {
            try {
                const response = await fetch(`/api/anchor/maintenance-count?inst_id=${instId}&pos_side=${posSide}&trade_mode=real`);
                const data = await response.json();
                
                if (data.success) {
                    alert(`ğŸ“Š ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'}\n\nä»Šæ—¥ç»´æŠ¤æ¬¡æ•°: ${data.count || 0}æ¬¡\næœ€åç»´æŠ¤æ—¶é—´: ${data.last_time || 'æš‚æ— '}`);
                } else {
                    alert('âš ï¸ è·å–ç»´æŠ¤æ¬¡æ•°å¤±è´¥');
                }
            } catch (error) {
                console.error('è·å–ç»´æŠ¤æ¬¡æ•°å¤±è´¥:', error);
                alert('âš ï¸ è·å–ç»´æŠ¤æ¬¡æ•°å¤±è´¥');
            }
        }

        // æ¸…é›¶ç»´æŠ¤æ¬¡æ•°
        async function resetMaintenanceCount(instId, posSide) {
            if (!confirm(`ç¡®è®¤æ¸…é›¶ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} çš„ä»Šæ—¥ç»´æŠ¤æ¬¡æ•°ï¼Ÿ`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/anchor/reset-maintenance-count', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inst_id: instId,
                        pos_side: posSide,
                        trade_mode: 'real'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('âœ… æ¸…é›¶æˆåŠŸ');
                    loadData(); // åˆ·æ–°é¡µé¢æ•°æ®
                } else {
                    alert('âš ï¸ æ¸…é›¶å¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('æ¸…é›¶å¤±è´¥:', error);
                alert('âš ï¸ æ¸…é›¶å¤±è´¥');
            }
        }

        // æ‰‹åŠ¨ç»´æŠ¤æŒä»“
        async function manualMaintainPosition(instId, posSide, posSize) {
            if (!confirm(`ç¡®è®¤æ‰‹åŠ¨ç»´æŠ¤ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“ï¼Ÿ\n\nå°†æ‰§è¡Œï¼š\n1. å¼€10å€åº•ä»“æ•°é‡çš„æ–°ä»“ï¼ˆ10å€æ æ†ï¼‰\n2. ç«‹å³å¹³æ‰92%\n3. ä¿ç•™8%ä½œä¸ºæ–°çš„é”šç‚¹å•`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/anchor/maintain-anchor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inst_id: instId,
                        pos_side: posSide,
                        pos_size: parseFloat(posSize),
                        trade_mode: 'real',
                        auto_adjust: false
                    })
                });
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                console.log('ç»´æŠ¤APIå“åº”çŠ¶æ€:', response.status);
                console.log('ç»´æŠ¤APIå“åº”å¤´:', response.headers);
                
                // å…ˆè·å–å“åº”æ–‡æœ¬ï¼Œå†å°è¯•è§£æJSON
                const responseText = await response.text();
                console.log('ç»´æŠ¤APIå“åº”æ–‡æœ¬:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSONè§£æå¤±è´¥:', parseError);
                    console.error('å“åº”æ–‡æœ¬:', responseText);
                    alert(`âŒ ç»´æŠ¤å¤±è´¥ï¼šæœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”\n\n${responseText.substring(0, 200)}`);
                    return;
                }
                
                if (result.success) {
                    alert(`âœ… ç»´æŠ¤æˆåŠŸï¼\n\n${result.message || 'ç»´æŠ¤å®Œæˆ'}`);
                    // åˆ·æ–°æŒä»“æ•°æ®
                    loadData();
                } else {
                    alert(`âŒ ç»´æŠ¤å¤±è´¥ï¼š${result.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                console.error('ç»´æŠ¤å¤±è´¥:', error);
                alert(`âŒ ç»´æŠ¤å¤±è´¥ï¼š${error.message}`);
            }
        }
        
        // æ£€æŸ¥å¹¶çº æ­£ä¸»è´¦æˆ·ï¼ˆé”šç‚¹è´¦å·ï¼‰æŒä»“
        async function checkAndFixAnchorPosition(instId, posSide, currentMargin) {
            const MARGIN_MIN = 0.6;
            const MARGIN_MAX = 1.2;
            
            if (!confirm(`ç¡®è®¤è¦çº é”™ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“å—ï¼Ÿ\n\nä¸»è´¦æˆ·ï¼ˆé”šç‚¹è´¦å·ï¼‰ä¿è¯é‡‘è§„åˆ™ï¼š\nç›®æ ‡èŒƒå›´: ${MARGIN_MIN}U - ${MARGIN_MAX}U\nå½“å‰ä¿è¯é‡‘: ${currentMargin.toFixed(4)}U\n\nç³»ç»Ÿå°†è‡ªåŠ¨è°ƒæ•´æŒä»“ï¼Œä½¿ä¿è¯é‡‘ç¬¦åˆè§„åˆ™\n\næ³¨æ„ï¼šä¸»è´¦æˆ·æ™®é€šç»´æŠ¤ä¸å—æ¬¡æ•°é™åˆ¶`)) {
                return;
            }
            
            alert('ğŸ” æ­£åœ¨æ£€æŸ¥å¹¶çº æ­£æŒä»“...');
            
            try {
                const response = await fetch('/api/anchor-system/check-and-fix-position', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inst_id: instId,
                        pos_side: posSide
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    if (data.action === 'none') {
                        alert(`âœ… ${data.message}`);
                    } else if (data.action === 'reduce') {
                        alert(`âœ… ${data.message}\n\nå¹³ä»“æ•°é‡: ${data.closed_size} å¼ \nè®¢å•ID: ${data.order_id}`);
                    } else if (data.action === 'increase') {
                        alert(`âœ… ${data.message}\n\nåŠ ä»“æ•°é‡: ${data.added_size} å¼ \nè®¢å•ID: ${data.order_id}`);
                    }
                    loadData(); // åˆ·æ–°æ•°æ®
                } else {
                    alert(`âŒ çº é”™å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                console.error('çº é”™å¤±è´¥:', error);
                alert(`âŒ çº é”™å¤±è´¥ï¼š${error.message}`);
            }
        }
        
        // æ˜¾ç¤ºæŒä»“è¯¦æƒ…
        async function showPositionDetail(instId, posSide) {
            try {
                // è¿™é‡Œå¯ä»¥è°ƒç”¨APIè·å–æŒä»“è¯¦ç»†ä¿¡æ¯
                // æš‚æ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
                const positionData = currentRecordsData.find(p => p.inst_id === instId && p.pos_side === posSide);
                if (!positionData) {
                    alert('æœªæ‰¾åˆ°æŒä»“æ•°æ®');
                    return;
                }
                
                const message = `ğŸ“Š æŒä»“è¯¦æƒ…\n\n` +
                    `å¸ç§: ${positionData.inst_id}\n` +
                    `æ–¹å‘: ${positionData.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'}\n` +
                    `æŒä»“é‡: ${positionData.pos_size?.toFixed(4) || '--'}\n` +
                    `å¼€ä»“å‡ä»·: $${positionData.avg_price?.toFixed(4) || '--'}\n` +
                    `æ ‡è®°ä»·æ ¼: $${positionData.mark_price?.toFixed(4) || '--'}\n` +
                    `æ æ†: ${positionData.lever}x\n` +
                    `æœªå®ç°ç›ˆäº: ${positionData.upl >= 0 ? '+' : ''}${positionData.upl?.toFixed(4) || '--'} USDT\n` +
                    `ä¿è¯é‡‘: ${positionData.margin?.toFixed(4) || '--'} USDT\n` +
                    `æ”¶ç›Šç‡: ${positionData.profit_rate >= 0 ? '+' : ''}${positionData.profit_rate?.toFixed(2) || '--'}%\n` +
                    `\næå€¼ç»Ÿè®¡:\n` +
                    `æœ€é«˜ç›ˆåˆ©ç‡: ${positionData.max_profit_rate?.toFixed(2) || '--'}%\n` +
                    `æœ€å¤§äºæŸç‡: ${positionData.max_loss_rate?.toFixed(2) || '--'}%`;
                
                alert(message);
            } catch (error) {
                console.error('è·å–è¯¦æƒ…å¤±è´¥:', error);
                alert(`âŒ è·å–è¯¦æƒ…å¤±è´¥ï¼š${error.message}`);
            }
        }

        // æ¸²æŸ“å­è´¦æˆ·æŒä»“è¡¨
        function renderSubAccountPositions(data) {
            const tbody = document.getElementById('subAccountPositionBody');
            
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="15" class="empty">æš‚æ— å­è´¦æˆ·æŒä»“</td></tr>';
                return;
            }
            
            console.log('ğŸ“Š æ¸²æŸ“å­è´¦æˆ·æŒä»“:', data.length, 'æ¡');
            
            // å¸ç§ç¼–å·æ˜ å°„ï¼ˆæŒ‰å¼€ä»“é¡ºåºï¼‰
            const coinNumbers = {
                'CFX-USDT-SWAP': 'NO.1',
                'FIL-USDT-SWAP': 'NO.2',
                'CRO-USDT-SWAP': 'NO.3',
                'UNI-USDT-SWAP': 'NO.4',
                'CRV-USDT-SWAP': 'NO.5',
                'LDO-USDT-SWAP': 'NO.6',
                'XLM-USDT-SWAP': 'NO.7',
                'XRP-USDT-SWAP': 'NO.8',
                'TON-USDT-SWAP': 'NO.9',
                'HBAR-USDT-SWAP': 'NO.10',
                'TAO-USDT-SWAP': 'NO.11',
                'BNB-USDT-SWAP': 'NO.12',
                'AAVE-USDT-SWAP': 'NO.13',
                'DOT-USDT-SWAP': 'NO.14',
                'STX-USDT-SWAP': 'NO.15',
                'APT-USDT-SWAP': 'NO.16',
                'BCH-USDT-SWAP': 'NO.17',
                'LINK-USDT-SWAP': 'NO.18'
            };
            
            tbody.innerHTML = data.map(item => {
                const coinNumber = coinNumbers[item.inst_id] || '--';
                return `
                <tr>
                    <td style="font-weight: 600; color: #667eea;">${item.account_name || '--'}</td>
                    <td style="font-weight: 700; color: #667eea;">${coinNumber}</td>
                    <td style="font-weight: 600;">${item.inst_id || '--'}</td>
                    <td>
                        <span class="badge ${item.pos_side === 'short' ? 'badge-short' : 'badge-long'}">
                            ${item.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'}
                        </span>
                    </td>
                    <td>${(item.pos_size || 0).toFixed(4)}</td>
                    <td>${item.avg_price ? '$' + parseFloat(item.avg_price).toFixed(4) : '--'}</td>
                    <td>${item.mark_price ? '$' + parseFloat(item.mark_price).toFixed(4) : '--'}</td>
                    <td>${item.leverage || 10}x</td>
                    <td style="color: ${item.upl >= 0 ? '#48bb78' : '#f56565'}; font-weight: 600;">
                        ${item.upl >= 0 ? '+' : ''}${(item.upl || 0).toFixed(4)} USDT
                    </td>
                    <td>${(item.margin || 0).toFixed(4)} USDT</td>
                    <td style="color: ${item.profit_rate >= 0 ? '#48bb78' : '#f56565'}; font-weight: 700; font-size: 16px;">
                        ${item.profit_rate >= 0 ? '+' : ''}${(item.profit_rate || 0).toFixed(2)}%
                    </td>
                    <td>
                        <button onclick="showSubAccountMaintenanceCount('${item.account_name}', '${item.inst_id}', '${item.pos_side}')" 
                                style="padding: 8px 12px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; font-weight: 700;">
                            ${item.maintenance_count || 0}æ¬¡
                        </button>
                    </td>
                    <td>
                        <button onclick="resetSubAccountMaintenanceCount('${item.account_name}', '${item.inst_id}', '${item.pos_side}')" 
                                style="padding: 5px 10px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            ğŸ”„ æ¸…é›¶
                        </button>
                    </td>
                    <td>
                        <span class="badge badge-normal">${item.status || 'æ­£å¸¸'}</span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                            <button onclick="maintainSubAccountPosition('${item.account_name}', '${item.inst_id}', '${item.pos_side}', ${item.margin || 0})" 
                                    style="padding: 5px 10px; background: #8b5cf6; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                ğŸ”§ ç»´æŠ¤
                            </button>
                            <button onclick="checkAndFixSubAccountPosition('${item.account_name}', '${item.inst_id}', '${item.pos_side}', ${item.maintenance_count || 0})" 
                                    style="padding: 5px 10px; background: #f59e0b; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                ğŸ” çº é”™
                            </button>
                            <button onclick="showClosePositionDialog('${item.account_name}', '${item.inst_id}', '${item.pos_side}', ${item.margin || 0})" 
                                    style="padding: 5px 10px; background: #f56565; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                ğŸš¨ å¹³ä»“
                            </button>
                        </div>
                    </td>
                </tr>
            `;
            }).join('');
        }

        // æ¸²æŸ“é¢„è­¦è¡¨
        function renderWarnings(data) {
            const tbody = document.getElementById('warningsBody');
            const updateTime = document.getElementById('warningsUpdateTime');
            
            // æ›´æ–°æ—¶é—´
            const now = new Date();
            updateTime.textContent = `æœ€åæ›´æ–°: ${now.toLocaleString('zh-CN')}`;
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="empty">âœ… å½“å‰æ— é¢„è­¦</td></tr>';
                return;
            }

            console.log('âš ï¸ æ¸²æŸ“é¢„è­¦æ•°æ®:', data);

            tbody.innerHTML = data.map(item => `
                <tr>
                    <td style="font-weight: 600;">${item.inst_id || '--'}</td>
                    <td>
                        <span class="badge ${item.pos_side === 'short' ? 'badge-short' : 'badge-long'}">
                            ${item.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'}
                        </span>
                    </td>
                    <td>$${item.open_price.toFixed(4)}</td>
                    <td>$${item.current_price.toFixed(4)}</td>
                    <td>
                        <span class="profit-rate ${
                            item.warning_level === 'critical' ? 'critical-level' : 
                            item.warning_level === 'warning' ? 'warning-level' : ''
                        }">
                            ${item.profit_rate.toFixed(2)}%
                        </span>
                    </td>
                    <td>${item.open_size.toFixed(4)}</td>
                    <td>
                        <span class="warning-badge ${item.warning_level}">
                            ${item.warning_level === 'critical' ? 'ğŸ”´ ä¸´ç•Œ' : 
                              item.warning_level === 'warning' ? 'ğŸŸ¡ é¢„è­¦' : 
                              'ğŸ”µ ä¿¡æ¯'}
                        </span>
                    </td>
                    <td style="max-width: 300px; white-space: normal;">${item.alert_message}</td>
                    <td style="font-size: 12px; color: #718096;">${item.created_at}</td>
                </tr>
            `).join('');
        }

        // æ¸²æŸ“ç›‘æ§è®°å½•è¡¨
        function renderMonitorTable(data) {
            const tbody = document.getElementById('monitorBody');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="empty">æš‚æ— ç›‘æ§è®°å½•</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(item => `
                <tr>
                    <td>${item.timestamp}</td>
                    <td>${item.inst_id || '--'}</td>
                    <td>
                        <span class="badge ${item.pos_side === 'short' ? 'badge-short' : 'badge-long'}">
                            ${item.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'}
                        </span>
                    </td>
                    <td>${Math.abs(item.pos_size || 0).toFixed(4)}</td>
                    <td>${item.avg_price ? '$' + parseFloat(item.avg_price).toFixed(4) : '--'}</td>
                    <td>${item.mark_price ? '$' + parseFloat(item.mark_price).toFixed(4) : '--'}</td>
                    <td>${item.leverage}x</td>
                    <td style="color: ${(item.profit_rate || 0) >= 0 ? '#48bb78' : '#f56565'}; font-weight: 600;">
                        ${(item.profit_rate || 0) >= 0 ? '+' : ''}${(item.profit_rate || 0).toFixed(2)}%
                    </td>
                    <td>
                        ${item.alert_type ? (() => {
                            if (item.alert_type === 'profit_target') {
                                return '<span class="badge badge-profit">ç›ˆåˆ©ç›®æ ‡</span>';
                            } else if (item.alert_type === 'loss_limit') {
                                return '<span class="badge badge-loss">æ­¢æŸè­¦å‘Š</span>';
                            } else if (item.alert_type === 'extreme_max_profit') {
                                return '<span class="badge badge-profit">æœ€é«˜ç›ˆåˆ©åˆ·æ–°</span>';
                            } else if (item.alert_type === 'extreme_max_loss') {
                                return '<span class="badge badge-loss">æœ€å¤§äºæŸåˆ·æ–°</span>';
                            } else {
                                return '<span class="badge badge-normal">å…¶ä»–å‘Šè­¦</span>';
                            }
                        })() : '--'}
                    </td>
                    <td>
                        ${item.alert_sent ? 
                            '<span class="badge badge-sent">å·²å‘é€</span>' : 
                            (item.alert_type ? '<span class="badge badge-pending">æœªå‘é€</span>' : '--')}
                    </td>
                </tr>
            `).join('');
        }

        // æ¸²æŸ“æ”¶ç›Šç‡å›¾è¡¨
        function renderProfitChart(data) {
            // åè½¬æ•°æ®é¡ºåºï¼ˆä»æ—§åˆ°æ–°ï¼‰
            const reversedData = [...data].reverse();
            
            const timestamps = reversedData.map(item => {
                const time = new Date(item.timestamp);
                return time.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
            });
            
            const profitRates = reversedData.map(item => (item.profit_rate || 0).toFixed(2));

            const option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const data = params[0];
                        return `æ—¶é—´: ${data.name}<br/>æ”¶ç›Šç‡: ${data.value}%`;
                    }
                },
                grid: {
                    left: '50px',
                    right: '20px',
                    top: '20px',
                    bottom: '30px'
                },
                xAxis: {
                    type: 'category',
                    data: timestamps,
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'æ”¶ç›Šç‡ (%)',
                    axisLabel: {
                        formatter: '{value}%'
                    }
                },
                series: [{
                    name: 'æ”¶ç›Šç‡',
                    type: 'line',
                    data: profitRates,
                    smooth: true,
                    lineStyle: {
                        width: 3,
                        color: '#667eea'
                    },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [
                                {offset: 0, color: 'rgba(102, 126, 234, 0.3)'},
                                {offset: 1, color: 'rgba(102, 126, 234, 0.05)'}
                            ]
                        }
                    }
                }]
            };

            profitChart.setOption(option);
        }

        // æ¸²æŸ“å‘Šè­¦åˆ—è¡¨
        function renderAlerts(data) {
            const alertList = document.getElementById('alertList');
            
            if (data.length === 0) {
                alertList.innerHTML = '<div class="empty">æš‚æ— å‘Šè­¦è®°å½•</div>';
                return;
            }

            alertList.innerHTML = data.map(alert => {
                // åˆ¤æ–­å‘Šè­¦ç±»å‹
                let alertTitle = '';
                let alertClass = '';
                
                if (alert.alert_type === 'profit_target') {
                    alertTitle = 'ğŸ‰ ç›ˆåˆ©ç›®æ ‡è¾¾æˆ';
                    alertClass = 'profit';
                } else if (alert.alert_type === 'loss_limit') {
                    alertTitle = 'âš ï¸ æ­¢æŸè­¦å‘Š';
                    alertClass = 'loss';
                } else if (alert.alert_type === 'extreme_max_profit') {
                    alertTitle = 'ğŸš€ æœ€é«˜ç›ˆåˆ©æå€¼åˆ·æ–°é¢„è­¦';
                    alertClass = 'profit';
                } else if (alert.alert_type === 'extreme_max_loss') {
                    alertTitle = 'ğŸ“‰ æœ€å¤§äºæŸæå€¼åˆ·æ–°é¢„è­¦';
                    alertClass = 'loss';
                } else {
                    alertTitle = 'ğŸ“¢ å‘Šè­¦';
                    alertClass = alert.profit_rate >= 0 ? 'profit' : 'loss';
                }
                
                return `
                    <div class="alert-item ${alertClass}">
                        <div class="alert-header">
                            <div class="alert-title">
                                ${alertTitle}
                            </div>
                            <div class="alert-time">${alert.timestamp}</div>
                        </div>
                        <div class="alert-details">
                            ${alert.inst_id} â€¢ ${alert.pos_side === 'short' ? 'åšç©º' : 'åšå¤š'} â€¢ 
                            <strong style="color: ${alert.profit_rate >= 0 ? '#48bb78' : '#f56565'}">
                                ${alert.profit_rate >= 0 ? '+' : ''}${alert.profit_rate.toFixed(2)}%
                            </strong>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            console.log('ğŸ”„ åˆ·æ–°æ•°æ®...', new Date().toLocaleString('zh-CN'));
            loadData();
        }

        // ==================== 1å°æ—¶çˆ†ä»“é‡‘é¢å›¾è¡¨ ====================
        let liquidation1hChart = null;
        let liqCurrentPage = 0;  // å½“å‰é¡µç ï¼ˆ0=æœ€æ–°12å°æ—¶ï¼‰
        let liqAllData = [];     // æ‰€æœ‰å†å²æ•°æ®
        const LIQ_HOURS_PER_PAGE = 12;  // æ¯é¡µæ˜¾ç¤º12å°æ—¶
        const LIQ_RECORDS_PER_HOUR = 60;  // æ¯å°æ—¶60æ¡è®°å½•ï¼ˆ1åˆ†é’Ÿä¸€æ¬¡ï¼‰
        const LIQ_RECORDS_PER_PAGE = LIQ_HOURS_PER_PAGE * LIQ_RECORDS_PER_HOUR;  // æ¯é¡µ720æ¡è®°å½•
        
        function initLiquidation1hChart() {
            const chartDom = document.getElementById('liquidation1hChart');
            if (!chartDom) {
                console.error('âŒ æ‰¾ä¸åˆ°liquidation1hChartå®¹å™¨');
                return;
            }
            liquidation1hChart = echarts.init(chartDom);
            loadAllLiquidationData();
        }
        
        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadAllLiquidationData() {
            try {
                console.log('ğŸ“Š åŠ è½½1å°æ—¶çˆ†ä»“é‡‘é¢å…¨éƒ¨æ•°æ®...');
                
                const response = await fetch('/api/liquidation-1h/history?limit=10000');
                const result = await response.json();
                
                if (!result.success || !result.data || result.data.length === 0) {
                    console.warn('âš ï¸ æš‚æ— 1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®');
                    if (liquidation1hChart) {
                        liquidation1hChart.setOption({
                            title: {
                                text: 'âš ï¸ æš‚æ— æ•°æ®',
                                left: 'center',
                                top: 'middle',
                                textStyle: {
                                    color: 'rgba(255, 255, 255, 0.6)',
                                    fontSize: 16
                                }
                            }
                        });
                    }
                    return;
                }
                
                liqAllData = result.data;
                console.log(`âœ… åŠ è½½æˆåŠŸ: ${liqAllData.length}æ¡è®°å½•`);
                
                // æ˜¾ç¤ºæœ€æ–°ä¸€é¡µ
                liqCurrentPage = 0;
                updateLiquidationChartForCurrentPage();
                updateLiquidationPageInfo();
                
            } catch (error) {
                console.error('âŒ åŠ è½½1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°å½“å‰é¡µçš„å›¾è¡¨
        function updateLiquidationChartForCurrentPage() {
            if (!liqAllData || liqAllData.length === 0) {
                console.warn('âš ï¸ æ²¡æœ‰æ•°æ®å¯æ˜¾ç¤º');
                return;
            }
            
            // è®¡ç®—å½“å‰é¡µçš„æ•°æ®èŒƒå›´
            const totalRecords = liqAllData.length;
            const startIndex = Math.max(0, totalRecords - (liqCurrentPage + 1) * LIQ_RECORDS_PER_PAGE);
            const endIndex = Math.max(0, totalRecords - liqCurrentPage * LIQ_RECORDS_PER_PAGE);
            
            const pageData = liqAllData.slice(startIndex, endIndex);
            console.log(`ğŸ“„ æ˜¾ç¤ºç¬¬${liqCurrentPage + 1}é¡µ: ${pageData.length}æ¡æ•°æ® (${startIndex}-${endIndex})`);
            
            if (pageData.length === 0) {
                console.warn('âš ï¸ å½“å‰é¡µæ— æ•°æ®');
                return;
            }
            
            // æå–æ—¶é—´å’Œé‡‘é¢
            const times = pageData.map(d => {
                const dt = new Date(d.timestamp * 1000);
                return `${dt.getMonth()+1}/${dt.getDate()} ${dt.getHours().toString().padStart(2, '0')}:${dt.getMinutes().toString().padStart(2, '0')}`;
            });
            
            const amounts = pageData.map(d => d.hour_1_amount);
            
            // è®¡ç®—å¹³å‡å€¼
            const avgAmount = (amounts.reduce((a, b) => a + b, 0) / amounts.length).toFixed(2);
            
            // æ‰¾åˆ°24å°æ—¶èŒƒå›´å†…1å°æ—¶çˆ†ä»“é‡‘é¢çš„æœ€å¤§å€¼
            const maxAmount = Math.max(...amounts);
            const maxIndex = amounts.indexOf(maxAmount);
            const maxTime = times[maxIndex];
            
            // è·å–æ—¶é—´èŒƒå›´
            const startTime = pageData[0].datetime.substring(5, 16);  // MM-DD HH:MM
            const endTime = pageData[pageData.length - 1].datetime.substring(5, 16);
            
            // é…ç½®å›¾è¡¨
            const option = {
                backgroundColor: 'transparent',  // é€æ˜èƒŒæ™¯ï¼Œèå…¥é¡µé¢ç´«è‰²æ¸å˜
                title: {
                    text: `1å°æ—¶çˆ†ä»“é‡‘é¢èµ°åŠ¿ï¼ˆ${startTime} ~ ${endTime}ï¼‰`,
                    left: 'center',
                    top: 10,
                    textStyle: {
                        color: 'rgba(255, 255, 255, 0.9)',
                        fontSize: 14
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: 'rgba(255, 255, 255, 0.2)',
                    textStyle: {
                        color: '#fff'
                    },
                    formatter: function(params) {
                        const p = params[0];
                        const amount = p.value;
                        const color = amount > avgAmount ? '#ef4444' : amount < avgAmount * 0.8 ? '#10b981' : '#fbbf24';
                        const currentIndex = p.dataIndex;
                        const isMax = currentIndex === maxIndex;
                        return `<div style="padding: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">${p.name}</div>
                            <div style="color: ${color}; font-size: 16px; font-weight: 600;">
                                ğŸ’¥ 1Hçˆ†ä»“: ${amount} ä¸‡ç¾å…ƒ${isMax ? ' ğŸ”¥' : ''}
                            </div>
                            <div style="font-size: 11px; color: #9ca3af; margin-top: 5px;">
                                å¹³å‡å€¼: ${avgAmount} ä¸‡ç¾å…ƒ
                            </div>
                            ${isMax ? '<div style="font-size: 12px; color: #ef4444; margin-top: 5px; font-weight: 700; background: rgba(239, 68, 68, 0.2); padding: 3px 6px; border-radius: 3px;">ğŸ”¥ 24å°æ—¶å†…1Hçˆ†ä»“æœ€å¤§å€¼ï¼</div>' : ''}
                        </div>`;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: times,
                    axisLabel: {
                        color: 'rgba(255, 255, 255, 0.6)',
                        fontSize: 10,
                        rotate: 45,
                        interval: Math.floor(times.length / 20)  // æ˜¾ç¤ºçº¦20ä¸ªæ ‡ç­¾
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'ä¸‡ç¾å…ƒ',
                    nameTextStyle: {
                        color: 'rgba(255, 255, 255, 0.6)',
                        fontSize: 11
                    },
                    axisLabel: {
                        color: 'rgba(255, 255, 255, 0.6)',
                        fontSize: 11
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)',
                            type: 'dashed'
                        }
                    }
                },
                series: [
                    {
                        name: '1å°æ—¶çˆ†ä»“é‡‘é¢',
                        type: 'line',
                        data: amounts,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 4,
                        lineStyle: {
                            color: '#f59e0b',
                            width: 2
                        },
                        itemStyle: {
                            color: '#f59e0b'
                        },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(245, 158, 11, 0.3)' },
                                    { offset: 1, color: 'rgba(245, 158, 11, 0.05)' }
                                ]
                            }
                        },
                        markLine: {
                            silent: true,
                            symbol: 'none',
                            label: {
                                position: 'end',
                                formatter: 'å¹³å‡: {c}ä¸‡'
                            },
                            lineStyle: {
                                color: 'rgba(255, 255, 255, 0.4)',
                                type: 'dashed',
                                width: 1
                            },
                            data: [
                                { yAxis: avgAmount }
                            ]
                        },
                        markPoint: {
                            symbol: 'pin',
                            symbolSize: 60,
                            label: {
                                show: true,
                                formatter: function(params) {
                                    return `${params.value}ä¸‡`;
                                },
                                color: '#fff',
                                fontSize: 16,
                                fontWeight: 'bold'
                            },
                            itemStyle: {
                                color: '#ef4444'
                            },
                            data: [
                                {
                                    coord: [maxIndex, maxAmount],
                                    value: maxAmount.toFixed(2),
                                    name: '24å°æ—¶å†…1Hçˆ†ä»“æœ€å¤§å€¼'
                                }
                            ]
                        }
                    }
                ]
            };
            
            liquidation1hChart.setOption(option);
        }
        
        // æ›´æ–°é¡µç ä¿¡æ¯
        function updateLiquidationPageInfo() {
            const totalPages = Math.ceil(liqAllData.length / LIQ_RECORDS_PER_PAGE);
            
            // æ›´æ–°é¡µç æ–‡æœ¬
            const pageInfo = document.getElementById('liqPageInfo');
            if (pageInfo) {
                pageInfo.textContent = `ç¬¬ ${liqCurrentPage + 1} é¡µ / å…± ${totalPages} é¡µ`;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('liqPrevPageBtn');
            const nextBtn = document.getElementById('liqNextPageBtn');
            if (prevBtn) prevBtn.disabled = (liqCurrentPage >= totalPages - 1);
            if (nextBtn) nextBtn.disabled = (liqCurrentPage <= 0);
        }
        
        // åŠ è½½ä¸Šä¸€é¡µï¼ˆæ›´æ—©çš„æ•°æ®ï¼‰
        function loadLiquidationPreviousPage() {
            const totalPages = Math.ceil(liqAllData.length / LIQ_RECORDS_PER_PAGE);
            if (liqCurrentPage < totalPages - 1) {
                liqCurrentPage++;
                updateLiquidationChartForCurrentPage();
                updateLiquidationPageInfo();
            }
        }
        
        // åŠ è½½ä¸‹ä¸€é¡µï¼ˆæ›´æ–°çš„æ•°æ®ï¼‰
        function loadLiquidationNextPage() {
            if (liqCurrentPage > 0) {
                liqCurrentPage--;
                updateLiquidationChartForCurrentPage();
                updateLiquidationPageInfo();
            }
        }

        // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', () => {
            profitChart.resize();
            profitStatsChart.resize();
            if (liquidation1hChart) liquidation1hChart.resize();
        });

        // ============================================================
        // é¡µé¢åˆå§‹åŒ–
        // ============================================================
        
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“Š å¼€å§‹åŠ è½½é”šç‚¹ç³»ç»Ÿæ•°æ®...', new Date().toLocaleString('zh-CN'));
            
            // è‡ªåŠ¨ç»´æŠ¤å¼€å…³äº‹ä»¶ç›‘å¬
            document.getElementById('autoMaintainLong').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸŸ¢ è‡ªåŠ¨ç»´æŠ¤å¤šå•-10%: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/anchor-system/auto-maintenance-config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            auto_maintain_long_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'âœ… å¤šå•è‡ªåŠ¨ç»´æŠ¤å·²å¼€å¯' : 'âŒ å¤šå•è‡ªåŠ¨ç»´æŠ¤å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled; // å›æ»š
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled; // å›æ»š
                }
            });
            
            document.getElementById('autoMaintainShort').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸ”´ è‡ªåŠ¨ç»´æŠ¤ç©ºå•-10%: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/anchor-system/auto-maintenance-config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            auto_maintain_short_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'âœ… ç©ºå•è‡ªåŠ¨ç»´æŠ¤å·²å¼€å¯' : 'âŒ ç©ºå•è‡ªåŠ¨ç»´æŠ¤å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            // è¶…çº§ç»´æŠ¤å¼€å…³äº‹ä»¶ç›‘å¬
            document.getElementById('superMaintainLong').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸš€ è¶…çº§ç»´æŠ¤å¤šå•-10%: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/anchor-system/auto-maintenance-config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            super_maintain_long_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'ğŸš€ å¤šå•è¶…çº§ç»´æŠ¤å·²å¼€å¯' : 'âŒ å¤šå•è¶…çº§ç»´æŠ¤å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            document.getElementById('superMaintainShort').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸš€ è¶…çº§ç»´æŠ¤ç©ºå•-10%: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/anchor-system/auto-maintenance-config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            super_maintain_short_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'ğŸš€ ç©ºå•è¶…çº§ç»´æŠ¤å·²å¼€å¯' : 'âŒ ç©ºå•è¶…çº§ç»´æŠ¤å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            // å­è´¦æˆ·è¶…çº§ç»´æŠ¤å¤šå•å¼€å…³
            document.getElementById('subSuperMaintainLong').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸš€ å­è´¦æˆ·è¶…çº§ç»´æŠ¤å¤šå•-10%: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/sub-account/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            super_maintain_long_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'ğŸš€ å­è´¦æˆ·å¤šå•è¶…çº§ç»´æŠ¤å·²å¼€å¯' : 'âŒ å­è´¦æˆ·å¤šå•è¶…çº§ç»´æŠ¤å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            // å­è´¦æˆ·è¶…çº§ç»´æŠ¤ç©ºå•å¼€å…³
            document.getElementById('subSuperMaintainShort').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸš€ å­è´¦æˆ·è¶…çº§ç»´æŠ¤ç©ºå•-10%: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/sub-account/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            super_maintain_short_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'ğŸš€ å­è´¦æˆ·ç©ºå•è¶…çº§ç»´æŠ¤å·²å¼€å¯' : 'âŒ å­è´¦æˆ·ç©ºå•è¶…çº§ç»´æŠ¤å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            // è·Ÿç©ºå•äºæŸå¼€å•å¼€å…³
            document.getElementById('followShortLoss').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸ“Š è·Ÿç©ºå•äºæŸå¼€å•: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/sub-account/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            follow_short_loss_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'ğŸ“Š è·Ÿç©ºå•äºæŸå¼€å•å·²å¼€å¯' : 'âŒ è·Ÿç©ºå•äºæŸå¼€å•å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            // è·Ÿå¤šå•äºæŸå¼€å•å¼€å…³
            document.getElementById('followLongLoss').addEventListener('change', async function(e) {
                const enabled = e.target.checked;
                console.log(`ğŸ“Š è·Ÿå¤šå•äºæŸå¼€å•: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                try {
                    const response = await fetch('/api/sub-account/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            follow_long_loss_enabled: enabled
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(enabled ? 'ğŸ“Š è·Ÿå¤šå•äºæŸå¼€å•å·²å¼€å¯' : 'âŒ è·Ÿå¤šå•äºæŸå¼€å•å·²å…³é—­');
                    } else {
                        alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                        e.target.checked = !enabled;
                    }
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    alert('âš ï¸ é…ç½®ä¿å­˜å¤±è´¥');
                    e.target.checked = !enabled;
                }
            });
            
            // å­è´¦æˆ·æ“ä½œå‡½æ•°
            async function showSubAccountMaintenanceCount(accountName, instId, posSide) {
                // TODO: å®ç°å­è´¦æˆ·ç»´æŠ¤æ¬¡æ•°æŸ¥è¯¢
                alert('å­è´¦æˆ·ç»´æŠ¤æ¬¡æ•°æŸ¥è¯¢åŠŸèƒ½å¼€å‘ä¸­...');
            }
            
            async function resetSubAccountMaintenanceCount(accountName, instId, posSide) {
                const direction = posSide === 'short' ? 'åšç©º' : 'åšå¤š';
                
                if (!confirm(`ç¡®è®¤æ¸…é›¶ ${accountName} çš„ ${instId} ${direction} ä»Šæ—¥ç»´æŠ¤æ¬¡æ•°ï¼Ÿ\n\næ¸…é›¶åï¼Œä¸‹æ¬¡ç»´æŠ¤å°†ä¿ç•™10Uä¿è¯é‡‘ã€‚`)) {
                    return;
                }
                
                try {
                    const response = await fetch('/api/sub-account/reset-maintenance-count', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            account_name: accountName,
                            inst_id: instId,
                            pos_side: posSide
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(`âœ… æ¸…é›¶æˆåŠŸï¼\n\nå¸ç§: ${data.inst_id}\næ–¹å‘: ${direction}\nåŸç»´æŠ¤æ¬¡æ•°: ${data.old_count}æ¬¡\nå½“å‰ç»´æŠ¤æ¬¡æ•°: ${data.new_count}æ¬¡`);
                        loadData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert(`âŒ æ¸…é›¶å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (error) {
                    console.error('æ¸…é›¶å¤±è´¥:', error);
                    alert(`âŒ æ¸…é›¶å¤±è´¥ï¼š${error.message}`);
                }
            }
            
            // ç»´æŠ¤å­è´¦æˆ·æŒä»“ï¼ˆä¹°100Uç„¶åç«‹å³å¹³æ‰ï¼‰
            async function maintainSubAccountPosition(accountName, instId, posSide, currentMargin) {
                if (!confirm(`ç¡®è®¤è¦ç»´æŠ¤ ${accountName} çš„ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“å—ï¼Ÿ\n\nç»´æŠ¤æ“ä½œï¼šä¹°100Uå¹¶ç«‹å³å¹³æ‰`)) {
                    return;
                }
                
                alert('ğŸ”„ æ­£åœ¨æ‰§è¡Œç»´æŠ¤æ“ä½œ...');
                
                try {
                    const response = await fetch('/api/sub-account/maintain', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            account_name: accountName,
                            inst_id: instId,
                            pos_side: posSide
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(`âœ… ç»´æŠ¤æˆåŠŸï¼`);
                        loadData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert(`âŒ ç»´æŠ¤å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (error) {
                    console.error('ç»´æŠ¤å¤±è´¥:', error);
                    alert(`âŒ ç»´æŠ¤å¤±è´¥ï¼š${error.message}`);
                }
            }
            
            // æ£€æŸ¥å¹¶çº æ­£å­è´¦æˆ·æŒä»“
            async function checkAndFixSubAccountPosition(accountName, instId, posSide, maintenanceCount) {
                // è®¡ç®—ç›®æ ‡ä¿è¯é‡‘
                let targetMargin = 10;
                if (maintenanceCount === 1) targetMargin = 20;
                else if (maintenanceCount === 2) targetMargin = 20;
                else if (maintenanceCount >= 3) targetMargin = 30;
                
                if (!confirm(`ç¡®è®¤è¦çº é”™ ${accountName} çš„ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“å—ï¼Ÿ\n\nå½“å‰ç»´æŠ¤æ¬¡æ•°: ${maintenanceCount}\nç›®æ ‡ä¿è¯é‡‘: ${targetMargin}U\n\nç³»ç»Ÿå°†è‡ªåŠ¨è°ƒæ•´æŒä»“ï¼Œä½¿ä¿è¯é‡‘ç¬¦åˆè§„åˆ™`)) {
                    return;
                }
                
                alert('ğŸ” æ­£åœ¨æ£€æŸ¥å¹¶çº æ­£æŒä»“...');
                
                try {
                    const response = await fetch('/api/sub-account/check-and-fix-position', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            account_name: accountName,
                            inst_id: instId,
                            pos_side: posSide
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        if (data.action === 'none') {
                            alert(`âœ… ${data.message}`);
                        } else if (data.action === 'reduce') {
                            alert(`âœ… ${data.message}\n\nå¹³ä»“æ•°é‡: ${data.closed_size} å¼ \nè®¢å•ID: ${data.order_id}`);
                        } else if (data.action === 'increase') {
                            alert(`âœ… ${data.message}\n\nåŠ ä»“æ•°é‡: ${data.added_size} å¼ \nè®¢å•ID: ${data.order_id}`);
                        }
                        loadData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert(`âŒ çº é”™å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (error) {
                    console.error('çº é”™å¤±è´¥:', error);
                    alert(`âŒ çº é”™å¤±è´¥ï¼š${error.message}`);
                }
            }
            
            // æ˜¾ç¤ºå¹³ä»“é€‰é¡¹å¼¹çª—
            function showClosePositionDialog(accountName, instId, posSide, currentMargin) {
                const direction = posSide === 'short' ? 'åšç©º' : 'åšå¤š';
                const options = [
                    { label: 'å¹³ä»“ 20%', value: 20 },
                    { label: 'å¹³ä»“ 33%', value: 33 },
                    { label: 'å¹³ä»“ 50%', value: 50 },
                    { label: 'å¹³ä»“ 66%', value: 66 },
                    { label: 'å¹³ä»“ 75%', value: 75 },
                    { label: 'å¹³è‡³10U', value: 'to10U' }
                ];
                
                let message = `é€‰æ‹©å¹³ä»“æ“ä½œï¼š\n\n`;
                message += `å¸ç§: ${instId}\n`;
                message += `æ–¹å‘: ${direction}\n`;
                message += `å½“å‰ä¿è¯é‡‘: ${currentMargin.toFixed(2)} USDT\n\n`;
                
                options.forEach((opt, idx) => {
                    message += `${idx + 1}. ${opt.label}\n`;
                });
                
                const choice = prompt(message + '\nè¯·è¾“å…¥é€‰é¡¹ç¼–å· (1-6):');
                
                if (!choice) return; // ç”¨æˆ·å–æ¶ˆ
                
                const index = parseInt(choice) - 1;
                if (index < 0 || index >= options.length) {
                    alert('âŒ æ— æ•ˆçš„é€‰é¡¹');
                    return;
                }
                
                const selected = options[index];
                
                if (selected.value === 'to10U') {
                    closeSubAccountPositionTo10U(accountName, instId, posSide, currentMargin);
                } else {
                    closeSubAccountPositionByPercent(accountName, instId, posSide, selected.value, currentMargin);
                }
            }
            
            // æŒ‰ç™¾åˆ†æ¯”å¹³ä»“
            async function closeSubAccountPositionByPercent(accountName, instId, posSide, percent, currentMargin) {
                
                if (!confirm(`ç¡®è®¤è¦å¹³æ‰ ${accountName} çš„ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“çš„ ${percent}% å—ï¼Ÿ\n\nå½“å‰ä¿è¯é‡‘: ${currentMargin.toFixed(2)} USDT`)) {
                    return;
                }
                
                alert('ğŸ”„ æ­£åœ¨å¹³ä»“...');
                
                try {
                    const response = await fetch('/api/sub-account/close-position-percent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            account_name: accountName,
                            inst_id: instId,
                            pos_side: posSide,
                            percent: percent
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(`âœ… å¹³ä»“ ${percent}% æˆåŠŸï¼`);
                        loadData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert(`âŒ å¹³ä»“å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (error) {
                    console.error('å¹³ä»“å¤±è´¥:', error);
                    alert(`âŒ å¹³ä»“å¤±è´¥ï¼š${error.message}`);
                }
            }
            
            // å¹³è‡³10Uï¼ˆ99Uçš„æŒä»“å¹³æ‰ï¼‰
            async function closeSubAccountPositionTo10U(accountName, instId, posSide, currentMargin) {
                
                if (currentMargin <= 10) {
                    alert('âŒ å½“å‰ä¿è¯é‡‘å·²ç»å°äºæˆ–ç­‰äº10Uï¼Œæ— éœ€å¹³ä»“');
                    return;
                }
                
                const closeAmount = currentMargin - 10;
                const percent = (closeAmount / currentMargin * 100).toFixed(2);
                
                if (!confirm(`ç¡®è®¤è¦å¹³æ‰ ${accountName} çš„ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“è‡³10Uå—ï¼Ÿ\n\nå½“å‰ä¿è¯é‡‘: ${currentMargin.toFixed(2)} USDT\nå¹³ä»“æ¯”ä¾‹: ${percent}%\nä¿ç•™ä¿è¯é‡‘: 10 USDT`)) {
                    return;
                }
                
                alert('ğŸ”„ æ­£åœ¨å¹³ä»“...');
                
                try {
                    const response = await fetch('/api/sub-account/close-position-to-amount', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            account_name: accountName,
                            inst_id: instId,
                            pos_side: posSide,
                            target_margin: 10
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(`âœ… å¹³ä»“æˆåŠŸï¼ä¿è¯é‡‘å·²é™è‡³çº¦10U`);
                        loadData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert(`âŒ å¹³ä»“å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (error) {
                    console.error('å¹³ä»“å¤±è´¥:', error);
                    alert(`âŒ å¹³ä»“å¤±è´¥ï¼š${error.message}`);
                }
            }
            
            async function closeSubAccountPosition(accountName, instId, posSide) {
                if (!confirm(`ç¡®è®¤è¦å¹³æ‰ ${accountName} çš„ ${instId} ${posSide === 'short' ? 'åšç©º' : 'åšå¤š'} æŒä»“å—ï¼Ÿ`)) {
                    return;
                }
                
                try {
                    const response = await fetch('/api/sub-account/close-position', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            account_name: accountName,
                            inst_id: instId,
                            pos_side: posSide
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(`âœ… å¹³ä»“æˆåŠŸï¼`);
                        loadData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert(`âŒ å¹³ä»“å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (error) {
                    console.error('å¹³ä»“å¤±è´¥:', error);
                    alert(`âŒ å¹³ä»“å¤±è´¥ï¼š${error.message}`);
                }
            }
            
            // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
            window.showSubAccountMaintenanceCount = showSubAccountMaintenanceCount;
            window.resetSubAccountMaintenanceCount = resetSubAccountMaintenanceCount;
            window.closeSubAccountPosition = closeSubAccountPosition;
            window.maintainSubAccountPosition = maintainSubAccountPosition;
            window.showClosePositionDialog = showClosePositionDialog;
            window.closeSubAccountPositionByPercent = closeSubAccountPositionByPercent;
            window.closeSubAccountPositionTo10U = closeSubAccountPositionTo10U;
            
            // ä¸€é”®å…¨éƒ¨å¹³ä»“æŒ‰é’®
            document.getElementById('closeAllSubAccountPositions').addEventListener('click', async function() {
                // äºŒæ¬¡ç¡®è®¤
                const confirmMessage = 'âš ï¸ ç¡®è®¤è¦å¹³æ‰æ‰€æœ‰å­è´¦æˆ·æŒä»“å—ï¼Ÿ\n\nè¿™å°†å…³é—­æ‰€æœ‰å­è´¦æˆ·çš„æ‰€æœ‰æŒä»“ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼';
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                console.log('ğŸš¨ å¼€å§‹æ‰§è¡Œä¸€é”®å…¨éƒ¨å¹³ä»“...');
                alert('ğŸ”„ æ­£åœ¨å¹³ä»“æ‰€æœ‰æŒä»“...');
                
                try {
                    const response = await fetch('/api/sub-account/close-all-positions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        alert(`âœ… å¹³ä»“å®Œæˆï¼æˆåŠŸ: ${data.success_count}ä¸ªï¼Œå¤±è´¥: ${data.fail_count}ä¸ª`);
                        // åˆ·æ–°æ•°æ®
                        setTimeout(() => {
                            loadData();
                        }, 2000);
                    } else {
                        alert(`âŒ å¹³ä»“å¤±è´¥: ${data.message}`);
                    }
                } catch (error) {
                    console.error('ä¸€é”®å¹³ä»“å¤±è´¥:', error);
                    alert('âŒ ä¸€é”®å¹³ä»“å¤±è´¥');
                }
            });
            
            // è‡ªåŠ¨åˆ·æ–°æ•°æ®å’ŒæŒç»­æ—¶é—´ï¼ˆåˆå¹¶ï¼šæ¯60ç§’ï¼Œä¼˜åŒ–ï¼šä»30ç§’æ”¹ä¸º60ç§’ï¼Œå‡å°‘CPUå ç”¨ï¼‰
            setInterval(() => {
                console.log('â° è‡ªåŠ¨åˆ·æ–°æ•°æ®å’ŒæŒç»­æ—¶é—´...', new Date().toLocaleString('zh-CN'));
                refreshData();
                updateDurations();
            }, 60000);
            
            // å®šæœŸæ£€æŸ¥ä¿æŠ¤çŠ¶æ€ï¼ˆæ¯60ç§’ï¼Œä¼˜åŒ–ï¼šä»15ç§’æ”¹ä¸º60ç§’ï¼Œå‡å°‘CPUå ç”¨ï¼‰
            setInterval(() => {
                updateProtectionStatus();
            }, 60000);
            
            // ä¼˜å…ˆæ˜¾ç¤ºé¡µé¢æ¡†æ¶ï¼Œå¼‚æ­¥åŠ è½½æ•°æ®ï¼ˆæå‡åŠ è½½é€Ÿåº¦ï¼‰
            console.log('ğŸš€ å¼€å§‹åŠ è½½é¡µé¢...');
            
            // ç«‹å³åˆå§‹åŒ–å›¾è¡¨å®¹å™¨ï¼ˆé¿å…å¸ƒå±€é—ªçƒï¼‰
            initEscapeSignalChart();
            initLiquidation1hChart();  // åˆå§‹åŒ–1å°æ—¶çˆ†ä»“é‡‘é¢å›¾è¡¨
            
            // å¼‚æ­¥å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®ï¼ˆä¸é˜»å¡é¡µé¢æ˜¾ç¤ºï¼‰
            Promise.all([
                loadData(),
                loadProfitStats(),
                loadShortProfitStats(),
                loadSarSlopeData(),
                loadEscapeSignalData()
            ]).then(() => {
                console.log('âœ… æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆ');
                // loadingå·²ç»åœ¨loadDataä¸­å¤„ç†

            }).catch(error => {
                console.error('âŒ æ•°æ®åŠ è½½å‡ºé”™:', error);
                clearTimeout(loadingTimeout);
                // å³ä½¿å‡ºé”™ä¹Ÿéšè—æŒ‡ç¤ºå™¨
                const indicator = document.getElementById('loading-indicator');
                if (indicator) {
                    indicator.classList.add('hidden');
                    indicator.style.display = 'none';  // å¼ºåˆ¶éšè—
                }
            });
            
            // å®šæœŸåˆ·æ–°ç©ºå•ç›ˆåˆ©ç»Ÿè®¡ï¼ˆæ¯60ç§’ï¼‰
            // å®šæœŸåˆ·æ–°æ‰€æœ‰ç»Ÿè®¡æ•°æ®ï¼ˆåˆå¹¶ï¼šæ¯120ç§’ï¼Œä¼˜åŒ–ï¼šä»60ç§’æ”¹ä¸º120ç§’å¹¶åˆå¹¶ï¼Œå¤§å¹…å‡å°‘CPUå ç”¨ï¼‰
            setInterval(() => {
                console.log('â° åˆ·æ–°æ‰€æœ‰ç»Ÿè®¡æ•°æ®...', new Date().toLocaleString('zh-CN'));
                loadProfitStats();
                loadShortProfitStats();
                loadSarSlopeData();
                loadEscapeSignalData();
            }, 120000);
            
            // å®šæœŸåˆ·æ–°1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®ï¼ˆæ¯3åˆ†é’Ÿï¼‰
            setInterval(() => {
                console.log('â° åˆ·æ–°1å°æ—¶çˆ†ä»“é‡‘é¢æ•°æ®...', new Date().toLocaleString('zh-CN'));
                loadAllLiquidationData();
            }, 180000);
            
            console.log('âœ… é¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œæ•°æ®å’ŒæŒç»­æ—¶é—´æ¯60ç§’åˆ·æ–°ï¼Œç»Ÿè®¡æ•°æ®æ¯120ç§’åˆ·æ–°ï¼Œ1å°æ—¶çˆ†ä»“é‡‘é¢æ¯3åˆ†é’Ÿåˆ·æ–°ï¼ˆå·²ä¼˜åŒ–ï¼Œå‡å°‘CPUå ç”¨ï¼‰');
        });
        
        // ============= äº¤æ˜“å¯¹ä¿æŠ¤ç³»ç»Ÿç›¸å…³å‡½æ•° =============
        
        // ä¿æŠ¤çŠ¶æ€
        let isProtectionActive = false;
        
        // åˆ‡æ¢ä¿æŠ¤ç³»ç»Ÿ
        async function togglePairProtection() {
            const btn = document.getElementById('pairProtectionBtn');
            const btnText = document.getElementById('protectionBtnText');
            const panel = document.getElementById('pairProtectionPanel');
            
            if (isProtectionActive) {
                // åœæ­¢ä¿æŠ¤
                if (!confirm('ç¡®è®¤åœæ­¢äº¤æ˜“å¯¹ä¿æŠ¤ç³»ç»Ÿå—ï¼Ÿ')) {
                    return;
                }
                
                try {
                    const response = await fetch('/api/pair-protection/stop', {
                        method: 'POST'
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        isProtectionActive = false;
                        btnText.textContent = 'å¯åŠ¨äº¤æ˜“å¯¹ä¿æŠ¤';
                        btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                        panel.style.display = 'none';
                        alert('âœ… ä¿æŠ¤ç³»ç»Ÿå·²åœæ­¢');
                    } else {
                        alert('âŒ åœæ­¢å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                    }
                } catch (error) {
                    console.error('åœæ­¢ä¿æŠ¤å¤±è´¥:', error);
                    alert('âŒ åœæ­¢å¤±è´¥: ' + error.message);
                }
            } else {
                // å¯åŠ¨ä¿æŠ¤
                try {
                    const response = await fetch('/api/pair-protection/start', {
                        method: 'POST'
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        isProtectionActive = true;
                        btnText.textContent = 'åœæ­¢äº¤æ˜“å¯¹ä¿æŠ¤';
                        btn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                        panel.style.display = 'block';
                        
                        // æ˜¾ç¤ºåˆå§‹åŒ–ä¿¡æ¯
                        document.getElementById('protectedPairsCount').textContent = data.protected_count || 0;
                        document.getElementById('currentPairsCount').textContent = data.current_count || 0;
                        document.getElementById('lastCheckTime').textContent = new Date().toLocaleString('zh-CN');
                        
                        alert(`âœ… ä¿æŠ¤ç³»ç»Ÿå·²å¯åŠ¨\n\nå½“å‰ä¿æŠ¤ ${data.protected_count || 0} ä¸ªäº¤æ˜“å¯¹\næ¯60ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡`);
                        
                        // ç«‹å³æ›´æ–°çŠ¶æ€
                        updateProtectionStatus();
                    } else {
                        alert('âŒ å¯åŠ¨å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                    }
                } catch (error) {
                    console.error('å¯åŠ¨ä¿æŠ¤å¤±è´¥:', error);
                    alert('âŒ å¯åŠ¨å¤±è´¥: ' + error.message);
                }
            }
        }
        
        // æ›´æ–°ä¿æŠ¤çŠ¶æ€
        async function updateProtectionStatus() {
            if (!isProtectionActive) return;
            
            try {
                const response = await fetch('/api/pair-protection/status');
                const data = await response.json();
                
                if (data.success && data.is_running) {
                    document.getElementById('protectionStatus').textContent = 'è¿è¡Œä¸­';
                    document.getElementById('protectedPairsCount').textContent = data.protected_count || 0;
                    document.getElementById('currentPairsCount').textContent = data.current_count || 0;
                    document.getElementById('lastCheckTime').textContent = data.last_check || '--';
                    document.getElementById('autoFillCount').textContent = data.fill_count || 0;
                    
                    // å¦‚æœæœ‰ç¼ºå¤±çš„äº¤æ˜“å¯¹ï¼Œæ˜¾ç¤ºè­¦å‘Š
                    if (data.missing_pairs && data.missing_pairs.length > 0) {
                        console.warn('âš ï¸ å‘ç°ç¼ºå¤±çš„äº¤æ˜“å¯¹:', data.missing_pairs);
                    }
                } else {
                    // ä¿æŠ¤ç³»ç»Ÿå·²åœæ­¢
                    isProtectionActive = false;
                    document.getElementById('protectionBtnText').textContent = 'å¯åŠ¨äº¤æ˜“å¯¹ä¿æŠ¤';
                    document.getElementById('pairProtectionBtn').style.background = 
                        'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    document.getElementById('pairProtectionPanel').style.display = 'none';
                }
            } catch (error) {
                console.error('è·å–ä¿æŠ¤çŠ¶æ€å¤±è´¥:', error);
            }
        }
    </script>
</body>
</html>
or);
            }
        }
    </script>
</body>
</html>
