<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>OKXå®ç›˜äº¤æ˜“ç³»ç»Ÿ v2.0</title>
    <!-- ç‰ˆæœ¬: 2026-02-13 - æ·»åŠ åŠ è½½è¿›åº¦æ˜¾ç¤º -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 30px;
            zoom: 1.5;
        }

        /* åŠ è½½è¿›åº¦è¦†ç›–å±‚ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
            color: white;
            max-width: 500px;
            width: 90%;
        }

        .loading-logo {
            font-size: 64px;
            margin-bottom: 30px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .loading-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            height: 50px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 0.3s ease;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .loading-step {
            font-size: 18px;
            margin-top: 20px;
            opacity: 0.9;
            min-height: 28px;
        }

        .loading-substeps {
            font-size: 14px;
            margin-top: 15px;
            opacity: 0.7;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .substep {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 14px;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .substep.completed {
            background: rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.4);
        }

        .substep.loading {
            background: rgba(59, 130, 246, 0.3);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .container {
            max-width: 2100px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mode-badge {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* è´¦æˆ·åˆ‡æ¢æ¨ªæ¡ */
        .account-switcher {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .account-switcher-label {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-tabs {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .account-tab {
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
        }

        .account-tab:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .account-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .account-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
            padding-left: 20px;
            border-left: 2px solid #e2e8f0;
        }

        .account-balance {
            font-size: 14px;
            color: #64748b;
        }

        .account-balance strong {
            color: #10b981;
            font-size: 16px;
            margin-left: 5px;
        }

        .btn-manage-accounts {
            background: #8b5cf6;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-manage-accounts:hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        /* è´¦æˆ·ç®¡ç†å¯¹è¯æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-header h2 {
            font-size: 22px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #64748b;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .btn-close:hover {
            background: #f1f5f9;
            color: #2d3748;
        }

        .account-list {
            margin-bottom: 25px;
        }

        .account-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .account-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }

        .account-item-info {
            flex: 1;
        }

        .account-item-name {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .account-item-balance {
            font-size: 14px;
            color: #10b981;
            font-weight: 600;
        }

        .account-item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .account-form {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-primary {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-add-account {
            background: #10b981;
            color: white;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-add-account:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-home {
            background: #10b981;
            color: white;
        }

        .btn-home:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-refresh {
            background: #3b82f6;
            color: white;
        }

        .btn-refresh:hover {
            background: #2563eb;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 20px;
        }

        /* å·¦ä¾§äº¤æ˜“å¯¹åˆ—è¡¨ */
        .symbols-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .symbols-panel h3 {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .symbol-search {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .symbol-search:focus {
            border-color: #3b82f6;
        }

        .symbol-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .symbol-item:hover {
            background: #f7fafc;
        }

        .symbol-item.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #1e40af;
        }

        .symbol-item.favorite {
            background: #fef3c7;
            border-color: #fbbf24;
        }

        .symbol-item.favorite.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-color: #b45309;
        }

        .symbol-content {
            flex: 1;
        }

        .symbol-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .favorite-badge {
            color: #f59e0b;
            font-size: 12px;
        }

        .symbol-item.active .favorite-badge {
            color: #fef3c7;
        }

        .symbol-price {
            font-size: 13px;
            opacity: 0.8;
        }

        .favorite-btn {
            padding: 4px 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            opacity: 0;
            margin-left: 8px;
        }

        .symbol-item:hover .favorite-btn {
            opacity: 1;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.favorited {
            opacity: 1;
        }

        .favorite-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #fbbf24;
        }

        .favorite-section-title {
            font-size: 13px;
            color: #d97706;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* ä¸­é—´äº¤æ˜“é¢æ¿ */
        .trading-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .symbol-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .symbol-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .current-symbol {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        .symbol-subtitle {
            font-size: 14px;
            color: #718096;
        }

        .current-price {
            text-align: right;
        }

        .price-value {
            font-size: 32px;
            font-weight: bold;
            color: #10b981;
        }

        .price-change {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 20px;
            margin-top: 5px;
            display: inline-block;
        }

        .price-change.up {
            background: #dcfce7;
            color: #16a34a;
        }

        .price-change.down {
            background: #fee2e2;
            color: #dc2626;
        }

        /* äº¤æ˜“æ–¹å‘æŒ‰é’® */
        .direction-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .direction-tab {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        .direction-tab:hover {
            transform: translateY(-2px);
        }

        .direction-tab.long {
            border-color: #10b981;
            color: #10b981;
        }

        .direction-tab.long.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #059669;
        }

        .direction-tab.short {
            border-color: #ef4444;
            color: #ef4444;
        }

        .direction-tab.short.active {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: #dc2626;
        }

        /* äº¤æ˜“è¡¨å• */
        .trading-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #3b82f6;
        }

        .leverage-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .leverage-btn {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
        }

        .leverage-btn:hover {
            background: #f7fafc;
        }

        .leverage-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #2563eb;
        }

        .amount-presets {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .preset-btn {
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
        }

        .preset-btn:hover {
            background: #f7fafc;
            border-color: #cbd5e0;
        }

        .submit-order {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .submit-order.long {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .submit-order.long:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .submit-order.short {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .submit-order.short:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        /* æ‰¹é‡å¼€ä»“æŒ‰é’® */
        .batch-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .batch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .batch-btn-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .batch-btn-desc {
            font-size: 11px;
            color: #64748b;
        }

        .batch-btn.long .batch-btn-title {
            color: #10b981;
        }

        .batch-btn.short .batch-btn-title {
            color: #ef4444;
        }

        .batch-btn:active {
            transform: scale(0.98);
        }

        /* æ‰¹é‡å¹³ä»“æŒ‰é’® */
        .batch-close-btn {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .batch-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .batch-close-btn:active {
            transform: scale(0.98);
        }

        /* å¹³ä¸€åŠå¤šå• */
        .batch-close-long-half {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            color: #166534;
        }

        .batch-close-long-half:hover {
            box-shadow: 0 4px 12px rgba(74, 222, 128, 0.4);
        }

        /* å¹³ä¸€åŠç©ºå• */
        .batch-close-short-half {
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%);
            color: #7f1d1d;
        }

        .batch-close-short-half:hover {
            box-shadow: 0 4px 12px rgba(248, 113, 113, 0.4);
        }

        /* å¹³å…¨éƒ¨å¤šå• */
        .batch-close-long-all {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .batch-close-long-all:hover {
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.5);
        }

        /* å¹³å…¨éƒ¨ç©ºå• */
        .batch-close-short-all {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .batch-close-short-all:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
        }


        /* å³ä¾§è´¦æˆ·ä¿¡æ¯ */
        .account-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f7fafc;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 13px;
            color: #718096;
        }

        .info-value {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
        }

        .risk-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .risk-warning h4 {
            font-size: 14px;
            color: #92400e;
            margin-bottom: 8px;
        }

        .risk-warning ul {
            font-size: 12px;
            color: #78350f;
            padding-left: 20px;
        }

        .risk-warning li {
            margin-bottom: 4px;
        }

        /* æš‚æ— æŒä»“æç¤º */
        .no-positions {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #a0aec0;
            font-size: 14px;
        }

        /* æŒä»“é¡¹ç›® */
        .position-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .position-symbol {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
        }

        .position-side {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .position-side.long {
            background: #d1fae5;
            color: #065f46;
        }

        .position-side.short {
            background: #fee2e2;
            color: #991b1b;
        }

        .close-position-btn {
            padding: 4px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .close-position-btn:hover {
            background: #dc2626;
        }

        .close-position-btn:active {
            background: #b91c1c;
        }

        .cancel-order-btn {
            padding: 4px 12px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .cancel-order-btn:hover {
            background: #d97706;
        }

        .cancel-order-btn:active {
            background: #b45309;
        }


        .position-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            font-size: 12px;
        }

        .position-detail-item {
            display: flex;
            justify-content: space-between;
        }

        .position-detail-label {
            color: #718096;
        }

        .position-detail-value {
            font-weight: 600;
            color: #2d3748;
        }

        .position-pnl {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 600;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        /* å¼€å…³æ ·å¼ */
        .switch input:checked + .slider {
            background-color: #10b981;
        }
        
        /* æ­¢ç›ˆå¼€å…³ - ç»¿è‰² */
        #takeProfitSwitch:checked + .slider-takeprofit {
            background-color: #10b981 !important;
        }
        
        /* æ­¢æŸå¼€å…³ - çº¢è‰² */
        #stopLossSwitch:checked + .slider-stoploss {
            background-color: #ef4444 !important;
        }
        
        .switch input:checked + .slider:before {
            transform: translateX(20px);
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½è¿›åº¦è¦†ç›–å±‚ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-logo">ğŸ’¹</div>
            <div class="loading-title">OKXå®ç›˜äº¤æ˜“ç³»ç»Ÿ</div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%;">
                    <span id="progressText">0%</span>
                </div>
            </div>
            <div class="loading-step" id="loadingStep">æ­£åœ¨åˆå§‹åŒ–...</div>
            <div class="loading-substeps" id="loadingSubsteps">
                <span class="substep" id="step-accounts">è´¦æˆ·é…ç½®</span>
                <span class="substep" id="step-favorites">å¸¸ç”¨å¸ç§</span>
                <span class="substep" id="step-tickers">å®æ—¶è¡Œæƒ…</span>
                <span class="substep" id="step-positions">æŒä»“ä¿¡æ¯</span>
                <span class="substep" id="step-orders">å§”æ‰˜è®¢å•</span>
                <span class="substep" id="step-logs">äº¤æ˜“æ—¥å¿—</span>
            </div>
        </div>
    </div>

    <div class="container" style="opacity: 0; transition: opacity 0.5s;" id="mainContent">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div>
                <h1>
                    ğŸ’¹ OKXå®ç›˜äº¤æ˜“ç³»ç»Ÿ
                    <span class="mode-badge">ğŸ”´ å®ç›˜äº¤æ˜“</span>
                </h1>
            </div>
            <div class="header-actions">
                <a href="/" class="btn btn-home">ğŸ  è¿”å›é¦–é¡µ</a>
                <a href="/okx-profit-analysis" class="btn btn-home" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">ğŸ“Š åˆ©æ¶¦åˆ†æ</a>
                <button class="btn btn-refresh" onclick="refreshData()">ğŸ”„ åˆ·æ–°</button>
            </div>
        </div>

        <!-- ç³»ç»Ÿæ¶æ„è¯´æ˜ï¼ˆå¯ä¼¸ç¼©ï¼‰ -->
        <div style="margin-top: 10px; padding: 10px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; border: 2px solid #0ea5e9;">
            <div style="cursor: pointer; display: flex; align-items: center; justify-content: space-between;" onclick="document.getElementById('systemArchitecture').style.display = document.getElementById('systemArchitecture').style.display === 'none' ? 'block' : 'none'; document.getElementById('archToggleIcon').textContent = document.getElementById('systemArchitecture').style.display === 'none' ? 'â–¶' : 'â–¼';">
                <span style="color: #0369a1; font-weight: 700; font-size: 13px;">ğŸ“š ç³»ç»Ÿæ¶æ„ä¸è¿è¡Œè¯´æ˜</span>
                <span id="archToggleIcon" style="color: #0369a1; font-weight: bold; font-size: 14px;">â–¼</span>
            </div>
            <div id="systemArchitecture" style="margin-top: 12px; max-height: 500px; overflow-y: auto; color: #0c4a6e; font-size: 11px; line-height: 1.8;">
                
                <!-- 1. ç³»ç»Ÿæ¦‚è¿° -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #0ea5e9;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ¯ ä¸€ã€ç³»ç»Ÿæ¦‚è¿°</h4>
                    <p style="margin: 4px 0;"><strong>ç³»ç»Ÿåç§°ï¼š</strong>OKX å®ç›˜äº¤æ˜“ç³»ç»Ÿ v2.0</p>
                    <p style="margin: 4px 0;"><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
                    <ul style="margin: 4px 0 0 20px; padding: 0;">
                        <li>å¤šè´¦æˆ·ç®¡ç†ï¼ˆä¸»è´¦æˆ·ã€fangfang12ã€poitã€marksï¼‰</li>
                        <li>å®æ—¶è¡Œæƒ…ç›‘æ§ï¼ˆ27ä¸ªUSDT-SWAPäº¤æ˜“å¯¹ï¼‰</li>
                        <li><strong>æ¶¨å¹…å8åç­–ç•¥ï¼š</strong>BTCä»·æ ¼è§¦å‘ï¼Œå¯¹å¸¸ç”¨å¸ä¸­æ¶¨å¹…å8åå¼€å¤šå•</li>
                        <li>è´¦æˆ·çº§æ­¢ç›ˆæ­¢æŸï¼ˆåŸºäºæ€»æœªå®ç°ç›ˆäºï¼‰</li>
                        <li>æŒä»“ç®¡ç†ä¸å§”æ‰˜è®¢å•è·Ÿè¸ª</li>
                        <li>äº¤æ˜“æ—¥å¿—è®°å½•ä¸åˆ†æ</li>
                        <li>ä»·æ ¼æ¶¨è·Œå¹…è¿½è¸ªä¸é¢„è­¦</li>
                    </ul>
                </div>
                
                <!-- 2. è¿è¡Œæµç¨‹ -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #06b6d4;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">âš™ï¸ äºŒã€è¿è¡Œæµç¨‹</h4>
                    <p style="margin: 4px 0;"><strong>é¡µé¢åŠ è½½æµç¨‹ï¼š</strong></p>
                    <ol style="margin: 4px 0 0 20px; padding: 0;">
                        <li>ä»åç«¯APIåŠ è½½è´¦æˆ·åˆ—è¡¨ï¼ˆ/api/okx-accounts/list-with-credentialsï¼‰</li>
                        <li>æ¸²æŸ“è´¦æˆ·æ ‡ç­¾å¹¶è®¾ç½®é»˜è®¤è´¦æˆ·</li>
                        <li>åŠ è½½å¸¸ç”¨å¸åˆ—è¡¨ï¼ˆä»æœåŠ¡å™¨localStorageåŒæ­¥ï¼‰</li>
                        <li>åŠ è½½å®æ—¶è¡Œæƒ…æ•°æ®ï¼ˆ/api/okx-trading/market-tickersï¼‰</li>
                        <li>åŠ è½½è´¦æˆ·ä¿¡æ¯ï¼ˆä½™é¢ã€æœªå®ç°ç›ˆäºï¼‰</li>
                        <li>åŠ è½½æŒä»“ã€å§”æ‰˜è®¢å•ã€äº¤æ˜“æ—¥å¿—</li>
                        <li>åŠ è½½æ­¢ç›ˆæ­¢æŸè®¾ç½®å’Œè‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®</li>
                    </ol>
                    <p style="margin: 8px 0 4px 0;"><strong>å®šæ—¶ä»»åŠ¡ï¼ˆæ¯30ç§’ï¼‰ï¼š</strong></p>
                    <ul style="margin: 4px 0 0 20px; padding: 0;">
                        <li>åˆ·æ–°è´¦æˆ·æ•°æ®ï¼ˆä½™é¢ã€æŒä»“ï¼‰</li>
                        <li>æ›´æ–°æ€»æ¶¨è·Œå¹…ç»Ÿè®¡</li>
                        <li>æ£€æŸ¥å¹¶æ‰§è¡Œè‡ªåŠ¨äº¤æ˜“ç­–ç•¥</li>
                        <li>æ£€æŸ¥æ­¢ç›ˆæ­¢æŸè§¦å‘æ¡ä»¶</li>
                    </ul>
                    <p style="margin: 8px 0 4px 0;"><strong>æ¶¨å¹…å8åç­–ç•¥æ‰§è¡Œæµç¨‹ï¼š</strong></p>
                    <ol style="margin: 4px 0 0 20px; padding: 0;">
                        <li><strong>è§¦å‘æ£€æŸ¥ï¼š</strong>æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡BTCä»·æ ¼</li>
                        <li><strong>è§¦å‘æ¡ä»¶ï¼š</strong>BTCä»·æ ¼ &lt; è®¾å®šçš„è§¦å‘ä»·æ ¼ï¼ˆå¦‚68000ï¼‰</li>
                        <li><strong>è¯†åˆ«æ ‡çš„ï¼š</strong>è·å–å¸¸ç”¨å¸(15ä¸ª)çš„24hæ¶¨è·Œå¹…æ•°æ®</li>
                        <li><strong>æ’åºç­›é€‰ï¼š</strong>æŒ‰æ¶¨è·Œå¹…å‡åºæ’åˆ—ï¼Œå–å‰8åï¼ˆæ¶¨å¹…æœ€ä½çš„8ä¸ªï¼‰</li>
                        <li><strong>ä»“ä½è®¡ç®—ï¼š</strong>æ¯ä¸ªå¸ç§ç”¨å¯ç”¨ä½™é¢çš„1.5%ï¼Œ10å€æ æ†</li>
                        <li><strong>æ‰¹é‡å¼€å•ï¼š</strong>å¯¹è¿™8ä¸ªå¸ç§é€ä¸ªä¸‹å¸‚ä»·å¤šå•</li>
                        <li><strong>è‡ªåŠ¨å…³é—­ï¼š</strong>æ‰§è¡Œå®Œæˆåè‡ªåŠ¨å…³é—­ç­–ç•¥å¼€å…³ï¼ˆenabled=falseï¼‰</li>
                        <li><strong>è®°å½•æ—¥å¿—ï¼š</strong>è®°å½•æ‰§è¡Œæ—¶é—´ã€å¸ç§ã€ç»“æœåˆ°JSONLæ–‡ä»¶</li>
                        <li><strong>ç”¨æˆ·é€šçŸ¥ï¼š</strong>å¼¹çª—æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥å¸ç§ï¼Œåˆ·æ–°æŒä»“åˆ—è¡¨</li>
                    </ol>
                    <p style="margin: 8px 0 4px 0; padding: 8px; background: #fef3c7; border-radius: 4px;"><strong>âš ï¸ æ³¨æ„ï¼š</strong>BTCä»·æ ¼åªæ˜¯è§¦å‘æ¡ä»¶ï¼ŒçœŸæ­£å¼€å•çš„æ˜¯æ¶¨å¹…å8åçš„å¸ç§ï¼ˆä¸ä¸€å®šåŒ…æ‹¬BTCï¼‰</p>
                </div>
                
                <!-- 3. æ•°æ®å­˜å‚¨ç»“æ„ -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #8b5cf6;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ’¾ ä¸‰ã€æ•°æ®å­˜å‚¨ç»“æ„ï¼ˆJSONLæ ¼å¼ï¼‰</h4>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600;">3.1 æ¶¨å¹…å8åç­–ç•¥è®¾ç½®</p>
                    <p style="margin: 2px 0;"><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">data/okx_auto_strategy/account_main.json</code></p>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
{
  "enabled": false,                // æ˜¯å¦å¯ç”¨ç­–ç•¥
  "strategyType": "bottom_performers",  // ç­–ç•¥ç±»å‹
  "strategyName": "æ¶¨å¹…å8åç­–ç•¥",   // ç­–ç•¥åç§°
  "targetSymbols": "favorite_bottom_8", // ç›®æ ‡å¸ç§
  "triggerPrice": 68000.0,         // BTCè§¦å‘ä»·æ ¼ï¼ˆUSDï¼‰
  "orderType": "long",             // å¼€å•æ–¹å‘ï¼ˆåªå¼€å¤šï¼‰
  "leverage": 10,                  // æ æ†å€æ•°
  "positionSize": 1.5,             // æ¯å¸ä»“ä½ç™¾åˆ†æ¯”
  "lastExecutedTime": null,        // ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
  "executedCount": 0,              // æ‰§è¡Œæ¬¡æ•°
  "lastUpdated": "2026-02-13 13:10:00"  // æœ€åæ›´æ–°æ—¶é—´
}</pre>
                    <p style="margin: 2px 0;"><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">data/okx_auto_strategy/account_main_history.jsonl</code></p>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
{"enabled": true, "triggerPrice": 68000.0, "strategyType": "bottom_performers", "lastExecutedTime": null, "executedCount": 0, "timestamp": "2026-02-13T13:00:00"}
{"enabled": false, "triggerPrice": 68000.0, "strategyType": "bottom_performers", "lastExecutedTime": "2026-02-13 13:15:22", "executedCount": 1, "executedCoins": ["SOL", "XRP", "TAO", "LDO", "CFX", "CRV", "UNI", "CRO"], "timestamp": "2026-02-13T13:15:22"}</pre>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600;">3.2 æ­¢ç›ˆæ­¢æŸè®¾ç½®</p>
                    <p style="margin: 2px 0;"><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">data/okx_tpsl_settings/account_main.json</code></p>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
{
  "takeProfitEnabled": true,       // æ­¢ç›ˆæ˜¯å¦å¯ç”¨
  "takeProfitThreshold": 100.0,    // æ­¢ç›ˆé˜ˆå€¼ï¼ˆUSDTï¼‰
  "stopLossEnabled": true,          // æ­¢æŸæ˜¯å¦å¯ç”¨
  "stopLossThreshold": -50.0,      // æ­¢æŸé˜ˆå€¼ï¼ˆUSDTï¼‰
  "lastUpdated": "2026-02-13 02:06:19"  // æœ€åæ›´æ–°æ—¶é—´
}</pre>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600;">3.3 äº¤æ˜“æ—¥å¿—</p>
                    <p style="margin: 2px 0;"><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">data/okx_trading_logs/trading_log_20260213.jsonl</code></p>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
{"timestamp": "2026-02-13T02:30:15", "account": "account_main", "action": "å¼€ä»“", "symbol": "BTC-USDT-SWAP", "side": "buy", "size": 10, "price": 64800, "lever": "10x", "orderId": "123456789"}</pre>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600;">3.4 å¸ç§æ¶¨è·Œå¹…è¿½è¸ª</p>
                    <p style="margin: 2px 0;"><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">data/coin_change_tracker/coin_change_20260213.jsonl</code></p>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
{"date": "20260213", "baseline_time": "2026-02-13 00:00:00", "total_change": -32.90, "changes": {"BTC": -2.48, "ETH": -1.85, ...}, "timestamp": "2026-02-13T02:41:35"}</pre>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600;">3.5 SARæŠ€æœ¯æŒ‡æ ‡</p>
                    <p style="margin: 2px 0;"><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">data/sar_jsonl/BTC.jsonl</code></p>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
{"time": "2026-02-13T02:00:00", "close": 66550, "sar": 65200, "signal": "åšå¤š", "bias": 2.07}</pre>
                </div>
                
                <!-- 4. APIæ¥å£ -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #f59e0b;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ”Œ å››ã€APIæ¥å£åˆ—è¡¨</h4>
                    <table style="width: 100%; font-size: 10px; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">æ¥å£è·¯å¾„</th>
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">æ–¹æ³•</th>
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">åŠŸèƒ½</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-accounts/list-with-credentials</td><td style="padding: 4px; border: 1px solid #cbd5e1;">GET</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–è´¦æˆ·åˆ—è¡¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/market-tickers</td><td style="padding: 4px; border: 1px solid #cbd5e1;">GET</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–å¸‚åœºè¡Œæƒ…</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/account-balance</td><td style="padding: 4px; border: 1px solid #cbd5e1;">POST</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–è´¦æˆ·ä½™é¢</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/account-info</td><td style="padding: 4px; border: 1px solid #cbd5e1;">POST</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–è´¦æˆ·è¯¦æƒ…</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/positions</td><td style="padding: 4px; border: 1px solid #cbd5e1;">POST</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–æŒä»“ä¿¡æ¯</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/place-order</td><td style="padding: 4px; border: 1px solid #cbd5e1;">POST</td><td style="padding: 4px; border: 1px solid #cbd5e1;">æ‰§è¡Œä¸‹å•</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/logs</td><td style="padding: 4px; border: 1px solid #cbd5e1;">GET</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–äº¤æ˜“æ—¥å¿—</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/auto-strategy/&lt;account_id&gt;</td><td style="padding: 4px; border: 1px solid #cbd5e1;">GET/POST</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è‡ªåŠ¨ç­–ç•¥è®¾ç½®</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/okx-trading/tpsl-settings/&lt;account_id&gt;</td><td style="padding: 4px; border: 1px solid #cbd5e1;">GET/POST</td><td style="padding: 4px; border: 1px solid #cbd5e1;">æ­¢ç›ˆæ­¢æŸè®¾ç½®</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">/api/coin-change-tracker/latest</td><td style="padding: 4px; border: 1px solid #cbd5e1;">GET</td><td style="padding: 4px; border: 1px solid #cbd5e1;">è·å–æ¶¨è·Œå¹…æ•°æ®</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 5. PM2è¿›ç¨‹ -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #10b981;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸš€ äº”ã€PM2è¿›ç¨‹åˆ—è¡¨</h4>
                    <table style="width: 100%; font-size: 10px; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">è¿›ç¨‹å</th>
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">è„šæœ¬è·¯å¾„</th>
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">åŠŸèƒ½è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">flask-app</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/app.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">ä¸»FlaskæœåŠ¡ï¼ˆç«¯å£5000ï¼‰</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">coin-change-tracker</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/coin_change_collector.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">å¸ç§æ¶¨è·Œå¹…è¿½è¸ªé‡‡é›†å™¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">okx-trade-history</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/okx_trade_history.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">OKXäº¤æ˜“å†å²é‡‡é›†å™¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">okx-trading-marks</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/okx_trading_marks.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">OKXäº¤æ˜“æ ‡è®°é‡‡é›†å™¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">panic-collector</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/panic_index_collector.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">ææ…ŒæŒ‡æ•°é‡‡é›†å™¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">price-position-collector</td><td style="padding: 4px; border: 1px solid #cbd5e1;">price_position_v2/...py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">ä»·æ ¼ä½ç½®é¢„è­¦é‡‡é›†å™¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">sar-bias-stats-collector</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/sar_bias_stats.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">SARåç¦»ç»Ÿè®¡é‡‡é›†å™¨</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">sar-jsonl-collector</td><td style="padding: 4px; border: 1px solid #cbd5e1;">code/python/sar_jsonl_collector.py</td><td style="padding: 4px; border: 1px solid #cbd5e1;">SARæŠ€æœ¯æŒ‡æ ‡é‡‡é›†å™¨</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 6. Pythonä¾èµ–åŒ… -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #ef4444;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ å…­ã€Pythonä¾èµ–åŒ…</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 10px;">
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">Flask</code> - Webæ¡†æ¶</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">requests</code> - HTTPè¯·æ±‚</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">pandas</code> - æ•°æ®å¤„ç†</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">numpy</code> - æ•°å€¼è®¡ç®—</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">ccxt</code> - äº¤æ˜“æ‰€API</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">hmac</code> - APIç­¾å</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">base64</code> - ç¼–ç è§£ç </div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">datetime</code> - æ—¶é—´å¤„ç†</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">json</code> - JSONå¤„ç†</div>
                        <div><code style="background: #f1f5f9; padding: 2px 4px; border-radius: 3px;">sqlite3</code> - æ•°æ®åº“</div>
                    </div>
                </div>
                
                <!-- 7. æ•°æ®ç›®å½•ç»“æ„ -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #a855f7;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ“ ä¸ƒã€æ•°æ®ç›®å½•ç»“æ„</h4>
                    <pre style="background: #1e293b; color: #e2e8f0; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 10px; margin: 4px 0;">
data/
â”œâ”€â”€ okx_auto_strategy/           # è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®
â”‚   â”œâ”€â”€ account_main.json
â”‚   â”œâ”€â”€ account_main_history.jsonl
â”‚   â””â”€â”€ ...
â”œâ”€â”€ okx_tpsl_settings/           # æ­¢ç›ˆæ­¢æŸè®¾ç½®
â”‚   â”œâ”€â”€ account_main.json
â”‚   â””â”€â”€ account_main_history.jsonl
â”œâ”€â”€ okx_trading_logs/            # äº¤æ˜“æ—¥å¿—
â”‚   â””â”€â”€ trading_log_20260213.jsonl
â”œâ”€â”€ coin_change_tracker/         # å¸ç§æ¶¨è·Œå¹…è¿½è¸ª
â”‚   â””â”€â”€ coin_change_20260213.jsonl
â”œâ”€â”€ sar_jsonl/                   # SARæŠ€æœ¯æŒ‡æ ‡
â”‚   â”œâ”€â”€ BTC.jsonl
â”‚   â”œâ”€â”€ ETH.jsonl
â”‚   â””â”€â”€ ...
â”œâ”€â”€ panic_jsonl/                 # ææ…ŒæŒ‡æ•°
â”‚   â””â”€â”€ panic_wash_index.jsonl
â””â”€â”€ price_position_v2/           # ä»·æ ¼ä½ç½®é¢„è­¦
    â””â”€â”€ config/data/db/price_position.db</pre>
                </div>
                
                <!-- 8. ç¯å¢ƒå˜é‡ -->
                <div style="background: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #ec4899;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ” å…«ã€ç¯å¢ƒå˜é‡ä¸é…ç½®</h4>
                    <table style="width: 100%; font-size: 10px; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f1f5f9;">
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">é…ç½®é¡¹</th>
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">è¯´æ˜</th>
                                <th style="padding: 4px; text-align: left; border: 1px solid #cbd5e1;">é»˜è®¤å€¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">FLASK_PORT</td><td style="padding: 4px; border: 1px solid #cbd5e1;">FlaskæœåŠ¡ç«¯å£</td><td style="padding: 4px; border: 1px solid #cbd5e1;">5000</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">OKX_API_KEY</td><td style="padding: 4px; border: 1px solid #cbd5e1;">OKX APIå¯†é’¥</td><td style="padding: 4px; border: 1px solid #cbd5e1;">ä»okx_accounts.jsonè¯»å–</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">OKX_API_SECRET</td><td style="padding: 4px; border: 1px solid #cbd5e1;">OKX APIå¯†é’¥å¯†ç </td><td style="padding: 4px; border: 1px solid #cbd5e1;">ä»okx_accounts.jsonè¯»å–</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">OKX_PASSPHRASE</td><td style="padding: 4px; border: 1px solid #cbd5e1;">OKX APIå£ä»¤</td><td style="padding: 4px; border: 1px solid #cbd5e1;">ä»okx_accounts.jsonè¯»å–</td></tr>
                            <tr><td style="padding: 4px; border: 1px solid #cbd5e1;">DATA_DIR</td><td style="padding: 4px; border: 1px solid #cbd5e1;">æ•°æ®å­˜å‚¨ç›®å½•</td><td style="padding: 4px; border: 1px solid #cbd5e1;">/home/user/webapp/data</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 9. åŠŸèƒ½ç‰¹æ€§ -->
                <div style="background: white; padding: 10px; border-radius: 6px; border-left: 4px solid #14b8a6;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">âœ¨ ä¹ã€æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</h4>
                    <ul style="margin: 4px 0 0 20px; padding: 0; font-size: 10px;">
                        <li><strong>å¤šè´¦æˆ·ç®¡ç†ï¼š</strong>æ”¯æŒ4ä¸ªç‹¬ç«‹è´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·ç‹¬ç«‹é…ç½®ç­–ç•¥å’Œæ­¢ç›ˆæ­¢æŸ</li>
                        <li><strong>å®æ—¶è¡Œæƒ…ï¼š</strong>27ä¸ªUSDT-SWAPäº¤æ˜“å¯¹ï¼Œ10ç§’åˆ·æ–°ä¸€æ¬¡</li>
                        <li><strong>æ¶¨å¹…å8åç­–ç•¥ï¼š</strong>BTCä»·æ ¼è§¦å‘ï¼Œå¯¹å¸¸ç”¨å¸(15ä¸ª)ä¸­æ¶¨å¹…å8åå¼€å¤šå•ï¼Œæ¯å¸1.5% Ã— 10å€æ æ†</li>
                        <li><strong>æ­¢ç›ˆæ­¢æŸï¼š</strong>åŸºäºè´¦æˆ·æ€»æœªå®ç°ç›ˆäºï¼Œæ”¯æŒUSDTé˜ˆå€¼è®¾ç½®</li>
                        <li><strong>æŒä»“è·Ÿè¸ªï¼š</strong>å®æ—¶æ˜¾ç¤ºæŒä»“ã€å§”æ‰˜è®¢å•ã€æµ®åŠ¨ç›ˆäº</li>
                        <li><strong>äº¤æ˜“æ—¥å¿—ï¼š</strong>å®Œæ•´è®°å½•æ¯ç¬”äº¤æ˜“ï¼Œæ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢</li>
                        <li><strong>æ¶¨è·Œå¹…ç»Ÿè®¡ï¼š</strong>27å¸ç§æ¶¨è·Œå¹…ä¹‹å’Œï¼Œä¸Šæ¶¨å æ¯”å®æ—¶è®¡ç®—</li>
                        <li><strong>æŠ€æœ¯æŒ‡æ ‡ï¼š</strong>SARæŠ›ç‰©çº¿ã€Biasåç¦»åº¦ã€24h/2hé€ƒé¡¶ä¿¡å·</li>
                        <li><strong>ææ…ŒæŒ‡æ•°ï¼š</strong>å¸‚åœºæƒ…ç»ªæŒ‡æ ‡ï¼Œæ´—ç›˜æŒ‡æ•°ç›‘æ§</li>
                        <li><strong>ä»·æ ¼é¢„è­¦ï¼š</strong>ä»·æ ¼ä½ç½®é¢„è­¦ç³»ç»Ÿï¼Œæ”¯æŒå¤šå¸ç§ç›‘æ§</li>
                        <li><strong>æ•°æ®æŒä¹…åŒ–ï¼š</strong>æ‰€æœ‰è®¾ç½®å’Œå†å²è®°å½•ä¿å­˜åˆ°JSONLæ–‡ä»¶</li>
                        <li><strong>è·¨è®¾å¤‡åŒæ­¥ï¼š</strong>æœåŠ¡å™¨ç«¯å­˜å‚¨ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®</li>
                    </ul>
                </div>
                
                <!-- 10. é˜²é‡å¤ä¸‹å•æœºåˆ¶è¯´æ˜ -->
                <div style="background: white; padding: 10px; border-radius: 6px; border-left: 4px solid #fbbf24;">
                    <h4 style="margin: 0 0 8px 0; color: #0369a1; font-size: 12px;">ğŸ›¡ï¸ åã€é˜²é‡å¤ä¸‹å•æœºåˆ¶ï¼ˆä¸‰å±‚é˜²æŠ¤ï¼‰</h4>
                    <p style="margin: 4px 0;"><strong>ç³»ç»Ÿé‡‡ç”¨ä¸‰å±‚é˜²æŠ¤æœºåˆ¶ï¼Œç¡®ä¿å³ä½¿å¤šè®¾å¤‡/å¤šæµè§ˆå™¨åŒæ—¶è®¿é—®ï¼Œä¹Ÿåªæ‰§è¡Œä¸€æ¬¡å¼€å•æ“ä½œã€‚</strong></p>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600; font-size: 10px;">10.1 ç¬¬ä¸€å±‚ï¼šJSONLæ–‡ä»¶é”ï¼ˆæ•°æ®å±‚ï¼‰- æœ€å¯é çš„é˜²æŠ¤</p>
                    <ul style="margin: 4px 0 0 20px; padding: 0; font-size: 10px;">
                        <li>æ¯ä¸ªè´¦å·ç‹¬ç«‹çš„æ‰§è¡Œè®¸å¯æ–‡ä»¶ï¼š<code style="background: #f1f5f9; padding: 2px 4px;">data/okx_auto_strategy/{account_id}_execution.jsonl</code></li>
                        <li>è®°å½•æ ¼å¼ï¼š<code>{"allowed": true/false, "reason": "...", "timestamp": "...", "trigger_price": 68000, "strategy_type": "bottom_performers"}</code></li>
                        <li>æ‰§è¡Œå‰é€šè¿‡APIæ£€æŸ¥æ–‡ä»¶æœ€åä¸€æ¡è®°å½•çš„ <code>allowed</code> çŠ¶æ€</li>
                        <li>æ‰§è¡Œåç«‹å³é€šè¿‡APIå†™å…¥ <code>allowed: false</code>ï¼Œé˜»æ­¢é‡å¤è§¦å‘</li>
                        <li><strong>âœ… è·¨è®¾å¤‡ã€è·¨æµè§ˆå™¨ã€è·¨ä¼šè¯æœ‰æ•ˆ - è¿™æ˜¯å”¯ä¸€çœŸç›¸æº</strong></li>
                    </ul>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600; font-size: 10px;">10.2 ç¬¬äºŒå±‚ï¼šå†·å´æœŸï¼ˆæ—¶é—´å±‚ï¼‰</p>
                    <ul style="margin: 4px 0 0 20px; padding: 0; font-size: 10px;">
                        <li>5åˆ†é’Ÿå¼ºåˆ¶å†·å´æœŸï¼Œé˜²æ­¢çŸ­æ—¶é—´å†…é‡å¤æ‰§è¡Œ</li>
                        <li>æ£€æŸ¥ <code>lastExecutedTime</code>ï¼Œè·ç¦»ä¸Šæ¬¡æ‰§è¡Œä¸è¶³5åˆ†é’Ÿåˆ™æ‹’ç»</li>
                    </ul>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600; font-size: 10px;">10.3 ç¬¬ä¸‰å±‚ï¼šæ‰§è¡Œé”ï¼ˆè¿›ç¨‹å±‚ï¼‰</p>
                    <ul style="margin: 4px 0 0 20px; padding: 0; font-size: 10px;">
                        <li>å…¨å±€å˜é‡ <code>strategyExecuting</code> æ ‡è®°æ‰§è¡Œä¸­çŠ¶æ€</li>
                        <li>åŒä¸€æµè§ˆå™¨é¡µé¢å†…é˜²æ­¢å¹¶å‘æ‰§è¡Œ</li>
                    </ul>
                    
                    <p style="margin: 8px 0 4px 0; font-weight: 600; font-size: 10px;">10.4 å·¥ä½œæµç¨‹</p>
                    <ol style="margin: 4px 0 0 20px; padding: 0; font-size: 10px;">
                        <li>ç”¨æˆ·å¼€å¯å¼€å…³ â†’ <code>POST /api/okx-trading/set-allowed/{account_id}</code> å†™å…¥ <code>allowed: true</code></li>
                        <li>è§¦å‘æ¡ä»¶æ»¡è¶³ â†’ <code>GET /api/okx-trading/check-allowed/{account_id}</code> æ£€æŸ¥JSONL</li>
                        <li>æ£€æŸ¥å†·å´æœŸï¼ˆ5åˆ†é’Ÿï¼‰</li>
                        <li>è®¾ç½®å‰ç«¯æ‰§è¡Œé”</li>
                        <li>æ‰§è¡Œä¸‹å•æ“ä½œ</li>
                        <li>ä¸‹å•æˆåŠŸ â†’ <code>POST /api/okx-trading/set-allowed/{account_id}</code> å†™å…¥ <code>allowed: false</code></li>
                        <li>é‡Šæ”¾å‰ç«¯æ‰§è¡Œé”</li>
                    </ol>
                    
                    <p style="margin: 8px 0 4px 0; padding: 8px; background: #fef3c7; border-radius: 4px; font-size: 10px;"><strong>âš ï¸ é‡è¦ï¼š</strong>å³ä½¿å¤šä¸ªæµè§ˆå™¨/è®¾å¤‡åŒæ—¶æ‰“å¼€ï¼ŒJSONLæ–‡ä»¶é”ç¡®ä¿åªæœ‰ç¬¬ä¸€ä¸ªè§¦å‘çš„è¯·æ±‚èƒ½å¤Ÿæ‰§è¡Œã€‚è¿™æ˜¯æœ€å¯é çš„é˜²æŠ¤å±‚ã€‚</p>
                </div>
            </div>
        </div>

        <!-- è´¦æˆ·åˆ‡æ¢ -->
        <div class="account-switcher">
            <div class="account-switcher-label">
                ğŸ‘¤ é€‰æ‹©è´¦æˆ·
            </div>
            <div class="account-tabs" id="accountTabs">
                <!-- è´¦æˆ·æ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
            <div class="account-info">
                <span class="account-balance">
                    è´¦æˆ·ä½™é¢: <strong id="accountBalance">0.00 USDT</strong>
                </span>
                <button class="btn-manage-accounts" onclick="openAccountModal()">
                    âš™ï¸ ç®¡ç†è´¦æˆ·
                </button>
                <button class="btn-close-all-positions" onclick="closeAllAccountsPositions()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; margin-left: 15px; box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 16px rgba(239, 68, 68, 0.4)'">
                    ğŸš¨ ä¸€é”®å…¨å¹³
                </button>
            </div>
        </div>

        <!-- ä¸»è¦å¸ƒå±€ -->
        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šäº¤æ˜“å¯¹åˆ—è¡¨ -->
            <div class="symbols-panel">
                <!-- å½“å‰è´¦æˆ·æ˜¾ç¤ºï¼ˆè¿·ä½ ç‰ˆï¼‰-->
                <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; font-size: 13px;" onclick="scrollToAccountSwitcher()">
                    <div style="font-weight: 600; margin-bottom: 4px;">
                        ğŸ‘¤ <span id="currentAccountName">ä¸»è´¦æˆ·</span>
                    </div>
                    <div style="font-size: 11px; opacity: 0.9;">
                        ä½™é¢: <span id="sidebarAccountBalance">0.00 USDT</span>
                    </div>
                    <div style="font-size: 10px; opacity: 0.7; margin-top: 4px;">
                        ç‚¹å‡»æŸ¥çœ‹è´¦æˆ·åˆ‡æ¢
                    </div>
                </div>
                <h3>ğŸ’° äº¤æ˜“å¯¹åˆ—è¡¨ (27)</h3>
                <input type="text" class="symbol-search" placeholder="æœç´¢äº¤æ˜“å¯¹..." id="symbolSearch">
                <div id="symbolsList">
                    <!-- äº¤æ˜“å¯¹åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- ä¸­é—´ï¼šäº¤æ˜“é¢æ¿ -->
            <div class="trading-panel">
                <!-- å½“å‰äº¤æ˜“å¯¹ä¿¡æ¯ -->
                <div class="symbol-header">
                    <div class="symbol-info">
                        <div class="current-symbol" id="currentSymbol">BTC-USDT</div>
                        <div class="symbol-subtitle">æ°¸ç»­åˆçº¦</div>
                    </div>
                    <div class="current-price">
                        <div class="price-value" id="currentPrice">95650.00</div>
                        <span class="price-change down" id="priceChange">-0.96%</span>
                    </div>
                </div>

                <!-- äº¤æ˜“æ–¹å‘é€‰æ‹© -->
                <div class="direction-tabs">
                    <div class="direction-tab long active" onclick="selectDirection('long')">
                        â¬† åšå¤š
                    </div>
                    <div class="direction-tab short" onclick="selectDirection('short')">
                        â¬‡ åšç©º
                    </div>
                </div>

                <!-- äº¤æ˜“è¡¨å• -->
                <form class="trading-form" onsubmit="submitOrder(event)">
                    <!-- ä»·æ ¼ç±»å‹ -->
                    <div class="form-group">
                        <label class="form-label">ä»·æ ¼ç±»å‹</label>
                        <select class="form-control" id="priceType">
                            <option value="market">å¸‚ä»·å§”æ‰˜</option>
                            <option value="limit">é™ä»·å§”æ‰˜</option>
                        </select>
                    </div>

                    <!-- æ æ†å€æ•° -->
                    <div class="form-group">
                        <label class="form-label">æ æ†å€æ•°</label>
                        <div class="leverage-buttons">
                            <button type="button" class="leverage-btn" onclick="selectLeverage(3)">3x</button>
                            <button type="button" class="leverage-btn" onclick="selectLeverage(5)">5x</button>
                            <button type="button" class="leverage-btn active" onclick="selectLeverage(10)">10x</button>
                            <button type="button" class="leverage-btn" onclick="selectLeverage(20)">20x</button>
                        </div>
                    </div>

                    <!-- äº¤æ˜“æ•°é‡ -->
                    <div class="form-group">
                        <label class="form-label">å¼€ä»“é‡‘é¢ (USDT)</label>
                        <input type="number" class="form-control" id="orderAmount" placeholder="è¾“å…¥å¼€ä»“é‡‘é¢USDT" step="0.01" required>
                        <div style="margin-top: 8px; font-size: 12px; color: #718096;">
                            å¯ç”¨ä½™é¢: <span id="orderAvailableBalance">224.15 USDT</span>
                        </div>
                        <div style="margin-top: 4px; font-size: 11px; color: #a0aec0;">
                            ğŸ’¡ å®é™…å ç”¨ä¿è¯é‡‘ = å¼€ä»“é‡‘é¢ Ã· æ æ†å€æ•°
                        </div>
                    </div>

                    <!-- å¿«æ·é‡‘é¢ -->
                    <div class="form-group">
                        <div class="amount-presets">
                            <button type="button" class="preset-btn" onclick="setAmount(5)">5%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(10)">10%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(20)">20%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(25)">25%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(33)">33%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(50)">50%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(100)">100%</button>
                        </div>
                    </div>

                    <!-- æäº¤æŒ‰é’® -->
                    <button type="submit" class="submit-order long" id="submitBtn">
                        â¬† åšå¤š
                    </button>
                </form>

                <!-- æ‰¹é‡å¼€ä»“åŠŸèƒ½åŒº - æ¶¨å¹…å‰6åç­–ç•¥ -->
                <div class="batch-trading-section" style="margin-top: 24px; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); max-width: 700px;">
                    <h3 style="color: white; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <span style="font-size: 18px;">âš¡</span>
                        æ¶¨å¹…å‰6åç­–ç•¥
                        <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: auto;">å¸¸è§„ç­–ç•¥</span>
                    </h3>
                    
                    <!-- ç©ºå•ç­–ç•¥è¡Œ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 3)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ A</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 5)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ B</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 8)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ C</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <!-- å¤šå•ç­–ç•¥è¡Œ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 3)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ A</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 5)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ B</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 8)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ C</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>ç­–ç•¥è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ ä»â­<strong>å¸¸ç”¨å¸</strong>ä¸­é€‰æ‹©<strong>æ¶¨å¹…å‰6å</strong><br>
                            â€¢ æ¯ä¸ªå¸ç§å¹³å‡åˆ†é…å¼€ä»“é‡‘é¢<br>
                            â€¢ ç»Ÿä¸€ä½¿ç”¨10å€æ æ†ã€å¸‚ä»·å•<br>
                            â€¢ ç©ºå•ç­–ç•¥ï¼šåšç©ºæ¶¨å¹…é«˜çš„å¸ç§<br>
                            â€¢ å¤šå•ç­–ç•¥ï¼šåšå¤šæ¶¨å¹…é«˜çš„å¸ç§<br>
                            â€¢ <span style="color: #fbbf24;">âš ï¸ è¯·å…ˆæ”¶è—è‡³å°‘6ä¸ªå¸¸ç”¨å¸</span>
                        </div>
                    </div>
                </div>

                <!-- æ‰¹é‡å¼€ä»“åŠŸèƒ½åŒº - æ¶¨å¹…å6åç­–ç•¥ (é«˜é£é™©) -->
                <div class="batch-trading-section" style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4); max-width: 700px; border: 3px solid #fbbf24;">
                    <h3 style="color: white; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <span style="font-size: 18px;">âš ï¸</span>
                        æ¶¨å¹…å6åç­–ç•¥
                        <span style="background: rgba(251,191,36,0.9); padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: auto; color: #78350f; font-weight: bold;">âš ï¸ é«˜é£é™©åŒºåŸŸ</span>
                    </h3>
                    
                    <!-- è­¦å‘Šæç¤º -->
                    <div style="margin-bottom: 12px; padding: 10px; background: rgba(251,191,36,0.15); border: 2px solid rgba(251,191,36,0.5); border-radius: 6px; color: #fbbf24; font-size: 12px; font-weight: bold;">
                        âš ï¸ æ³¨æ„ï¼šæ­¤åŒºåŸŸé’ˆå¯¹è·Œå¹…æœ€å¤§çš„å¸ç§ï¼Œæ³¢åŠ¨æ€§æé«˜ï¼Œè¯·è°¨æ…æ“ä½œï¼
                    </div>
                    
                    <!-- å¤šå•ç­–ç•¥è¡Œ (é¢„æœŸåå¼¹) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 3, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ D</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 5, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ E</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 8, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ F</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <!-- ç©ºå•ç­–ç•¥è¡Œ (è¶‹åŠ¿å»¶ç»­) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 3, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ D</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 5, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ E</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 8, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ F</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>ç­–ç•¥è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ ä»â­<strong>å¸¸ç”¨å¸</strong>ä¸­é€‰æ‹©<strong>æ¶¨å¹…å6å</strong>ï¼ˆè·Œå¹…æœ€å¤§ï¼‰<br>
                            â€¢ <strong style="color: #fbbf24;">å¤šå•ç­–ç•¥ï¼š</strong>é¢„æœŸè¶…è·Œåå¼¹ï¼Œå¼€å¤šå•ç­‰å¾…å›å‡<br>
                            â€¢ <strong style="color: #fbbf24;">ç©ºå•ç­–ç•¥ï¼š</strong>é¢„æœŸè¶‹åŠ¿å»¶ç»­ï¼Œåšç©ºç»§ç»­ä¸‹è·Œ<br>
                            â€¢ ç»Ÿä¸€ä½¿ç”¨10å€æ æ†ã€å¸‚ä»·å•<br>
                            â€¢ <span style="color: #fef3c7;">âš ï¸ è·Œå¹…å¤§çš„å¸ç§æ³¢åŠ¨æé«˜ï¼Œé£é™©æå¤§ï¼</span>
                        </div>
                    </div>
                </div>

                <!-- æ‰¹é‡å¼€ä»“åŠŸèƒ½åŒº - æ¶¨å¹…å‰8/å8åç­–ç•¥ -->
                <div class="batch-trading-section" style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4); max-width: 1450px;">
                    <h3 style="color: white; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <span style="font-size: 18px;">ğŸ¯</span>
                        æ¶¨å¹…å‰8/å8åç­–ç•¥
                        <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: auto;">æ‰©å±•ç­–ç•¥</span>
                    </h3>
                    
                    <!-- æ¶¨å¹…å‰8åç­–ç•¥åŒºåŸŸ -->
                    <div style="margin-bottom: 16px; padding: 12px; background: rgba(102,126,234,0.2); border-radius: 8px; border: 2px solid rgba(102,126,234,0.4);">
                        <h4 style="color: white; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                            âš¡ æ¶¨å¹…å‰8åç­–ç•¥
                        </h4>
                        
                        <!-- å¤šå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 8px;">
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 1.5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 3)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 8)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                        
                        <!-- ç©ºå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 1.5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 3)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 8)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æ¶¨å¹…å8åç­–ç•¥åŒºåŸŸ -->
                    <div style="padding: 12px; background: rgba(220,38,38,0.2); border-radius: 8px; border: 2px solid rgba(220,38,38,0.4);">
                        <h4 style="color: white; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                            âš ï¸ æ¶¨å¹…å8åç­–ç•¥ <span style="color: #fbbf24; font-size: 11px; margin-left: auto;">(é«˜é£é™©)</span>
                        </h4>
                        
                        <!-- å¤šå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 8px;">
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 1.5)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 3)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 5)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 8)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                        
                        <!-- ç©ºå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 1.5)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 3)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 5)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 8)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>ç­–ç•¥è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ ä»â­<strong>å¸¸ç”¨å¸</strong>ä¸­é€‰æ‹©<strong>æ¶¨å¹…å‰8å</strong>æˆ–<strong>æ¶¨å¹…å8å</strong><br>
                            â€¢ æ¯ä¸ªå¸ç§å¹³å‡åˆ†é…å¼€ä»“é‡‘é¢ï¼Œç»Ÿä¸€ä½¿ç”¨10å€æ æ†<br>
                            â€¢ <strong>æ¶¨å¹…å‰8ï¼š</strong>é’ˆå¯¹è¡¨ç°æœ€å¼ºçš„å¸ç§<br>
                            â€¢ <strong>æ¶¨å¹…å8ï¼š</strong>é’ˆå¯¹è·Œå¹…æœ€å¤§çš„å¸ç§ï¼ˆé«˜é£é™©ï¼‰<br>
                            â€¢ <span style="color: #fbbf24;">âš ï¸ è¯·å…ˆæ”¶è—è‡³å°‘8ä¸ªå¸¸ç”¨å¸</span>
                        </div>
                    </div>
                </div>

                <!-- 1:1å¯¹å†²é…å¯¹ç­–ç•¥ -->
                <div class="batch-trading-section" style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                    <h3 style="color: white; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">âš–ï¸</span>
                        1:1å¯¹å†²é…å¯¹ç­–ç•¥
                    </h3>
                    
                    <div class="batch-strategies" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <!-- ç©ºå•é…å¤šå• -->
                        <button type="button" class="batch-btn" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #78350f;" onclick="hedgePositions('short')">
                            <div class="batch-btn-title">âš–ï¸ ç©ºå•é…å¤šå•</div>
                            <div class="batch-btn-desc">æŒä»“ç©ºå• 1:1 é…å¯¹å¤šå•</div>
                        </button>
                        
                        <!-- å¤šå•é…ç©ºå• -->
                        <button type="button" class="batch-btn" style="background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%); color: #7c2d12;" onclick="hedgePositions('long')">
                            <div class="batch-btn-title">âš–ï¸ å¤šå•é…ç©ºå•</div>
                            <div class="batch-btn-desc">æŒä»“å¤šå• 1:1 é…å¯¹ç©ºå•</div>
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>å¯¹å†²è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ <strong>ç©ºå•é…å¤šå•ï¼š</strong>æ ¹æ®ç°æœ‰ç©ºå•æŒä»“ï¼Œå¼€ç­‰é¢å¤šå•å¯¹å†²<br>
                            â€¢ <strong>å¤šå•é…ç©ºå•ï¼š</strong>æ ¹æ®ç°æœ‰å¤šå•æŒä»“ï¼Œå¼€ç­‰é¢ç©ºå•å¯¹å†²<br>
                            â€¢ è‡ªåŠ¨è®¡ç®—æ¯ä¸ªå¸ç§çš„æŒä»“é‡‘é¢<br>
                            â€¢ å¯¹å†²åé”å®šç›ˆäºï¼Œé™ä½é£é™©<br>
                            â€¢ ç¤ºä¾‹ï¼š6ä¸ªç©ºå•å„7U â†’ å¼€6ä¸ªå¤šå•å„7U<br>
                            â€¢ <span style="color: #fef3c7;">âš ï¸ éœ€è¦æœ‰å¯¹åº”æ–¹å‘çš„æŒä»“</span>
                        </div>
                    </div>
                </div>

                <!-- é£é™©æç¤º -->
                <div class="risk-warning">
                    <h4>âš ï¸ é£é™©æç¤º</h4>
                    <ul>
                        <li>åˆçº¦äº¤æ˜“å­˜åœ¨é«˜é£é™©ï¼Œè¯·è°¨æ…æ“ä½œ</li>
                        <li>æ æ†ä¼šæ”¾å¤§æ”¶ç›Šï¼Œä¹Ÿä¼šæ”¾å¤§äºæŸ</li>
                        <li>å»ºè®®è®¾ç½®æ­¢æŸï¼Œæ§åˆ¶é£é™©</li>
                    </ul>
                </div>
            </div>

            <!-- å³ä¾§ï¼šè´¦æˆ·ä¿¡æ¯ -->
            <div class="account-panel">
                <!-- APIé…ç½®æç¤º -->
                <div id="apiConfigNotice" style="display: none; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">âš ï¸</span>
                        <strong style="color: #92400e;">éœ€è¦é…ç½®APIå‡­è¯</strong>
                    </div>
                    <p style="margin: 0 0 8px 28px; color: #78350f; font-size: 13px;">
                        å½“å‰è´¦æˆ·æœªé…ç½®OKX APIå‡­è¯ï¼Œæ— æ³•æŸ¥è¯¢è´¦æˆ·ä½™é¢å’ŒæŒä»“ä¿¡æ¯ã€‚
                    </p>
                    <p style="margin: 0 0 0 28px; color: #78350f; font-size: 13px;">
                        è¯·ç‚¹å‡»è´¦æˆ·æ ‡ç­¾ä¸Šçš„"ç¼–è¾‘"æŒ‰é’®ï¼Œå¡«å…¥æ‚¨çš„API Keyã€API Secretå’ŒPassphraseã€‚
                    </p>
                </div>
                
                <!-- è´¦æˆ·æ€»è§ˆ -->
                <div class="info-card">
                    <h3>ğŸ’° è´¦æˆ·ä¿¡æ¯ <button onclick="refreshAccountData()" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">ğŸ”„</button></h3>
                    <div class="info-row">
                        <span class="info-label">æ€»æƒç›Š</span>
                        <span class="info-value" style="color: #10b981;" id="totalEquity">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å¯ç”¨ä½™é¢</span>
                        <span class="info-value" id="availableBalance">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æŒä»“ä¿è¯é‡‘</span>
                        <span class="info-value" id="usedMargin">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æœªå®ç°ç›ˆäº</span>
                        <span class="info-value" id="unrealizedPnl">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å†»ç»“ä½™é¢</span>
                        <span class="info-value" id="frozenBalance">-- USDT</span>
                    </div>
                </div>

                <!-- æ­¢ç›ˆæ­¢æŸè®¾ç½® -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #22c55e;">
                    <h3 style="color: #166534; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ¯ æ­¢ç›ˆæ­¢æŸè®¾ç½®
                    </h3>
                    
                    <!-- å½“å‰æœªå®ç°ç›ˆäº -->
                    <div class="info-row" style="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.6); border-radius: 6px; border: 2px dashed #22c55e;">
                        <span class="info-label" style="color: #166534; font-weight: 600;">å½“å‰æœªå®ç°ç›ˆäº</span>
                        <span class="info-value" style="font-weight: bold; font-size: 18px;" id="currentUnrealizedPnl">-- USDT</span>
                    </div>
                    
                    <!-- æœåŠ¡å™¨æ‰§è¡Œçš„é˜ˆå€¼æ˜¾ç¤º -->
                    <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                        <div style="flex: 1; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 6px; border: 1px solid #22c55e;">
                            <div style="font-size: 11px; color: #166534; margin-bottom: 3px;">ğŸ“ˆ æœåŠ¡å™¨æ­¢ç›ˆé˜ˆå€¼</div>
                            <div style="font-size: 14px; font-weight: 700; color: #166534;" id="serverTakeProfitThreshold">+50 USDT</div>
                            <div style="font-size: 10px; color: #166534; margin-top: 2px; opacity: 0.7;" id="takeProfitStatus">æœªå¯ç”¨</div>
                        </div>
                        <div style="flex: 1; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 6px; border: 1px solid #ef4444;">
                            <div style="font-size: 11px; color: #991b1b; margin-bottom: 3px;">ğŸ“‰ æœåŠ¡å™¨æ­¢æŸé˜ˆå€¼</div>
                            <div style="font-size: 14px; font-weight: 700; color: #991b1b;" id="serverStopLossThreshold">-30 USDT</div>
                            <div style="font-size: 10px; color: #991b1b; margin-top: 2px; opacity: 0.7;" id="stopLossStatus">æœªå¯ç”¨</div>
                        </div>
                    </div>
                    
                    <!-- æ­¢ç›ˆè®¾ç½® -->
                    <div style="padding: 10px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid #22c55e; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #166534; font-weight: 600; font-size: 13px;">ğŸ“ˆ æ­¢ç›ˆè­¦æŠ¥</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="takeProfitSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider slider-takeprofit" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="number" id="takeProfitThreshold" value="50" step="1" min="1" 
                                   style="flex: 1; padding: 6px 10px; border: 1px solid #22c55e; border-radius: 6px; font-size: 13px;"
                                   placeholder="æ­¢ç›ˆé‡‘é¢">
                            <span style="color: #166534; font-size: 13px; font-weight: 600;">USDT</span>
                        </div>
                        <div style="font-size: 11px; color: #166534; margin-top: 6px;">
                            æœªå®ç°ç›ˆäºè¾¾åˆ°æ­¤é‡‘é¢æ—¶è§¦å‘è­¦æŠ¥
                        </div>
                    </div>
                    
                    <!-- æ­¢æŸè®¾ç½® -->
                    <div style="padding: 10px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid #ef4444;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #991b1b; font-weight: 600; font-size: 13px;">ğŸ“‰ æ­¢æŸè­¦æŠ¥</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="stopLossSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider slider-stoploss" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="number" id="stopLossThreshold" value="-30" step="1" max="-1" 
                                   style="flex: 1; padding: 6px 10px; border: 1px solid #ef4444; border-radius: 6px; font-size: 13px;"
                                   placeholder="æ­¢æŸé‡‘é¢">
                            <span style="color: #991b1b; font-size: 13px; font-weight: 600;">USDT</span>
                        </div>
                        <div style="font-size: 11px; color: #991b1b; margin-top: 6px;">
                            æœªå®ç°ç›ˆäºè¾¾åˆ°æ­¤è´Ÿå€¼æ—¶è§¦å‘è­¦æŠ¥ï¼ˆè¾“å…¥è´Ÿæ•°ï¼‰
                        </div>
                    </div>
                    
                    <!-- è¯´æ˜ -->
                    <div style="margin-top: 10px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 6px; border-left: 3px solid #22c55e;">
                        <p style="color: #166534; font-size: 11px; margin: 0; line-height: 1.5;">
                            ğŸ’¡ <strong>æç¤ºï¼š</strong>æ­¢ç›ˆæ­¢æŸåŸºäºè´¦æˆ·æ€»çš„æœªå®ç°ç›ˆäºï¼ˆUSDTï¼‰æ¥è®¡ç®—ï¼Œä¸æ˜¯æŒ‰å¸ç§ç™¾åˆ†æ¯”ã€‚æ¯ä¸ªè´¦æˆ·çš„è®¾ç½®ç‹¬ç«‹ä¿å­˜åˆ°æœåŠ¡å™¨JSONLæ–‡ä»¶ï¼Œå¯è·¨è®¾å¤‡ä½¿ç”¨ã€‚è¾¾åˆ°é˜ˆå€¼æ—¶ä¼šå¼¹çª—è­¦æŠ¥å’Œæ’­æ”¾å£°éŸ³ã€‚
                        </p>
                    </div>
                </div>

                <!-- ğŸ“‰ æ¶¨å¹…å8åç­–ç•¥ï¼ˆæŠ„åº•ï¼‰ -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border: 2px solid #8b5cf6;">
                    <h3 style="color: #5b21b6; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ“‰ æ¶¨å¹…å8åç­–ç•¥ï¼ˆæŠ„åº•ï¼‰
                    </h3>
                    
                    <!-- ç­–ç•¥å¼€å…³ -->
                    <div style="padding: 10px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border: 1px solid #8b5cf6; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #5b21b6; font-weight: 600; font-size: 13px;">ğŸš€ å¯ç”¨è‡ªåŠ¨å¼€å•</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="autoTradeSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider slider-autotrade" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;">
                                    <style>
                                        #autoTradeSwitch:checked + .slider-autotrade { background-color: #8b5cf6; }
                                        #autoTradeSwitch:checked + .slider-autotrade:before { transform: translateX(20px); }
                                        .slider-autotrade:before {
                                            position: absolute;
                                            content: "";
                                            height: 18px;
                                            width: 18px;
                                            left: 3px;
                                            bottom: 3px;
                                            background-color: white;
                                            transition: .4s;
                                            border-radius: 50%;
                                        }
                                    </style>
                                </span>
                            </label>
                        </div>
                        
                        <!-- åå°è®¾ç½®æ˜¾ç¤º -->
                        <div id="serverAutoTradeSettings" style="display: none; padding: 8px; background: rgba(139, 92, 246, 0.15); border-radius: 6px; margin-bottom: 8px; border: 1px solid #8b5cf6;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #5b21b6; font-size: 11px; font-weight: 600;">ğŸ“Œ æœåŠ¡å™¨è§¦å‘ä»·æ ¼</span>
                                <span id="serverTriggerPrice" style="color: #7c3aed; font-size: 13px; font-weight: bold;">$68000.00</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #5b21b6; font-size: 11px;">ç­–ç•¥çŠ¶æ€</span>
                                <span id="serverAutoTradeStatusBadge" style="color: #10b981; font-size: 11px; font-weight: 600;">âœ… å·²å¯ç”¨</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="color: #5b21b6; font-size: 11px;">ğŸ“„ JSONLæ‰§è¡Œè®¸å¯</span>
                                <span id="jsonlAllowedStatus" style="color: #6b7280; font-size: 11px; font-weight: 600;">â³ æ£€æŸ¥ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§¦å‘æ¡ä»¶è®¾ç½® -->
                    <div style="padding: 10px; background: rgba(139, 92, 246, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="margin-bottom: 8px;">
                            <label style="color: #5b21b6; font-weight: 600; font-size: 13px; display: block; margin-bottom: 8px;">
                                âš™ï¸ BTCä»·æ ¼è§¦å‘æ¡ä»¶
                            </label>
                            <!-- å½“å‰BTCä»·æ ¼ - é«˜äº®æ˜¾ç¤º -->
                            <div style="padding: 12px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 8px; margin-bottom: 12px; border: 2px solid #3b82f6; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <span style="color: #1e40af; font-size: 12px; font-weight: 600;">ğŸ“Š å½“å‰BTCä»·æ ¼</span>
                                    <span id="currentBtcPrice" style="color: #1e3a8a; font-weight: 800; font-size: 18px; font-family: 'Courier New', monospace; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">--</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                <label style="color: #5b21b6; font-size: 12px; white-space: nowrap;">è§¦å‘ä»·æ ¼ (USD)</label>
                                <input type="number" id="autoTriggerPrice" value="68000" 
                                       style="flex: 1; padding: 8px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 14px; font-weight: 600;"
                                       placeholder="ä¾‹å¦‚: 68000">
                            </div>
                            <!-- éšè—çš„ç­–ç•¥ç±»å‹ï¼ˆJavaScriptéœ€è¦ï¼‰ -->
                            <input type="hidden" id="autoStrategyType" value="bottom_performers">
                        </div>
                    </div>
                    
                    <!-- æ‰§è¡ŒçŠ¶æ€ -->
                    <div style="padding: 10px; background: rgba(139, 92, 246, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                            <span style="color: #5b21b6; font-size: 12px; font-weight: 600;">ç­–ç•¥çŠ¶æ€</span>
                            <span id="autoTradeStatus" style="color: #6b7280; font-size: 12px; font-weight: 600;">æœªå¯ç”¨</span>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="color: #5b21b6; font-size: 12px;">ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´</span>
                            <span id="autoTradeLastTime" style="color: #6b7280; font-size: 11px;">--</span>
                        </div>
                    </div>
                    
                    <div style="padding: 8px; background: rgba(139, 92, 246, 0.05); border-radius: 6px; margin-top: 8px; text-align: center;">
                        <span style="color: #5b21b6; font-size: 10px;">ğŸ“š è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹é¡µé¢é¡¶éƒ¨"ç³»ç»Ÿæ¶æ„ä¸è¿è¡Œè¯´æ˜"</span>
                    </div>
                    
                </div>

                <!-- ğŸ“ˆ æ¶¨å¹…å‰8åç­–ç•¥ï¼ˆè¿½æ¶¨ï¼‰ -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b;">
                    <h3 style="color: #92400e; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ“ˆ æ¶¨å¹…å‰8åç­–ç•¥ï¼ˆè¿½æ¶¨ï¼‰
                    </h3>
                    
                    <!-- ç­–ç•¥å¼€å…³ -->
                    <div style="padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border: 1px solid #f59e0b; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #92400e; font-weight: 600; font-size: 13px;">ğŸš€ å¯ç”¨è‡ªåŠ¨å¼€å•</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="autoTradeSwitchTop" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider slider-autotrade-top" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;">
                                    <style>
                                        #autoTradeSwitchTop:checked + .slider-autotrade-top { background-color: #f59e0b; }
                                        #autoTradeSwitchTop:checked + .slider-autotrade-top:before { transform: translateX(20px); }
                                        .slider-autotrade-top:before {
                                            position: absolute;
                                            content: "";
                                            height: 18px;
                                            width: 18px;
                                            left: 3px;
                                            bottom: 3px;
                                            background-color: white;
                                            transition: .4s;
                                            border-radius: 50%;
                                        }
                                    </style>
                                </span>
                            </label>
                        </div>
                        
                        <!-- åå°è®¾ç½®æ˜¾ç¤º -->
                        <div id="serverAutoTradeSettingsTop" style="display: none; padding: 8px; background: rgba(245, 158, 11, 0.15); border-radius: 6px; margin-bottom: 8px; border: 1px solid #f59e0b;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #92400e; font-size: 11px; font-weight: 600;">ğŸ“Œ æœåŠ¡å™¨è§¦å‘ä»·æ ¼</span>
                                <span id="serverTriggerPriceTop" style="color: #b45309; font-size: 13px; font-weight: bold;">$68000.00</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #92400e; font-size: 11px;">ç­–ç•¥çŠ¶æ€</span>
                                <span id="serverAutoTradeStatusBadgeTop" style="color: #10b981; font-size: 11px; font-weight: 600;">âœ… å·²å¯ç”¨</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="color: #92400e; font-size: 11px;">ğŸ“„ JSONLæ‰§è¡Œè®¸å¯</span>
                                <span id="jsonlAllowedStatusTop" style="color: #6b7280; font-size: 11px; font-weight: 600;">â³ æ£€æŸ¥ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§¦å‘æ¡ä»¶è®¾ç½® -->
                    <div style="padding: 10px; background: rgba(245, 158, 11, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="margin-bottom: 8px;">
                            <label style="color: #92400e; font-weight: 600; font-size: 13px; display: block; margin-bottom: 8px;">
                                âš™ï¸ BTCä»·æ ¼è§¦å‘æ¡ä»¶
                            </label>
                            <!-- å½“å‰BTCä»·æ ¼ - é«˜äº®æ˜¾ç¤º -->
                            <div style="padding: 12px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 8px; margin-bottom: 12px; border: 2px solid #3b82f6; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <span style="color: #1e40af; font-size: 12px; font-weight: 600;">ğŸ“Š å½“å‰BTCä»·æ ¼</span>
                                    <span id="currentBtcPriceTop" style="color: #1e3a8a; font-weight: 800; font-size: 18px; font-family: 'Courier New', monospace; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">--</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                <label style="color: #92400e; font-size: 12px; white-space: nowrap;">è§¦å‘ä»·æ ¼ (USD)</label>
                                <input type="number" id="autoTriggerPriceTop" value="68000" 
                                       style="flex: 1; padding: 8px; border: 2px solid #f59e0b; border-radius: 6px; font-size: 14px; font-weight: 600;"
                                       placeholder="ä¾‹å¦‚: 68000">
                            </div>
                            <!-- éšè—çš„ç­–ç•¥ç±»å‹ï¼ˆJavaScriptéœ€è¦ï¼‰ -->
                            <input type="hidden" id="autoStrategyTypeTop" value="top_performers">
                        </div>
                    </div>
                    
                    <!-- æ‰§è¡ŒçŠ¶æ€ -->
                    <div style="padding: 10px; background: rgba(245, 158, 11, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                            <span style="color: #92400e; font-size: 12px; font-weight: 600;">ç­–ç•¥çŠ¶æ€</span>
                            <span id="autoTradeStatusTop" style="color: #6b7280; font-size: 12px; font-weight: 600;">æœªå¯ç”¨</span>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="color: #92400e; font-size: 12px;">ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´</span>
                            <span id="autoTradeLastTimeTop" style="color: #6b7280; font-size: 11px;">--</span>
                        </div>
                    </div>
                    
                    <div style="padding: 8px; background: rgba(245, 158, 11, 0.05); border-radius: 6px; margin-top: 8px; text-align: center;">
                        <span style="color: #92400e; font-size: 10px;">ğŸ“š è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹é¡µé¢é¡¶éƒ¨"ç³»ç»Ÿæ¶æ„ä¸è¿è¡Œè¯´æ˜"</span>
                    </div>
                    
                </div>

                <!-- è´¦æˆ·ä»“ä½é™é¢ -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #fbbf24;">
                    <h3 style="color: #78350f; margin-bottom: 12px;">ğŸ“Š è´¦æˆ·ä»“ä½é™é¢</h3>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">è´¦æˆ·åç§°</span>
                        <span class="info-value" style="color: #78350f; font-weight: bold;" id="accountName">ä¸»è´¦æˆ·</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">å¼€å§‹æ—¥æœŸ</span>
                        <span class="info-value" style="color: #78350f;" id="accountStartDate">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">å·²è¿è¡Œå¤©æ•°</span>
                        <span class="info-value" style="color: #78350f;" id="accountDaysPassed">-- å¤©</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">å½“å‰æœ€å¤§ä»“ä½</span>
                        <span class="info-value" style="color: #059669; font-weight: bold; font-size: 16px;" id="accountMaxLimit">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">ä¸‹æ¬¡å¢åŠ æ—¥æœŸ</span>
                        <span class="info-value" style="color: #78350f;" id="accountNextIncreaseDate">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">è·ç¦»ä¸‹æ¬¡å¢åŠ </span>
                        <span class="info-value" style="color: #78350f;" id="accountDaysUntilIncrease">-- å¤©</span>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(251, 191, 36, 0.2); border-radius: 6px; border-left: 3px solid #fbbf24;">
                        <p style="color: #78350f; font-size: 11px; margin: 0; line-height: 1.5;">
                            ğŸ’¡ <strong>è§„åˆ™è¯´æ˜ï¼š</strong>è´¦æˆ·ä»å¼€å§‹æ—¥æœŸè®¡ç®—ï¼Œåˆå§‹é™é¢300 USDTï¼Œæ¯æ»¡30å¤©è‡ªåŠ¨å¢åŠ 300 USDTä»“ä½ä¸Šé™ã€‚æ­¤é™é¢ä¸ºç¡¬ç¼–ç è§„åˆ™ï¼Œä¸å¯ä¿®æ”¹ã€‚
                        </p>
                    </div>
                </div>

                <!-- æ¶¨è·Œé¢„è­¦è®¾ç½® -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #ef4444;">
                    <h3 style="color: #991b1b; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ”” æ¶¨è·Œé¢„è­¦
                        <button onclick="window.open('/coin-change-tracker', '_blank')" style="margin-left: auto; padding: 4px 10px; font-size: 11px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="æ‰“å¼€è¯¦ç»†é¡µé¢">
                            ğŸ“Š è¯¦æƒ…
                        </button>
                    </h3>
                    
                    <!-- å½“å‰æ¶¨è·Œå¹… -->
                    <div class="info-row" style="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                        <span class="info-label" style="color: #991b1b;">27å¸æ€»æ¶¨è·Œå¹…</span>
                        <span class="info-value" style="font-weight: bold; font-size: 18px;" id="totalChangePercent">--</span>
                    </div>
                    
                    <!-- ä¸Šæ¶¨é¢„è­¦ -->
                    <div style="padding: 10px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid #22c55e; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #166534; font-weight: 600; font-size: 13px;">ğŸ“ˆ ä¸Šæ¶¨é¢„è­¦</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="upperAlertSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="number" id="upperThreshold" value="30" step="0.1" min="0" max="100" 
                                   style="flex: 1; padding: 6px 10px; border: 1px solid #22c55e; border-radius: 6px; font-size: 13px;">
                            <span style="color: #166534; font-size: 13px; font-weight: 600;">%</span>
                        </div>
                        <div style="font-size: 11px; color: #166534; margin-top: 6px;">
                            æ¶¨å¹…è¶…è¿‡æ­¤å€¼æ—¶è§¦å‘
                        </div>
                    </div>
                    
                    <!-- ä¸‹è·Œé¢„è­¦ -->
                    <div style="padding: 10px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid #ef4444; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #991b1b; font-weight: 600; font-size: 13px;">ğŸ“‰ ä¸‹è·Œé¢„è­¦</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="lowerAlertSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="number" id="lowerThreshold" value="-40" step="0.1" max="0" min="-100" 
                                   style="flex: 1; padding: 6px 10px; border: 1px solid #ef4444; border-radius: 6px; font-size: 13px;">
                            <span style="color: #991b1b; font-size: 13px; font-weight: 600;">%</span>
                        </div>
                        <div style="font-size: 11px; color: #991b1b; margin-top: 6px;">
                            è·Œå¹…å°äºæ­¤å€¼æ—¶è§¦å‘
                        </div>
                    </div>
                    
                    <!-- ä¿å­˜æŒ‰é’® -->
                    <button onclick="saveAlertSettingsOKX()" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);">
                        ğŸ’¾ ä¿å­˜é¢„è­¦è®¾ç½®
                    </button>
                    
                    <!-- æç¤º -->
                    <div style="margin-top: 10px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 6px; border-left: 3px solid #ef4444;">
                        <p style="color: #991b1b; font-size: 10px; margin: 0; line-height: 1.4;">
                            ğŸ’¡ è§¦å‘åå°†æ’­æ”¾éŸ³æ•ˆã€æ˜¾ç¤ºå¼¹çª—ï¼Œå¹¶è‡ªåŠ¨å…³é—­å¼€å…³ã€‚éœ€è¦é‡æ–°å¼€å¯æ‰èƒ½å†æ¬¡è§¦å‘ã€‚
                        </p>
                    </div>
                </div>

                <!-- ğŸ“ˆ ä¸Šæ¶¨å æ¯”0ç­–ç•¥Aï¼ˆæ¶¨å¹…å‰8åå¤šå•ï¼‰ -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #3b82f6;">
                    <h3 style="color: #1e40af; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ“ˆ ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8å
                    </h3>
                    
                    <!-- ç­–ç•¥å¼€å…³ -->
                    <div style="padding: 10px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid #3b82f6; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #1e40af; font-weight: 600; font-size: 13px;">ğŸš€ å¯ç”¨è‡ªåŠ¨å¼€å•</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="autoTradeSwitchUpRatio0Top8" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider slider-autotrade-upratio0-top8" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;">
                                    <style>
                                        #autoTradeSwitchUpRatio0Top8:checked + .slider-autotrade-upratio0-top8 { background-color: #3b82f6; }
                                        #autoTradeSwitchUpRatio0Top8:checked + .slider-autotrade-upratio0-top8:before { transform: translateX(20px); }
                                        .slider-autotrade-upratio0-top8:before {
                                            position: absolute;
                                            content: "";
                                            height: 18px;
                                            width: 18px;
                                            left: 3px;
                                            bottom: 3px;
                                            background-color: white;
                                            transition: .4s;
                                            border-radius: 50%;
                                        }
                                    </style>
                                </span>
                            </label>
                        </div>
                        
                        <!-- åå°è®¾ç½®æ˜¾ç¤º -->
                        <div id="serverAutoTradeSettingsUpRatio0Top8" style="display: none; padding: 8px; background: rgba(59, 130, 246, 0.15); border-radius: 6px; margin-bottom: 8px; border: 1px solid #3b82f6;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #1e40af; font-size: 11px; font-weight: 600;">ğŸ“Œ ç­–ç•¥çŠ¶æ€</span>
                                <span id="serverAutoTradeStatusBadgeUpRatio0Top8" style="color: #10b981; font-size: 11px; font-weight: 600;">âœ… å·²å¯ç”¨</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="color: #1e40af; font-size: 11px;">ğŸ“„ æ‰§è¡Œè®¸å¯</span>
                                <span id="jsonlAllowedStatusUpRatio0Top8" style="color: #6b7280; font-size: 11px; font-weight: 600;">â³ æ£€æŸ¥ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§¦å‘æ¡ä»¶ -->
                    <div style="padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="margin-bottom: 8px;">
                            <label style="color: #1e40af; font-weight: 600; font-size: 13px; display: block; margin-bottom: 8px;">
                                âš™ï¸ è§¦å‘æ¡ä»¶
                            </label>
                            <!-- å½“å‰ä¸Šæ¶¨å æ¯” -->
                            <div style="padding: 12px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 8px; margin-bottom: 12px; border: 2px solid #f59e0b; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <span style="color: #92400e; font-size: 12px; font-weight: 600;">ğŸ“Š å½“å‰ä¸Šæ¶¨å æ¯”</span>
                                    <span id="currentUpRatioTop8" style="color: #92400e; font-weight: 800; font-size: 18px; font-family: 'Courier New', monospace; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">--</span>
                                </div>
                            </div>
                            <div style="padding: 10px; background: rgba(251, 191, 36, 0.1); border-radius: 6px; border-left: 3px solid #f59e0b;">
                                <p style="color: #92400e; font-size: 11px; margin: 0; line-height: 1.5;">
                                    ğŸ“Œ <strong>è§¦å‘æ¡ä»¶ï¼š</strong>ä¸Šæ¶¨å æ¯” = 0% ä¸” å½“å‰æ—¶é—´ä¸åœ¨ 0:00-0:30<br>
                                    ğŸ“Œ <strong>å¼€å•ç­–ç•¥ï¼š</strong>ä»å¸¸ç”¨å¸15ä¸ªä¸­å–æ¶¨å¹…å‰8å<br>
                                    ğŸ“Œ <strong>ä»“ä½è®¾ç½®ï¼š</strong>æ¯å¸1.5%å¯ç”¨ä½™é¢ï¼Œ10å€æ æ†ï¼Œå¤šå•<br>
                                    ğŸ“Œ <strong>æ’é™¤æ—¶æ®µï¼š</strong>æ¯å¤©0:00-0:30ä¸æ‰§è¡Œ
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ‰§è¡ŒçŠ¶æ€ -->
                    <div style="padding: 10px; background: rgba(59, 130, 246, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                            <span style="color: #1e40af; font-size: 12px; font-weight: 600;">ç­–ç•¥çŠ¶æ€</span>
                            <span id="autoTradeStatusUpRatio0Top8" style="color: #6b7280; font-size: 12px; font-weight: 600;">æœªå¯ç”¨</span>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="color: #1e40af; font-size: 12px;">ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´</span>
                            <span id="autoTradeLastTimeUpRatio0Top8" style="color: #6b7280; font-size: 11px;">--</span>
                        </div>
                    </div>
                </div>

                <!-- ğŸ“‰ ä¸Šæ¶¨å æ¯”0ç­–ç•¥Bï¼ˆæ¶¨å¹…å8åå¤šå•ï¼‰ -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); border: 2px solid #ef4444;">
                    <h3 style="color: #991b1b; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ“‰ ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8å
                    </h3>
                    
                    <!-- ç­–ç•¥å¼€å…³ -->
                    <div style="padding: 10px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid #ef4444; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #991b1b; font-weight: 600; font-size: 13px;">ğŸš€ å¯ç”¨è‡ªåŠ¨å¼€å•</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="autoTradeSwitchUpRatio0Bottom8" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider slider-autotrade-upratio0-bottom8" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;">
                                    <style>
                                        #autoTradeSwitchUpRatio0Bottom8:checked + .slider-autotrade-upratio0-bottom8 { background-color: #ef4444; }
                                        #autoTradeSwitchUpRatio0Bottom8:checked + .slider-autotrade-upratio0-bottom8:before { transform: translateX(20px); }
                                        .slider-autotrade-upratio0-bottom8:before {
                                            position: absolute;
                                            content: "";
                                            height: 18px;
                                            width: 18px;
                                            left: 3px;
                                            bottom: 3px;
                                            background-color: white;
                                            transition: .4s;
                                            border-radius: 50%;
                                        }
                                    </style>
                                </span>
                            </label>
                        </div>
                        
                        <!-- åå°è®¾ç½®æ˜¾ç¤º -->
                        <div id="serverAutoTradeSettingsUpRatio0Bottom8" style="display: none; padding: 8px; background: rgba(239, 68, 68, 0.15); border-radius: 6px; margin-bottom: 8px; border: 1px solid #ef4444;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #991b1b; font-size: 11px; font-weight: 600;">ğŸ“Œ ç­–ç•¥çŠ¶æ€</span>
                                <span id="serverAutoTradeStatusBadgeUpRatio0Bottom8" style="color: #10b981; font-size: 11px; font-weight: 600;">âœ… å·²å¯ç”¨</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="color: #991b1b; font-size: 11px;">ğŸ“„ æ‰§è¡Œè®¸å¯</span>
                                <span id="jsonlAllowedStatusUpRatio0Bottom8" style="color: #6b7280; font-size: 11px; font-weight: 600;">â³ æ£€æŸ¥ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§¦å‘æ¡ä»¶ -->
                    <div style="padding: 10px; background: rgba(239, 68, 68, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="margin-bottom: 8px;">
                            <label style="color: #991b1b; font-weight: 600; font-size: 13px; display: block; margin-bottom: 8px;">
                                âš™ï¸ è§¦å‘æ¡ä»¶
                            </label>
                            <!-- å½“å‰ä¸Šæ¶¨å æ¯” -->
                            <div style="padding: 12px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 8px; margin-bottom: 12px; border: 2px solid #f59e0b; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <span style="color: #92400e; font-size: 12px; font-weight: 600;">ğŸ“Š å½“å‰ä¸Šæ¶¨å æ¯”</span>
                                    <span id="currentUpRatioBottom8" style="color: #92400e; font-weight: 800; font-size: 18px; font-family: 'Courier New', monospace; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">--</span>
                                </div>
                            </div>
                            <div style="padding: 10px; background: rgba(251, 191, 36, 0.1); border-radius: 6px; border-left: 3px solid #f59e0b;">
                                <p style="color: #92400e; font-size: 11px; margin: 0; line-height: 1.5;">
                                    ğŸ“Œ <strong>è§¦å‘æ¡ä»¶ï¼š</strong>ä¸Šæ¶¨å æ¯” = 0% ä¸” å½“å‰æ—¶é—´ä¸åœ¨ 0:00-0:30<br>
                                    ğŸ“Œ <strong>å¼€å•ç­–ç•¥ï¼š</strong>ä»å¸¸ç”¨å¸15ä¸ªä¸­å–æ¶¨å¹…å8å<br>
                                    ğŸ“Œ <strong>ä»“ä½è®¾ç½®ï¼š</strong>æ¯å¸1.5%å¯ç”¨ä½™é¢ï¼Œ10å€æ æ†ï¼Œå¤šå•<br>
                                    ğŸ“Œ <strong>æ’é™¤æ—¶æ®µï¼š</strong>æ¯å¤©0:00-0:30ä¸æ‰§è¡Œ
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ‰§è¡ŒçŠ¶æ€ -->
                    <div style="padding: 10px; background: rgba(239, 68, 68, 0.05); border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                            <span style="color: #991b1b; font-size: 12px; font-weight: 600;">ç­–ç•¥çŠ¶æ€</span>
                            <span id="autoTradeStatusUpRatio0Bottom8" style="color: #6b7280; font-size: 12px; font-weight: 600;">æœªå¯ç”¨</span>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="color: #991b1b; font-size: 12px;">ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´</span>
                            <span id="autoTradeLastTimeUpRatio0Bottom8" style="color: #6b7280; font-size: 11px;">--</span>
                        </div>
                    </div>
                </div>

                <!-- æŒä»“åˆ—è¡¨ -->
                <div class="info-card">
                    <h3 style="margin-bottom: 12px;">
                        ğŸ“Š æŒä»“ 
                        <span id="positionsCount" style="color: #888; font-size: 14px; font-weight: normal;">(0)</span>
                        <button onclick="loadPositions()" style="float: right; padding: 4px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="åˆ·æ–°æŒä»“">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </h3>
                    
                    <!-- æ‰¹é‡å¹³ä»“æŒ‰é’®ç»„ -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 16px;">
                        <button onclick="batchClosePositions('long', 0.5)" class="batch-close-btn batch-close-long-half">
                            ğŸ“‰ å¹³ä¸€åŠå¤šå•
                        </button>
                        <button onclick="batchClosePositions('short', 0.5)" class="batch-close-btn batch-close-short-half">
                            ğŸ“ˆ å¹³ä¸€åŠç©ºå•
                        </button>
                        <button onclick="batchClosePositions('long', 1)" class="batch-close-btn batch-close-long-all">
                            ğŸš« å¹³å…¨éƒ¨å¤šå•
                        </button>
                        <button onclick="batchClosePositions('short', 1)" class="batch-close-btn batch-close-short-all">
                            â›” å¹³å…¨éƒ¨ç©ºå•
                        </button>
                    </div>
                    
                    <div id="positionsList" class="no-positions">
                        æš‚æ— æŒä»“
                    </div>
                </div>

                <!-- å½“å‰å§”æ‰˜åˆ—è¡¨ -->
                <div class="info-card" style="margin-top: 24px;">
                    <h3>
                        ğŸ“‹ å½“å‰å§”æ‰˜ 
                        <span id="pendingOrdersCount" style="color: #888; font-size: 14px; font-weight: normal;">(0)</span>
                        <button onclick="loadPendingOrders()" style="float: right; padding: 4px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="åˆ·æ–°å§”æ‰˜">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </h3>
                    <div id="pendingOrdersList" class="no-positions">
                        æš‚æ— å§”æ‰˜
                    </div>
                </div>
                
                <!-- äº¤æ˜“æ—¥å¿— -->
                <div class="info-card" style="margin-top: 24px;">
                    <h3>
                        ğŸ“œ äº¤æ˜“æ—¥å¿— 
                        <span id="logsCount" style="color: #888; font-size: 14px; font-weight: normal;">(0)</span>
                        <button onclick="loadTradingLogs()" style="float: right; padding: 4px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="åˆ·æ–°æ—¥å¿—">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </h3>
                    <div style="margin-bottom: 12px; font-size: 12px; color: #64748b;">
                        ğŸ“ æ‰€æœ‰æ“ä½œå‡è‡ªåŠ¨è®°å½•ï¼Œä¸å¯ä¿®æ”¹ | æ•°æ®ä¿å­˜æ ¼å¼: JSONL
                    </div>
                    <div id="tradingLogsList" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; padding: 20px; color: #94a3b8;">
                            æš‚æ— æ—¥å¿—
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¡®è®¤å¯¹è¯æ¡†
        let confirmDialogResolve = null;

        function showConfirmDialog(message, title = 'âš ï¸ ç¡®è®¤æ“ä½œ') {
            return new Promise((resolve) => {
                confirmDialogResolve = resolve;
                document.getElementById('confirmDialogTitle').textContent = title;
                document.getElementById('confirmDialogMessage').textContent = message;
                document.getElementById('confirmDialog').classList.add('active');
            });
        }

        function closeConfirmDialog(result) {
            document.getElementById('confirmDialog').classList.remove('active');
            if (confirmDialogResolve) {
                confirmDialogResolve(result);
                confirmDialogResolve = null;
            }
        }

        // å½“å‰äº¤æ˜“æ–¹å‘
        let currentDirection = 'long';
        let currentLeverage = 10;
        let currentSymbol = 'BTC-USDT-SWAP';

        // å½“å‰è´¦æˆ·
        let currentAccount = 'account_poit_main';
        
        // APIè¯·æ±‚è¶…æ—¶æ§åˆ¶
        async function fetchWithTimeout(url, options = {}, timeout = 5000) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(id);
                return response;
            } catch (error) {
                clearTimeout(id);
                if (error.name === 'AbortError') {
                    console.warn(`[fetchWithTimeout] è¯·æ±‚è¶…æ—¶: ${url}`);
                    throw new Error('è¯·æ±‚è¶…æ—¶');
                }
                throw error;
            }
        }
        
        // æ”¶è—çš„äº¤æ˜“å¯¹ï¼ˆä»æœåŠ¡å™¨APIè¯»å–ï¼Œå…¨å±€å…±äº«ï¼‰
        let favoriteSymbols = [];
        
        // ä»æœåŠ¡å™¨åŠ è½½å¸¸ç”¨å¸åˆ—è¡¨
        async function loadFavoriteSymbols() {
            try {
                const response = await fetchWithTimeout('/api/okx-trading/favorite-symbols', {}, 3000);
                const data = await response.json();
                
                if (data.success) {
                    favoriteSymbols = data.symbols || [];
                    console.log('âœ… å·²åŠ è½½å¸¸ç”¨å¸åˆ—è¡¨ (å…±' + favoriteSymbols.length + 'ä¸ª)');
                } else {
                    console.error('âŒ åŠ è½½å¸¸ç”¨å¸å¤±è´¥:', data.error);
                    // ä½¿ç”¨é»˜è®¤åˆ—è¡¨ï¼ˆç”¨æˆ·é…ç½®çš„15ä¸ªå¸ï¼‰
                    favoriteSymbols = [
                        "SOL-USDT-SWAP", "XRP-USDT-SWAP", "TAO-USDT-SWAP",
                        "LDO-USDT-SWAP", "CFX-USDT-SWAP", "CRV-USDT-SWAP",
                        "UNI-USDT-SWAP", "CRO-USDT-SWAP", "FIL-USDT-SWAP",
                        "APT-USDT-SWAP", "SUI-USDT-SWAP", "NEAR-USDT-SWAP",
                        "DOT-USDT-SWAP", "LINK-USDT-SWAP", "STX-USDT-SWAP"
                    ];
                }
            } catch (error) {
                console.error('âŒ åŠ è½½å¸¸ç”¨å¸å¼‚å¸¸:', error.message);
                // ä½¿ç”¨é»˜è®¤åˆ—è¡¨ï¼ˆç”¨æˆ·é…ç½®çš„15ä¸ªå¸ï¼‰
                favoriteSymbols = [
                    "SOL-USDT-SWAP", "XRP-USDT-SWAP", "TAO-USDT-SWAP",
                    "LDO-USDT-SWAP", "CFX-USDT-SWAP", "CRV-USDT-SWAP",
                    "UNI-USDT-SWAP", "CRO-USDT-SWAP", "FIL-USDT-SWAP",
                    "APT-USDT-SWAP", "SUI-USDT-SWAP", "NEAR-USDT-SWAP",
                    "DOT-USDT-SWAP", "LINK-USDT-SWAP", "STX-USDT-SWAP"
                ];
            }
        }
        
        // ä¿å­˜å¸¸ç”¨å¸åˆ—è¡¨åˆ°æœåŠ¡å™¨
        async function saveFavoriteSymbols() {
            try {
                const response = await fetch('/api/okx-trading/favorite-symbols', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbols: favoriteSymbols })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('âœ… å¸¸ç”¨å¸åˆ—è¡¨å·²ä¿å­˜åˆ°æœåŠ¡å™¨');
                } else {
                    console.error('âŒ ä¿å­˜å¸¸ç”¨å¸å¤±è´¥:', data.error);
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜å¸¸ç”¨å¸å¼‚å¸¸:', error);
            }
        }
        
        // ä»localStorageåŠ è½½è´¦æˆ·åˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤è´¦æˆ·
        let accounts = JSON.parse(localStorage.getItem('okx_accounts') || JSON.stringify([
            { 
                id: 'account_main', 
                name: 'ä¸»è´¦æˆ·', 
                apiKey: 'b0c18f2d-e014-4ae8-9c3c-cb02161de4db',
                apiSecret: '92F864C599B2CE2EC5186AD14C8B4110',
                passphrase: 'Tencent@123',
                balance: 0 
            },
            { 
                id: 'account_fangfang12', 
                name: 'Fangfang12', 
                apiKey: 'e5867a9a-93b7-476f-81ce-093c3aacae0d',
                apiSecret: '4624EE63A9BF3F84250AC71C9A37F47D',
                passphrase: 'Tencent@123',
                balance: 0 
            },
            { 
                id: 'account_anchor', 
                name: 'é”šç‚¹è´¦å·', 
                apiKey: '0b05a729-40eb-4809-b3eb-eb2de75b7e9e',
                apiSecret: '4E4DA8BE3B18D01AA07185A006BF9F8E',
                passphrase: 'Tencent@123',
                balance: 0 
            },
            { 
                id: 'account_poit', 
                name: 'POIT', 
                apiKey: '8650e46c-059b-431d-93cf-55f8c79babdb',
                apiSecret: '4C2BD2AC6A08615EA7F36A6251857FCE',
                passphrase: 'Wu666666.',
                balance: 0 
            }
        ]));

        // äº¤æ˜“å¯¹æ•°æ®ï¼ˆåˆå§‹åŒ–ä¸ºç©ºï¼Œä»APIåŠ è½½ï¼‰
        let symbols = [];

        // åŠ è½½å®æ—¶è¡Œæƒ…æ•°æ®
        async function loadMarketTickers() {
            try {
                console.log('[loadMarketTickers] å¼€å§‹åŠ è½½è¡Œæƒ…æ•°æ®...');
                const response = await fetch('/api/okx-trading/market-tickers');
                const result = await response.json();
                
                if (result.success && result.data) {
                    symbols = result.data.map(ticker => ({
                        symbol: ticker.symbol,
                        name: ticker.name,
                        price: ticker.price,
                        change: ticker.change24h  // 24hæ¶¨è·Œå¹…
                    }));
                    console.log(`[loadMarketTickers] åŠ è½½æˆåŠŸï¼Œå…±${symbols.length}ä¸ªäº¤æ˜“å¯¹`);
                    
                    // é‡æ–°æ¸²æŸ“äº¤æ˜“å¯¹åˆ—è¡¨
                    renderSymbolsList();
                } else {
                    console.error('[loadMarketTickers] åŠ è½½å¤±è´¥:', result.error);
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    symbols = [
                        { symbol: 'BTC-USDT-SWAP', name: 'BTC', price: 0, change: 0 },
                        { symbol: 'ETH-USDT-SWAP', name: 'ETH', price: 0, change: 0 }
                    ];
                    renderSymbolsList();
                }
            } catch (error) {
                console.error('[loadMarketTickers] åŠ è½½å¼‚å¸¸:', error);
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                symbols = [
                    { symbol: 'BTC-USDT-SWAP', name: 'BTC', price: 0, change: 0 },
                    { symbol: 'ETH-USDT-SWAP', name: 'ETH', price: 0, change: 0 }
                ];
                renderSymbolsList();
            }
        }

        // åŠ è½½è´¦æˆ·ä¿¡æ¯
        async function loadAccountInfo() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                // æ²¡æœ‰APIå‡­è¯ï¼Œæ˜¾ç¤ºé»˜è®¤å€¼å’Œæç¤º
                document.getElementById('totalEquity').textContent = 'æœªé…ç½®';
                document.getElementById('availableBalance').textContent = 'æœªé…ç½®';
                document.getElementById('usedMargin').textContent = 'æœªé…ç½®';
                document.getElementById('unrealizedPnl').textContent = 'æœªé…ç½®';
                document.getElementById('frozenBalance').textContent = 'æœªé…ç½®';
                
                // æ˜¾ç¤ºé…ç½®æç¤º
                showApiConfigNotice();
                return;
            }
            
            // éšè—é…ç½®æç¤º
            hideApiConfigNotice();

            try {
                const response = await fetch('/api/okx-trading/account-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });

                const result = await response.json();

                if (result.success && result.data) {
                    const data = result.data;
                    document.getElementById('totalEquity').textContent = data.totalEquity.toFixed(2) + ' USDT';
                    document.getElementById('availableBalance').textContent = data.availableBalance.toFixed(2) + ' USDT';
                    document.getElementById('usedMargin').textContent = data.usedMargin.toFixed(2) + ' USDT';
                    
                    // æ›´æ–°è´¦æˆ·å¯¹è±¡ä¸­çš„ä½™é¢ï¼ˆä½¿ç”¨å¯ç”¨ä½™é¢ï¼‰
                    account.balance = data.availableBalance;
                    localStorage.setItem('okx_accounts', JSON.stringify(accounts));
                    
                    // åŒæ—¶æ›´æ–°è®¢å•è¡¨å•ä¸­çš„å¯ç”¨ä½™é¢
                    const orderBalanceEl = document.getElementById('orderAvailableBalance');
                    if (orderBalanceEl) {
                        orderBalanceEl.textContent = data.availableBalance.toFixed(2) + ' USDT';
                    }
                    
                    // æ›´æ–°è´¦æˆ·æ ‡ç­¾å¤„çš„ä½™é¢
                    const accountBalanceEl = document.getElementById('accountBalance');
                    if (accountBalanceEl) {
                        accountBalanceEl.textContent = data.availableBalance.toFixed(2) + ' USDT';
                    }
                    
                    // æœªå®ç°ç›ˆäºå¸¦é¢œè‰²
                    const uplElement = document.getElementById('unrealizedPnl');
                    const upl = data.unrealizedPnl;
                    uplElement.textContent = (upl >= 0 ? '+' : '') + upl.toFixed(2) + ' USDT';
                    uplElement.style.color = upl >= 0 ? '#10b981' : '#ef4444';
                    
                    // æ›´æ–°æ­¢ç›ˆæ­¢æŸæ¨¡å—çš„å½“å‰æœªå®ç°ç›ˆäºæ˜¾ç¤º
                    const currentUplElement = document.getElementById('currentUnrealizedPnl');
                    if (currentUplElement) {
                        currentUplElement.textContent = (upl >= 0 ? '+' : '') + upl.toFixed(2) + ' USDT';
                        currentUplElement.style.color = upl >= 0 ? '#10b981' : '#ef4444';
                    }
                    
                    // æ£€æŸ¥æ­¢ç›ˆæ­¢æŸè§¦å‘
                    checkTakeProfitStopLoss(upl);
                    
                    document.getElementById('frozenBalance').textContent = data.frozenBalance.toFixed(2) + ' USDT';
                } else {
                    console.error('è·å–è´¦æˆ·ä¿¡æ¯å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('åŠ è½½è´¦æˆ·ä¿¡æ¯å¼‚å¸¸:', error);
            }
        }

        // åŠ è½½æŒä»“åˆ—è¡¨
        async function loadPositions() {
            console.log('[loadPositions] å¼€å§‹åŠ è½½æŒä»“...');
            console.log('[loadPositions] currentAccount:', currentAccount);
            console.log('[loadPositions] accounts:', accounts);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            console.log('[loadPositions] æ‰¾åˆ°çš„è´¦æˆ·:', account);
            
            if (!account) {
                console.error('[loadPositions] è´¦æˆ·ä¸å­˜åœ¨');
                document.getElementById('positionsList').innerHTML = '<div class="no-positions">è´¦æˆ·ä¸å­˜åœ¨</div>';
                document.getElementById('positionsCount').textContent = '(0)';
                return;
            }
            
            console.log('[loadPositions] APIå‡­è¯æ£€æŸ¥:', {
                hasApiKey: !!account.apiKey,
                hasApiSecret: !!account.apiSecret,
                hasPassphrase: !!account.passphrase
            });
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                console.log('[loadPositions] æœªé…ç½®APIå‡­è¯');
                document.getElementById('positionsList').innerHTML = '<div class="no-positions">è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯</div>';
                document.getElementById('positionsCount').textContent = '(0)';
                return;
            }

            try {
                console.log('[loadPositions] è°ƒç”¨API...');
                const response = await fetch('/api/okx-trading/positions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });

                const result = await response.json();
                console.log('[loadPositions] APIå“åº”:', result);

                if (result.success && result.data) {
                    const positions = result.data;
                    const positionsCount = positions.length;
                    
                    console.log('[loadPositions] æŒä»“æ•°é‡:', positionsCount);
                    console.log('[loadPositions] æŒä»“æ•°æ®:', positions);
                    
                    document.getElementById('positionsCount').textContent = `(${positionsCount})`;
                    
                    if (positionsCount === 0) {
                        document.getElementById('positionsList').innerHTML = '<div class="no-positions">æš‚æ— æŒä»“</div>';
                    } else {
                        // æ›´æ–°å·²ç”¨ä¿è¯é‡‘
                        if (result.summary) {
                            document.getElementById('usedMargin').textContent = result.summary.totalMargin.toFixed(2) + ' USDT';
                        }
                        
                        // æ¸²æŸ“æŒä»“åˆ—è¡¨
                        const html = positions.map(pos => {
                            const pnlColor = pos.unrealizedPnl >= 0 ? '#10b981' : '#ef4444';
                            const pnlSign = pos.unrealizedPnl >= 0 ? '+' : '';
                            const sideClass = pos.posSide === 'long' ? 'long' : 'short';
                            const sideName = pos.posSide === 'long' ? 'åšå¤š' : 'åšç©º';
                            
                            return `
                                <div class="position-item">
                                    <div class="position-header">
                                        <span class="position-symbol">${pos.instId}</span>
                                        <span class="position-side ${sideClass}">${sideName}</span>
                                        <button class="close-position-btn" onclick="closePosition('${pos.instId}', '${pos.posSide}')">
                                            å¹³ä»“
                                        </button>
                                    </div>
                                    <div class="position-details">
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æŒä»“é‡:</span>
                                            <span class="position-detail-value">${pos.posSize}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æ æ†:</span>
                                            <span class="position-detail-value">${pos.leverage}x</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">å¼€ä»“ä»·:</span>
                                            <span class="position-detail-value">$${pos.avgPrice.toFixed(2)}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æ ‡è®°ä»·:</span>
                                            <span class="position-detail-value">$${pos.markPrice.toFixed(2)}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">ä¿è¯é‡‘:</span>
                                            <span class="position-detail-value">${pos.margin.toFixed(2)} USDT</span>
                                        </div>
                                    </div>
                                    <div class="position-pnl">
                                        <span>æœªå®ç°ç›ˆäº:</span>
                                        <span style="color: ${pnlColor};">
                                            ${pnlSign}${pos.unrealizedPnl.toFixed(2)} USDT 
                                            (${pnlSign}${pos.unrealizedPnlRatio.toFixed(2)}%)
                                        </span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        document.getElementById('positionsList').innerHTML = html;
                    }
                } else {
                    console.error('[loadPositions] è·å–æŒä»“å¤±è´¥:', result.error);
                    console.error('[loadPositions] å®Œæ•´å“åº”:', result);
                    document.getElementById('positionsList').innerHTML = '<div class="no-positions">åŠ è½½å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('[loadPositions] åŠ è½½æŒä»“å¼‚å¸¸:', error);
                document.getElementById('positionsList').innerHTML = '<div class="no-positions">åŠ è½½å¼‚å¸¸</div>';
            }
        }

        // æ­¢ç›ˆæ­¢æŸçŠ¶æ€ï¼ˆé˜²æ­¢é‡å¤è§¦å‘ï¼‰
        let takeProfitTriggered = false;
        let stopLossTriggered = false;
        let lastTakeProfitTime = 0;
        let lastStopLossTime = 0;
        const ALERT_COOLDOWN = 5 * 60 * 1000; // 5åˆ†é’Ÿå†·å´æ—¶é—´

        // æ£€æŸ¥æ­¢ç›ˆæ­¢æŸ
        function checkTakeProfitStopLoss(unrealizedPnl) {
            const now = Date.now();
            
            // æ£€æŸ¥æ­¢ç›ˆ
            const takeProfitSwitch = document.getElementById('takeProfitSwitch');
            const takeProfitThreshold = parseFloat(document.getElementById('takeProfitThreshold').value);
            
            if (takeProfitSwitch && takeProfitSwitch.checked && !isNaN(takeProfitThreshold)) {
                if (unrealizedPnl >= takeProfitThreshold && now - lastTakeProfitTime > ALERT_COOLDOWN) {
                    lastTakeProfitTime = now;
                    showTakeProfitAlert(unrealizedPnl, takeProfitThreshold);
                    playAlertSound();
                }
            }
            
            // æ£€æŸ¥æ­¢æŸ
            const stopLossSwitch = document.getElementById('stopLossSwitch');
            const stopLossThreshold = parseFloat(document.getElementById('stopLossThreshold').value);
            
            if (stopLossSwitch && stopLossSwitch.checked && !isNaN(stopLossThreshold)) {
                // æ­¢æŸé˜ˆå€¼åº”è¯¥æ˜¯è´Ÿæ•°ï¼Œæœªå®ç°ç›ˆäºä¹Ÿæ˜¯è´Ÿæ•°ï¼Œå½“äºæŸè¾¾åˆ°æˆ–è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘
                if (unrealizedPnl <= stopLossThreshold && now - lastStopLossTime > ALERT_COOLDOWN) {
                    lastStopLossTime = now;
                    showStopLossAlert(unrealizedPnl, stopLossThreshold);
                    playAlertSound();
                }
            }
        }

        // æ˜¾ç¤ºæ­¢ç›ˆè­¦æŠ¥
        async function showTakeProfitAlert(currentPnl, threshold) {
            // è‡ªåŠ¨å…³é—­æ­¢ç›ˆå¼€å…³
            const takeProfitSwitch = document.getElementById('takeProfitSwitch');
            if (takeProfitSwitch) {
                takeProfitSwitch.checked = false;
                
                // ä¿å­˜è®¾ç½®åˆ°æœåŠ¡å™¨
                await saveTakeProfitStopLossSettings();
                
                console.log('[æ­¢ç›ˆè­¦æŠ¥] æ­¢ç›ˆå·²è§¦å‘å¹¶è‡ªåŠ¨å…³é—­ï¼Œä¸‹æ¬¡éœ€è¦æ‰‹åŠ¨å¼€å¯');
            }
            
            // ç›´æ¥æ‰§è¡Œä¸€é”®å¹³ä»“ï¼Œä¸å†è¯¢é—®
            console.log('[æ­¢ç›ˆè­¦æŠ¥] è‡ªåŠ¨è§¦å‘ä¸€é”®å¹³ä»“');
            await closeAllPositions();
            
            // å‘é€æµè§ˆå™¨é€šçŸ¥ï¼ˆå¦‚æœç”¨æˆ·å…è®¸ï¼‰
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('ğŸ‰ æ­¢ç›ˆè­¦æŠ¥', {
                    body: `å½“å‰ç›ˆåˆ©ï¼š+${currentPnl.toFixed(2)} USDTï¼Œå·²è¾¾æ­¢ç›ˆç›®æ ‡ï¼å·²è‡ªåŠ¨æ‰§è¡Œä¸€é”®å¹³ä»“ã€‚`,
                    icon: '/static/favicon.ico',
                    requireInteraction: true
                });
            }
        }

        // æ˜¾ç¤ºæ­¢æŸè­¦æŠ¥
        async function showStopLossAlert(currentPnl, threshold) {
            // è‡ªåŠ¨å…³é—­æ­¢æŸå¼€å…³
            const stopLossSwitch = document.getElementById('stopLossSwitch');
            if (stopLossSwitch) {
                stopLossSwitch.checked = false;
                
                // ä¿å­˜è®¾ç½®åˆ°æœåŠ¡å™¨
                await saveTakeProfitStopLossSettings();
                
                console.log('[æ­¢æŸè­¦æŠ¥] æ­¢æŸå·²è§¦å‘å¹¶è‡ªåŠ¨å…³é—­ï¼Œä¸‹æ¬¡éœ€è¦æ‰‹åŠ¨å¼€å¯');
            }
            
            // ç›´æ¥æ‰§è¡Œä¸€é”®å¹³ä»“ï¼Œä¸å†è¯¢é—®
            console.log('[æ­¢æŸè­¦æŠ¥] è‡ªåŠ¨è§¦å‘ä¸€é”®å¹³ä»“');
            await closeAllPositions();
            
            // å‘é€æµè§ˆå™¨é€šçŸ¥ï¼ˆå¦‚æœç”¨æˆ·å…è®¸ï¼‰
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('âš ï¸ æ­¢æŸè­¦æŠ¥', {
                    body: `å½“å‰äºæŸï¼š${currentPnl.toFixed(2)} USDTï¼Œå·²è¾¾æ­¢æŸçº¿ï¼å·²è‡ªåŠ¨æ‰§è¡Œä¸€é”®å¹³ä»“ã€‚`,
                    icon: '/static/favicon.ico',
                    requireInteraction: true
                });
            }
        }

        // ä¸€é”®å¹³ä»“æ‰€æœ‰æŒä»“
        async function closeAllPositions() {
            console.log('[closeAllPositions] å¼€å§‹ä¸€é”®å¹³ä»“æ‰€æœ‰æŒä»“');
            
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) {
                alert('æœªæ‰¾åˆ°è´¦æˆ·ä¿¡æ¯');
                return;
            }
            
            try {
                const response = await fetch('/api/okx-trading/close-all-positions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        accountId: account.id
                    })
                });
                
                const result = await response.json();
                console.log('[closeAllPositions] APIå“åº”:', result);
                
                if (result.success) {
                    let message = `âœ… ä¸€é”®å¹³ä»“å®Œæˆï¼\n\næ€»æŒä»“ï¼š${result.totalPositions} ä¸ª\næˆåŠŸå¹³ä»“ï¼š${result.closedCount} ä¸ª\nå¤±è´¥ï¼š${result.failedCount} ä¸ª`;
                    
                    // å¦‚æœæœ‰é‡è¯•ä¿¡æ¯ï¼Œæ˜¾ç¤ºé‡è¯•ç»“æœ
                    if (result.retryCount > 0) {
                        message += `\n\nç¬¬äºŒè½®é‡è¯•ï¼š${result.retrySuccess}/${result.retryCount} æˆåŠŸ`;
                    }
                    
                    // æ˜¾ç¤ºè¯¦ç»†çš„å¤±è´¥ä¿¡æ¯
                    if (result.failedCount > 0) {
                        message += '\n\nå¤±è´¥è¯¦æƒ…ï¼š';
                        result.results.filter(r => r.status === 'failed' || r.status === 'error').forEach(r => {
                            message += `\nâ€¢ ${r.instId}: ${r.message}`;
                        });
                    }
                    
                    alert(message);
                    
                    // åˆ·æ–°è´¦æˆ·æ•°æ®
                    await refreshAccountData();
                } else {
                    alert(`å¹³ä»“å¤±è´¥ï¼š${result.message || result.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                console.error('[closeAllPositions] ä¸€é”®å¹³ä»“å¼‚å¸¸:', error);
                alert(`ä¸€é”®å¹³ä»“å¼‚å¸¸ï¼š${error.message}`);
            }
        }

        // åˆ·æ–°è´¦æˆ·æ•°æ®ï¼ˆè´¦æˆ·ä¿¡æ¯+æŒä»“ï¼‰
        async function refreshAccountData() {
            await Promise.all([
                loadAccountInfo(),
                loadPositions()
            ]);
        }

        // åŠ è½½è´¦æˆ·ä»“ä½é™é¢
        async function loadAccountLimit() {
            console.log('[loadAccountLimit] å¼€å§‹åŠ è½½è´¦æˆ·ä»“ä½é™é¢...');
            
            const account = accounts.find(acc => acc.id === currentAccount);
            const accountName = account ? account.name : 'ä¸»è´¦æˆ·';
            
            try {
                const response = await fetch(`/api/okx-trading/account-limit?account_name=${encodeURIComponent(accountName)}`);
                const result = await response.json();
                
                console.log('[loadAccountLimit] APIå“åº”:', result);
                
                if (result.success) {
                    const data = result.data;
                    
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    document.getElementById('accountName').textContent = data.account_name;
                    document.getElementById('accountStartDate').textContent = data.start_date;
                    document.getElementById('accountDaysPassed').textContent = `${data.days_passed} å¤©`;
                    document.getElementById('accountMaxLimit').textContent = `${data.current_max_limit} USDT`;
                    document.getElementById('accountNextIncreaseDate').textContent = data.next_increase_date;
                    document.getElementById('accountDaysUntilIncrease').textContent = `${data.days_until_next_increase} å¤©`;
                    
                    console.log(`âœ… è´¦æˆ·é™é¢å·²æ›´æ–°: ${data.current_max_limit} USDT`);
                } else {
                    console.error('[loadAccountLimit] åŠ è½½å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('[loadAccountLimit] åŠ è½½å¼‚å¸¸:', error);
            }
        }

        // å¹³ä»“å‡½æ•°
        async function closePosition(instId, posSide) {
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            const sideName = posSide === 'long' ? 'åšå¤š' : 'åšç©º';
            const confirmMsg = `ç¡®è®¤å¹³ä»“ ${instId} ${sideName} æŒä»“ï¼Ÿ`;
            
            // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            const confirmed = await showConfirmDialog(confirmMsg, 'ğŸ”” æ‰¹é‡å¹³å…¨å•æç¤º');
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch('/api/okx-trading/close-position', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        instId: instId,
                        posSide: posSide
                    })
                });
                
                const result = await response.json();
                console.log('å¹³ä»“å“åº”:', result);
                
                if (result.success) {
                    alert('âœ… å¹³ä»“æˆåŠŸï¼');
                    // å¹³ä»“æˆåŠŸååˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
                    await refreshAccountData();
                } else {
                    const errorMsg = result.error || 'æœªçŸ¥é”™è¯¯';
                    // ç‰¹æ®Šå¤„ç†"æ²¡æœ‰æŒä»“"é”™è¯¯
                    if (errorMsg.includes('æ²¡æœ‰') && errorMsg.includes('æŒä»“')) {
                        alert(`âš ï¸ ${errorMsg}\n\nå¯èƒ½åŸå› ï¼š\nâ€¢ æŒä»“å·²è¢«å…¶ä»–æ“ä½œå¹³ä»“\nâ€¢ è´¦æˆ·åˆ‡æ¢åæŒä»“æœªåŒæ­¥\nâ€¢ æŒä»“å·²è¿‡æœŸæˆ–è¢«æ¸…ç®—\n\nå»ºè®®ï¼šç‚¹å‡»"åˆ·æ–°"æŒ‰é’®æ›´æ–°æŒä»“ä¿¡æ¯`);
                        // è‡ªåŠ¨åˆ·æ–°æŒä»“åˆ—è¡¨
                        console.log('[closePosition] æŒä»“ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ·æ–°æŒä»“åˆ—è¡¨');
                        await refreshAccountData();
                    } else {
                        alert(`âŒ å¹³ä»“å¤±è´¥: ${errorMsg}`);
                    }
                }
            } catch (error) {
                console.error('å¹³ä»“å¼‚å¸¸:', error);
                alert(`âŒ å¹³ä»“å¼‚å¸¸: ${error.message || error}`);
            }
        }

        // åŠ è½½å½“å‰å§”æ‰˜ï¼ˆæœªæˆäº¤è®¢å•ï¼‰
        async function loadPendingOrders() {
            console.log('[loadPendingOrders] å¼€å§‹åŠ è½½å§”æ‰˜è®¢å•...');
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account) {
                console.error('[loadPendingOrders] è´¦æˆ·ä¸å­˜åœ¨');
                document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">è´¦æˆ·ä¸å­˜åœ¨</div>';
                document.getElementById('pendingOrdersCount').textContent = '(0)';
                return;
            }
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                console.log('[loadPendingOrders] æœªé…ç½®APIå‡­è¯');
                document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯</div>';
                document.getElementById('pendingOrdersCount').textContent = '(0)';
                return;
            }

            try {
                console.log('[loadPendingOrders] è°ƒç”¨API...');
                const response = await fetch('/api/okx-trading/pending-orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });

                const result = await response.json();
                console.log('[loadPendingOrders] APIå“åº”:', result);

                if (result.success && result.data) {
                    const orders = result.data;
                    const ordersCount = orders.length;
                    
                    console.log('[loadPendingOrders] å§”æ‰˜æ•°é‡:', ordersCount);
                    
                    document.getElementById('pendingOrdersCount').textContent = `(${ordersCount})`;
                    
                    if (ordersCount === 0) {
                        document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">æš‚æ— å§”æ‰˜</div>';
                    } else {
                        // æ¸²æŸ“å§”æ‰˜è®¢å•åˆ—è¡¨
                        const html = orders.map(order => {
                            const sideClass = order.posSide === 'long' ? 'long' : 'short';
                            const sideName = order.posSide === 'long' ? 'åšå¤š' : 'åšç©º';
                            const sideAction = order.side === 'buy' ? 'ä¹°å…¥' : 'å–å‡º';
                            
                            // æ ¼å¼åŒ–åˆ›å»ºæ—¶é—´
                            const createTime = new Date(parseInt(order.createTime)).toLocaleString('zh-CN');
                            
                            return `
                                <div class="position-item" style="border-left: 3px solid #f59e0b;">
                                    <div class="position-header">
                                        <span class="position-symbol">${order.instId}</span>
                                        <span class="position-side ${sideClass}">${sideName}</span>
                                        <button class="cancel-order-btn" onclick="cancelOrder('${order.ordId}', '${order.instId}')">
                                            æ’¤é”€
                                        </button>
                                    </div>
                                    <div class="position-details">
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">çŠ¶æ€:</span>
                                            <span class="position-detail-value" style="color: #f59e0b;">${order.stateText}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">ç±»å‹:</span>
                                            <span class="position-detail-value">${order.ordTypeText}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æ•°é‡:</span>
                                            <span class="position-detail-value">${order.size}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">ä»·æ ¼:</span>
                                            <span class="position-detail-value">$${parseFloat(order.price).toFixed(4)}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">å·²æˆäº¤:</span>
                                            <span class="position-detail-value">${order.filledSize}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">åˆ›å»ºæ—¶é—´:</span>
                                            <span class="position-detail-value" style="font-size: 11px;">${createTime}</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 8px; font-size: 11px; color: #888;">
                                        è®¢å•ID: ${order.ordId}
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        document.getElementById('pendingOrdersList').innerHTML = html;
                    }
                } else {
                    console.error('[loadPendingOrders] è·å–å§”æ‰˜åˆ—è¡¨å¤±è´¥:', result.error);
                    document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">åŠ è½½å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('[loadPendingOrders] åŠ è½½å§”æ‰˜å¼‚å¸¸:', error);
                document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">åŠ è½½å¼‚å¸¸</div>';
            }
        }

        // æ’¤é”€è®¢å•å‡½æ•°
        async function cancelOrder(ordId, instId) {
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            const confirmMsg = `ç¡®è®¤æ’¤é”€è®¢å•ï¼Ÿ\n\näº¤æ˜“å¯¹: ${instId}\nè®¢å•ID: ${ordId}`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            try {
                const response = await fetch('/api/okx-trading/cancel-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        ordId: ordId,
                        instId: instId
                    })
                });
                
                const result = await response.json();
                console.log('æ’¤é”€å“åº”:', result);
                
                if (result.success) {
                    alert('âœ… è®¢å•å·²æ’¤é”€ï¼');
                    // æ’¤é”€æˆåŠŸååˆ·æ–°è´¦æˆ·ä¿¡æ¯ã€æŒä»“å’Œå§”æ‰˜åˆ—è¡¨
                    await refreshAccountData();
                    await loadPendingOrders();
                } else {
                    alert(`âŒ æ’¤é”€å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                console.error('æ’¤é”€å¼‚å¸¸:', error);
                alert(`âŒ æ’¤é”€å¼‚å¸¸: ${error.message || error}`);
            }
        }


        // æ˜¾ç¤ºAPIé…ç½®æç¤º
        function showApiConfigNotice() {
            const notice = document.getElementById('apiConfigNotice');
            if (notice) {
                notice.style.display = 'block';
            }
        }

        // éšè—APIé…ç½®æç¤º
        function hideApiConfigNotice() {
            const notice = document.getElementById('apiConfigNotice');
            if (notice) {
                notice.style.display = 'none';
            }
        }

        // åŠ è½½äº¤æ˜“æ—¥å¿—
        async function loadTradingLogs() {
            console.log('[loadTradingLogs] å¼€å§‹åŠ è½½äº¤æ˜“æ—¥å¿—');
            
            try {
                const response = await fetch('/api/okx-trading/logs?limit=50');
                const result = await response.json();
                
                if (result.success && result.logs) {
                    const logs = result.logs;
                    const logsCount = document.getElementById('logsCount');
                    const logsContainer = document.getElementById('tradingLogsList');
                    
                    logsCount.textContent = `(${logs.length})`;
                    
                    if (logs.length === 0) {
                        logsContainer.innerHTML = `
                            <div style="text-align: center; padding: 20px; color: #94a3b8;">
                                æš‚æ— æ—¥å¿—
                            </div>
                        `;
                        return;
                    }
                    
                    // åè½¬é¡ºåºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢
                    const reversedLogs = [...logs].reverse();
                    
                    logsContainer.innerHTML = reversedLogs.map(log => {
                        const time = new Date(log.timestamp).toLocaleString('zh-CN');
                        const actionEmoji = {
                            'open_position': 'ğŸ“ˆ',
                            'close_position': 'ğŸ“‰',
                            'cancel_order': 'ğŸš«',
                            'batch_open': 'ğŸ¯',
                            'batch_close': 'âš¡'
                        }[log.action] || 'ğŸ“';
                        
                        const actionText = {
                            'open_position': 'å¼€ä»“',
                            'close_position': 'å¹³ä»“',
                            'cancel_order': 'æ’¤å•',
                            'batch_open': 'æ‰¹é‡å¼€ä»“',
                            'batch_close': 'æ‰¹é‡å¹³ä»“'
                        }[log.action] || log.action;
                        
                        const status = log.result.status;
                        const statusColor = status === 'success' ? '#10b981' : '#ef4444';
                        const statusText = status === 'success' ? 'æˆåŠŸ' : 'å¤±è´¥';
                        const statusEmoji = status === 'success' ? 'âœ…' : 'âŒ';
                        
                        // æ„å»ºè¯¦æƒ…æ–‡æœ¬
                        let detailsText = '';
                        if (log.details.instId) {
                            const coinName = log.details.instId.replace('-USDT-SWAP', '');
                            detailsText += `${coinName} `;
                        }
                        if (log.details.posSide) {
                            detailsText += log.details.posSide === 'long' ? 'åšå¤š' : 'åšç©º';
                            detailsText += ' ';
                        }
                        if (log.details.inputUsdt) {
                            detailsText += `${log.details.inputUsdt} USDT`;
                        }
                        if (log.details.contracts) {
                            detailsText += ` (${log.details.contracts}å¼ )`;
                        }
                        if (log.details.leverage) {
                            detailsText += ` ${log.details.leverage}x`;
                        }
                        
                        // é”™è¯¯ä¿¡æ¯
                        let errorText = '';
                        if (status === 'failed' && log.result.error) {
                            errorText = `<div style="margin-top: 4px; font-size: 11px; color: #ef4444;">é”™è¯¯: ${log.result.error}</div>`;
                        }
                        
                        return `
                            <div style="padding: 12px; border-bottom: 1px solid #e5e7eb; transition: background 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='transparent'">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                                    <div>
                                        <span style="font-size: 16px;">${actionEmoji}</span>
                                        <strong style="margin-left: 6px; color: #1e293b;">${actionText}</strong>
                                        <span style="margin-left: 8px; color: #64748b; font-size: 13px;">${detailsText}</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <span style="font-size: 14px;">${statusEmoji}</span>
                                        <span style="margin-left: 4px; color: ${statusColor}; font-weight: 600; font-size: 13px;">${statusText}</span>
                                    </div>
                                </div>
                                <div style="font-size: 11px; color: #94a3b8;">
                                    ${time}
                                </div>
                                ${errorText}
                            </div>
                        `;
                    }).join('');
                    
                    console.log(`[loadTradingLogs] åŠ è½½äº† ${logs.length} æ¡æ—¥å¿—`);
                } else {
                    console.error('[loadTradingLogs] åŠ è½½å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('[loadTradingLogs] åŠ è½½å¼‚å¸¸:', error);
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        // ä»åç«¯APIåŠ è½½è´¦æˆ·åˆ—è¡¨
        async function loadAccountsList() {
            console.log('[loadAccountsList] å¼€å§‹åŠ è½½è´¦æˆ·åˆ—è¡¨...');
            try {
                const response = await fetch('/api/okx-accounts/list-with-credentials');
                const result = await response.json();
                
                if (result.success && result.accounts) {
                    console.log('[loadAccountsList] ä»åç«¯åŠ è½½æˆåŠŸ:', result);
                    
                    // å°†åç«¯è´¦æˆ·è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼
                    accounts = result.accounts.map(acc => ({
                        id: acc.id || acc.account_id,
                        name: acc.name || acc.account_name,
                        apiKey: acc.apiKey || acc.api_key,
                        apiSecret: acc.apiSecret || acc.api_secret,
                        passphrase: acc.passphrase,
                        balance: 0
                    }));
                    
                    // ä¿å­˜åˆ° localStorage
                    localStorage.setItem('okx_accounts', JSON.stringify(accounts));
                    
                    // è®¾ç½®é»˜è®¤è´¦æˆ·
                    if (result.default_account && accounts.length > 0) {
                        const defaultAcc = accounts.find(acc => acc.id === result.default_account);
                        if (defaultAcc) {
                            currentAccount = defaultAcc.id;
                        } else {
                            currentAccount = accounts[0].id;
                        }
                    }
                    
                    console.log('[loadAccountsList] è´¦æˆ·åˆ—è¡¨å·²æ›´æ–°:', accounts);
                    console.log('[loadAccountsList] å½“å‰è´¦æˆ·:', currentAccount);
                } else {
                    console.warn('[loadAccountsList] åç«¯APIè¿”å›å¤±è´¥ï¼Œä½¿ç”¨localStorageæ•°æ®');
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä»localStorageè¯»å–
                    loadAccountsFromLocalStorage();
                }
            } catch (error) {
                console.warn('[loadAccountsList] åç«¯APIè°ƒç”¨å¼‚å¸¸ï¼Œä½¿ç”¨localStorageæ•°æ®:', error);
                // å¤‡ç”¨æ–¹æ¡ˆï¼šä»localStorageè¯»å–
                loadAccountsFromLocalStorage();
            }
        }
        
        function loadAccountsFromLocalStorage() {
            const storedAccounts = localStorage.getItem('okx_accounts');
            if (storedAccounts) {
                try {
                    accounts = JSON.parse(storedAccounts);
                    console.log('[loadAccountsFromLocalStorage] ä»localStorageåŠ è½½è´¦æˆ·:', accounts);
                    
                    // è®¾ç½®é»˜è®¤è´¦æˆ·
                    if (accounts.length > 0) {
                        currentAccount = accounts[0].id;
                    }
                } catch (error) {
                    console.error('[loadAccountsFromLocalStorage] è§£ælocalStorageå¤±è´¥:', error);
                }
            } else {
                console.warn('[loadAccountsFromLocalStorage] localStorageä¸­æ²¡æœ‰è´¦æˆ·æ•°æ®');
            }
        }

        // è¿›åº¦è·Ÿè¸ª
        let loadingProgress = 0;
        const totalSteps = 6;

        function updateProgress(step, stepName, substepId) {
            loadingProgress++;
            const percentage = Math.round((loadingProgress / totalSteps) * 100);
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const loadingStep = document.getElementById('loadingStep');
            const substepEl = document.getElementById(substepId);
            
            if (progressBar) progressBar.style.width = percentage + '%';
            if (progressText) progressText.textContent = percentage + '%';
            if (loadingStep) loadingStep.textContent = stepName;
            if (substepEl) {
                substepEl.classList.remove('loading');
                substepEl.classList.add('completed');
            }
            
            console.log(`[è¿›åº¦] ${percentage}% - ${stepName}`);
        }

        function setLoadingStep(substepId) {
            const substepEl = document.getElementById(substepId);
            if (substepEl) {
                // ç§»é™¤æ‰€æœ‰loadingçŠ¶æ€
                document.querySelectorAll('.substep.loading').forEach(el => {
                    el.classList.remove('loading');
                });
                // æ·»åŠ å½“å‰loadingçŠ¶æ€
                substepEl.classList.add('loading');
            }
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            const mainContent = document.getElementById('mainContent');
            
            if (overlay) {
                overlay.classList.add('fade-out');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 500);
            }
            
            if (mainContent) {
                mainContent.style.opacity = '1';
            }
        }

        async function init() {
            const startTime = Date.now();
            console.log('[init] é¡µé¢åˆå§‹åŒ–å¼€å§‹...');
            
            try {
                // æ­¥éª¤1: åŠ è½½è´¦æˆ·åˆ—è¡¨
                setLoadingStep('step-accounts');
                await loadAccountsList();
                updateProgress(1, 'âœ“ è´¦æˆ·é…ç½®åŠ è½½å®Œæˆ', 'step-accounts');
                
                // ç¡®ä¿accountsæ•°ç»„ä¸ä¸ºç©º
                if (!accounts || accounts.length === 0) {
                    console.warn('[init] accountsä¸ºç©ºï¼Œä½¿ç”¨åˆå§‹åŒ–çš„é»˜è®¤å€¼');
                    if (!currentAccount && accounts.length > 0) {
                        currentAccount = accounts[0].id;
                    }
                }
                
                renderAccountTabs();
                
                // æ­¥éª¤2: åŠ è½½å¸¸ç”¨å¸åˆ—è¡¨ï¼ˆä¼˜å…ˆçº§é«˜ï¼Œå½±å“å…¶ä»–æ•°æ®ï¼‰
                setLoadingStep('step-favorites');
                await loadFavoriteSymbols();
                updateProgress(2, 'âœ“ å¸¸ç”¨å¸ç§åŠ è½½å®Œæˆ', 'step-favorites');
                
                // æ­¥éª¤3: åŠ è½½å®æ—¶è¡Œæƒ…ï¼ˆå¹¶è¡Œï¼Œä¸é˜»å¡ï¼‰
                setLoadingStep('step-tickers');
                loadMarketTickers();  // ä¸awaitï¼Œè®©å®ƒåœ¨åå°æ‰§è¡Œ
                updateProgress(3, 'âœ“ å®æ—¶è¡Œæƒ…åŠ è½½ä¸­...', 'step-tickers');
                
                // æ­¥éª¤4: åŠ è½½è´¦æˆ·æ•°æ®å’ŒæŒä»“ï¼ˆå…³é”®æ•°æ®ï¼‰
                setLoadingStep('step-positions');
                await Promise.all([
                    loadAccountData(),
                    refreshAccountData()
                ]);
                updateProgress(4, 'âœ“ è´¦æˆ·ä¸æŒä»“åŠ è½½å®Œæˆ', 'step-positions');
                
                // æ­¥éª¤5: åŠ è½½å§”æ‰˜è®¢å•ï¼ˆæ¬¡è¦æ•°æ®ï¼‰
                setLoadingStep('step-orders');
                loadPendingOrders();  // ä¸awaitï¼Œè®©å®ƒåœ¨åå°æ‰§è¡Œ
                updateProgress(5, 'âœ“ å§”æ‰˜è®¢å•åŠ è½½ä¸­...', 'step-orders');
                
                // æ­¥éª¤6: åŠ è½½äº¤æ˜“æ—¥å¿—å’Œè´¦æˆ·é™é¢ï¼ˆæ¬¡è¦æ•°æ®ï¼‰
                setLoadingStep('step-logs');
                Promise.all([
                    loadTradingLogs(),
                    loadAccountLimit()
                ]);
                updateProgress(6, 'âœ“ æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆï¼', 'step-logs');
                
                // å»¶è¿Ÿéšè—åŠ è½½ç•Œé¢ï¼Œè®©ç”¨æˆ·çœ‹åˆ°å®ŒæˆçŠ¶æ€
                setTimeout(() => {
                    hideLoadingOverlay();
                    const loadTime = Date.now() - startTime;
                    console.log(`[init] é¡µé¢åŠ è½½å®Œæˆï¼Œè€—æ—¶ ${loadTime}ms`);
                }, 800);
                
            } catch (error) {
                console.error('[init] åˆå§‹åŒ–å¤±è´¥:', error);
                // å³ä½¿å¤±è´¥ä¹Ÿè¦éšè—åŠ è½½ç•Œé¢
                setTimeout(() => {
                    hideLoadingOverlay();
                    alert('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨');
                }, 1000);
            }
            
            // å¯åŠ¨å®šæ—¶åˆ·æ–°ä»»åŠ¡
            // æ¯60ç§’è‡ªåŠ¨åˆ·æ–°è´¦æˆ·ä¿¡æ¯ã€æŒä»“ã€å§”æ‰˜å’Œæ—¥å¿—ï¼ˆä¼˜åŒ–ï¼šä»30ç§’æ”¹ä¸º60ç§’ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›ï¼‰
            setInterval(() => {
                refreshAccountData();
                loadPendingOrders();
                loadTradingLogs();
                updateTotalChangeOKX(); // åŒæ—¶æ›´æ–°æ¶¨è·Œå¹…
                checkAndExecuteAutoStrategy(); // æ£€æŸ¥è‡ªåŠ¨äº¤æ˜“ç­–ç•¥
                checkAndExecuteUpRatio0Top8(); // æ£€æŸ¥ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åç­–ç•¥
                checkAndExecuteUpRatio0Bottom8(); // æ£€æŸ¥ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åç­–ç•¥
            }, 60000);
            
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°è¡Œæƒ…æ•°æ®ï¼ˆä¼˜åŒ–ï¼šä»10ç§’æ”¹ä¸º30ç§’ï¼Œå‡å°‘é¢‘ç¹è¯·æ±‚ï¼‰
            setInterval(() => {
                loadMarketTickers();
            }, 30000);
        }

        // æ¸²æŸ“è´¦æˆ·æ ‡ç­¾
        function renderAccountTabs() {
            console.log('[renderAccountTabs] å¼€å§‹æ¸²æŸ“è´¦æˆ·æ ‡ç­¾...');
            console.log('[renderAccountTabs] accounts:', accounts);
            console.log('[renderAccountTabs] currentAccount:', currentAccount);
            
            const tabsContainer = document.getElementById('accountTabs');
            if (!tabsContainer) {
                console.error('[renderAccountTabs] accountTabså…ƒç´ ä¸å­˜åœ¨ï¼');
                return;
            }
            
            if (!accounts || accounts.length === 0) {
                console.error('[renderAccountTabs] accountsæ•°ç»„ä¸ºç©ºï¼');
                tabsContainer.innerHTML = '<div class="text-gray-500">æš‚æ— è´¦æˆ·</div>';
                return;
            }
            
            tabsContainer.innerHTML = accounts.map(acc => `
                <div class="account-tab ${acc.id === currentAccount ? 'active' : ''}" onclick="selectAccount('${acc.id}')">
                    ${acc.name}
                </div>
            `).join('');
            
            console.log('[renderAccountTabs] æ¸²æŸ“å®Œæˆï¼Œå…±', accounts.length, 'ä¸ªè´¦æˆ·');
            
            // æ›´æ–°è´¦æˆ·ä½™é¢æ˜¾ç¤º
            updateAccountBalance();
        }

        // é€‰æ‹©è´¦æˆ·
        function selectAccount(accountId) {
            console.log(`[selectAccount] åˆ‡æ¢è´¦æˆ·: ${accountId}`);
            console.log(`[selectAccount] åˆ‡æ¢å‰ currentAccount: ${currentAccount}`);
            
            currentAccount = accountId;
            
            console.log(`[selectAccount] åˆ‡æ¢å currentAccount: ${currentAccount}`);
            console.log(`[selectAccount] å½“å‰è´¦æˆ·åˆ—è¡¨:`, accounts.map(a => ({id: a.id, name: a.name})));
            
            renderAccountTabs();
            loadAccountData();
            refreshAccountData();  // åˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
            loadTakeProfitStopLossSettings();  // åŠ è½½è¯¥è´¦æˆ·çš„æ­¢ç›ˆæ­¢æŸè®¾ç½®
            loadAutoStrategySettings();  // åŠ è½½è¯¥è´¦æˆ·çš„è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®
            
            const account = accounts.find(acc => acc.id === accountId);
            console.log(`[selectAccount] å·²åˆ‡æ¢åˆ°è´¦æˆ·: ${account ? account.name : 'æœªæ‰¾åˆ°'} (${accountId})`);
        }

        // æ›´æ–°è´¦æˆ·ä½™é¢æ˜¾ç¤º
        function updateAccountBalance() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (account) {
                // æ›´æ–°è´¦æˆ·æ ‡ç­¾å¤„çš„ä½™é¢
                document.getElementById('accountBalance').textContent = account.balance.toFixed(2) + ' USDT';
                // æ›´æ–°ä¾§è¾¹æ è´¦æˆ·æ˜¾ç¤º
                const sidebarBalanceEl = document.getElementById('sidebarAccountBalance');
                if (sidebarBalanceEl) {
                    sidebarBalanceEl.textContent = account.balance.toFixed(2) + ' USDT';
                }
                const currentAccountNameEl = document.getElementById('currentAccountName');
                if (currentAccountNameEl) {
                    currentAccountNameEl.textContent = account.name;
                }
                // æ›´æ–°è®¢å•è¡¨å•ä¸­çš„å¯ç”¨ä½™é¢
                const orderBalanceEl = document.getElementById('orderAvailableBalance');
                if (orderBalanceEl) {
                    orderBalanceEl.textContent = account.balance.toFixed(2) + ' USDT';
                }
            }
        }
        
        // æ»šåŠ¨åˆ°è´¦æˆ·åˆ‡æ¢å™¨
        function scrollToAccountSwitcher() {
            const switcher = document.querySelector('.account-switcher');
            if (switcher) {
                switcher.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // æ¸²æŸ“äº¤æ˜“å¯¹åˆ—è¡¨
        function renderSymbolsList() {
            const list = document.getElementById('symbolsList');
            
            // åˆ†ç»„ï¼šæ”¶è—çš„å’Œéæ”¶è—çš„
            const favorited = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            const notFavorited = symbols.filter(s => !favoriteSymbols.includes(s.symbol));
            
            let html = '';
            
            // æ¸²æŸ“æ”¶è—åˆ†ç»„
            if (favorited.length > 0) {
                html += '<div class="favorite-section">';
                html += '<div class="favorite-section-title">â­ å¸¸ç”¨å¸ (' + favorited.length + ')</div>';
                html += favorited.map(s => renderSymbolItem(s, true)).join('');
                html += '</div>';
            }
            
            // æ¸²æŸ“éæ”¶è—åˆ†ç»„
            html += notFavorited.map(s => renderSymbolItem(s, false)).join('');
            
            list.innerHTML = html;
        }
        
        // æ¸²æŸ“å•ä¸ªäº¤æ˜“å¯¹é¡¹
        function renderSymbolItem(s, isFavorite) {
            const isActive = s.symbol === currentSymbol;
            const favoriteClass = isFavorite ? 'favorite' : '';
            const starIcon = isFavorite ? 'â­' : 'â˜†';
            
            return `
                <div class="symbol-item ${isActive ? 'active' : ''} ${favoriteClass}" onclick="selectSymbol('${s.symbol}')">
                    <div class="symbol-content">
                        <div class="symbol-name">
                            ${s.name}/USDT
                            ${isFavorite ? '<span class="favorite-badge">â­</span>' : ''}
                        </div>
                        <div class="symbol-price">
                            $${s.price.toFixed(s.price < 1 ? 4 : 2)} 
                            <span style="color: ${s.change >= 0 ? '#10b981' : '#ef4444'}">
                                ${s.change >= 0 ? '+' : ''}${s.change}%
                            </span>
                        </div>
                    </div>
                    <button class="favorite-btn ${isFavorite ? 'favorited' : ''}" 
                            onclick="event.stopPropagation(); toggleFavorite('${s.symbol}')"
                            title="${isFavorite ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}">
                        ${starIcon}
                    </button>
                </div>
            `;
        }
        
        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        async function toggleFavorite(symbol) {
            const index = favoriteSymbols.indexOf(symbol);
            
            if (index > -1) {
                // å–æ¶ˆæ”¶è—
                favoriteSymbols.splice(index, 1);
            } else {
                // æ·»åŠ æ”¶è—
                favoriteSymbols.push(symbol);
            }
            
            // ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆå…¨å±€å…±äº«ï¼‰
            await saveFavoriteSymbols();
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderSymbolsList();
            
            console.log('æ”¶è—åˆ—è¡¨å·²æ›´æ–°:', favoriteSymbols);
        }

        // é€‰æ‹©äº¤æ˜“å¯¹
        function selectSymbol(symbol) {
            currentSymbol = symbol;
            const symbolData = symbols.find(s => s.symbol === symbol);
            
            document.getElementById('currentSymbol').textContent = symbolData.name + '-USDT';
            document.getElementById('currentPrice').textContent = symbolData.price.toFixed(2);
            
            const changeEl = document.getElementById('priceChange');
            changeEl.textContent = (symbolData.change >= 0 ? '+' : '') + symbolData.change + '%';
            changeEl.className = 'price-change ' + (symbolData.change >= 0 ? 'up' : 'down');
            
            renderSymbolsList();
        }

        // é€‰æ‹©äº¤æ˜“æ–¹å‘
        function selectDirection(direction) {
            currentDirection = direction;
            
            document.querySelectorAll('.direction-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.direction-tab.' + direction).classList.add('active');
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.className = 'submit-order ' + direction;
            submitBtn.innerHTML = direction === 'long' ? 'â¬† åšå¤š' : 'â¬‡ åšç©º';
        }

        // é€‰æ‹©æ æ†
        function selectLeverage(leverage) {
            currentLeverage = leverage;
            
            document.querySelectorAll('.leverage-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // è®¾ç½®é‡‘é¢ç™¾åˆ†æ¯”
        function setAmount(percent) {
            // ä»DOMä¸­è·å–å®æ—¶çš„å¯ç”¨ä½™é¢
            const orderBalanceEl = document.getElementById('orderAvailableBalance');
            let balance = 0;
            
            if (orderBalanceEl && orderBalanceEl.textContent) {
                // æå–æ•°å­—éƒ¨åˆ†ï¼Œä¾‹å¦‚ "101.28 USDT" -> 101.28
                const balanceText = orderBalanceEl.textContent.trim();
                const balanceMatch = balanceText.match(/[\d.]+/);
                if (balanceMatch) {
                    balance = parseFloat(balanceMatch[0]);
                }
            }
            
            // å¦‚æœæ²¡æœ‰ä»DOMè·å–åˆ°ï¼Œå°è¯•ä»è´¦æˆ·å¯¹è±¡è·å–
            if (balance === 0) {
                const account = accounts.find(acc => acc.id === currentAccount);
                balance = account ? (account.balance || 0) : 0;
            }
            
            // è®¡ç®—ä»“ä½é‡‘é¢
            const amount = (balance * percent / 100).toFixed(2);
            const orderAmountInput = document.getElementById('orderAmount');
            if (orderAmountInput) {
                orderAmountInput.value = amount;
                console.log(`è®¾ç½®${percent}%ä»“ä½: å¯ç”¨ä½™é¢=${balance} USDT, ä»“ä½é‡‘é¢=${amount} USDT`);
            }
        }

        // æ‰¹é‡å¼€ä»“å‡½æ•°
        async function batchOrder(direction, percentPerCoin) {
            console.log(`[batchOrder] å¼€å§‹æ‰¹é‡å¼€ä»“: direction=${direction}, percentPerCoin=${percentPerCoin}%`);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å¯ç”¨ä½™é¢
            const balance = account.balance || 0;
            if (balance <= 0) {
                alert('âŒ è´¦æˆ·ä½™é¢ä¸è¶³ï¼');
                return;
            }
            
            // åªä»æ”¶è—çš„å¸ç§ä¸­é€‰æ‹©
            const favoriteSymbolsData = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            
            if (favoriteSymbolsData.length === 0) {
                alert('âŒ è¯·å…ˆæ”¶è—ä¸€äº›å¸¸ç”¨å¸ç§ï¼\n\nåœ¨äº¤æ˜“å¯¹åˆ—è¡¨ä¸­ç‚¹å‡»â­æŒ‰é’®æ·»åŠ æ”¶è—ã€‚');
                return;
            }
            
            console.log('[batchOrder] å¸¸ç”¨å¸ç§æ•°é‡:', favoriteSymbolsData.length);
            console.log('[batchOrder] å¸¸ç”¨å¸ç§:', favoriteSymbolsData.map(s => s.name).join(', '));
            
            // ä»å¸¸ç”¨å¸ç§ä¸­æŒ‰æ¶¨è·Œå¹…æ’åºï¼Œè·å–å‰6å
            const sortedSymbols = [...favoriteSymbolsData].sort((a, b) => b.change - a.change);
            const top6Symbols = sortedSymbols.slice(0, 6);
            
            if (top6Symbols.length < 6) {
                alert(`âŒ å¸¸ç”¨å¸ç§ä¸è¶³6ä¸ªï¼\n\nå½“å‰å¸¸ç”¨å¸ç§ï¼š${favoriteSymbolsData.length}ä¸ª\nè¯·è‡³å°‘æ”¶è—6ä¸ªå¸ç§æ‰èƒ½ä½¿ç”¨æ‰¹é‡å¼€ä»“ã€‚`);
                return;
            }
            
            console.log('[batchOrder] å¸¸ç”¨å¸ç§æ¶¨å¹…å‰6:', top6Symbols.map(s => `${s.name} (${s.change}%)`));
            
            // è®¡ç®—æ¯ä¸ªå¸çš„ä¿è¯é‡‘å ç”¨ï¼ˆç”¨æˆ·è¾“å…¥çš„ç™¾åˆ†æ¯”æ˜¯æŒ‡ä¿è¯é‡‘å æ¯”ï¼‰
            const marginPerCoin = (balance * percentPerCoin / 100).toFixed(2);
            const totalMargin = (marginPerCoin * 6).toFixed(2);
            
            // âš ï¸ é‡è¦ï¼š10xæ æ†ä¸‹ï¼Œåˆçº¦ä»·å€¼ = ä¿è¯é‡‘ Ã— 10
            const contractValuePerCoin = (parseFloat(marginPerCoin) * 10).toFixed(2);
            const totalContractValue = (parseFloat(contractValuePerCoin) * 6).toFixed(2);
            
            console.log(`[batchOrder] ä½™é¢æ£€æŸ¥: å¯ç”¨=${balance.toFixed(2)}, æ¯å¸ä¿è¯é‡‘=${marginPerCoin}, æ¯å¸åˆçº¦ä»·å€¼=${contractValuePerCoin}, æ€»ä¿è¯é‡‘=${totalMargin}, æ€»åˆçº¦ä»·å€¼=${totalContractValue}`);
            
            // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿï¼ˆä¿å®ˆæ£€æŸ¥ï¼šéœ€è¦æ€»ä¿è¯é‡‘çš„ 1.2 å€ä½œä¸ºç¼“å†²ï¼‰
            const requiredBalance = parseFloat(totalMargin) * 1.2;
            if (balance < requiredBalance) {
                alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                    `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                    `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                    `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT (10xæ æ†)\n` +
                    `  â€¢ 6ä¸ªå¸æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                    `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `  â€¢ ç¼ºå°‘: ${(requiredBalance - balance).toFixed(2)} USDT\n\n` +
                    `ğŸ’¡ å»ºè®®ï¼š\n` +
                    `  1. é™ä½å¼€ä»“æ¯”ä¾‹ (å½“å‰æ¯å¸${percentPerCoin}%)\n` +
                    `  2. å¢åŠ è´¦æˆ·ä½™é¢\n` +
                    `  3. å‡å°‘å¼€ä»“å¸ç§æ•°é‡`);
                return;
            }
            
            // é¢å¤–æç¤ºï¼šå¦‚æœä½™é¢åˆšå¥½å¤Ÿï¼Œç»™ä¸ªè­¦å‘Š
            if (balance < requiredBalance * 1.5) {
                const warningMsg = `âš ï¸ ä½™é¢åç´§\n\n` +
                    `å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `é¢„è®¡å ç”¨ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `å‰©ä½™: ${(balance - parseFloat(totalMargin)).toFixed(2)} USDT\n\n` +
                    `å»ºè®®å¢åŠ ä½™é¢æˆ–é™ä½å¼€ä»“æ¯”ä¾‹ï¼Œé¿å…å› ä½™é¢ä¸è¶³å¯¼è‡´éƒ¨åˆ†è®¢å•å¤±è´¥ã€‚\n\n` +
                    `æ˜¯å¦ç»§ç»­ï¼Ÿ`;
                if (!confirm(warningMsg)) {
                    console.log('[batchOrder] ç”¨æˆ·å› ä½™é¢ä¸è¶³å–æ¶ˆ');
                    return;
                }
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            const directionText = direction === 'long' ? 'åšå¤š' : 'åšç©º';
            const emoji = direction === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const strategyName = direction === 'long' ? 'å¤šå•' : 'ç©ºå•';
            
            const symbolsList = top6Symbols.map(s => 
                `  â€¢ ${s.name}: $${s.price.toFixed(2)} (${s.change >= 0 ? '+' : ''}${s.change}%)`
            ).join('\n');
            
            const confirmMsg = `${emoji} æ‰¹é‡${strategyName}ç­–ç•¥\n\n` +
                `ã€å¸¸ç”¨å¸æ¶¨å¹…å‰6ã€‘\n${symbolsList}\n\n` +
                `ã€å¼€ä»“å‚æ•°ã€‘\n` +
                `  â€¢ æ–¹å‘: ${directionText}\n` +
                `  â€¢ æ æ†: 10x\n` +
                `  â€¢ è®¢å•ç±»å‹: å¸‚ä»·å•\n\n` +
                `ã€èµ„é‡‘åˆ†é…ã€‘\n` +
                `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT\n` +
                `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                `  â€¢ æ€»åˆçº¦ä»·å€¼: ${totalContractValue} USDT\n` +
                `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n\n` +
                `ç¡®è®¤æ‰¹é‡å¼€ä»“ï¼Ÿ`;
            
            if (!confirm(confirmMsg)) {
                console.log('[batchOrder] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¼€ä»“');
                return;
            }
            
            // å¼€å§‹æ‰¹é‡ä¸‹å•
            console.log('[batchOrder] å¼€å§‹æ‰¹é‡ä¸‹å•...');
            let successCount = 0;
            let failCount = 0;
            const results = [];
            
            for (const symbolData of top6Symbols) {
                try {
                    console.log(`[batchOrder] æ­£åœ¨ä¸‹å•: ${symbolData.name}...`);
                    
                    // æ„å»ºè®¢å•æ•°æ®
                    // szä¼ é€’åˆçº¦ä»·å€¼ï¼Œåç«¯ä¼šæ ¹æ®å½“å‰ä»·æ ¼è®¡ç®—åˆçº¦å¼ æ•°
                    const orderData = {
                        instId: symbolData.symbol,
                        side: direction === 'long' ? 'buy' : 'sell',
                        posSide: direction,
                        ordType: 'market',
                        sz: contractValuePerCoin,  // ä¼ é€’åˆçº¦ä»·å€¼ï¼ˆä¿è¯é‡‘ Ã— 10ï¼‰
                        lever: '10'
                    };
                    
                    // å‘é€è®¢å•è¯·æ±‚
                    const response = await fetch('/api/okx-trading/place-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase,
                            ...orderData
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        results.push(`âœ… ${symbolData.name}: æˆåŠŸ`);
                        console.log(`[batchOrder] ${symbolData.name} ä¸‹å•æˆåŠŸ`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${symbolData.name}: ${result.error || 'å¤±è´¥'}`);
                        console.error(`[batchOrder] ${symbolData.name} ä¸‹å•å¤±è´¥:`, result.error);
                    }
                    
                    // å»¶è¿Ÿ100msï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${symbolData.name}: ${error.message || 'å¼‚å¸¸'}`);
                    console.error(`[batchOrder] ${symbolData.name} ä¸‹å•å¼‚å¸¸:`, error);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultMsg = `${emoji} æ‰¹é‡å¼€ä»“å®Œæˆ\n\n` +
                `ã€ç»“æœç»Ÿè®¡ã€‘\n` +
                `  â€¢ æˆåŠŸ: ${successCount} ä¸ª\n` +
                `  â€¢ å¤±è´¥: ${failCount} ä¸ª\n\n` +
                `ã€è¯¦ç»†ç»“æœã€‘\n${results.join('\n')}`;
            
            alert(resultMsg);
            
            // åˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
            await refreshAccountData();
            await loadPendingOrders();
        }

        // æ‰¹é‡å¼€ä»“ - æ¶¨å¹…å‰8åç­–ç•¥
        async function batchOrderTop8(direction, percentPerCoin) {
            console.log(`[batchOrderTop8] å¼€å§‹æ‰¹é‡å¼€ä»“å‰8: direction=${direction}, percentPerCoin=${percentPerCoin}%`);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å¯ç”¨ä½™é¢
            const balance = account.balance || 0;
            if (balance <= 0) {
                alert('âŒ è´¦æˆ·ä½™é¢ä¸è¶³ï¼');
                return;
            }
            
            // åªä»æ”¶è—çš„å¸ç§ä¸­é€‰æ‹©
            const favoriteSymbolsData = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            
            if (favoriteSymbolsData.length === 0) {
                alert('âŒ è¯·å…ˆæ”¶è—ä¸€äº›å¸¸ç”¨å¸ç§ï¼\n\nåœ¨äº¤æ˜“å¯¹åˆ—è¡¨ä¸­ç‚¹å‡»â­æŒ‰é’®æ·»åŠ æ”¶è—ã€‚');
                return;
            }
            
            console.log('[batchOrderTop8] å¸¸ç”¨å¸ç§æ•°é‡:', favoriteSymbolsData.length);
            
            // ä»å¸¸ç”¨å¸ç§ä¸­æŒ‰æ¶¨è·Œå¹…æ’åºï¼Œè·å–å‰8å
            const sortedSymbols = [...favoriteSymbolsData].sort((a, b) => b.change - a.change);
            const top8Symbols = sortedSymbols.slice(0, 8);
            
            if (top8Symbols.length < 8) {
                alert(`âŒ å¸¸ç”¨å¸ç§ä¸è¶³8ä¸ªï¼\n\nå½“å‰å¸¸ç”¨å¸ç§ï¼š${favoriteSymbolsData.length}ä¸ª\nè¯·è‡³å°‘æ”¶è—8ä¸ªå¸ç§æ‰èƒ½ä½¿ç”¨æ­¤ç­–ç•¥ã€‚`);
                return;
            }
            
            console.log('[batchOrderTop8] å¸¸ç”¨å¸ç§æ¶¨å¹…å‰8:', top8Symbols.map(s => `${s.name} (${s.change}%)`));
            
            // è®¡ç®—æ¯ä¸ªå¸çš„ä¿è¯é‡‘å ç”¨
            const marginPerCoin = (balance * percentPerCoin / 100).toFixed(2);
            const totalMargin = (marginPerCoin * 8).toFixed(2);
            const contractValuePerCoin = (parseFloat(marginPerCoin) * 10).toFixed(2);
            const totalContractValue = (parseFloat(contractValuePerCoin) * 8).toFixed(2);
            
            console.log(`[batchOrderTop8] ä½™é¢æ£€æŸ¥: å¯ç”¨=${balance.toFixed(2)}, æ¯å¸ä¿è¯é‡‘=${marginPerCoin}, æ€»ä¿è¯é‡‘=${totalMargin}`);
            
            // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿ
            const requiredBalance = parseFloat(totalMargin) * 1.2;
            if (balance < requiredBalance) {
                alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                    `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                    `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                    `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT (10xæ æ†)\n` +
                    `  â€¢ 8ä¸ªå¸æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                    `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `  â€¢ ç¼ºå°‘: ${(requiredBalance - balance).toFixed(2)} USDT`);
                return;
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            const directionText = direction === 'long' ? 'åšå¤š' : 'åšç©º';
            const emoji = direction === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const strategyName = direction === 'long' ? 'å¤šå•' : 'ç©ºå•';
            
            const symbolsList = top8Symbols.map(s => 
                `  â€¢ ${s.name}: $${s.price.toFixed(2)} (${s.change >= 0 ? '+' : ''}${s.change}%)`
            ).join('\n');
            
            const confirmMsg = `${emoji} æ¶¨å¹…å‰8æ‰¹é‡${strategyName}ç­–ç•¥\n\n` +
                `ã€å¸¸ç”¨å¸æ¶¨å¹…å‰8ã€‘\n${symbolsList}\n\n` +
                `ã€å¼€ä»“å‚æ•°ã€‘\n` +
                `  â€¢ æ–¹å‘: ${directionText}\n` +
                `  â€¢ æ æ†: 10x\n` +
                `  â€¢ è®¢å•ç±»å‹: å¸‚ä»·å•\n\n` +
                `ã€èµ„é‡‘åˆ†é…ã€‘\n` +
                `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT\n` +
                `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                `  â€¢ æ€»åˆçº¦ä»·å€¼: ${totalContractValue} USDT\n` +
                `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n\n` +
                `ç¡®è®¤æ‰¹é‡å¼€ä»“ï¼Ÿ`;
            
            if (!confirm(confirmMsg)) {
                console.log('[batchOrderTop8] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¼€ä»“');
                return;
            }
            
            // å¼€å§‹æ‰¹é‡ä¸‹å•
            console.log('[batchOrderTop8] å¼€å§‹æ‰¹é‡ä¸‹å•...');
            let successCount = 0;
            let failCount = 0;
            const results = [];
            
            for (const symbolData of top8Symbols) {
                try {
                    console.log(`[batchOrderTop8] æ­£åœ¨ä¸‹å•: ${symbolData.name}...`);
                    
                    const orderData = {
                        instId: symbolData.symbol,
                        side: direction === 'long' ? 'buy' : 'sell',
                        posSide: direction,
                        ordType: 'market',
                        sz: contractValuePerCoin,
                        lever: '10'
                    };
                    
                    const response = await fetch('/api/okx-trading/place-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase,
                            ...orderData
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        results.push(`âœ… ${symbolData.name}: æˆåŠŸ`);
                        console.log(`[batchOrderTop8] ${symbolData.name} ä¸‹å•æˆåŠŸ`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${symbolData.name}: ${result.message || 'å¤±è´¥'}`);
                        console.error(`[batchOrderTop8] ${symbolData.name} ä¸‹å•å¤±è´¥:`, result);
                    }
                    
                    // å»¶è¿Ÿ100msé¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${symbolData.name}: ${error.message}`);
                    console.error(`[batchOrderTop8] ${symbolData.name} å¼‚å¸¸:`, error);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultMsg = `${emoji} æ‰¹é‡å¼€ä»“å®Œæˆ\n\n` +
                `æˆåŠŸ: ${successCount}/${top8Symbols.length}\n` +
                `å¤±è´¥: ${failCount}/${top8Symbols.length}\n\n` +
                `è¯¦ç»†ç»“æœ:\n${results.join('\n')}`;
            
            alert(resultMsg);
            console.log('[batchOrderTop8] æ‰¹é‡å¼€ä»“å®Œæˆ:', { successCount, failCount });
            
            // åˆ·æ–°æ•°æ®
            await refreshAccountData();
        }

        // æ‰¹é‡å¼€ä»“ - æ¶¨å¹…å8åç­–ç•¥
        async function batchOrderBottom8(direction, percentPerCoin) {
            console.log(`[batchOrderBottom8] å¼€å§‹æ‰¹é‡å¼€ä»“å8: direction=${direction}, percentPerCoin=${percentPerCoin}%`);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å¯ç”¨ä½™é¢
            const balance = account.balance || 0;
            if (balance <= 0) {
                alert('âŒ è´¦æˆ·ä½™é¢ä¸è¶³ï¼');
                return;
            }
            
            // åªä»æ”¶è—çš„å¸ç§ä¸­é€‰æ‹©
            const favoriteSymbolsData = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            
            if (favoriteSymbolsData.length === 0) {
                alert('âŒ è¯·å…ˆæ”¶è—ä¸€äº›å¸¸ç”¨å¸ç§ï¼\n\nåœ¨äº¤æ˜“å¯¹åˆ—è¡¨ä¸­ç‚¹å‡»â­æŒ‰é’®æ·»åŠ æ”¶è—ã€‚');
                return;
            }
            
            console.log('[batchOrderBottom8] å¸¸ç”¨å¸ç§æ•°é‡:', favoriteSymbolsData.length);
            
            // ä»å¸¸ç”¨å¸ç§ä¸­æŒ‰æ¶¨è·Œå¹…æ’åºï¼Œè·å–å8åï¼ˆè·Œå¹…æœ€å¤§ï¼‰
            const sortedSymbols = [...favoriteSymbolsData].sort((a, b) => a.change - b.change);
            const bottom8Symbols = sortedSymbols.slice(0, 8);
            
            if (bottom8Symbols.length < 8) {
                alert(`âŒ å¸¸ç”¨å¸ç§ä¸è¶³8ä¸ªï¼\n\nå½“å‰å¸¸ç”¨å¸ç§ï¼š${favoriteSymbolsData.length}ä¸ª\nè¯·è‡³å°‘æ”¶è—8ä¸ªå¸ç§æ‰èƒ½ä½¿ç”¨æ­¤ç­–ç•¥ã€‚`);
                return;
            }
            
            console.log('[batchOrderBottom8] å¸¸ç”¨å¸ç§æ¶¨å¹…å8:', bottom8Symbols.map(s => `${s.name} (${s.change}%)`));
            
            // è®¡ç®—æ¯ä¸ªå¸çš„ä¿è¯é‡‘å ç”¨
            const marginPerCoin = (balance * percentPerCoin / 100).toFixed(2);
            const totalMargin = (marginPerCoin * 8).toFixed(2);
            const contractValuePerCoin = (parseFloat(marginPerCoin) * 10).toFixed(2);
            const totalContractValue = (parseFloat(contractValuePerCoin) * 8).toFixed(2);
            
            console.log(`[batchOrderBottom8] ä½™é¢æ£€æŸ¥: å¯ç”¨=${balance.toFixed(2)}, æ¯å¸ä¿è¯é‡‘=${marginPerCoin}, æ€»ä¿è¯é‡‘=${totalMargin}`);
            
            // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿ
            const requiredBalance = parseFloat(totalMargin) * 1.2;
            if (balance < requiredBalance) {
                alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                    `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                    `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                    `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT (10xæ æ†)\n` +
                    `  â€¢ 8ä¸ªå¸æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                    `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `  â€¢ ç¼ºå°‘: ${(requiredBalance - balance).toFixed(2)} USDT`);
                return;
            }
            
            // é£é™©è­¦å‘Š
            const riskWarning = `âš ï¸ é«˜é£é™©ç­–ç•¥è­¦å‘Š\n\n` +
                `æ­¤ç­–ç•¥é’ˆå¯¹è·Œå¹…æœ€å¤§çš„å¸ç§ï¼Œæ³¢åŠ¨æ€§æé«˜ï¼\n\n` +
                `ã€æ¶¨å¹…å8å = è·Œå¹…æœ€å¤§ã€‘\n` +
                bottom8Symbols.map(s => 
                    `  â€¢ ${s.name}: ${s.change >= 0 ? '+' : ''}${s.change}%`
                ).join('\n') + '\n\n' +
                `âš ï¸ è¿™äº›å¸ç§å¯èƒ½ï¼š\n` +
                `  â€¢ ç»§ç»­ä¸‹è·Œï¼ˆç©ºå•è·åˆ©ï¼‰\n` +
                `  â€¢ è¶…è·Œåå¼¹ï¼ˆå¤šå•è·åˆ©ï¼‰\n` +
                `  â€¢ å‰§çƒˆæ³¢åŠ¨ï¼ˆé«˜é£é™©ï¼‰\n\n` +
                `ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`;
            
            if (!confirm(riskWarning)) {
                console.log('[batchOrderBottom8] ç”¨æˆ·å–æ¶ˆï¼ˆé£é™©è­¦å‘Šï¼‰');
                return;
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            const directionText = direction === 'long' ? 'åšå¤šï¼ˆé¢„æœŸåå¼¹ï¼‰' : 'åšç©ºï¼ˆé¢„æœŸå»¶ç»­ï¼‰';
            const emoji = direction === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const strategyName = direction === 'long' ? 'å¤šå•' : 'ç©ºå•';
            
            const symbolsList = bottom8Symbols.map(s => 
                `  â€¢ ${s.name}: $${s.price.toFixed(2)} (${s.change >= 0 ? '+' : ''}${s.change}%)`
            ).join('\n');
            
            const confirmMsg = `${emoji} æ¶¨å¹…å8æ‰¹é‡${strategyName}ç­–ç•¥\n\n` +
                `ã€å¸¸ç”¨å¸æ¶¨å¹…å8ï¼ˆè·Œå¹…æœ€å¤§ï¼‰ã€‘\n${symbolsList}\n\n` +
                `ã€å¼€ä»“å‚æ•°ã€‘\n` +
                `  â€¢ æ–¹å‘: ${directionText}\n` +
                `  â€¢ æ æ†: 10x\n` +
                `  â€¢ è®¢å•ç±»å‹: å¸‚ä»·å•\n\n` +
                `ã€èµ„é‡‘åˆ†é…ã€‘\n` +
                `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT\n` +
                `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                `  â€¢ æ€»åˆçº¦ä»·å€¼: ${totalContractValue} USDT\n` +
                `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n\n` +
                `âš ï¸ æœ€åç¡®è®¤ï¼šè¿™æ˜¯é«˜é£é™©ç­–ç•¥ï¼`;
            
            if (!confirm(confirmMsg)) {
                console.log('[batchOrderBottom8] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¼€ä»“');
                return;
            }
            
            // å¼€å§‹æ‰¹é‡ä¸‹å•
            console.log('[batchOrderBottom8] å¼€å§‹æ‰¹é‡ä¸‹å•...');
            let successCount = 0;
            let failCount = 0;
            const results = [];
            
            for (const symbolData of bottom8Symbols) {
                try {
                    console.log(`[batchOrderBottom8] æ­£åœ¨ä¸‹å•: ${symbolData.name}...`);
                    
                    const orderData = {
                        instId: symbolData.symbol,
                        side: direction === 'long' ? 'buy' : 'sell',
                        posSide: direction,
                        ordType: 'market',
                        sz: contractValuePerCoin,
                        lever: '10'
                    };
                    
                    const response = await fetch('/api/okx-trading/place-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase,
                            ...orderData
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        results.push(`âœ… ${symbolData.name}: æˆåŠŸ`);
                        console.log(`[batchOrderBottom8] ${symbolData.name} ä¸‹å•æˆåŠŸ`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${symbolData.name}: ${result.message || 'å¤±è´¥'}`);
                        console.error(`[batchOrderBottom8] ${symbolData.name} ä¸‹å•å¤±è´¥:`, result);
                    }
                    
                    // å»¶è¿Ÿ100msé¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${symbolData.name}: ${error.message}`);
                    console.error(`[batchOrderBottom8] ${symbolData.name} å¼‚å¸¸:`, error);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultMsg = `${emoji} æ‰¹é‡å¼€ä»“å®Œæˆ\n\n` +
                `æˆåŠŸ: ${successCount}/${bottom8Symbols.length}\n` +
                `å¤±è´¥: ${failCount}/${bottom8Symbols.length}\n\n` +
                `è¯¦ç»†ç»“æœ:\n${results.join('\n')}`;
            
            alert(resultMsg);
            console.log('[batchOrderBottom8] æ‰¹é‡å¼€ä»“å®Œæˆ:', { successCount, failCount });
            
            // åˆ·æ–°æ•°æ®
            await refreshAccountData();
        }

        // ä¸€é”®å…¨å¹³æ‰€æœ‰è´¦æˆ·çš„æ‰€æœ‰æŒä»“
        async function closeAllAccountsPositions() {
            console.log('[closeAllAccountsPositions] å¼€å§‹ä¸€é”®å…¨å¹³æ‰€æœ‰è´¦æˆ·æŒä»“');
            
            // è·å–æ‰€æœ‰è´¦æˆ·
            if (!accounts || accounts.length === 0) {
                alert('âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è´¦æˆ·ï¼\n\nè¯·å…ˆåœ¨è´¦æˆ·ç®¡ç†ä¸­æ·»åŠ è´¦æˆ·ã€‚');
                return;
            }
            
            // ç­›é€‰å‡ºæœ‰APIå‡­è¯çš„è´¦æˆ·
            const validAccounts = accounts.filter(acc => 
                acc.apiKey && acc.apiSecret && acc.passphrase
            );
            
            if (validAccounts.length === 0) {
                alert('âŒ æ²¡æœ‰é…ç½®å®Œæ•´APIå‡­è¯çš„è´¦æˆ·ï¼\n\nè¯·åœ¨è´¦æˆ·ç®¡ç†ä¸­å®Œå–„è´¦æˆ·çš„APIé…ç½®ï¼š\n- API Key\n- API Secret\n- Passphrase');
                return;
            }
            
            console.log(`[closeAllAccountsPositions] æ‰¾åˆ° ${validAccounts.length} ä¸ªæœ‰æ•ˆè´¦æˆ·`);
            
            // ç›´æ¥æ‰§è¡Œå¹³ä»“ï¼Œä¸éœ€è¦ç¡®è®¤
            console.log('[closeAllAccountsPositions] ç›´æ¥æ‰§è¡Œä¸€é”®å¹³ä»“ï¼Œæ— éœ€ç¡®è®¤');
            
            // æ”¶é›†æ‰€æœ‰è´¦æˆ·çš„æ‰€æœ‰æŒä»“
            let totalPositionsCount = 0;
            let totalSuccess = 0;
            let totalFail = 0;
            const accountResults = [];
            
            for (const account of validAccounts) {
                console.log(`[closeAllAccountsPositions] å¤„ç†è´¦æˆ·: ${account.name || account.id}`);
                
                try {
                    // è·å–è´¦æˆ·æŒä»“
                    const response = await fetch('/api/okx-trading/positions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (!result.success || !result.data) {
                        console.error(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} è·å–æŒä»“å¤±è´¥:`, result.error);
                        accountResults.push({
                            account: account.name || account.id,
                            success: 0,
                            fail: 0,
                            error: result.error || 'è·å–æŒä»“å¤±è´¥'
                        });
                        continue;
                    }
                    
                    const positions = result.data;
                    console.log(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} æœ‰ ${positions.length} ä¸ªæŒä»“`);
                    
                    if (positions.length === 0) {
                        accountResults.push({
                            account: account.name || account.id,
                            success: 0,
                            fail: 0,
                            message: 'æ— æŒä»“'
                        });
                        continue;
                    }
                    
                    totalPositionsCount += positions.length;
                    
                    // é€ä¸ªå¹³ä»“
                    let accountSuccess = 0;
                    let accountFail = 0;
                    
                    for (const position of positions) {
                        try {
                            const coinName = position.instId.replace('-USDT-SWAP', '');
                            console.log(`[closeAllAccountsPositions] å¹³ä»“ ${account.name} - ${coinName} ${position.posSide}...`);
                            
                            const closeResponse = await fetch('/api/okx-trading/close-position', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    apiKey: account.apiKey,
                                    apiSecret: account.apiSecret,
                                    passphrase: account.passphrase,
                                    instId: position.instId,
                                    posSide: position.posSide,
                                    closeSize: position.posSize
                                })
                            });
                            
                            const closeResult = await closeResponse.json();
                            
                            if (closeResult.success) {
                                accountSuccess++;
                                totalSuccess++;
                                console.log(`[closeAllAccountsPositions] âœ… ${coinName} å¹³ä»“æˆåŠŸ`);
                            } else {
                                accountFail++;
                                totalFail++;
                                console.error(`[closeAllAccountsPositions] âŒ ${coinName} å¹³ä»“å¤±è´¥:`, closeResult.error);
                            }
                            
                            // æ·»åŠ å°å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                            await new Promise(resolve => setTimeout(resolve, 200));
                            
                        } catch (error) {
                            accountFail++;
                            totalFail++;
                            console.error(`[closeAllAccountsPositions] å¹³ä»“å¼‚å¸¸:`, error);
                        }
                    }
                    
                    accountResults.push({
                        account: account.name || account.id,
                        success: accountSuccess,
                        fail: accountFail,
                        total: positions.length
                    });
                    
                    // è´¦æˆ·ä¹‹é—´æ·»åŠ 1ç§’å»¶è¿Ÿï¼Œé¿å…APIå†²çª
                    console.log(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} å¤„ç†å®Œæˆï¼Œç­‰å¾…1ç§’åå¤„ç†ä¸‹ä¸€ä¸ªè´¦æˆ·...`);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} å¤„ç†å¼‚å¸¸:`, error);
                    accountResults.push({
                        account: account.name || account.id,
                        success: 0,
                        fail: 0,
                        error: error.message || 'å¤„ç†å¼‚å¸¸'
                    });
                    
                    // å³ä½¿å‡ºé”™ä¹Ÿæ·»åŠ å»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultLines = accountResults.map(r => {
                if (r.error) {
                    return `  âŒ ${r.account}: ${r.error}`;
                } else if (r.message) {
                    return `  âšª ${r.account}: ${r.message}`;
                } else {
                    const emoji = r.fail === 0 ? 'âœ…' : (r.success > 0 ? 'âš ï¸' : 'âŒ');
                    return `  ${emoji} ${r.account}: æˆåŠŸ${r.success}/${r.total}`;
                }
            }).join('\n');
            
            const resultMsg = `ğŸš¨ ä¸€é”®å…¨å¹³å®Œæˆ\n\n` +
                `ã€æ€»è®¡ã€‘\n` +
                `  â€¢ å¤„ç†è´¦æˆ·: ${validAccounts.length} ä¸ª\n` +
                `  â€¢ æ€»æŒä»“æ•°: ${totalPositionsCount} ä¸ª\n` +
                `  â€¢ æˆåŠŸå¹³ä»“: ${totalSuccess} ä¸ª\n` +
                `  â€¢ å¤±è´¥: ${totalFail} ä¸ª\n\n` +
                `ã€å„è´¦æˆ·è¯¦æƒ…ã€‘\n${resultLines}`;
            
            alert(resultMsg);
            
            // åˆ·æ–°å½“å‰è´¦æˆ·æ•°æ®
            await refreshAccountData();
            await loadPendingOrders();
            
            console.log('[closeAllAccountsPositions] ä¸€é”®å…¨å¹³å®Œæˆ');
        }

        // æ‰¹é‡å¹³ä»“å‡½æ•°
        async function batchClosePositions(posSide, ratio) {
            console.log(`========== [batchClosePositions] å¼€å§‹æ‰¹é‡å¹³ä»“ ==========`);
            console.log(`[batchClosePositions] å‚æ•°: posSide=${posSide}, ratio=${ratio}`);
            console.log(`[batchClosePositions] å…¨å±€å˜é‡ currentAccount=${currentAccount}`);
            console.log(`[batchClosePositions] å…¨å±€å˜é‡ accounts=`, accounts);
            console.log(`[batchClosePositions] accounts é•¿åº¦=${accounts.length}`);
            
            // è·å–å½“å‰è´¦æˆ·
            const account = accounts.find(acc => acc.id === currentAccount);
            console.log(`[batchClosePositions] æŸ¥æ‰¾è´¦æˆ·: currentAccount=${currentAccount}`);
            console.log(`[batchClosePositions] æ‰¾åˆ°çš„è´¦æˆ·=`, account);
            
            if (!account) {
                const availableAccounts = accounts.map(a => `${a.name}(${a.id})`).join(', ');
                alert(`âŒ æœªæ‰¾åˆ°è´¦æˆ·ï¼\n\nå½“å‰è´¦æˆ·ID: ${currentAccount}\nå¯ç”¨è´¦æˆ·: ${availableAccounts}\n\nè¯·åœ¨è´¦æˆ·ç®¡ç†ä¸­æ£€æŸ¥è´¦æˆ·é…ç½®ã€‚`);
                console.error(`[batchClosePositions] é”™è¯¯: æœªæ‰¾åˆ°è´¦æˆ· currentAccount=${currentAccount}`);
                return;
            }
            
            console.log(`[batchClosePositions] âœ… æˆåŠŸæ‰¾åˆ°è´¦æˆ·: ${account.name} (${account.id})`);
            console.log(`[batchClosePositions] APIå‡­è¯æ£€æŸ¥: hasApiKey=${!!account.apiKey}, hasApiSecret=${!!account.apiSecret}, hasPassphrase=${!!account.passphrase}`);
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                alert(`âŒ è´¦æˆ· "${account.name || account.id}" æœªé…ç½®APIå‡­è¯ï¼\n\nè¯·åœ¨è´¦æˆ·ç®¡ç†ä¸­å®Œå–„APIé…ç½®ï¼š\n- API Key\n- API Secret\n- Passphrase`);
                console.error(`[batchClosePositions] é”™è¯¯: è´¦æˆ·å‡­è¯ä¸å®Œæ•´`);
                return;
            }
            
            // è·å–å½“å‰æŒä»“
            try {
                console.log(`[batchClosePositions] å‡†å¤‡è°ƒç”¨APIè·å–æŒä»“...`);
                console.log(`[batchClosePositions] APIè¯·æ±‚å‚æ•°:`, {
                    apiKey: account.apiKey.substring(0, 8) + '...',
                    hasApiSecret: !!account.apiSecret,
                    hasPassphrase: !!account.passphrase
                });
                
                const response = await fetch('/api/okx-trading/positions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                console.log(`[batchClosePositions] APIå“åº”çŠ¶æ€: ${response.status}`);
                
                const result = await response.json();
                console.log(`[batchClosePositions] APIå“åº”æ•°æ®:`, result);
                
                if (!result.success || !result.data) {
                    console.error(`[batchClosePositions] APIè¿”å›å¤±è´¥:`, result);
                    alert(`âŒ è·å–æŒä»“å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                    return;
                }
                
                console.log(`[batchClosePositions] è·å–åˆ°æŒä»“æ•°é‡: ${result.data.length}`);
                console.log(`[batchClosePositions] å…¨éƒ¨æŒä»“:`, result.data.map(p => ({
                    instId: p.instId,
                    posSide: p.posSide,
                    posSize: p.posSize
                })));
                
                // ç­›é€‰å‡ºæŒ‡å®šæ–¹å‘çš„æŒä»“
                // æ”¯æŒä¸¤ç§æŒä»“æ¨¡å¼ï¼š
                // 1. åŒå‘æŒä»“æ¨¡å¼ï¼šposSide = 'long' æˆ– 'short'
                // 2. å•å‘æŒä»“æ¨¡å¼ï¼šposSide = 'net'ï¼Œé€šè¿‡posSizeæ­£è´Ÿåˆ¤æ–­æ–¹å‘
                const targetPositions = result.data.filter(pos => {
                    if (pos.posSide === posSide) {
                        // åŒå‘æŒä»“æ¨¡å¼ï¼šç›´æ¥åŒ¹é…posSide
                        return true;
                    } else if (pos.posSide === 'net') {
                        // å•å‘æŒä»“æ¨¡å¼ï¼šé€šè¿‡posSizeæ­£è´Ÿåˆ¤æ–­
                        if (posSide === 'long' && pos.posSize > 0) {
                            return true;  // å¤šå•ï¼šposSize > 0
                        } else if (posSide === 'short' && pos.posSize < 0) {
                            return true;  // ç©ºå•ï¼šposSize < 0
                        }
                    }
                    return false;
                });
                console.log(`[batchClosePositions] ç­›é€‰ posSide=${posSide} åçš„æŒä»“æ•°é‡: ${targetPositions.length}`);
                
                if (targetPositions.length === 0) {
                    const directionText = posSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                    console.warn(`[batchClosePositions] æ²¡æœ‰æ‰¾åˆ°${directionText}æŒä»“`);
                    alert(`âš ï¸ å½“å‰æ²¡æœ‰${directionText}æŒä»“ï¼`);
                    return;
                }
                
                console.log(`[batchClosePositions] æ‰¾åˆ° ${targetPositions.length} ä¸ª${posSide}æŒä»“`);
                
                // æ„å»ºç¡®è®¤ä¿¡æ¯
                const directionText = posSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                const ratioText = ratio === 1 ? 'å…¨éƒ¨' : 'ä¸€åŠ';
                const emoji = posSide === 'long' ? 'ğŸ“‰' : 'ğŸ“ˆ';
                
                const positionsList = targetPositions.map(pos => {
                    // å•å‘æŒä»“æ¨¡å¼ä¸‹ç©ºå•çš„posSizeæ˜¯è´Ÿæ•°ï¼Œéœ€è¦å–ç»å¯¹å€¼
                    const absSize = Math.abs(pos.posSize);
                    const closeSize = ratio === 1 ? absSize : Math.floor(absSize / 2);
                    const unrealizedPnl = pos.unrealizedPnl || 0;
                    const pnlColor = unrealizedPnl >= 0 ? 'ğŸŸ¢' : 'ğŸ”´';
                    return `  ${pnlColor} ${pos.instId.replace('-USDT-SWAP', '')}: ${closeSize}å¼  (ç›ˆäº: ${unrealizedPnl >= 0 ? '+' : ''}${unrealizedPnl.toFixed(2)} USDT)`;
                }).join('\n');
                
                const totalUnrealizedPnl = targetPositions.reduce((sum, pos) => sum + (pos.unrealizedPnl || 0), 0);
                const totalMargin = targetPositions.reduce((sum, pos) => sum + (pos.margin || 0), 0);
                
                const confirmMsg = `${emoji} æ‰¹é‡å¹³${ratioText}${directionText}\n\n` +
                    `ã€æŒä»“åˆ—è¡¨ã€‘\n${positionsList}\n\n` +
                    `ã€ç»Ÿè®¡ä¿¡æ¯ã€‘\n` +
                    `  â€¢ æŒä»“æ•°é‡: ${targetPositions.length} ä¸ª\n` +
                    `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin.toFixed(2)} USDT\n` +
                    `  â€¢ æ€»æµ®åŠ¨ç›ˆäº: ${totalUnrealizedPnl >= 0 ? '+' : ''}${totalUnrealizedPnl.toFixed(2)} USDT\n` +
                    `  â€¢ å¹³ä»“æ¯”ä¾‹: ${ratio === 1 ? '100%' : '50%'}\n\n` +
                    `ç¡®è®¤æ‰¹é‡å¹³ä»“ï¼Ÿ`;
                
                // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                const confirmed = await showConfirmDialog(confirmMsg, 'ğŸ”” æ‰¹é‡å¹³ä»“ç¡®è®¤');
                if (!confirmed) {
                    console.log('[batchClosePositions] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¹³ä»“');
                    return;
                }
                
                // å¼€å§‹æ‰¹é‡å¹³ä»“
                console.log('[batchClosePositions] å¼€å§‹æ‰¹é‡å¹³ä»“...');
                let successCount = 0;
                let failCount = 0;
                const results = [];
                
                for (const position of targetPositions) {
                    try {
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        console.log(`[batchClosePositions] æ­£åœ¨å¹³ä»“: ${coinName}...`);
                        
                        // è®¡ç®—å¹³ä»“æ•°é‡
                        // æ³¨æ„ï¼šå•å‘æŒä»“æ¨¡å¼ä¸‹ï¼Œç©ºå•çš„posSizeæ˜¯è´Ÿæ•°
                        let closeSize = Math.abs(position.posSize);  // å–ç»å¯¹å€¼
                        if (ratio !== 1) {
                            // å¹³ä¸€åŠï¼šå‘ä¸‹å–æ•´
                            closeSize = Math.floor(closeSize / 2);
                            // è‡³å°‘å¹³1å¼ 
                            if (closeSize < 1) {
                                closeSize = 1;
                            }
                        }
                        
                        // è°ƒç”¨å¹³ä»“API
                        const closeResponse = await fetch('/api/okx-trading/close-position', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                apiKey: account.apiKey,
                                apiSecret: account.apiSecret,
                                passphrase: account.passphrase,
                                instId: position.instId,
                                posSide: position.posSide,
                                closeSize: closeSize  // æŒ‡å®šå¹³ä»“æ•°é‡
                            })
                        });
                        
                        const closeResult = await closeResponse.json();
                        
                        if (closeResult.success) {
                            successCount++;
                            const pnl = position.unrealizedPnl || 0;
                            results.push(`âœ… ${coinName}: ${closeSize}å¼  (${pnl >= 0 ? '+' : ''}${pnl.toFixed(2)} USDT)`);
                            console.log(`[batchClosePositions] ${coinName} å¹³ä»“æˆåŠŸ`);
                        } else {
                            failCount++;
                            results.push(`âŒ ${coinName}: ${closeResult.error || 'å¤±è´¥'}`);
                            console.error(`[batchClosePositions] ${coinName} å¹³ä»“å¤±è´¥:`, closeResult.error);
                        }
                        
                        // å»¶è¿Ÿ100msï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        failCount++;
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        results.push(`âŒ ${coinName}: ${error.message || 'å¼‚å¸¸'}`);
                        console.error(`[batchClosePositions] ${coinName} å¹³ä»“å¼‚å¸¸:`, error);
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                const resultMsg = `${emoji} æ‰¹é‡å¹³ä»“å®Œæˆ\n\n` +
                    `ã€ç»“æœç»Ÿè®¡ã€‘\n` +
                    `  â€¢ æˆåŠŸ: ${successCount} ä¸ª\n` +
                    `  â€¢ å¤±è´¥: ${failCount} ä¸ª\n\n` +
                    `ã€è¯¦ç»†ç»“æœã€‘\n${results.join('\n')}`;
                
                alert(resultMsg);
                
                // åˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
                await refreshAccountData();
                
            } catch (error) {
                console.error('[batchClosePositions] æ‰¹é‡å¹³ä»“å¼‚å¸¸:', error);
                alert(`âŒ æ‰¹é‡å¹³ä»“å¼‚å¸¸: ${error.message}`);
            }
        }

        // 1:1å¯¹å†²é…å¯¹å‡½æ•°
        async function hedgePositions(basePosSide) {
            console.log(`[hedgePositions] å¼€å§‹å¯¹å†²é…å¯¹: basePosSide=${basePosSide}`);
            
            // è·å–å½“å‰è´¦æˆ·
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) {
                alert('âŒ è¯·å…ˆé€‰æ‹©è´¦æˆ·ï¼');
                return;
            }
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å½“å‰æŒä»“
            try {
                const response = await fetch('/api/okx-trading/positions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                const result = await response.json();
                
                if (!result.success || !result.data) {
                    alert(`âŒ è·å–æŒä»“å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                    return;
                }
                
                // ç­›é€‰å‡ºæŒ‡å®šæ–¹å‘çš„æŒä»“
                const basePositions = result.data.filter(pos => pos.posSide === basePosSide);
                
                if (basePositions.length === 0) {
                    const directionText = basePosSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                    alert(`âš ï¸ å½“å‰æ²¡æœ‰${directionText}æŒä»“ï¼Œæ— æ³•è¿›è¡Œå¯¹å†²é…å¯¹ï¼`);
                    return;
                }
                
                console.log(`[hedgePositions] æ‰¾åˆ° ${basePositions.length} ä¸ª${basePosSide}æŒä»“`);
                
                // è·å–è´¦æˆ·ä½™é¢
                const balanceResponse = await fetch('/api/okx-trading/account', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                const balanceResult = await balanceResponse.json();
                let availableBalance = 0;
                if (balanceResult.success && balanceResult.data) {
                    availableBalance = parseFloat(balanceResult.data.availBal || 0);
                }
                
                // è®¡ç®—å¯¹å†²æ‰€éœ€çš„æ€»é‡‘é¢ï¼ˆå®é™…å ç”¨ä¿è¯é‡‘ï¼Œ10xæ æ†ï¼‰
                const totalMarginNeeded = basePositions.reduce((sum, pos) => sum + (pos.margin || 0), 0);
                
                // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿï¼ˆç•™20%ç¼“å†²ï¼‰
                const requiredBalance = totalMarginNeeded * 1.2;
                if (availableBalance < requiredBalance) {
                    alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                        `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                        `  â€¢ å¯¹å†²æ‰€éœ€ä¿è¯é‡‘: ${totalMarginNeeded.toFixed(2)} USDT\n` +
                        `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                        `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                        `  â€¢ å¯ç”¨ä½™é¢: ${availableBalance.toFixed(2)} USDT\n` +
                        `  â€¢ ç¼ºå°‘: ${(requiredBalance - availableBalance).toFixed(2)} USDT\n\n` +
                        `ğŸ’¡ å»ºè®®ï¼šå¢åŠ è´¦æˆ·ä½™é¢æˆ–å…ˆå¹³æ‰éƒ¨åˆ†æŒä»“`);
                    return;
                }
                
                // æ„å»ºç¡®è®¤ä¿¡æ¯
                const baseDirectionText = basePosSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                const hedgeDirectionText = basePosSide === 'long' ? 'ç©ºå•' : 'å¤šå•';
                const emoji = basePosSide === 'long' ? 'âš–ï¸' : 'âš–ï¸';
                
                const positionsList = basePositions.map(pos => {
                    const coinName = pos.instId.replace('-USDT-SWAP', '');
                    // è®¡ç®—åˆçº¦ä»·å€¼ï¼ˆå¼ æ•° Ã— æ¯å¼ ä»·å€¼ï¼‰
                    const contractValue = pos.posSize * pos.avgPrice * (pos.instId.includes('BTC') ? 0.01 : pos.instId.includes('ETH') ? 0.1 : 1.0);
                    return `  â€¢ ${coinName}: ${pos.posSize}å¼  â‰ˆ ${contractValue.toFixed(2)} USDT (ä¿è¯é‡‘: ${pos.margin.toFixed(2)} USDT)`;
                }).join('\n');
                
                const totalContractValue = basePositions.reduce((sum, pos) => {
                    const contractValue = pos.posSize * pos.avgPrice * (pos.instId.includes('BTC') ? 0.01 : pos.instId.includes('ETH') ? 0.1 : 1.0);
                    return sum + contractValue;
                }, 0);
                
                const confirmMsg = `${emoji} 1:1å¯¹å†²é…å¯¹\n\n` +
                    `ã€ç°æœ‰${baseDirectionText}æŒä»“ã€‘\n${positionsList}\n\n` +
                    `ã€å¯¹å†²æ–¹æ¡ˆã€‘\n` +
                    `  â€¢ æŒä»“æ•°é‡: ${basePositions.length} ä¸ª\n` +
                    `  â€¢ åˆçº¦æ€»å€¼: ${totalContractValue.toFixed(2)} USDT\n` +
                    `  â€¢ éœ€è¦ä¿è¯é‡‘: ${totalMarginNeeded.toFixed(2)} USDT (10xæ æ†)\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${availableBalance.toFixed(2)} USDT\n\n` +
                    `ã€å¯¹å†²æ“ä½œã€‘\n` +
                    `  å°†å¼€${basePositions.length}ä¸ª${hedgeDirectionText}ï¼Œæ¯ä¸ªå¸ç§å¼€ç­‰é¢å¯¹å†²ä»“ä½\n\n` +
                    `âš ï¸ å¯¹å†²åå°†é”å®šå½“å‰ç›ˆäºï¼ŒåŒå‘æŒä»“ï¼\n\n` +
                    `ç¡®è®¤æ‰§è¡Œå¯¹å†²é…å¯¹ï¼Ÿ`;
                
                if (!confirm(confirmMsg)) {
                    console.log('[hedgePositions] ç”¨æˆ·å–æ¶ˆå¯¹å†²é…å¯¹');
                    return;
                }
                
                // å¼€å§‹æ‰¹é‡å¯¹å†²å¼€ä»“
                console.log('[hedgePositions] å¼€å§‹æ‰¹é‡å¯¹å†²å¼€ä»“...');
                let successCount = 0;
                let failCount = 0;
                const results = [];
                
                // å¯¹å†²æ–¹å‘ï¼šå¤šå•é…ç©ºå•ï¼Œç©ºå•é…å¤šå•
                const hedgeDirection = basePosSide === 'long' ? 'short' : 'long';
                
                for (const position of basePositions) {
                    try {
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        console.log(`[hedgePositions] æ­£åœ¨å¯¹å†²: ${coinName}...`);
                        
                        // è®¡ç®—å¯¹å†²é‡‘é¢ï¼ˆä½¿ç”¨ç›¸åŒçš„ä¿è¯é‡‘ï¼‰
                        const hedgeAmount = position.margin.toFixed(2);
                        
                        // æ„å»ºè®¢å•æ•°æ®
                        const orderData = {
                            instId: position.instId,
                            side: hedgeDirection === 'long' ? 'buy' : 'sell',
                            posSide: hedgeDirection,
                            ordType: 'market',
                            sz: hedgeAmount,  // USDTé‡‘é¢
                            lever: '10'
                        };
                        
                        // å‘é€è®¢å•è¯·æ±‚
                        const orderResponse = await fetch('/api/okx-trading/place-order', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                apiKey: account.apiKey,
                                apiSecret: account.apiSecret,
                                passphrase: account.passphrase,
                                ...orderData
                            })
                        });
                        
                        const orderResult = await orderResponse.json();
                        
                        if (orderResult.success) {
                            successCount++;
                            results.push(`âœ… ${coinName}: ${hedgeAmount} USDT`);
                            console.log(`[hedgePositions] ${coinName} å¯¹å†²æˆåŠŸ`);
                        } else {
                            failCount++;
                            results.push(`âŒ ${coinName}: ${orderResult.error || 'å¤±è´¥'}`);
                            console.error(`[hedgePositions] ${coinName} å¯¹å†²å¤±è´¥:`, orderResult.error);
                        }
                        
                        // å»¶è¿Ÿ100msï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        failCount++;
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        results.push(`âŒ ${coinName}: ${error.message || 'å¼‚å¸¸'}`);
                        console.error(`[hedgePositions] ${coinName} å¯¹å†²å¼‚å¸¸:`, error);
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                const resultMsg = `${emoji} å¯¹å†²é…å¯¹å®Œæˆ\n\n` +
                    `ã€ç»“æœç»Ÿè®¡ã€‘\n` +
                    `  â€¢ æˆåŠŸ: ${successCount} ä¸ª\n` +
                    `  â€¢ å¤±è´¥: ${failCount} ä¸ª\n\n` +
                    `ã€è¯¦ç»†ç»“æœã€‘\n${results.join('\n')}\n\n` +
                    `âœ… å¯¹å†²åæŒä»“ï¼š${baseDirectionText} ${basePositions.length}ä¸ª + ${hedgeDirectionText} ${successCount}ä¸ª`;
                
                alert(resultMsg);
                
                // åˆ·æ–°è´¦æˆ·ä¿¡æ¯ã€æŒä»“å’Œæ—¥å¿—
                await refreshAccountData();
                await loadTradingLogs();
                
            } catch (error) {
                console.error('[hedgePositions] å¯¹å†²é…å¯¹å¼‚å¸¸:', error);
                alert(`âŒ å¯¹å†²é…å¯¹å¼‚å¸¸: ${error.message}`);
            }
        }

        // æäº¤è®¢å•
        // æäº¤è®¢å•
        async function submitOrder(event) {
            event.preventDefault();
            
            const amount = document.getElementById('orderAmount').value;
            const priceType = document.getElementById('priceType').value;
            
            if (!amount || parseFloat(amount) <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ˜“æ•°é‡');
                return;
            }
            
            const symbolData = symbols.find(s => s.symbol === currentSymbol);
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // æ„å»ºè®¢å•æ•°æ®
            const orderData = {
                instId: currentSymbol,  // äº¤æ˜“å¯¹
                side: currentDirection === 'long' ? 'buy' : 'sell',  // buy/sell
                posSide: currentDirection,  // long/short
                ordType: priceType,  // market/limit
                sz: parseFloat(amount),  // æ•°é‡ï¼ˆUSDTï¼‰
                lever: currentLeverage  // æ æ†å€æ•°
            };
            
            // é™ä»·å•éœ€è¦ä»·æ ¼
            if (priceType === 'limit') {
                orderData.px = symbolData.price;
            }
            
            console.log('å‡†å¤‡æäº¤è®¢å•:', orderData);
            
            const confirmMsg = `ç¡®è®¤${currentDirection === 'long' ? 'åšå¤š' : 'åšç©º'} ${symbolData.name}ï¼Ÿ
äº¤æ˜“å¯¹: ${currentSymbol}
å¼€ä»“é‡‘é¢: ${amount} USDT
æ æ†: ${currentLeverage}x
å ç”¨ä¿è¯é‡‘: ${(parseFloat(amount) / currentLeverage).toFixed(2)} USDT
${priceType === 'limit' ? 'ä»·æ ¼: ' + symbolData.price : 'å¸‚ä»·å•'}

âš ï¸ è¿™å°†åœ¨OKXçœŸå®ä¸‹å•ï¼Œè¯·ç¡®è®¤æ— è¯¯ï¼`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            try {
                // è°ƒç”¨çœŸå®ä¸‹å•API
                const response = await fetch('/api/okx-trading/place-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        ...orderData
                    })
                });
                
                const result = await response.json();
                console.log('ä¸‹å•å“åº”:', result);
                
                if (result.success) {
                    const data = result.data;
                    alert(`âœ… è®¢å•æäº¤æˆåŠŸï¼

è®¢å•ID: ${data.ordId || ''}
åˆçº¦å¼ æ•°: ${data.contracts || ''} å¼ 
å¼€ä»“é‡‘é¢: ${data.inputUsdt} USDT
å ç”¨ä¿è¯é‡‘: ${data.actualUsdt || (data.inputUsdt / data.leverage).toFixed(2)} USDT
æ æ†å€æ•°: ${data.leverage || currentLeverage}x
å½“å‰ä»·æ ¼: ${data.price || ''}

${data.sMsg || result.message || ''}`);
                    
                    // ä¸‹å•æˆåŠŸååˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
                    await refreshAccountData();
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    document.getElementById('orderAmount').value = '';
                } else {
                    alert(`âŒ ä¸‹å•å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}
é”™è¯¯ä»£ç : ${result.code || ''}`);
                }
            } catch (error) {
                console.error('ä¸‹å•å¼‚å¸¸:', error);
                alert(`âŒ ä¸‹å•å¼‚å¸¸: ${error.message || error}`);
            }
        }

        // åŠ è½½è´¦æˆ·æ•°æ®
        function loadAccountData() {
            // è¿™é‡Œåº”è¯¥ä»APIåŠ è½½çœŸå®æ•°æ®
            console.log('åŠ è½½è´¦æˆ·æ•°æ®...');
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            console.log('åˆ·æ–°æ•°æ®...');
            loadAccountData();
        }

        // æœç´¢äº¤æ˜“å¯¹
        document.getElementById('symbolSearch').addEventListener('input', function(e) {
            const search = e.target.value.toLowerCase();
            document.querySelectorAll('.symbol-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'block' : 'none';
            });
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>

    <!-- è´¦æˆ·ç®¡ç†å¯¹è¯æ¡† -->
    <div class="modal" id="accountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ è´¦æˆ·ç®¡ç†</h2>
                <button class="btn-close" onclick="closeAccountModal()">Ã—</button>
            </div>
            
            <div class="account-list" id="accountList">
                <!-- è´¦æˆ·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>

            <button class="btn-add-account" onclick="showAddAccountForm()">
                â• æ·»åŠ æ–°è´¦æˆ·
            </button>
            
            <!-- å¿«é€Ÿé…ç½®POITè´¦æˆ·æŒ‰é’® -->
            <button class="btn-add-account" onclick="quickAddPoitAccount()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); margin-top: 10px;">
                âš¡ å¿«é€Ÿé…ç½®POITå­è´¦æˆ·
            </button>

            <!-- æ·»åŠ /ç¼–è¾‘è´¦æˆ·è¡¨å• -->
            <div class="account-form" id="accountForm" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #2d3748;" id="formTitle">æ·»åŠ è´¦æˆ·</h3>
                <form onsubmit="saveAccount(event)">
                    <input type="hidden" id="editAccountId">
                    <div class="form-group">
                        <label for="accountName">è´¦æˆ·åç§°</label>
                        <input type="text" id="accountName" required placeholder="ä¾‹å¦‚ï¼šä¸»è´¦æˆ·ã€å­è´¦æˆ·1">
                    </div>
                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="text" id="apiKey" placeholder="è¾“å…¥OKX API Key">
                    </div>
                    <div class="form-group">
                        <label for="apiSecret">API Secret</label>
                        <input type="password" id="apiSecret" placeholder="è¾“å…¥OKX API Secret">
                    </div>
                    <div class="form-group">
                        <label for="passphrase">Passphrase</label>
                        <input type="password" id="passphrase" placeholder="è¾“å…¥OKX Passphrase">
                    </div>
                    <div class="form-group">
                        <label for="accountBalance">è´¦æˆ·ä½™é¢ (USDT) <small style="color: #888;">[å¯é€‰ï¼Œé…ç½®APIåè‡ªåŠ¨è·å–]</small></label>
                        <input type="number" id="accountBalance" placeholder="é…ç½®APIå‡­è¯åå°†è‡ªåŠ¨è·å–ä½™é¢" step="0.01" min="0" style="background-color: #f7fafc;">
                        <small style="color: #888; display: block; margin-top: 5px;">
                            ğŸ’¡ æç¤ºï¼šå¡«å†™API Keyã€Secretå’ŒPassphraseåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»OKXè·å–æœ€æ–°ä½™é¢
                        </small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="hideAccountForm()">å–æ¶ˆ</button>
                        <button type="submit" class="btn-primary">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="modal" id="confirmDialog">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="border-bottom: none; padding-bottom: 10px;">
                <h2 id="confirmDialogTitle" style="font-size: 18px;">âš ï¸ ç¡®è®¤æ“ä½œ</h2>
            </div>
            <div id="confirmDialogMessage" style="white-space: pre-wrap; line-height: 1.8; color: #2d3748; margin: 20px 0; font-size: 14px;">
                <!-- æ¶ˆæ¯å†…å®¹ -->
            </div>
            <div class="form-actions" style="margin-top: 25px; gap: 10px;">
                <button type="button" class="btn-secondary" onclick="closeConfirmDialog(false)" style="flex: 1;">å–æ¶ˆ</button>
                <button type="button" class="btn-primary" onclick="closeConfirmDialog(true)" style="flex: 1;">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('confirmDialog').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfirmDialog(false);
            }
        });
        
        // æ‰“å¼€è´¦æˆ·ç®¡ç†å¯¹è¯æ¡†
        function openAccountModal() {
            document.getElementById('accountModal').classList.add('active');
            renderAccountList();
        }

        // å…³é—­è´¦æˆ·ç®¡ç†å¯¹è¯æ¡†
        function closeAccountModal() {
            document.getElementById('accountModal').classList.remove('active');
            hideAccountForm();
        }

        // åˆ·æ–°è´¦æˆ·ä½™é¢
        async function refreshAccountBalance(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) {
                alert('è´¦æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯¥è´¦æˆ·æœªé…ç½®APIå‡­è¯ï¼Œæ— æ³•è‡ªåŠ¨è·å–ä½™é¢ï¼');
                return;
            }
            
            const balance = await fetchAccountBalance(account.apiKey, account.apiSecret, account.passphrase);
            
            if (balance > 0) {
                account.balance = balance;
                localStorage.setItem('okx_accounts', JSON.stringify(accounts));
                renderAccountList();
                renderAccountTabs();
                
                // å¦‚æœæ˜¯å½“å‰è´¦æˆ·ï¼Œæ›´æ–°ä½™é¢æ˜¾ç¤º
                if (accountId === currentAccount) {
                    updateAccountBalance();
                }
                
                alert(`ä½™é¢åˆ·æ–°æˆåŠŸï¼å½“å‰ä½™é¢: ${balance.toFixed(2)} USDT`);
            } else {
                alert('è·å–ä½™é¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIå‡­è¯æ˜¯å¦æ­£ç¡®ï¼');
            }
        }

        // æ¸²æŸ“è´¦æˆ·åˆ—è¡¨
        function renderAccountList() {
            const accountList = document.getElementById('accountList');
            accountList.innerHTML = accounts.map((account, index) => {
                const hasApi = account.apiKey && account.apiSecret && account.passphrase;
                const apiStatus = hasApi ? 
                    '<span style="color: #10b981; font-size: 12px;">âœ“ APIå·²é…ç½®</span>' : 
                    '<span style="color: #ef4444; font-size: 12px;">âœ— APIæœªé…ç½®</span>';
                return `
                <div class="account-item">
                    <div class="account-item-info">
                        <div class="account-item-name">${account.name}</div>
                        <div class="account-item-balance">${account.balance.toFixed(2)} USDT</div>
                        <div style="margin-top: 4px;">${apiStatus}</div>
                    </div>
                    <div class="account-item-actions">
                        ${hasApi ? `<button class="btn-small" onclick="refreshAccountBalance('${account.id}')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); margin-bottom: 5px;">ğŸ”„ åˆ·æ–°ä½™é¢</button>` : ''}
                        <button class="btn-small btn-edit" onclick="editAccount('${account.id}')">ç¼–è¾‘</button>
                        ${accounts.length > 1 ? `<button class="btn-small btn-delete" onclick="deleteAccount('${account.id}')">åˆ é™¤</button>` : ''}
                    </div>
                </div>
            `}).join('');
        }

        // æ˜¾ç¤ºæ·»åŠ è´¦æˆ·è¡¨å•
        function showAddAccountForm() {
            document.getElementById('formTitle').textContent = 'æ·»åŠ è´¦æˆ·';
            document.getElementById('editAccountId').value = '';
            document.getElementById('accountName').value = '';
            document.getElementById('apiKey').value = '';
            document.getElementById('apiSecret').value = '';
            document.getElementById('passphrase').value = '';
            document.getElementById('accountBalance').value = '';
            document.getElementById('accountForm').style.display = 'block';
        }

        // éšè—è´¦æˆ·è¡¨å•
        function hideAccountForm() {
            document.getElementById('accountForm').style.display = 'none';
        }

        // ç¼–è¾‘è´¦æˆ·
        function editAccount(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) return;

            document.getElementById('formTitle').textContent = 'ç¼–è¾‘è´¦æˆ·';
            document.getElementById('editAccountId').value = accountId;
            document.getElementById('accountName').value = account.name;
            document.getElementById('apiKey').value = account.apiKey || '';
            document.getElementById('apiSecret').value = account.apiSecret || '';
            document.getElementById('passphrase').value = account.passphrase || '';
            document.getElementById('accountBalance').value = account.balance;
            document.getElementById('accountForm').style.display = 'block';
        }

        // åˆ é™¤è´¦æˆ·
        function deleteAccount(accountId) {
            if (accounts.length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªè´¦æˆ·ï¼');
                return;
            }

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦æˆ·å—ï¼Ÿ')) return;

            accounts = accounts.filter(a => a.id !== accountId);
            
            // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰è´¦æˆ·ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªè´¦æˆ·
            if (currentAccount === accountId) {
                currentAccount = accounts[0].id;
                selectAccount(currentAccount);
            }

            localStorage.setItem('okx_accounts', JSON.stringify(accounts));
            renderAccountList();
            renderAccountTabs();
        }

        // ä»APIè·å–è´¦æˆ·ä½™é¢
        async function fetchAccountBalance(apiKey, apiSecret, passphrase) {
            try {
                const response = await fetch('/api/okx-trading/account-balance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        passphrase: passphrase
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    return result.balance;
                } else {
                    console.error('è·å–ä½™é¢å¤±è´¥:', result.error);
                    return 0;
                }
            } catch (error) {
                console.error('è·å–ä½™é¢å¼‚å¸¸:', error);
                return 0;
            }
        }

        // ä¿å­˜è´¦æˆ·
        async function saveAccount(event) {
            event.preventDefault();

            const accountId = document.getElementById('editAccountId').value;
            const name = document.getElementById('accountName').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiSecret = document.getElementById('apiSecret').value.trim();
            const passphrase = document.getElementById('passphrase').value.trim();

            if (!name) {
                alert('è¯·å¡«å†™è´¦æˆ·åç§°ï¼');
                return;
            }

            // å¦‚æœæä¾›äº†APIå‡­è¯ï¼Œè‡ªåŠ¨è·å–ä½™é¢
            let balance = 0;
            if (apiKey && apiSecret && passphrase) {
                // æ˜¾ç¤ºåŠ è½½æç¤º
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'æ­£åœ¨è·å–ä½™é¢...';
                submitBtn.disabled = true;
                
                balance = await fetchAccountBalance(apiKey, apiSecret, passphrase);
                
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                
                if (balance === 0) {
                    const confirm = window.confirm('æ— æ³•è·å–è´¦æˆ·ä½™é¢ï¼Œå¯èƒ½æ˜¯APIå‡­è¯é”™è¯¯ã€‚æ˜¯å¦ç»§ç»­ä¿å­˜ï¼Ÿ');
                    if (!confirm) {
                        return;
                    }
                }
            } else {
                // å¦‚æœæ²¡æœ‰APIå‡­è¯ï¼Œä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„ä½™é¢ï¼ˆå¦‚æœæœ‰ï¼‰
                const balanceInput = document.getElementById('accountBalance');
                if (balanceInput && balanceInput.value) {
                    balance = parseFloat(balanceInput.value);
                }
            }

            if (accountId) {
                // ç¼–è¾‘ç°æœ‰è´¦æˆ·
                const account = accounts.find(a => a.id === accountId);
                if (account) {
                    account.name = name;
                    account.apiKey = apiKey;
                    account.apiSecret = apiSecret;
                    account.passphrase = passphrase;
                    account.balance = balance;
                }
            } else {
                // æ·»åŠ æ–°è´¦æˆ·
                const newId = 'account_' + Date.now();
                accounts.push({
                    id: newId,
                    name: name,
                    apiKey: apiKey,
                    apiSecret: apiSecret,
                    passphrase: passphrase,
                    balance: balance
                });
            }

            localStorage.setItem('okx_accounts', JSON.stringify(accounts));
            renderAccountList();
            renderAccountTabs();
            hideAccountForm();
            
            // å¦‚æœç¼–è¾‘çš„æ˜¯å½“å‰è´¦æˆ·ï¼Œæ›´æ–°ä½™é¢æ˜¾ç¤º
            if (accountId === currentAccount) {
                updateAccountBalance();
            }
            
            alert(`è´¦æˆ·ä¿å­˜æˆåŠŸï¼${balance > 0 ? `å½“å‰ä½™é¢: ${balance.toFixed(2)} USDT` : 'æœªè·å–åˆ°ä½™é¢'}`);
        }

        // å¿«é€Ÿé…ç½®POITå­è´¦æˆ·
        async function quickAddPoitAccount() {
            const confirmed = confirm('ç¡®è®¤è¦å¿«é€Ÿé…ç½®POITå­è´¦æˆ·å—ï¼Ÿ\n\nè´¦æˆ·ä¿¡æ¯ï¼š\n- è´¦æˆ·åç§°: POIT (å­è´¦æˆ·)\n- API Key: 8650e46c-***\n- ç³»ç»Ÿå°†è‡ªåŠ¨ä»OKXè·å–è´¦æˆ·ä½™é¢');
            
            if (!confirmed) return;
            
            // POITè´¦æˆ·é…ç½®
            const poitAccount = {
                id: 'account_poit_' + Date.now(),
                name: 'POIT (å­è´¦æˆ·)',
                apiKey: '8650e46c-059b-431d-93cf-55f8c79babdb',
                apiSecret: '4C2BD2AC6A08615EA7F36A6251857FCE',
                passphrase: 'Wu666666.',
                balance: 0
            };
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const existingIndex = accounts.findIndex(acc => 
                acc.apiKey === poitAccount.apiKey || acc.name === poitAccount.name
            );
            
            if (existingIndex > -1) {
                const update = confirm('æ£€æµ‹åˆ°åŒåæˆ–ç›¸åŒAPI Keyçš„è´¦æˆ·ï¼Œæ˜¯å¦æ›´æ–°ï¼Ÿ');
                if (!update) return;
                
                accounts[existingIndex] = poitAccount;
                console.log('âœ… POITè´¦æˆ·å·²æ›´æ–°');
            } else {
                accounts.push(poitAccount);
                console.log('âœ… POITè´¦æˆ·å·²æ·»åŠ ');
            }
            
            // è·å–è´¦æˆ·ä½™é¢
            alert('æ­£åœ¨ä»OKXè·å–è´¦æˆ·ä½™é¢ï¼Œè¯·ç¨å€™...');
            const balance = await fetchAccountBalance(
                poitAccount.apiKey,
                poitAccount.apiSecret,
                poitAccount.passphrase
            );
            
            if (balance > 0) {
                poitAccount.balance = balance;
                alert(`âœ… POITå­è´¦æˆ·é…ç½®æˆåŠŸï¼\n\nè´¦æˆ·ä½™é¢: ${balance.toFixed(2)} USDT`);
            } else {
                alert('âš ï¸ POITå­è´¦æˆ·å·²æ·»åŠ ï¼Œä½†æ— æ³•è·å–ä½™é¢ã€‚\nè¯·æ£€æŸ¥APIæƒé™è®¾ç½®ã€‚\n\nè´¦æˆ·å·²ä¿å­˜ï¼Œæ‚¨å¯ä»¥ç¨åæ‰‹åŠ¨åˆ·æ–°ä½™é¢ã€‚');
            }
            
            // ä¿å­˜å¹¶åˆ·æ–°
            localStorage.setItem('okx_accounts', JSON.stringify(accounts));
            renderAccountList();
            renderAccountTabs();
            
            // åˆ‡æ¢åˆ°POITè´¦æˆ·
            if (existingIndex > -1) {
                selectAccount(accounts[existingIndex].id);
            } else {
                selectAccount(accounts[accounts.length - 1].id);
            }
            
            // å…³é—­å¯¹è¯æ¡†
            closeAccountModal();
        }
        
        // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('accountModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAccountModal();
            }
        });

        // ==================== é¢„è­¦åŠŸèƒ½ ====================
        
        // åŠ è½½é¢„è­¦è®¾ç½®
        async function loadAlertSettingsOKX() {
            try {
                const response = await fetch('/api/coin-tracker/alert-settings');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.settings) {
                        const settings = result.settings;
                        
                        // æ›´æ–°UI
                        document.getElementById('upperThreshold').value = settings.upperThreshold || 30;
                        document.getElementById('lowerThreshold').value = settings.lowerThreshold || -40;
                        document.getElementById('upperAlertSwitch').checked = settings.upperEnabled || false;
                        document.getElementById('lowerAlertSwitch').checked = settings.lowerEnabled || false;
                        
                        console.log('âœ… OKXé¡µé¢ï¼šé¢„è­¦è®¾ç½®å·²åŠ è½½', settings);
                    }
                }
            } catch (e) {
                console.warn('âš ï¸ OKXé¡µé¢ï¼šåŠ è½½é¢„è­¦è®¾ç½®å¤±è´¥', e);
            }
        }
        
        // ä¿å­˜é¢„è­¦è®¾ç½®
        async function saveAlertSettingsOKX() {
            try {
                const settings = {
                    upperThreshold: parseFloat(document.getElementById('upperThreshold').value),
                    lowerThreshold: parseFloat(document.getElementById('lowerThreshold').value),
                    upperEnabled: document.getElementById('upperAlertSwitch').checked,
                    lowerEnabled: document.getElementById('lowerAlertSwitch').checked,
                    tgEnabled: false, // OKXé¡µé¢é»˜è®¤ä¸å¯ç”¨TGé€šçŸ¥
                    upperTriggered: false,
                    lowerTriggered: false,
                    lastCheckTime: null
                };
                
                const response = await fetch('/api/coin-tracker/alert-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert('âœ… é¢„è­¦è®¾ç½®å·²ä¿å­˜ï¼');
                        console.log('âœ… OKXé¡µé¢ï¼šé¢„è­¦è®¾ç½®å·²ä¿å­˜', settings);
                    }
                }
            } catch (e) {
                console.error('âŒ OKXé¡µé¢ï¼šä¿å­˜é¢„è­¦è®¾ç½®å¤±è´¥', e);
                alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // æ›´æ–°æœåŠ¡å™¨é˜ˆå€¼æ˜¾ç¤º
        function updateServerThresholdDisplay(settings) {
            // æ›´æ–°æ­¢ç›ˆé˜ˆå€¼æ˜¾ç¤º
            const takeProfitThreshold = settings.takeProfitThreshold || 50;
            const takeProfitEnabled = settings.takeProfitEnabled || false;
            document.getElementById('serverTakeProfitThreshold').textContent = 
                (takeProfitThreshold >= 0 ? '+' : '') + takeProfitThreshold + ' USDT';
            document.getElementById('takeProfitStatus').textContent = 
                takeProfitEnabled ? 'âœ… å·²å¯ç”¨' : 'âšª æœªå¯ç”¨';
            document.getElementById('takeProfitStatus').style.color = 
                takeProfitEnabled ? '#166534' : '#6b7280';
            
            // æ›´æ–°æ­¢æŸé˜ˆå€¼æ˜¾ç¤º
            const stopLossThreshold = settings.stopLossThreshold || -30;
            const stopLossEnabled = settings.stopLossEnabled || false;
            document.getElementById('serverStopLossThreshold').textContent = 
                stopLossThreshold + ' USDT';
            document.getElementById('stopLossStatus').textContent = 
                stopLossEnabled ? 'âœ… å·²å¯ç”¨' : 'âšª æœªå¯ç”¨';
            document.getElementById('stopLossStatus').style.color = 
                stopLossEnabled ? '#991b1b' : '#6b7280';
        }
        
        // åŠ è½½æ­¢ç›ˆæ­¢æŸè®¾ç½®ï¼ˆä» localStorageï¼ŒæŒ‰è´¦æˆ·å­˜å‚¨ï¼‰
        // åŠ è½½æ­¢ç›ˆæ­¢æŸè®¾ç½®ï¼ˆä»æœåŠ¡å™¨APIï¼ŒæŒ‰è´¦æˆ·ç‹¬ç«‹å­˜å‚¨ï¼‰
        async function loadTakeProfitStopLossSettings() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) return;
            
            try {
                const response = await fetch(`/api/okx-trading/tpsl-settings/${account.id}`);
                const result = await response.json();
                
                if (result.success && result.settings) {
                    const settings = result.settings;
                    document.getElementById('takeProfitThreshold').value = settings.takeProfitThreshold || 50;
                    document.getElementById('stopLossThreshold').value = settings.stopLossThreshold || -30;
                    document.getElementById('takeProfitSwitch').checked = settings.takeProfitEnabled || false;
                    document.getElementById('stopLossSwitch').checked = settings.stopLossEnabled || false;
                    
                    // æ›´æ–°æœåŠ¡å™¨é˜ˆå€¼æ˜¾ç¤º
                    updateServerThresholdDisplay(settings);
                    
                    console.log(`âœ… å·²ä»æœåŠ¡å™¨åŠ è½½è´¦æˆ· ${account.name} çš„æ­¢ç›ˆæ­¢æŸè®¾ç½®`, settings);
                } else {
                    console.warn('âš ï¸ åŠ è½½æ­¢ç›ˆæ­¢æŸè®¾ç½®å¤±è´¥:', result.error);
                }
            } catch (e) {
                console.warn('âš ï¸ åŠ è½½æ­¢ç›ˆæ­¢æŸè®¾ç½®å¼‚å¸¸', e);
            }
        }
        
        // ä¿å­˜æ­¢ç›ˆæ­¢æŸè®¾ç½®ï¼ˆåˆ°æœåŠ¡å™¨APIå’ŒJSONLæ–‡ä»¶ï¼ŒæŒ‰è´¦æˆ·ç‹¬ç«‹å­˜å‚¨ï¼‰
        async function saveTakeProfitStopLossSettings() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) {
                alert('âš ï¸ è¯·å…ˆé€‰æ‹©è´¦æˆ·');
                return;
            }
            
            const settings = {
                takeProfitThreshold: parseFloat(document.getElementById('takeProfitThreshold').value),
                stopLossThreshold: parseFloat(document.getElementById('stopLossThreshold').value),
                takeProfitEnabled: document.getElementById('takeProfitSwitch').checked,
                stopLossEnabled: document.getElementById('stopLossSwitch').checked
            };
            
            try {
                const response = await fetch(`/api/okx-trading/tpsl-settings/${account.id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`âœ… è´¦æˆ·ã€Œ${account.name}ã€çš„æ­¢ç›ˆæ­¢æŸè®¾ç½®å·²ä¿å­˜åˆ°æœåŠ¡å™¨ï¼`);
                    console.log(`âœ… å·²ä¿å­˜è´¦æˆ· ${account.name} çš„æ­¢ç›ˆæ­¢æŸè®¾ç½®åˆ°æœåŠ¡å™¨`, settings);
                    
                    // æ›´æ–°æœåŠ¡å™¨é˜ˆå€¼æ˜¾ç¤º
                    updateServerThresholdDisplay(settings);
                } else {
                    alert(`âŒ ä¿å­˜å¤±è´¥ï¼š${result.error}`);
                    console.error('âŒ ä¿å­˜æ­¢ç›ˆæ­¢æŸè®¾ç½®å¤±è´¥:', result.error);
                }
            } catch (e) {
                alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                console.error('âŒ ä¿å­˜æ­¢ç›ˆæ­¢æŸè®¾ç½®å¼‚å¸¸', e);
            }
        }
        
        // åŠ è½½è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®ï¼ˆä»æœåŠ¡å™¨APIï¼ŒæŒ‰è´¦æˆ·ç‹¬ç«‹å­˜å‚¨ï¼‰
        async function loadAutoStrategySettings() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) return;
            
            try {
                const response = await fetch(`/api/okx-trading/auto-strategy/${account.id}`);
                const result = await response.json();
                
                if (result.success && result.settings) {
                    const settings = result.settings;
                    document.getElementById('autoTriggerPrice').value = settings.triggerPrice || 65000;
                    document.getElementById('autoTradeSwitch').checked = settings.enabled || false;
                    
                    // åŠ è½½ç­–ç•¥ç±»å‹
                    const strategyTypeEl = document.getElementById('autoStrategyType');
                    if (strategyTypeEl) {
                        strategyTypeEl.value = settings.strategyType || 'bottom_performers';
                        // æ›´æ–°ç­–ç•¥æè¿°
                        const strategyTarget = document.getElementById('strategyTarget');
                        if (strategyTarget) {
                            strategyTarget.textContent = settings.strategyType === 'top_performers' ? 'æ¶¨å¹…å‰8å' : 'æ¶¨å¹…å8å';
                        }
                    }
                    
                    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                    updateAutoTradeStatus(settings.enabled, settings.lastExecutedTime);
                    
                    // æ›´æ–°æœåŠ¡å™¨è®¾ç½®æ˜¾ç¤º
                    updateServerAutoTradeDisplay(settings);
                    
                    // åŠ è½½å¹¶æ˜¾ç¤ºå½“å‰BTCä»·æ ¼
                    const btcPrice = await getBTCPrice();
                    if (btcPrice) {
                        const priceEl = document.getElementById('currentBtcPrice');
                        if (priceEl) {
                            priceEl.textContent = `$${btcPrice.toFixed(2)}`;
                            priceEl.style.color = btcPrice < settings.triggerPrice ? '#ef4444' : '#10b981';
                        }
                    }
                    
                    console.log(`âœ… å·²ä»æœåŠ¡å™¨åŠ è½½è´¦æˆ· ${account.name} çš„è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®`, settings);
                } else {
                    console.warn('âš ï¸ åŠ è½½è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®å¤±è´¥:', result.error);
                }
            } catch (e) {
                console.warn('âš ï¸ åŠ è½½è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®å¼‚å¸¸', e);
            }
        }
        
        // ä¿å­˜è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®ï¼ˆåˆ°æœåŠ¡å™¨APIå’ŒJSONLæ–‡ä»¶ï¼ŒæŒ‰è´¦æˆ·ç‹¬ç«‹å­˜å‚¨ï¼‰
        async function saveAutoStrategySettings() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) {
                alert('âš ï¸ è¯·å…ˆé€‰æ‹©è´¦æˆ·');
                return;
            }
            
            // è¯»å–å½“å‰è®¾ç½®
            const currentSettings = await loadAutoStrategySettingsData();
            
            const settings = {
                enabled: document.getElementById('autoTradeSwitch').checked,
                triggerPrice: parseFloat(document.getElementById('autoTriggerPrice').value),
                strategyType: document.getElementById('autoStrategyType').value,
                lastExecutedTime: currentSettings?.lastExecutedTime || null,
                executedCount: currentSettings?.executedCount || 0
            };
            
            try {
                const response = await fetch(`/api/okx-trading/auto-strategy/${account.id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log(`âœ… å·²ä¿å­˜è´¦æˆ· ${account.name} çš„è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®åˆ°æœåŠ¡å™¨`, settings);
                    
                    // âš ï¸ å¦‚æœå¼€å…³è¢«æ‰“å¼€ï¼Œå†™å…¥JSONLè®¾ç½®allowed=true
                    if (settings.enabled) {
                        console.log('ğŸ“ ç”¨æˆ·å¼€å¯ç­–ç•¥ï¼Œå†™å…¥JSONLï¼šè®¾ç½®allowed=true');
                        await fetch(`/api/okx-trading/set-allowed/${account.id}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: true,
                                reason: 'User enabled strategy',
                                triggerPrice: settings.triggerPrice,
                                strategyType: settings.strategyType
                            })
                        });
                    }
                    
                    updateAutoTradeStatus(settings.enabled, settings.lastExecutedTime);
                    
                    // æ›´æ–°æœåŠ¡å™¨è®¾ç½®æ˜¾ç¤º
                    updateServerAutoTradeDisplay(settings);
                } else {
                    alert(`âŒ ä¿å­˜å¤±è´¥ï¼š${result.error}`);
                    console.error('âŒ ä¿å­˜è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®å¤±è´¥:', result.error);
                }
            } catch (e) {
                alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                console.error('âŒ ä¿å­˜è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®å¼‚å¸¸', e);
            }
        }
        
        // ä»…ç”¨äºè¯»å–æ•°æ®ï¼Œä¸æ›´æ–°UI
        async function loadAutoStrategySettingsData() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) return null;
            
            try {
                const response = await fetch(`/api/okx-trading/auto-strategy/${account.id}`);
                const result = await response.json();
                if (result.success && result.settings) {
                    return result.settings;
                }
            } catch (e) {
                console.error('è¯»å–è®¾ç½®æ•°æ®å¤±è´¥:', e);
            }
            return null;
        }
        
        // æ›´æ–°è‡ªåŠ¨äº¤æ˜“çŠ¶æ€æ˜¾ç¤º
        function updateAutoTradeStatus(enabled, lastExecutedTime) {
            const statusEl = document.getElementById('autoTradeStatus');
            const timeEl = document.getElementById('autoTradeLastTime');
            
            if (enabled) {
                statusEl.textContent = 'ğŸŸ¢ å·²å¯ç”¨ï¼ˆç›‘æ§ä¸­ï¼‰';
                statusEl.style.color = '#10b981';
            } else {
                statusEl.textContent = 'âšª æœªå¯ç”¨';
                statusEl.style.color = '#6b7280';
            }
            
            if (lastExecutedTime) {
                timeEl.textContent = lastExecutedTime;
            } else {
                timeEl.textContent = '--';
            }
        }
        
        // æ›´æ–°æœåŠ¡å™¨è‡ªåŠ¨äº¤æ˜“è®¾ç½®æ˜¾ç¤º
        function updateServerAutoTradeDisplay(settings) {
            const settingsBox = document.getElementById('serverAutoTradeSettings');
            const triggerPriceEl = document.getElementById('serverTriggerPrice');
            const statusBadgeEl = document.getElementById('serverAutoTradeStatusBadge');
            
            if (!settingsBox || !triggerPriceEl || !statusBadgeEl) return;
            
            // å¦‚æœå¼€å…³å¼€å¯ï¼Œæ˜¾ç¤ºæœåŠ¡å™¨è®¾ç½®
            if (settings.enabled) {
                settingsBox.style.display = 'block';
                triggerPriceEl.textContent = `$${(settings.triggerPrice || 68000).toFixed(2)}`;
                statusBadgeEl.textContent = 'âœ… å·²å¯ç”¨';
                statusBadgeEl.style.color = '#8b5cf6';
                
                // åŒæ—¶æ£€æŸ¥JSONLçŠ¶æ€
                updateJsonlAllowedStatus();
            } else {
                settingsBox.style.display = 'none';
            }
            
            console.log('âœ… å·²æ›´æ–°æœåŠ¡å™¨è‡ªåŠ¨äº¤æ˜“è®¾ç½®æ˜¾ç¤º:', settings);
        }
        
        // æ£€æŸ¥å¹¶æ›´æ–°JSONLæ‰§è¡Œè®¸å¯çŠ¶æ€
        async function updateJsonlAllowedStatus() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) return;
            
            const jsonlStatusEl = document.getElementById('jsonlAllowedStatus');
            if (!jsonlStatusEl) return;
            
            try {
                const response = await fetch(`/api/okx-trading/check-allowed/${account.id}`);
                const result = await response.json();
                
                if (result.success) {
                    if (result.allowed) {
                        jsonlStatusEl.textContent = 'âœ… å…è®¸æ‰§è¡Œ';
                        jsonlStatusEl.style.color = '#10b981';
                    } else {
                        jsonlStatusEl.textContent = 'ğŸš« å·²ç¦æ­¢';
                        jsonlStatusEl.style.color = '#ef4444';
                    }
                } else {
                    jsonlStatusEl.textContent = 'âŒ æ£€æŸ¥å¤±è´¥';
                    jsonlStatusEl.style.color = '#6b7280';
                }
            } catch (e) {
                console.error('æ£€æŸ¥JSONLçŠ¶æ€å¤±è´¥:', e);
                jsonlStatusEl.textContent = 'âŒ å¼‚å¸¸';
                jsonlStatusEl.style.color = '#6b7280';
            }
        }
        
        // æ›´æ–°æ€»æ¶¨è·Œå¹…æ˜¾ç¤º
        async function updateTotalChangeOKX() {
            try {
                const response = await fetch('/api/coin-change-tracker/latest');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        const totalChange = result.data.total_change;
                        const element = document.getElementById('totalChangePercent');
                        if (element) {
                            element.textContent = `${totalChange > 0 ? '+' : ''}${totalChange.toFixed(2)}%`;
                            element.style.color = totalChange > 0 ? '#10b981' : totalChange < 0 ? '#ef4444' : '#6b7280';
                        }
                    }
                }
            } catch (e) {
                console.warn('âš ï¸ OKXé¡µé¢ï¼šæ›´æ–°æ€»æ¶¨è·Œå¹…å¤±è´¥', e);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        (async () => {
            await init();
            
            // åŠ è½½é¢„è­¦è®¾ç½®
            loadAlertSettingsOKX();
            
            // åŠ è½½æ­¢ç›ˆæ­¢æŸè®¾ç½®
            loadTakeProfitStopLossSettings();
            
            // åŠ è½½è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®
            loadAutoStrategySettings();
        })();
        
        // æ·»åŠ æ­¢ç›ˆæ­¢æŸè®¾ç½®çš„äº‹ä»¶ç›‘å¬å™¨
        ['takeProfitThreshold', 'stopLossThreshold'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', saveTakeProfitStopLossSettings);
            }
        });
        
        ['takeProfitSwitch', 'stopLossSwitch'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', saveTakeProfitStopLossSettings);
            }
        });
        
        // æ·»åŠ è‡ªåŠ¨äº¤æ˜“ç­–ç•¥è®¾ç½®çš„äº‹ä»¶ç›‘å¬å™¨
        const autoTriggerPriceEl = document.getElementById('autoTriggerPrice');
        if (autoTriggerPriceEl) {
            autoTriggerPriceEl.addEventListener('change', saveAutoStrategySettings);
        }
        
        const autoTradeSwitchEl = document.getElementById('autoTradeSwitch');
        if (autoTradeSwitchEl) {
            autoTradeSwitchEl.addEventListener('change', saveAutoStrategySettings);
        }
        
        // ä¸Šæ¶¨å æ¯”0ç­–ç•¥Aï¼ˆæ¶¨å¹…å‰8åï¼‰å¼€å…³äº‹ä»¶ç›‘å¬
        const autoTradeSwitchUpRatio0Top8El = document.getElementById('autoTradeSwitchUpRatio0Top8');
        if (autoTradeSwitchUpRatio0Top8El) {
            autoTradeSwitchUpRatio0Top8El.addEventListener('change', async function() {
                const account = accounts.find(acc => acc.id === currentAccount);
                if (!account) return;
                
                const enabled = this.checked;
                console.log(`[ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8å] å¼€å…³${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                // å¦‚æœå¼€å¯ï¼Œå†™å…¥JSONLè®¾ç½®allowed=true
                if (enabled) {
                    try {
                        await fetch(`/api/okx-trading/set-allowed-upratio0/${account.id}/top8`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: true,
                                reason: 'User enabled strategy',
                                upRatio: null
                            })
                        });
                        console.log('âœ… å·²å†™å…¥JSONLï¼šå…è®¸æ‰§è¡Œï¼ˆæ¶¨å¹…å‰8åï¼‰');
                        
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Top8');
                        if (statusEl) statusEl.textContent = 'ç›‘æ§ä¸­';
                    } catch (e) {
                        console.error('âŒ å†™å…¥JSONLå¤±è´¥:', e);
                        this.checked = false;
                    }
                } else {
                    // å¦‚æœå…³é—­ï¼Œå†™å…¥JSONLè®¾ç½®allowed=false
                    try {
                        await fetch(`/api/okx-trading/set-allowed-upratio0/${account.id}/top8`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: false,
                                reason: 'User disabled strategy',
                                upRatio: null
                            })
                        });
                        console.log('âœ… å·²å†™å…¥JSONLï¼šç¦æ­¢æ‰§è¡Œï¼ˆæ¶¨å¹…å‰8åï¼‰');
                        
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Top8');
                        if (statusEl) statusEl.textContent = 'æœªå¯ç”¨';
                    } catch (e) {
                        console.error('âŒ å†™å…¥JSONLå¤±è´¥:', e);
                    }
                }
            });
        }
        
        // ä¸Šæ¶¨å æ¯”0ç­–ç•¥Bï¼ˆæ¶¨å¹…å8åï¼‰å¼€å…³äº‹ä»¶ç›‘å¬
        const autoTradeSwitchUpRatio0Bottom8El = document.getElementById('autoTradeSwitchUpRatio0Bottom8');
        if (autoTradeSwitchUpRatio0Bottom8El) {
            autoTradeSwitchUpRatio0Bottom8El.addEventListener('change', async function() {
                const account = accounts.find(acc => acc.id === currentAccount);
                if (!account) return;
                
                const enabled = this.checked;
                console.log(`[ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8å] å¼€å…³${enabled ? 'å¼€å¯' : 'å…³é—­'}`);
                
                // å¦‚æœå¼€å¯ï¼Œå†™å…¥JSONLè®¾ç½®allowed=true
                if (enabled) {
                    try {
                        await fetch(`/api/okx-trading/set-allowed-upratio0/${account.id}/bottom8`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: true,
                                reason: 'User enabled strategy',
                                upRatio: null
                            })
                        });
                        console.log('âœ… å·²å†™å…¥JSONLï¼šå…è®¸æ‰§è¡Œï¼ˆæ¶¨å¹…å8åï¼‰');
                        
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Bottom8');
                        if (statusEl) statusEl.textContent = 'ç›‘æ§ä¸­';
                    } catch (e) {
                        console.error('âŒ å†™å…¥JSONLå¤±è´¥:', e);
                        this.checked = false;
                    }
                } else {
                    // å¦‚æœå…³é—­ï¼Œå†™å…¥JSONLè®¾ç½®allowed=false
                    try {
                        await fetch(`/api/okx-trading/set-allowed-upratio0/${account.id}/bottom8`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: false,
                                reason: 'User disabled strategy',
                                upRatio: null
                            })
                        });
                        console.log('âœ… å·²å†™å…¥JSONLï¼šç¦æ­¢æ‰§è¡Œï¼ˆæ¶¨å¹…å8åï¼‰');
                        
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Bottom8');
                        if (statusEl) statusEl.textContent = 'æœªå¯ç”¨';
                    } catch (e) {
                        console.error('âŒ å†™å…¥JSONLå¤±è´¥:', e);
                    }
                }
            });
        }
        
        // ç­–ç•¥ç±»å‹é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
        const autoStrategyTypeEl = document.getElementById('autoStrategyType');
        if (autoStrategyTypeEl) {
            autoStrategyTypeEl.addEventListener('change', function() {
                // æ›´æ–°ç­–ç•¥æè¿°
                const strategyTarget = document.getElementById('strategyTarget');
                if (strategyTarget) {
                    strategyTarget.textContent = this.value === 'top_performers' ? 'æ¶¨å¹…å‰8å' : 'æ¶¨å¹…å8å';
                }
                // ä¿å­˜è®¾ç½®
                saveAutoStrategySettings();
            });
        }
        
        // è¯·æ±‚æµè§ˆå™¨é€šçŸ¥æƒé™
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // æ›´æ–°æ€»æ¶¨è·Œå¹…
        updateTotalChangeOKX();

        // æ£€æŸ¥å¹¶æ‰§è¡Œè‡ªåŠ¨äº¤æ˜“ç­–ç•¥
        // å‘é€Telegramæ¶ˆæ¯
        async function sendTelegramMessage(message) {
            try {
                const response = await fetch('/api/telegram/send-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log('âœ… Telegramæ¶ˆæ¯å‘é€æˆåŠŸ');
                } else {
                    console.warn('âš ï¸ Telegramæ¶ˆæ¯å‘é€å¤±è´¥:', result.error);
                }
            } catch (e) {
                console.error('âŒ Telegramæ¶ˆæ¯å‘é€å¼‚å¸¸:', e);
            }
        }
        
        // ğŸ”’ æ·»åŠ æ‰§è¡Œé”ï¼Œé˜²æ­¢é‡å¤è§¦å‘
        let strategyExecuting = false;
        
        async function checkAndExecuteAutoStrategy() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account || !account.apiKey) return;
            
            // æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ‰§è¡Œ
            if (strategyExecuting) {
                console.log('âš ï¸ ç­–ç•¥æ­£åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡æœ¬æ¬¡æ£€æŸ¥');
                return;
            }
            
            try {
                // åŠ è½½ç­–ç•¥è®¾ç½®
                const settings = await loadAutoStrategySettingsData();
                if (!settings || !settings.enabled) {
                    return; // ç­–ç•¥æœªå¯ç”¨
                }
                
                // è·å–å½“å‰BTCä»·æ ¼
                const btcPrice = await getBTCPrice();
                if (!btcPrice) {
                    console.warn('âš ï¸ æ— æ³•è·å–BTCä»·æ ¼');
                    return;
                }
                
                // æ›´æ–°æ˜¾ç¤º
                const priceEl = document.getElementById('currentBtcPrice');
                if (priceEl) {
                    priceEl.textContent = `$${btcPrice.toFixed(2)}`;
                    priceEl.style.color = btcPrice < settings.triggerPrice ? '#ef4444' : '#6b7280';
                }
                
                // æ£€æŸ¥è§¦å‘æ¡ä»¶ï¼šBTCä»·æ ¼è·Œç ´è®¾å®šä»·æ ¼
                if (btcPrice < settings.triggerPrice) {
                    // ğŸ”’ ç¬¬ä¸€é‡æ£€æŸ¥ï¼šJSONL allowedçŠ¶æ€ï¼ˆæœ€é‡è¦ï¼ï¼‰
                    console.log('ğŸ” æ£€æŸ¥JSONLæ‰§è¡Œè®¸å¯çŠ¶æ€...');
                    const allowedCheck = await fetch(`/api/okx-trading/check-allowed/${account.id}`);
                    const allowedResult = await allowedCheck.json();
                    
                    if (!allowedResult.success) {
                        console.error('âŒ æ£€æŸ¥JSONLçŠ¶æ€å¤±è´¥:', allowedResult.error);
                        return;
                    }
                    
                    if (!allowedResult.allowed) {
                        console.log('ğŸš« JSONLçŠ¶æ€ä¸å…è®¸æ‰§è¡Œï¼Œè·³è¿‡æœ¬æ¬¡æ‰§è¡Œ');
                        console.log('ğŸ“„ æœ€åè®°å½•:', allowedResult.lastRecord);
                        
                        // åŒæ—¶å…³é—­UIå¼€å…³
                        if (settings.enabled) {
                            document.getElementById('autoTradeSwitch').checked = false;
                            await saveAutoStrategySettings();
                        }
                        return;
                    }
                    
                    console.log('âœ… JSONLçŠ¶æ€å…è®¸æ‰§è¡Œ');
                    
                    // ğŸ”’ ç¬¬äºŒé‡æ£€æŸ¥ï¼šå†·å´æœŸï¼ˆ5åˆ†é’Ÿå†…ä¸é‡å¤æ‰§è¡Œï¼‰
                    const COOLDOWN_PERIOD = 5 * 60 * 1000; // 5åˆ†é’Ÿ
                    if (settings.lastExecutedTime) {
                        const lastTime = new Date(settings.lastExecutedTime.replace(/\//g, '-')).getTime();
                        const now = Date.now();
                        const timeSinceLastExec = now - lastTime;
                        if (timeSinceLastExec < COOLDOWN_PERIOD) {
                            const remainingSeconds = Math.ceil((COOLDOWN_PERIOD - timeSinceLastExec) / 1000);
                            console.log(`â³ ç­–ç•¥åœ¨å†·å´æœŸå†…ï¼ˆè¿˜éœ€ç­‰å¾… ${remainingSeconds} ç§’ï¼‰ï¼Œè·³è¿‡æ‰§è¡Œ`);
                            return;
                        }
                    }
                    
                    // ğŸ”’ ç¬¬ä¸‰é‡æ£€æŸ¥ï¼šè®¾ç½®æ‰§è¡Œé”
                    strategyExecuting = true;
                    console.log(`ğŸ”’ å·²è®¾ç½®æ‰§è¡Œé”ï¼Œé˜²æ­¢é‡å¤è§¦å‘`);
                    
                    console.log(`ğŸ¯ è§¦å‘æ¡ä»¶æ»¡è¶³ï¼BTCä»·æ ¼ $${btcPrice} ä½äºè§¦å‘ä»· $${settings.triggerPrice}`);
                    console.log(`ğŸ“Š å‡†å¤‡å¯¹å¸¸ç”¨å¸(15ä¸ª)ä¸­æ¶¨å¹…å8åå¼€å¤šå•...`);
                    
                    // å‘é€TGé€šçŸ¥ï¼šè§¦å‘
                    const triggerTime = new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                    const triggerMessage = `ğŸ¯ <b>æ¶¨å¹…å8åç­–ç•¥è§¦å‘</b>\n\n` +
                        `â° è§¦å‘æ—¶é—´: ${triggerTime}\n` +
                        `ğŸ’° BTCä»·æ ¼: $${btcPrice.toFixed(2)}\n` +
                        `ğŸ“‰ è§¦å‘ä»·æ ¼: $${settings.triggerPrice}\n` +
                        `ğŸ‘¤ è´¦æˆ·: ${account.name}\n\n` +
                        `ğŸ“Š æ­£åœ¨åˆ†æå¸¸ç”¨å¸(15ä¸ª)æ¶¨è·Œå¹…...\n` +
                        `ğŸ”„ å‡†å¤‡å¯¹æ¶¨å¹…å8åå¼€å¤šå•...`;
                    await sendTelegramMessage(triggerMessage);
                    
                    // æ‰§è¡Œå¼€å•ï¼ˆæ ¹æ®ç­–ç•¥ç±»å‹é€‰æ‹©ï¼‰
                    const strategyType = settings.strategyType || 'bottom_performers';
                    const result = await executeAutoTrade(account, btcPrice, settings.triggerPrice, strategyType);
                    
                    if (result.success) {
                        // âš ï¸ æ‰§è¡ŒæˆåŠŸåç«‹å³å†™å…¥JSONLè®¾ç½®allowed=false
                        console.log('ğŸ“ å†™å…¥JSONLï¼šè®¾ç½®allowed=falseï¼Œç¦æ­¢å†æ¬¡æ‰§è¡Œ');
                        await fetch(`/api/okx-trading/set-allowed/${account.id}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: false,
                                reason: 'Strategy executed successfully',
                                triggerPrice: settings.triggerPrice,
                                strategyType: strategyType
                            })
                        });
                        
                        // æ›´æ–°è®¾ç½®ï¼šå…³é—­å¼€å…³ï¼Œè®°å½•æ‰§è¡Œæ—¶é—´
                        const now = new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                        await fetch(`/api/okx-trading/auto-strategy/${account.id}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                enabled: false, // æ‰§è¡Œåè‡ªåŠ¨å…³é—­
                                triggerPrice: settings.triggerPrice,
                                strategyType: strategyType,
                                lastExecutedTime: now,
                                executedCount: (settings.executedCount || 0) + 1
                            })
                        });
                        
                        // åˆ·æ–°UI
                        await loadAutoStrategySettings();
                        
                        // å‘é€TGé€šçŸ¥ï¼šå®Œæˆ
                        const successCoins = result.successCoins.map(c => c.name).join(', ');
                        const failedCoins = result.failedCoins.map(c => c.name).join(', ');
                        
                        let completionMessage = `âœ… <b>æ¶¨å¹…å8åç­–ç•¥æ‰§è¡Œå®Œæˆ</b>\n\n`;
                        completionMessage += `â° å®Œæˆæ—¶é—´: ${now}\n`;
                        completionMessage += `ğŸ‘¤ è´¦æˆ·: ${account.name}\n`;
                        completionMessage += `ğŸ’° BTCä»·æ ¼: $${btcPrice.toFixed(2)}\n\n`;
                        completionMessage += `ğŸ“Š <b>æ‰§è¡Œç»“æœ</b>\n`;
                        completionMessage += `âœ“ æˆåŠŸ: ${result.successCount}/${result.totalCount} ä¸ªå¸ç§\n`;
                        
                        if (successCoins) {
                            completionMessage += `\nğŸŸ¢ <b>æˆåŠŸå¸ç§:</b>\n${successCoins}\n`;
                        }
                        
                        if (failedCoins) {
                            completionMessage += `\nğŸ”´ <b>å¤±è´¥å¸ç§:</b>\n${failedCoins}\n`;
                        }
                        
                        // æ·»åŠ æ¶¨å¹…å8åè¯¦æƒ…
                        if (result.bottom8Coins && result.bottom8Coins.length > 0) {
                            completionMessage += `\nğŸ“‰ <b>æ¶¨å¹…å8å:</b>\n`;
                            result.bottom8Coins.forEach((coin, index) => {
                                completionMessage += `${index + 1}. ${coin.name} (${coin.change >= 0 ? '+' : ''}${coin.change.toFixed(2)}%)\n`;
                            });
                        }
                        
                        completionMessage += `\nğŸ”’ ç­–ç•¥å·²è‡ªåŠ¨å…³é—­`;
                        
                        await sendTelegramMessage(completionMessage);
                        
                        // é€šçŸ¥ç”¨æˆ·
                        let alertMessage = `âœ… æ¶¨å¹…å8åç­–ç•¥æ‰§è¡Œå®Œæˆï¼\n\n`;
                        alertMessage += `è§¦å‘æ¡ä»¶ï¼šBTCä»·æ ¼ $${btcPrice.toFixed(2)} < $${settings.triggerPrice}\n`;
                        alertMessage += `æˆåŠŸå¼€å•ï¼š${result.successCount}/${result.totalCount} ä¸ªå¸ç§\n`;
                        if (successCoins) alertMessage += `æˆåŠŸå¸ç§ï¼š${successCoins}\n`;
                        if (failedCoins) alertMessage += `å¤±è´¥å¸ç§ï¼š${failedCoins}\n`;
                        alertMessage += `\nç­–ç•¥å·²è‡ªåŠ¨å…³é—­ï¼Œå¦‚éœ€å†æ¬¡æ‰§è¡Œè¯·é‡æ–°å¼€å¯ã€‚`;
                        
                        alert(alertMessage);
                        playAlertSound();
                        
                        // åˆ·æ–°æŒä»“
                        await loadPositions();
                    }
                }
            } catch (e) {
                console.error('âŒ è‡ªåŠ¨äº¤æ˜“ç­–ç•¥æ£€æŸ¥å¼‚å¸¸:', e);
            } finally {
                // ğŸ”“ é‡Šæ”¾æ‰§è¡Œé”
                if (strategyExecuting) {
                    strategyExecuting = false;
                    console.log('ğŸ”“ å·²é‡Šæ”¾æ‰§è¡Œé”');
                }
            }
        }
        
        // ========== æ–°å¢ç­–ç•¥ï¼šä¸Šæ¶¨å æ¯”=0è§¦å‘ç­–ç•¥ï¼ˆæŒ‰è´¦å·ç‹¬ç«‹æ§åˆ¶ï¼‰==========
        
        // æ£€æŸ¥å¹¶æ‰§è¡Œä¸Šæ¶¨å æ¯”0ç­–ç•¥Aï¼ˆæ¶¨å¹…å‰8åå¤šå•ï¼‰
        async function checkAndExecuteUpRatio0Top8() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account || !account.apiKey) return;
            
            // æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ‰§è¡Œ
            if (strategyExecuting) {
                console.log('âš ï¸ ç­–ç•¥æ­£åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åæ£€æŸ¥');
                return;
            }
            
            try {
                // è¯»å–å¼€å…³çŠ¶æ€ï¼ˆä»UIï¼‰
                const switchEl = document.getElementById('autoTradeSwitchUpRatio0Top8');
                if (!switchEl || !switchEl.checked) {
                    return; // ç­–ç•¥æœªå¯ç”¨
                }
                
                // è·å–å½“å‰æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
                const now = new Date();
                const bjHour = (now.getUTCHours() + 8) % 24;
                const bjMinute = now.getUTCMinutes();
                
                // æ’é™¤0:00-0:30
                if (bjHour === 0 && bjMinute < 30) {
                    console.log('â° å½“å‰æ—¶é—´åœ¨0:00-0:30æ’é™¤æ—¶æ®µï¼Œè·³è¿‡ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åç­–ç•¥');
                    return;
                }
                
                // è·å–ä¸Šæ¶¨å æ¯”
                const upRatio = await getUpRatio();
                if (upRatio === null) {
                    console.warn('âš ï¸ æ— æ³•è·å–ä¸Šæ¶¨å æ¯”');
                    return;
                }
                
                // æ›´æ–°æ˜¾ç¤º
                const upRatioEl = document.getElementById('currentUpRatioTop8');
                if (upRatioEl) {
                    upRatioEl.textContent = `${upRatio}%`;
                    upRatioEl.style.color = upRatio === 0 ? '#ef4444' : '#6b7280';
                }
                
                // æ£€æŸ¥è§¦å‘æ¡ä»¶ï¼šä¸Šæ¶¨å æ¯”=0
                if (upRatio === 0) {
                    // ğŸ”’ ç¬¬ä¸€é‡æ£€æŸ¥ï¼šJSONL allowedçŠ¶æ€ï¼ˆæœ€é‡è¦ï¼ï¼‰
                    console.log('ğŸ” æ£€æŸ¥JSONLæ‰§è¡Œè®¸å¯çŠ¶æ€ï¼ˆä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åï¼‰...');
                    const allowedCheck = await fetch(`/api/okx-trading/check-allowed-upratio0/${account.id}/top8`);
                    const allowedResult = await allowedCheck.json();
                    
                    if (!allowedResult.success) {
                        console.error('âŒ æ£€æŸ¥JSONLçŠ¶æ€å¤±è´¥:', allowedResult.error);
                        return;
                    }
                    
                    if (!allowedResult.allowed) {
                        console.log('ğŸš« JSONLçŠ¶æ€ä¸å…è®¸æ‰§è¡Œï¼Œè·³è¿‡æœ¬æ¬¡æ‰§è¡Œ');
                        console.log('ğŸ“„ æœ€åè®°å½•:', allowedResult.lastRecord);
                        
                        // åŒæ—¶å…³é—­UIå¼€å…³
                        switchEl.checked = false;
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Top8');
                        if (statusEl) statusEl.textContent = 'å·²å…³é—­';
                        return;
                    }
                    
                    console.log('âœ… JSONLçŠ¶æ€å…è®¸æ‰§è¡Œ');
                    console.log('ğŸ¯ è§¦å‘æ¡ä»¶æ»¡è¶³ï¼ä¸Šæ¶¨å æ¯” = 0%');
                    console.log('ğŸ“Š å‡†å¤‡å¯¹å¸¸ç”¨å¸(15ä¸ª)ä¸­æ¶¨å¹…å‰8åå¼€å¤šå•...');
                    
                    // ğŸ”’ è®¾ç½®æ‰§è¡Œé”
                    strategyExecuting = true;
                    console.log('ğŸ”’ å·²è®¾ç½®æ‰§è¡Œé”ï¼ˆä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åï¼‰');
                    
                    // æ‰§è¡Œå¼€å•
                    const result = await executeUpRatio0Strategy(account, upRatio, 'top_8');
                    
                    if (result.success) {
                        // âš ï¸ æ‰§è¡ŒæˆåŠŸåç«‹å³å†™å…¥JSONLè®¾ç½®allowed=false
                        console.log('ğŸ“ å†™å…¥JSONLï¼šè®¾ç½®allowed=falseï¼Œç¦æ­¢å†æ¬¡æ‰§è¡Œ');
                        await fetch(`/api/okx-trading/set-allowed-upratio0/${account.id}/top8`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: false,
                                reason: 'Strategy executed successfully',
                                upRatio: upRatio
                            })
                        });
                        
                        // æ‰§è¡Œåè‡ªåŠ¨å…³é—­å¼€å…³
                        switchEl.checked = false;
                        
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Top8');
                        if (statusEl) statusEl.textContent = 'å·²æ‰§è¡Œ';
                        
                        const timeEl = document.getElementById('autoTradeLastTimeUpRatio0Top8');
                        if (timeEl) {
                            const now = new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                            timeEl.textContent = now;
                        }
                        
                        // é™é»˜é€šçŸ¥ç”¨æˆ·ï¼ˆä¸éœ€è¦äººå·¥ç¡®è®¤ï¼‰
                        const successCoins = result.successCoins.map(c => c.name).join(', ');
                        const failedCoins = result.failedCoins.map(c => c.name).join(', ');
                        
                        // æ„å»ºé€šçŸ¥æ¶ˆæ¯
                        let notificationMessage = `âœ… ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åç­–ç•¥æ‰§è¡Œå®Œæˆï¼\n\n`;
                        notificationMessage += `è´¦æˆ·ï¼š${account.name}\n`;
                        notificationMessage += `è§¦å‘æ¡ä»¶ï¼šä¸Šæ¶¨å æ¯” = 0%\n`;
                        notificationMessage += `æˆåŠŸå¼€å•ï¼š${result.successCount}/${result.totalCount} ä¸ªå¸ç§\n`;
                        if (successCoins) notificationMessage += `æˆåŠŸå¸ç§ï¼š${successCoins}\n`;
                        if (failedCoins) notificationMessage += `å¤±è´¥å¸ç§ï¼š${failedCoins}\n`;
                        notificationMessage += `\nç­–ç•¥å·²è‡ªåŠ¨å…³é—­ï¼Œå¦‚éœ€å†æ¬¡æ‰§è¡Œè¯·é‡æ–°å¼€å¯ã€‚`;
                        
                        // æ§åˆ¶å°è¾“å‡ºè¯¦ç»†ä¿¡æ¯
                        console.log('ğŸ‰ ===== ç­–ç•¥æ‰§è¡Œå®Œæˆ =====');
                        console.log(notificationMessage);
                        console.log('ğŸ‰ ==========================');
                        
                        // æµè§ˆå™¨é€šçŸ¥ï¼ˆä¸é˜»å¡ï¼‰
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åç­–ç•¥', {
                                body: `è´¦æˆ·ï¼š${account.name}\næˆåŠŸï¼š${result.successCount}/${result.totalCount}\n${successCoins}`,
                                icon: '/static/icon.png',
                                requireInteraction: false
                            });
                        }
                        
                        // æ’­æ”¾æç¤ºéŸ³
                        playAlertSound();
                        
                        // åˆ·æ–°æŒä»“
                        await loadPositions();
                    }
                }
            } catch (e) {
                console.error('âŒ ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åç­–ç•¥æ£€æŸ¥å¼‚å¸¸:', e);
            } finally {
                // ğŸ”“ é‡Šæ”¾æ‰§è¡Œé”
                if (strategyExecuting) {
                    strategyExecuting = false;
                    console.log('ğŸ”“ å·²é‡Šæ”¾æ‰§è¡Œé”ï¼ˆä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å‰8åï¼‰');
                }
            }
        }
        
        // æ£€æŸ¥å¹¶æ‰§è¡Œä¸Šæ¶¨å æ¯”0ç­–ç•¥Bï¼ˆæ¶¨å¹…å8åå¤šå•ï¼‰
        async function checkAndExecuteUpRatio0Bottom8() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account || !account.apiKey) return;
            
            // æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ‰§è¡Œ
            if (strategyExecuting) {
                console.log('âš ï¸ ç­–ç•¥æ­£åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åæ£€æŸ¥');
                return;
            }
            
            try {
                // è¯»å–å¼€å…³çŠ¶æ€ï¼ˆä»UIï¼‰
                const switchEl = document.getElementById('autoTradeSwitchUpRatio0Bottom8');
                if (!switchEl || !switchEl.checked) {
                    return; // ç­–ç•¥æœªå¯ç”¨
                }
                
                // è·å–å½“å‰æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
                const now = new Date();
                const bjHour = (now.getUTCHours() + 8) % 24;
                const bjMinute = now.getUTCMinutes();
                
                // æ’é™¤0:00-0:30
                if (bjHour === 0 && bjMinute < 30) {
                    console.log('â° å½“å‰æ—¶é—´åœ¨0:00-0:30æ’é™¤æ—¶æ®µï¼Œè·³è¿‡ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åç­–ç•¥');
                    return;
                }
                
                // è·å–ä¸Šæ¶¨å æ¯”
                const upRatio = await getUpRatio();
                if (upRatio === null) {
                    console.warn('âš ï¸ æ— æ³•è·å–ä¸Šæ¶¨å æ¯”');
                    return;
                }
                
                // æ›´æ–°æ˜¾ç¤º
                const upRatioEl = document.getElementById('currentUpRatioBottom8');
                if (upRatioEl) {
                    upRatioEl.textContent = `${upRatio}%`;
                    upRatioEl.style.color = upRatio === 0 ? '#ef4444' : '#6b7280';
                }
                
                // æ£€æŸ¥è§¦å‘æ¡ä»¶ï¼šä¸Šæ¶¨å æ¯”=0
                if (upRatio === 0) {
                    // ğŸ”’ ç¬¬ä¸€é‡æ£€æŸ¥ï¼šJSONL allowedçŠ¶æ€ï¼ˆæœ€é‡è¦ï¼ï¼‰
                    console.log('ğŸ” æ£€æŸ¥JSONLæ‰§è¡Œè®¸å¯çŠ¶æ€ï¼ˆä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åï¼‰...');
                    const allowedCheck = await fetch(`/api/okx-trading/check-allowed-upratio0/${account.id}/bottom8`);
                    const allowedResult = await allowedCheck.json();
                    
                    if (!allowedResult.success) {
                        console.error('âŒ æ£€æŸ¥JSONLçŠ¶æ€å¤±è´¥:', allowedResult.error);
                        return;
                    }
                    
                    if (!allowedResult.allowed) {
                        console.log('ğŸš« JSONLçŠ¶æ€ä¸å…è®¸æ‰§è¡Œï¼Œè·³è¿‡æœ¬æ¬¡æ‰§è¡Œ');
                        console.log('ğŸ“„ æœ€åè®°å½•:', allowedResult.lastRecord);
                        
                        // åŒæ—¶å…³é—­UIå¼€å…³
                        switchEl.checked = false;
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Bottom8');
                        if (statusEl) statusEl.textContent = 'å·²å…³é—­';
                        return;
                    }
                    
                    console.log('âœ… JSONLçŠ¶æ€å…è®¸æ‰§è¡Œ');
                    console.log('ğŸ¯ è§¦å‘æ¡ä»¶æ»¡è¶³ï¼ä¸Šæ¶¨å æ¯” = 0%');
                    console.log('ğŸ“Š å‡†å¤‡å¯¹å¸¸ç”¨å¸(15ä¸ª)ä¸­æ¶¨å¹…å8åå¼€å¤šå•...');
                    
                    // ğŸ”’ è®¾ç½®æ‰§è¡Œé”
                    strategyExecuting = true;
                    console.log('ğŸ”’ å·²è®¾ç½®æ‰§è¡Œé”ï¼ˆä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åï¼‰');
                    
                    // æ‰§è¡Œå¼€å•
                    const result = await executeUpRatio0Strategy(account, upRatio, 'bottom_8');
                    
                    if (result.success) {
                        // âš ï¸ æ‰§è¡ŒæˆåŠŸåç«‹å³å†™å…¥JSONLè®¾ç½®allowed=false
                        console.log('ğŸ“ å†™å…¥JSONLï¼šè®¾ç½®allowed=falseï¼Œç¦æ­¢å†æ¬¡æ‰§è¡Œ');
                        await fetch(`/api/okx-trading/set-allowed-upratio0/${account.id}/bottom8`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                allowed: false,
                                reason: 'Strategy executed successfully',
                                upRatio: upRatio
                            })
                        });
                        
                        // æ‰§è¡Œåè‡ªåŠ¨å…³é—­å¼€å…³
                        switchEl.checked = false;
                        
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        const statusEl = document.getElementById('autoTradeStatusUpRatio0Bottom8');
                        if (statusEl) statusEl.textContent = 'å·²æ‰§è¡Œ';
                        
                        const timeEl = document.getElementById('autoTradeLastTimeUpRatio0Bottom8');
                        if (timeEl) {
                            const now = new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                            timeEl.textContent = now;
                        }
                        
                        // é™é»˜é€šçŸ¥ç”¨æˆ·ï¼ˆä¸éœ€è¦äººå·¥ç¡®è®¤ï¼‰
                        const successCoins = result.successCoins.map(c => c.name).join(', ');
                        const failedCoins = result.failedCoins.map(c => c.name).join(', ');
                        
                        // æ„å»ºé€šçŸ¥æ¶ˆæ¯
                        let notificationMessage = `âœ… ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åç­–ç•¥æ‰§è¡Œå®Œæˆï¼\n\n`;
                        notificationMessage += `è´¦æˆ·ï¼š${account.name}\n`;
                        notificationMessage += `è§¦å‘æ¡ä»¶ï¼šä¸Šæ¶¨å æ¯” = 0%\n`;
                        notificationMessage += `æˆåŠŸå¼€å•ï¼š${result.successCount}/${result.totalCount} ä¸ªå¸ç§\n`;
                        if (successCoins) notificationMessage += `æˆåŠŸå¸ç§ï¼š${successCoins}\n`;
                        if (failedCoins) notificationMessage += `å¤±è´¥å¸ç§ï¼š${failedCoins}\n`;
                        notificationMessage += `\nç­–ç•¥å·²è‡ªåŠ¨å…³é—­ï¼Œå¦‚éœ€å†æ¬¡æ‰§è¡Œè¯·é‡æ–°å¼€å¯ã€‚`;
                        
                        // æ§åˆ¶å°è¾“å‡ºè¯¦ç»†ä¿¡æ¯
                        console.log('ğŸ‰ ===== ç­–ç•¥æ‰§è¡Œå®Œæˆ =====');
                        console.log(notificationMessage);
                        console.log('ğŸ‰ ==========================');
                        
                        // æµè§ˆå™¨é€šçŸ¥ï¼ˆä¸é˜»å¡ï¼‰
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åç­–ç•¥', {
                                body: `è´¦æˆ·ï¼š${account.name}\næˆåŠŸï¼š${result.successCount}/${result.totalCount}\n${successCoins}`,
                                icon: '/static/icon.png',
                                requireInteraction: false
                            });
                        }
                        
                        // æ’­æ”¾æç¤ºéŸ³
                        playAlertSound();
                        
                        // åˆ·æ–°æŒä»“
                        await loadPositions();
                    }
                }
            } catch (e) {
                console.error('âŒ ä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åç­–ç•¥æ£€æŸ¥å¼‚å¸¸:', e);
            } finally {
                // ğŸ”“ é‡Šæ”¾æ‰§è¡Œé”
                if (strategyExecuting) {
                    strategyExecuting = false;
                    console.log('ğŸ”“ å·²é‡Šæ”¾æ‰§è¡Œé”ï¼ˆä¸Šæ¶¨å æ¯”0-æ¶¨å¹…å8åï¼‰');
                }
            }
        }
        
        // è·å–å½“å‰ä¸Šæ¶¨å æ¯”
        async function getUpRatio() {
            try {
                const response = await fetch('/api/coin-change-tracker/latest');
                const result = await response.json();
                
                if (result.success && result.data && result.data.up_ratio !== undefined) {
                    return result.data.up_ratio;
                }
            } catch (e) {
                console.error('è·å–ä¸Šæ¶¨å æ¯”å¤±è´¥:', e);
            }
            return null;
        }
        
        // æ‰§è¡Œä¸Šæ¶¨å æ¯”0ç­–ç•¥ï¼ˆé€šç”¨å‡½æ•°ï¼‰
        async function executeUpRatio0Strategy(account, upRatio, strategyType) {
            try {
                const strategyName = strategyType === 'top_8' ? 'æ¶¨å¹…å‰8å' : 'æ¶¨å¹…å8å';
                console.log(`ğŸ“Š å¼€å§‹æ‰§è¡Œä¸Šæ¶¨å æ¯”0-${strategyName}ç­–ç•¥...`);
                
                // 1. è·å–å¸¸ç”¨å¸åˆ—è¡¨ï¼ˆ15ä¸ªï¼‰
                if (!favoriteSymbols || favoriteSymbols.length === 0) {
                    console.error('âŒ å¸¸ç”¨å¸åˆ—è¡¨ä¸ºç©º');
                    return { success: false, error: 'å¸¸ç”¨å¸åˆ—è¡¨ä¸ºç©º' };
                }
                
                console.log('å¸¸ç”¨å¸åˆ—è¡¨ (15ä¸ª):', favoriteSymbols);
                
                // 2. è·å–æ¶¨è·Œå¹…æ•°æ®
                const changeResponse = await fetch('/api/coin-change-tracker/latest');
                const changeResult = await changeResponse.json();
                
                if (!changeResult.success || !changeResult.data || !changeResult.data.changes) {
                    console.error('âŒ è·å–æ¶¨è·Œå¹…æ•°æ®å¤±è´¥');
                    return { success: false, error: 'è·å–æ¶¨è·Œå¹…æ•°æ®å¤±è´¥' };
                }
                
                const changes = changeResult.data.changes;
                
                // 3. ç­›é€‰å¸¸ç”¨å¸çš„æ¶¨è·Œå¹…æ•°æ®
                const favoriteChanges = favoriteSymbols
                    .map(sym => {
                        const coinName = sym.replace('-USDT-SWAP', '');
                        const change = changes[coinName];
                        if (change) {
                            return {
                                symbol: sym,
                                name: coinName,
                                changePct: change.change_pct
                            };
                        }
                        return null;
                    })
                    .filter(item => item !== null);
                
                console.log(`ç­›é€‰åçš„å¸¸ç”¨å¸æ¶¨è·Œå¹… (${favoriteChanges.length}ä¸ª):`, favoriteChanges);
                
                // 4. æ’åºå¹¶é€‰å–ç›®æ ‡å¸ç§
                let targetCoins;
                if (strategyType === 'top_8') {
                    // æ¶¨å¹…å‰8åï¼šæŒ‰æ¶¨è·Œå¹…é™åºæ’åˆ—ï¼Œå–å‰8
                    targetCoins = favoriteChanges
                        .sort((a, b) => b.changePct - a.changePct)
                        .slice(0, 8);
                    console.log('æ¶¨å¹…å‰8å:', targetCoins);
                } else {
                    // æ¶¨å¹…å8åï¼šæŒ‰æ¶¨è·Œå¹…å‡åºæ’åˆ—ï¼Œå–å‰8
                    targetCoins = favoriteChanges
                        .sort((a, b) => a.changePct - b.changePct)
                        .slice(0, 8);
                    console.log('æ¶¨å¹…å8å:', targetCoins);
                }
                
                if (targetCoins.length < 8) {
                    console.warn(`âš ï¸ å¯ç”¨å¸ç§ä¸è¶³8ä¸ªï¼Œä»…${targetCoins.length}ä¸ª`);
                }
                
                // 5. è·å–è´¦æˆ·ä½™é¢
                const balanceResponse = await fetch('/api/okx-trading/account-balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                const balanceResult = await balanceResponse.json();
                if (!balanceResult.success || !balanceResult.balance) {
                    console.error('âŒ è·å–è´¦æˆ·ä½™é¢å¤±è´¥');
                    return { success: false, error: 'è·å–è´¦æˆ·ä½™é¢å¤±è´¥' };
                }
                
                const availableBalance = parseFloat(balanceResult.balance);
                console.log(`ğŸ’° å½“å‰å¯ç”¨ä½™é¢: ${availableBalance} USDT`);
                
                // 6. è®¡ç®—æ¯ä¸ªå¸ç§çš„å¼€ä»“é‡‘é¢ï¼ˆ1.5%å¯ç”¨ä½™é¢ï¼‰
                const positionSize = availableBalance * 0.015; // 1.5%
                console.log(`ğŸ“Š æ¯ä¸ªå¸ç§å¼€ä»“é‡‘é¢: ${positionSize.toFixed(2)} USDT`);
                
                // 7. ä¾æ¬¡ä¸‹å•
                const successCoins = [];
                const failedCoins = [];
                
                for (const coin of targetCoins) {
                    try {
                        console.log(`ğŸ“¤ æ­£åœ¨ä¸º ${coin.name} ä¸‹å¤šå•ï¼Œå¼€ä»“é‡‘é¢ ${positionSize.toFixed(2)} USDTï¼Œ10å€æ æ†...`);
                        
                        const orderResponse = await fetch('/api/okx-trading/place-order', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                apiKey: account.apiKey,
                                apiSecret: account.apiSecret,
                                passphrase: account.passphrase,
                                symbol: coin.symbol,
                                side: 'buy',  // å¤šå•
                                amount: positionSize,
                                leverage: 10,
                                orderType: 'market',
                                accountId: account.id
                            })
                        });
                        
                        const orderResult = await orderResponse.json();
                        
                        if (orderResult.success) {
                            successCoins.push({
                                name: coin.name,
                                change: coin.changePct,
                                orderId: orderResult.orderId
                            });
                            console.log(`âœ… ${coin.name} ä¸‹å•æˆåŠŸ`);
                        } else {
                            failedCoins.push({
                                name: coin.name,
                                change: coin.changePct,
                                error: orderResult.error
                            });
                            console.error(`âŒ ${coin.name} ä¸‹å•å¤±è´¥:`, orderResult.error);
                        }
                        
                        // æ¯æ¬¡ä¸‹å•åç­‰å¾…500msï¼Œé¿å…é¢‘ç¹è¯·æ±‚
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } catch (error) {
                        failedCoins.push({
                            name: coin.name,
                            change: coin.changePct,
                            error: error.message
                        });
                        console.error(`âŒ ${coin.name} ä¸‹å•å¼‚å¸¸:`, error);
                    }
                }
                
                return {
                    success: true,
                    totalCount: targetCoins.length,
                    successCount: successCoins.length,
                    failedCount: failedCoins.length,
                    successCoins: successCoins,
                    failedCoins: failedCoins,
                    targetCoins: targetCoins
                };
            } catch (error) {
                console.error('âŒ æ‰§è¡Œä¸Šæ¶¨å æ¯”0ç­–ç•¥å¤±è´¥:', error);
                return { success: false, error: error.message };
            }
        }
        
        // è·å–BTCå½“å‰ä»·æ ¼
        async function getBTCPrice() {
            try {
                const response = await fetch('/api/okx-trading/market-tickers');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const btcTicker = result.data.find(t => t.symbol === 'BTC-USDT-SWAP');
                    if (btcTicker) {
                        return btcTicker.price;
                    }
                }
            } catch (e) {
                console.error('è·å–BTCä»·æ ¼å¤±è´¥:', e);
            }
            return null;
        }
        
        // æ‰§è¡Œè‡ªåŠ¨å¼€å•ï¼ˆæ”¯æŒæ¶¨å¹…å8åå’Œæ¶¨å¹…å‰8åä¸¤ç§ç­–ç•¥ï¼‰
        async function executeAutoTrade(account, btcPrice, triggerPrice, strategyType = 'bottom_performers') {
            try {
                const strategyName = strategyType === 'top_performers' ? 'æ¶¨å¹…å‰8å' : 'æ¶¨å¹…å8å';
                console.log(`ğŸ“Š å¼€å§‹æ‰§è¡Œ${strategyName}ç­–ç•¥...`);
                
                // 1. è·å–å¸¸ç”¨å¸åˆ—è¡¨ï¼ˆ15ä¸ªï¼‰
                if (!favoriteSymbols || favoriteSymbols.length === 0) {
                    console.error('âŒ å¸¸ç”¨å¸åˆ—è¡¨ä¸ºç©º');
                    return { success: false, error: 'å¸¸ç”¨å¸åˆ—è¡¨ä¸ºç©º' };
                }
                
                console.log('å¸¸ç”¨å¸åˆ—è¡¨ (15ä¸ª):', favoriteSymbols);
                
                // 2. è·å–è¡Œæƒ…æ•°æ®
                const marketsResponse = await fetch('/api/okx-trading/market-tickers');
                const marketsResult = await marketsResponse.json();
                
                if (!marketsResult.success || !marketsResult.data) {
                    console.error('âŒ è·å–è¡Œæƒ…æ•°æ®å¤±è´¥');
                    return { success: false, error: 'è·å–è¡Œæƒ…æ•°æ®å¤±è´¥' };
                }
                
                // 3. ç­›é€‰å¸¸ç”¨å¸çš„è¡Œæƒ…æ•°æ®
                const favoriteMarkets = marketsResult.data.filter(t => 
                    favoriteSymbols.includes(t.symbol)
                );
                
                console.log(`æ‰¾åˆ° ${favoriteMarkets.length} ä¸ªå¸¸ç”¨å¸çš„è¡Œæƒ…æ•°æ®`);
                
                // 4. æŒ‰æ¶¨è·Œå¹…æ’åº
                let targetCoins;
                if (strategyType === 'top_performers') {
                    // æ¶¨å¹…å‰8åï¼šæŒ‰æ¶¨è·Œå¹…é™åºæ’åˆ—ï¼Œå–å‰8
                    targetCoins = favoriteMarkets
                        .sort((a, b) => b.change24h - a.change24h)
                        .slice(0, 8);
                    console.log('ğŸ“ˆ æ¶¨å¹…å‰8åå¸ç§ï¼ˆä¹°å…¥å¼ºåŠ¿å¸ç§ï¼‰:');
                } else {
                    // æ¶¨å¹…å8åï¼šæŒ‰æ¶¨è·Œå¹…å‡åºæ’åˆ—ï¼Œå–å‰8
                    targetCoins = favoriteMarkets
                        .sort((a, b) => a.change24h - b.change24h)
                        .slice(0, 8);
                    console.log('ğŸ“‰ æ¶¨å¹…å8åå¸ç§ï¼ˆä¹°å…¥å¼±åŠ¿å¸ç§ï¼‰:');
                }
                
                const bottom8 = targetCoins;  // ä¿æŒå˜é‡åå…¼å®¹
                    .slice(0, 8);
                
                console.log('ğŸ“‰ æ¶¨å¹…å8åå¸ç§:');
                bottom8.forEach((coin, index) => {
                    console.log(`  ${index + 1}. ${coin.name} (${coin.symbol}) - æ¶¨è·Œå¹…: ${coin.change24h}%`);
                });
                
                // 5. è·å–è´¦æˆ·ä½™é¢
                const balanceResponse = await fetch('/api/okx-trading/account-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                const balanceResult = await balanceResponse.json();
                if (!balanceResult.success || !balanceResult.data) {
                    console.error('âŒ è·å–è´¦æˆ·ä½™é¢å¤±è´¥');
                    return { success: false, error: 'è·å–è´¦æˆ·ä½™é¢å¤±è´¥' };
                }
                
                const availableBalance = balanceResult.data.availableBalance;
                console.log(`ğŸ’° è´¦æˆ·å¯ç”¨ä½™é¢: ${availableBalance.toFixed(2)} USDT`);
                
                // 6. å¯¹æ¯ä¸ªå¸ç§å¼€å¤šå•
                const results = [];
                const successCoins = [];
                const failedCoins = [];
                
                for (const coin of bottom8) {
                    try {
                        // è®¡ç®—æ¯ä¸ªå¸ç§çš„ä»“ä½ï¼šå¯ç”¨ä½™é¢çš„1.5%
                        const positionUSDT = availableBalance * 0.015; // 1.5%
                        
                        console.log(`\nå‡†å¤‡å¼€å•: ${coin.name}`);
                        console.log(`  å¸ç§: ${coin.symbol}`);
                        console.log(`  å½“å‰ä»·æ ¼: $${coin.price}`);
                        console.log(`  ä»“ä½é‡‘é¢: ${positionUSDT.toFixed(2)} USDT`);
                        console.log(`  æ æ†: 10x`);
                        
                        // è·å–åˆçº¦è§„æ ¼ï¼ˆæ¯å¼ åˆçº¦ä»·å€¼ï¼‰
                        const contractInfo = await getContractInfo(coin.symbol);
                        if (!contractInfo) {
                            console.error(`  âŒ æ— æ³•è·å– ${coin.name} çš„åˆçº¦ä¿¡æ¯`);
                            failedCoins.push({ name: coin.name, error: 'è·å–åˆçº¦ä¿¡æ¯å¤±è´¥' });
                            continue;
                        }
                        
                        // è®¡ç®—å¼ æ•°ï¼špositionUSDT / (ä»·æ ¼ * åˆçº¦é¢å€¼)
                        // ä½¿ç”¨10å€æ æ†ï¼Œå®é™…éœ€è¦çš„ä¿è¯é‡‘æ˜¯ positionUSDT / 10
                        const size = Math.floor(positionUSDT * 10 / (coin.price * contractInfo.ctVal));
                        
                        if (size < 1) {
                            console.warn(`  âš ï¸ ${coin.name} è®¡ç®—å¼ æ•°ä¸è¶³1å¼ ï¼Œè·³è¿‡`);
                            failedCoins.push({ name: coin.name, error: 'ä»“ä½ä¸è¶³1å¼ ' });
                            continue;
                        }
                        
                        console.log(`  å¼€ä»“å¼ æ•°: ${size} å¼ `);
                        
                        // ä¸‹å•
                        const orderResponse = await fetch('/api/okx-trading/place-order', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                apiKey: account.apiKey,
                                apiSecret: account.apiSecret,
                                passphrase: account.passphrase,
                                instId: coin.symbol,
                                tdMode: 'cross', // å…¨ä»“æ¨¡å¼
                                side: 'buy',
                                posSide: 'long',
                                ordType: 'market',
                                sz: size.toString(),
                                lever: '10'
                            })
                        });
                        
                        const orderResult = await orderResponse.json();
                        
                        if (orderResult.success) {
                            console.log(`  âœ… ${coin.name} å¼€å¤šå•æˆåŠŸï¼`);
                            successCoins.push({ name: coin.name, size: size, price: coin.price });
                            results.push({ coin: coin.name, success: true });
                        } else {
                            console.error(`  âŒ ${coin.name} å¼€å•å¤±è´¥:`, orderResult.error);
                            failedCoins.push({ name: coin.name, error: orderResult.error });
                            results.push({ coin: coin.name, success: false, error: orderResult.error });
                        }
                        
                        // å»¶è¿Ÿ100msï¼Œé¿å…é¢‘ç‡é™åˆ¶
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (e) {
                        console.error(`  âŒ ${coin.name} å¼€å•å¼‚å¸¸:`, e);
                        failedCoins.push({ name: coin.name, error: e.message });
                        results.push({ coin: coin.name, success: false, error: e.message });
                    }
                }
                
                // 7. æ±‡æ€»ç»“æœ
                const successCount = successCoins.length;
                const totalCount = bottom8.length;
                
                console.log('\nğŸ“Š æ‰§è¡Œç»“æœæ±‡æ€»:');
                console.log(`  æˆåŠŸ: ${successCount}/${totalCount}`);
                console.log(`  æˆåŠŸå¸ç§:`, successCoins.map(c => c.name).join(', '));
                if (failedCoins.length > 0) {
                    console.log(`  å¤±è´¥å¸ç§:`, failedCoins.map(c => c.name).join(', '));
                }
                
                // å‡†å¤‡æ¶¨å¹…å8åè¯¦æƒ…
                const bottom8Coins = bottom8.map(coin => ({
                    name: coin.name,
                    symbol: coin.symbol,
                    change: coin.change24h,
                    price: coin.price
                }));
                
                return {
                    success: successCount > 0,
                    successCount: successCount,
                    totalCount: totalCount,
                    successCoins: successCoins,
                    failedCoins: failedCoins,
                    bottom8Coins: bottom8Coins,
                    results: results
                };
                
            } catch (e) {
                console.error('âŒ æ‰§è¡Œè‡ªåŠ¨å¼€å•å¼‚å¸¸:', e);
                return { success: false, error: e.message };
            }
        }
        
        // è·å–åˆçº¦ä¿¡æ¯
        async function getContractInfo(symbol) {
            try {
                // ä»å·²åŠ è½½çš„å¸‚åœºæ•°æ®ä¸­è·å–
                // OKX USDTæ°¸ç»­åˆçº¦çš„è§„æ ¼é€šå¸¸æ˜¯ï¼š
                // BTC/ETHç­‰ä¸»æµå¸ï¼š1å¼  = 0.01å¸
                // å…¶ä»–å°å¸ç§ï¼š1å¼  = 0.1å¸ æˆ– 1å¸
                
                // ç®€åŒ–å¤„ç†ï¼šæ ¹æ®å¸ç§åç§°åˆ¤æ–­
                const coinName = symbol.replace('-USDT-SWAP', '');
                
                if (['BTC', 'ETH'].includes(coinName)) {
                    return { ctVal: 0.01 }; // 1å¼  = 0.01å¸
                } else if (['SOL', 'BNB', 'XRP', 'DOGE', 'ADA', 'DOT', 'MATIC', 'SHIB'].includes(coinName)) {
                    return { ctVal: 0.1 }; // 1å¼  = 0.1å¸
                } else {
                    return { ctVal: 1 }; // 1å¼  = 1å¸
                }
            } catch (e) {
                console.error('è·å–åˆçº¦ä¿¡æ¯å¤±è´¥:', e);
                return null;
            }
        }
        
        // å®šæ—¶åˆ·æ–°è´¦æˆ·æ•°æ®ï¼ˆæ¯60ç§’ï¼‰ - ä¸ä¸Šé¢çš„å®šæ—¶å™¨åˆå¹¶ï¼Œé¿å…é‡å¤åˆ·æ–°
        // æ³¨æ„ï¼šæ­¤å®šæ—¶å™¨å·²åœ¨initä¸­è®¾ç½®ï¼Œè¿™é‡Œæ³¨é‡Šæ‰é¿å…é‡å¤
        // setInterval(() => {
        //     refreshAccountData();
        //     updateTotalChangeOKX(); // åŒæ—¶æ›´æ–°æ¶¨è·Œå¹…
        //     checkAndExecuteAutoStrategy(); // æ£€æŸ¥è‡ªåŠ¨äº¤æ˜“ç­–ç•¥
        // }, 60000);
    </script>
</body>
</html>
