<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>OKXå®ç›˜äº¤æ˜“ç³»ç»Ÿ - Fangfang12</title>
    <!-- ç‰ˆæœ¬: 2026-02-08 13:00 - ä¿®å¤è´¦æˆ·åˆ—è¡¨åŠ è½½é—®é¢˜ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 30px;
            zoom: 1.5;
        }

        .container {
            max-width: 2100px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mode-badge {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* è´¦æˆ·åˆ‡æ¢æ¨ªæ¡ */
        .account-switcher {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .account-switcher-label {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-tabs {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .account-tab {
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
        }

        .account-tab:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .account-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .account-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
            padding-left: 20px;
            border-left: 2px solid #e2e8f0;
        }

        .account-balance {
            font-size: 14px;
            color: #64748b;
        }

        .account-balance strong {
            color: #10b981;
            font-size: 16px;
            margin-left: 5px;
        }

        .btn-manage-accounts {
            background: #8b5cf6;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-manage-accounts:hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        /* è´¦æˆ·ç®¡ç†å¯¹è¯æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-header h2 {
            font-size: 22px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #64748b;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .btn-close:hover {
            background: #f1f5f9;
            color: #2d3748;
        }

        .account-list {
            margin-bottom: 25px;
        }

        .account-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .account-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }

        .account-item-info {
            flex: 1;
        }

        .account-item-name {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .account-item-balance {
            font-size: 14px;
            color: #10b981;
            font-weight: 600;
        }

        .account-item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .account-form {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-primary {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-add-account {
            background: #10b981;
            color: white;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-add-account:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-home {
            background: #10b981;
            color: white;
        }

        .btn-home:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-refresh {
            background: #3b82f6;
            color: white;
        }

        .btn-refresh:hover {
            background: #2563eb;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 20px;
        }

        /* å·¦ä¾§äº¤æ˜“å¯¹åˆ—è¡¨ */
        .symbols-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .symbols-panel h3 {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .symbol-search {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .symbol-search:focus {
            border-color: #3b82f6;
        }

        .symbol-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .symbol-item:hover {
            background: #f7fafc;
        }

        .symbol-item.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #1e40af;
        }

        .symbol-item.favorite {
            background: #fef3c7;
            border-color: #fbbf24;
        }

        .symbol-item.favorite.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-color: #b45309;
        }

        .symbol-content {
            flex: 1;
        }

        .symbol-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .favorite-badge {
            color: #f59e0b;
            font-size: 12px;
        }

        .symbol-item.active .favorite-badge {
            color: #fef3c7;
        }

        .symbol-price {
            font-size: 13px;
            opacity: 0.8;
        }

        .favorite-btn {
            padding: 4px 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            opacity: 0;
            margin-left: 8px;
        }

        .symbol-item:hover .favorite-btn {
            opacity: 1;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.favorited {
            opacity: 1;
        }

        .favorite-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #fbbf24;
        }

        .favorite-section-title {
            font-size: 13px;
            color: #d97706;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* ä¸­é—´äº¤æ˜“é¢æ¿ */
        .trading-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .symbol-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .symbol-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .current-symbol {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        .symbol-subtitle {
            font-size: 14px;
            color: #718096;
        }

        .current-price {
            text-align: right;
        }

        .price-value {
            font-size: 32px;
            font-weight: bold;
            color: #10b981;
        }

        .price-change {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 20px;
            margin-top: 5px;
            display: inline-block;
        }

        .price-change.up {
            background: #dcfce7;
            color: #16a34a;
        }

        .price-change.down {
            background: #fee2e2;
            color: #dc2626;
        }

        /* äº¤æ˜“æ–¹å‘æŒ‰é’® */
        .direction-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .direction-tab {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        .direction-tab:hover {
            transform: translateY(-2px);
        }

        .direction-tab.long {
            border-color: #10b981;
            color: #10b981;
        }

        .direction-tab.long.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #059669;
        }

        .direction-tab.short {
            border-color: #ef4444;
            color: #ef4444;
        }

        .direction-tab.short.active {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: #dc2626;
        }

        /* äº¤æ˜“è¡¨å• */
        .trading-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #3b82f6;
        }

        .leverage-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .leverage-btn {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
        }

        .leverage-btn:hover {
            background: #f7fafc;
        }

        .leverage-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #2563eb;
        }

        .amount-presets {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .preset-btn {
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
        }

        .preset-btn:hover {
            background: #f7fafc;
            border-color: #cbd5e0;
        }

        .submit-order {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .submit-order.long {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .submit-order.long:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .submit-order.short {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .submit-order.short:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        /* æ‰¹é‡å¼€ä»“æŒ‰é’® */
        .batch-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .batch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .batch-btn-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .batch-btn-desc {
            font-size: 11px;
            color: #64748b;
        }

        .batch-btn.long .batch-btn-title {
            color: #10b981;
        }

        .batch-btn.short .batch-btn-title {
            color: #ef4444;
        }

        .batch-btn:active {
            transform: scale(0.98);
        }

        /* æ‰¹é‡å¹³ä»“æŒ‰é’® */
        .batch-close-btn {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .batch-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .batch-close-btn:active {
            transform: scale(0.98);
        }

        /* å¹³ä¸€åŠå¤šå• */
        .batch-close-long-half {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            color: #166534;
        }

        .batch-close-long-half:hover {
            box-shadow: 0 4px 12px rgba(74, 222, 128, 0.4);
        }

        /* å¹³ä¸€åŠç©ºå• */
        .batch-close-short-half {
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%);
            color: #7f1d1d;
        }

        .batch-close-short-half:hover {
            box-shadow: 0 4px 12px rgba(248, 113, 113, 0.4);
        }

        /* å¹³å…¨éƒ¨å¤šå• */
        .batch-close-long-all {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .batch-close-long-all:hover {
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.5);
        }

        /* å¹³å…¨éƒ¨ç©ºå• */
        .batch-close-short-all {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .batch-close-short-all:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
        }


        /* å³ä¾§è´¦æˆ·ä¿¡æ¯ */
        .account-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f7fafc;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 13px;
            color: #718096;
        }

        .info-value {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
        }

        .risk-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .risk-warning h4 {
            font-size: 14px;
            color: #92400e;
            margin-bottom: 8px;
        }

        .risk-warning ul {
            font-size: 12px;
            color: #78350f;
            padding-left: 20px;
        }

        .risk-warning li {
            margin-bottom: 4px;
        }

        /* æš‚æ— æŒä»“æç¤º */
        .no-positions {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #a0aec0;
            font-size: 14px;
        }

        /* æŒä»“é¡¹ç›® */
        .position-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .position-symbol {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
        }

        .position-side {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .position-side.long {
            background: #d1fae5;
            color: #065f46;
        }

        .position-side.short {
            background: #fee2e2;
            color: #991b1b;
        }

        .close-position-btn {
            padding: 4px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .close-position-btn:hover {
            background: #dc2626;
        }

        .close-position-btn:active {
            background: #b91c1c;
        }

        .cancel-order-btn {
            padding: 4px 12px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .cancel-order-btn:hover {
            background: #d97706;
        }

        .cancel-order-btn:active {
            background: #b45309;
        }


        .position-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            font-size: 12px;
        }

        .position-detail-item {
            display: flex;
            justify-content: space-between;
        }

        .position-detail-label {
            color: #718096;
        }

        .position-detail-value {
            font-weight: 600;
            color: #2d3748;
        }

        .position-pnl {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 600;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        /* å¼€å…³æ ·å¼ */
        .switch input:checked + .slider {
            background-color: #10b981;
        }
        
        .switch input:checked + .slider:before {
            transform: translateX(20px);
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div>
                <h1>
                    ğŸ’¹ OKXå®ç›˜äº¤æ˜“ç³»ç»Ÿ
                    <span class="mode-badge">ğŸ”´ å®ç›˜äº¤æ˜“</span>
                </h1>
            </div>
            <div class="header-actions">
                <a href="/" class="btn btn-home">ğŸ  è¿”å›é¦–é¡µ</a>
                <a href="/okx-profit-analysis" class="btn btn-home" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">ğŸ“Š åˆ©æ¶¦åˆ†æ</a>
                <button class="btn btn-refresh" onclick="refreshData()">ğŸ”„ åˆ·æ–°</button>
            </div>
        </div>

        <!-- è´¦æˆ·åˆ‡æ¢ -->
        <div class="account-switcher">
            <div class="account-switcher-label">
                ğŸ‘¤ é€‰æ‹©è´¦æˆ·
            </div>
            <div class="account-tabs" id="accountTabs">
                <!-- è´¦æˆ·æ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
            <div class="account-info">
                <span class="account-balance">
                    è´¦æˆ·ä½™é¢: <strong id="accountBalance">0.00 USDT</strong>
                </span>
                <button class="btn-manage-accounts" onclick="openAccountModal()">
                    âš™ï¸ ç®¡ç†è´¦æˆ·
                </button>
                <button class="btn-close-all-positions" onclick="closeAllAccountsPositions()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; margin-left: 15px; box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 16px rgba(239, 68, 68, 0.4)'">
                    ğŸš¨ ä¸€é”®å…¨å¹³
                </button>
            </div>
        </div>

        <!-- ä¸»è¦å¸ƒå±€ -->
        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šäº¤æ˜“å¯¹åˆ—è¡¨ -->
            <div class="symbols-panel">
                <h3>ğŸ’° äº¤æ˜“å¯¹åˆ—è¡¨ (27)</h3>
                <input type="text" class="symbol-search" placeholder="æœç´¢äº¤æ˜“å¯¹..." id="symbolSearch">
                <div id="symbolsList">
                    <!-- äº¤æ˜“å¯¹åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- ä¸­é—´ï¼šäº¤æ˜“é¢æ¿ -->
            <div class="trading-panel">
                <!-- å½“å‰äº¤æ˜“å¯¹ä¿¡æ¯ -->
                <div class="symbol-header">
                    <div class="symbol-info">
                        <div class="current-symbol" id="currentSymbol">BTC-USDT</div>
                        <div class="symbol-subtitle">æ°¸ç»­åˆçº¦</div>
                    </div>
                    <div class="current-price">
                        <div class="price-value" id="currentPrice">95650.00</div>
                        <span class="price-change down" id="priceChange">-0.96%</span>
                    </div>
                </div>

                <!-- äº¤æ˜“æ–¹å‘é€‰æ‹© -->
                <div class="direction-tabs">
                    <div class="direction-tab long active" onclick="selectDirection('long')">
                        â¬† åšå¤š
                    </div>
                    <div class="direction-tab short" onclick="selectDirection('short')">
                        â¬‡ åšç©º
                    </div>
                </div>

                <!-- äº¤æ˜“è¡¨å• -->
                <form class="trading-form" onsubmit="submitOrder(event)">
                    <!-- ä»·æ ¼ç±»å‹ -->
                    <div class="form-group">
                        <label class="form-label">ä»·æ ¼ç±»å‹</label>
                        <select class="form-control" id="priceType">
                            <option value="market">å¸‚ä»·å§”æ‰˜</option>
                            <option value="limit">é™ä»·å§”æ‰˜</option>
                        </select>
                    </div>

                    <!-- æ æ†å€æ•° -->
                    <div class="form-group">
                        <label class="form-label">æ æ†å€æ•°</label>
                        <div class="leverage-buttons">
                            <button type="button" class="leverage-btn" onclick="selectLeverage(3)">3x</button>
                            <button type="button" class="leverage-btn" onclick="selectLeverage(5)">5x</button>
                            <button type="button" class="leverage-btn active" onclick="selectLeverage(10)">10x</button>
                            <button type="button" class="leverage-btn" onclick="selectLeverage(20)">20x</button>
                        </div>
                    </div>

                    <!-- äº¤æ˜“æ•°é‡ -->
                    <div class="form-group">
                        <label class="form-label">å¼€ä»“é‡‘é¢ (USDT)</label>
                        <input type="number" class="form-control" id="orderAmount" placeholder="è¾“å…¥å¼€ä»“é‡‘é¢USDT" step="0.01" required>
                        <div style="margin-top: 8px; font-size: 12px; color: #718096;">
                            å¯ç”¨ä½™é¢: <span id="orderAvailableBalance">224.15 USDT</span>
                        </div>
                        <div style="margin-top: 4px; font-size: 11px; color: #a0aec0;">
                            ğŸ’¡ å®é™…å ç”¨ä¿è¯é‡‘ = å¼€ä»“é‡‘é¢ Ã· æ æ†å€æ•°
                        </div>
                    </div>

                    <!-- å¿«æ·é‡‘é¢ -->
                    <div class="form-group">
                        <div class="amount-presets">
                            <button type="button" class="preset-btn" onclick="setAmount(5)">5%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(10)">10%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(20)">20%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(25)">25%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(33)">33%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(50)">50%</button>
                            <button type="button" class="preset-btn" onclick="setAmount(100)">100%</button>
                        </div>
                    </div>

                    <!-- æäº¤æŒ‰é’® -->
                    <button type="submit" class="submit-order long" id="submitBtn">
                        â¬† åšå¤š
                    </button>
                </form>

                <!-- æ‰¹é‡å¼€ä»“åŠŸèƒ½åŒº - æ¶¨å¹…å‰6åç­–ç•¥ -->
                <div class="batch-trading-section" style="margin-top: 24px; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); max-width: 700px;">
                    <h3 style="color: white; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <span style="font-size: 18px;">âš¡</span>
                        æ¶¨å¹…å‰6åç­–ç•¥
                        <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: auto;">å¸¸è§„ç­–ç•¥</span>
                    </h3>
                    
                    <!-- ç©ºå•ç­–ç•¥è¡Œ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 3)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ A</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 5)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ B</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 8)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ C</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <!-- å¤šå•ç­–ç•¥è¡Œ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 3)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ A</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 5)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ B</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 8)" style="padding: 8px;">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ C</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>ç­–ç•¥è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ ä»â­<strong>å¸¸ç”¨å¸</strong>ä¸­é€‰æ‹©<strong>æ¶¨å¹…å‰6å</strong><br>
                            â€¢ æ¯ä¸ªå¸ç§å¹³å‡åˆ†é…å¼€ä»“é‡‘é¢<br>
                            â€¢ ç»Ÿä¸€ä½¿ç”¨10å€æ æ†ã€å¸‚ä»·å•<br>
                            â€¢ ç©ºå•ç­–ç•¥ï¼šåšç©ºæ¶¨å¹…é«˜çš„å¸ç§<br>
                            â€¢ å¤šå•ç­–ç•¥ï¼šåšå¤šæ¶¨å¹…é«˜çš„å¸ç§<br>
                            â€¢ <span style="color: #fbbf24;">âš ï¸ è¯·å…ˆæ”¶è—è‡³å°‘6ä¸ªå¸¸ç”¨å¸</span>
                        </div>
                    </div>
                </div>

                <!-- æ‰¹é‡å¼€ä»“åŠŸèƒ½åŒº - æ¶¨å¹…å6åç­–ç•¥ (é«˜é£é™©) -->
                <div class="batch-trading-section" style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4); max-width: 700px; border: 3px solid #fbbf24;">
                    <h3 style="color: white; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <span style="font-size: 18px;">âš ï¸</span>
                        æ¶¨å¹…å6åç­–ç•¥
                        <span style="background: rgba(251,191,36,0.9); padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: auto; color: #78350f; font-weight: bold;">âš ï¸ é«˜é£é™©åŒºåŸŸ</span>
                    </h3>
                    
                    <!-- è­¦å‘Šæç¤º -->
                    <div style="margin-bottom: 12px; padding: 10px; background: rgba(251,191,36,0.15); border: 2px solid rgba(251,191,36,0.5); border-radius: 6px; color: #fbbf24; font-size: 12px; font-weight: bold;">
                        âš ï¸ æ³¨æ„ï¼šæ­¤åŒºåŸŸé’ˆå¯¹è·Œå¹…æœ€å¤§çš„å¸ç§ï¼Œæ³¢åŠ¨æ€§æé«˜ï¼Œè¯·è°¨æ…æ“ä½œï¼
                    </div>
                    
                    <!-- å¤šå•ç­–ç•¥è¡Œ (é¢„æœŸåå¼¹) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 3, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ D</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 5, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ E</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn long" onclick="batchOrder('long', 8, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥ F</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <!-- ç©ºå•ç­–ç•¥è¡Œ (è¶‹åŠ¿å»¶ç»­) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 3, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ D</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 3% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 5, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ E</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 5% Â· 10x</div>
                        </button>
                        
                        <button type="button" class="batch-btn short" onclick="batchOrder('short', 8, 'bottom')" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥ F</div>
                            <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å6 Â· 8% Â· 10x</div>
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>ç­–ç•¥è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ ä»â­<strong>å¸¸ç”¨å¸</strong>ä¸­é€‰æ‹©<strong>æ¶¨å¹…å6å</strong>ï¼ˆè·Œå¹…æœ€å¤§ï¼‰<br>
                            â€¢ <strong style="color: #fbbf24;">å¤šå•ç­–ç•¥ï¼š</strong>é¢„æœŸè¶…è·Œåå¼¹ï¼Œå¼€å¤šå•ç­‰å¾…å›å‡<br>
                            â€¢ <strong style="color: #fbbf24;">ç©ºå•ç­–ç•¥ï¼š</strong>é¢„æœŸè¶‹åŠ¿å»¶ç»­ï¼Œåšç©ºç»§ç»­ä¸‹è·Œ<br>
                            â€¢ ç»Ÿä¸€ä½¿ç”¨10å€æ æ†ã€å¸‚ä»·å•<br>
                            â€¢ <span style="color: #fef3c7;">âš ï¸ è·Œå¹…å¤§çš„å¸ç§æ³¢åŠ¨æé«˜ï¼Œé£é™©æå¤§ï¼</span>
                        </div>
                    </div>
                </div>

                <!-- æ‰¹é‡å¼€ä»“åŠŸèƒ½åŒº - æ¶¨å¹…å‰8/å8åç­–ç•¥ -->
                <div class="batch-trading-section" style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4); max-width: 1450px;">
                    <h3 style="color: white; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <span style="font-size: 18px;">ğŸ¯</span>
                        æ¶¨å¹…å‰8/å8åç­–ç•¥
                        <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-left: auto;">æ‰©å±•ç­–ç•¥</span>
                    </h3>
                    
                    <!-- æ¶¨å¹…å‰8åç­–ç•¥åŒºåŸŸ -->
                    <div style="margin-bottom: 16px; padding: 12px; background: rgba(102,126,234,0.2); border-radius: 8px; border: 2px solid rgba(102,126,234,0.4);">
                        <h4 style="color: white; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                            âš¡ æ¶¨å¹…å‰8åç­–ç•¥
                        </h4>
                        
                        <!-- å¤šå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 8px;">
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 1.5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 3)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderTop8('long', 8)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                        
                        <!-- ç©ºå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 1.5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 3)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 5)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderTop8('short', 8)" style="padding: 8px;">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å‰8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æ¶¨å¹…å8åç­–ç•¥åŒºåŸŸ -->
                    <div style="padding: 12px; background: rgba(220,38,38,0.2); border-radius: 8px; border: 2px solid rgba(220,38,38,0.4);">
                        <h4 style="color: white; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                            âš ï¸ æ¶¨å¹…å8åç­–ç•¥ <span style="color: #fbbf24; font-size: 11px; margin-left: auto;">(é«˜é£é™©)</span>
                        </h4>
                        
                        <!-- å¤šå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 8px;">
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 1.5)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 3)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 5)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn long" onclick="batchOrderBottom8('long', 8)" style="padding: 8px; background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“ˆ å¤šå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                        
                        <!-- ç©ºå•ç­–ç•¥è¡Œ -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 1.5)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 1.5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 3)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 3% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 5)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 5% Â· 10x</div>
                            </button>
                            
                            <button type="button" class="batch-btn short" onclick="batchOrderBottom8('short', 8)" style="padding: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="batch-btn-title" style="font-size: 13px;">ğŸ“‰ ç©ºå•ç­–ç•¥</div>
                                <div class="batch-btn-desc" style="font-size: 11px;">æ¶¨å¹…å8 Â· 8% Â· 10x</div>
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>ç­–ç•¥è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ ä»â­<strong>å¸¸ç”¨å¸</strong>ä¸­é€‰æ‹©<strong>æ¶¨å¹…å‰8å</strong>æˆ–<strong>æ¶¨å¹…å8å</strong><br>
                            â€¢ æ¯ä¸ªå¸ç§å¹³å‡åˆ†é…å¼€ä»“é‡‘é¢ï¼Œç»Ÿä¸€ä½¿ç”¨10å€æ æ†<br>
                            â€¢ <strong>æ¶¨å¹…å‰8ï¼š</strong>é’ˆå¯¹è¡¨ç°æœ€å¼ºçš„å¸ç§<br>
                            â€¢ <strong>æ¶¨å¹…å8ï¼š</strong>é’ˆå¯¹è·Œå¹…æœ€å¤§çš„å¸ç§ï¼ˆé«˜é£é™©ï¼‰<br>
                            â€¢ <span style="color: #fbbf24;">âš ï¸ è¯·å…ˆæ”¶è—è‡³å°‘8ä¸ªå¸¸ç”¨å¸</span>
                        </div>
                    </div>
                </div>

                <!-- 1:1å¯¹å†²é…å¯¹ç­–ç•¥ -->
                <div class="batch-trading-section" style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                    <h3 style="color: white; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">âš–ï¸</span>
                        1:1å¯¹å†²é…å¯¹ç­–ç•¥
                    </h3>
                    
                    <div class="batch-strategies" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <!-- ç©ºå•é…å¤šå• -->
                        <button type="button" class="batch-btn" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #78350f;" onclick="hedgePositions('short')">
                            <div class="batch-btn-title">âš–ï¸ ç©ºå•é…å¤šå•</div>
                            <div class="batch-btn-desc">æŒä»“ç©ºå• 1:1 é…å¯¹å¤šå•</div>
                        </button>
                        
                        <!-- å¤šå•é…ç©ºå• -->
                        <button type="button" class="batch-btn" style="background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%); color: #7c2d12;" onclick="hedgePositions('long')">
                            <div class="batch-btn-title">âš–ï¸ å¤šå•é…ç©ºå•</div>
                            <div class="batch-btn-desc">æŒä»“å¤šå• 1:1 é…å¯¹ç©ºå•</div>
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; color: white; font-size: 12px;">
                        <div style="margin-bottom: 4px;">ğŸ’¡ <strong>å¯¹å†²è¯´æ˜ï¼š</strong></div>
                        <div style="padding-left: 20px;">
                            â€¢ <strong>ç©ºå•é…å¤šå•ï¼š</strong>æ ¹æ®ç°æœ‰ç©ºå•æŒä»“ï¼Œå¼€ç­‰é¢å¤šå•å¯¹å†²<br>
                            â€¢ <strong>å¤šå•é…ç©ºå•ï¼š</strong>æ ¹æ®ç°æœ‰å¤šå•æŒä»“ï¼Œå¼€ç­‰é¢ç©ºå•å¯¹å†²<br>
                            â€¢ è‡ªåŠ¨è®¡ç®—æ¯ä¸ªå¸ç§çš„æŒä»“é‡‘é¢<br>
                            â€¢ å¯¹å†²åé”å®šç›ˆäºï¼Œé™ä½é£é™©<br>
                            â€¢ ç¤ºä¾‹ï¼š6ä¸ªç©ºå•å„7U â†’ å¼€6ä¸ªå¤šå•å„7U<br>
                            â€¢ <span style="color: #fef3c7;">âš ï¸ éœ€è¦æœ‰å¯¹åº”æ–¹å‘çš„æŒä»“</span>
                        </div>
                    </div>
                </div>

                <!-- é£é™©æç¤º -->
                <div class="risk-warning">
                    <h4>âš ï¸ é£é™©æç¤º</h4>
                    <ul>
                        <li>åˆçº¦äº¤æ˜“å­˜åœ¨é«˜é£é™©ï¼Œè¯·è°¨æ…æ“ä½œ</li>
                        <li>æ æ†ä¼šæ”¾å¤§æ”¶ç›Šï¼Œä¹Ÿä¼šæ”¾å¤§äºæŸ</li>
                        <li>å»ºè®®è®¾ç½®æ­¢æŸï¼Œæ§åˆ¶é£é™©</li>
                    </ul>
                </div>
            </div>

            <!-- å³ä¾§ï¼šè´¦æˆ·ä¿¡æ¯ -->
            <div class="account-panel">
                <!-- APIé…ç½®æç¤º -->
                <div id="apiConfigNotice" style="display: none; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">âš ï¸</span>
                        <strong style="color: #92400e;">éœ€è¦é…ç½®APIå‡­è¯</strong>
                    </div>
                    <p style="margin: 0 0 8px 28px; color: #78350f; font-size: 13px;">
                        å½“å‰è´¦æˆ·æœªé…ç½®OKX APIå‡­è¯ï¼Œæ— æ³•æŸ¥è¯¢è´¦æˆ·ä½™é¢å’ŒæŒä»“ä¿¡æ¯ã€‚
                    </p>
                    <p style="margin: 0 0 0 28px; color: #78350f; font-size: 13px;">
                        è¯·ç‚¹å‡»è´¦æˆ·æ ‡ç­¾ä¸Šçš„"ç¼–è¾‘"æŒ‰é’®ï¼Œå¡«å…¥æ‚¨çš„API Keyã€API Secretå’ŒPassphraseã€‚
                    </p>
                </div>
                
                <!-- è´¦æˆ·æ€»è§ˆ -->
                <div class="info-card">
                    <h3>ğŸ’° è´¦æˆ·ä¿¡æ¯ <button onclick="refreshAccountData()" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">ğŸ”„</button></h3>
                    <div class="info-row">
                        <span class="info-label">æ€»æƒç›Š</span>
                        <span class="info-value" style="color: #10b981;" id="totalEquity">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å¯ç”¨ä½™é¢</span>
                        <span class="info-value" id="availableBalance">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æŒä»“ä¿è¯é‡‘</span>
                        <span class="info-value" id="usedMargin">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æœªå®ç°ç›ˆäº</span>
                        <span class="info-value" id="unrealizedPnl">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å†»ç»“ä½™é¢</span>
                        <span class="info-value" id="frozenBalance">-- USDT</span>
                    </div>
                </div>

                <!-- è´¦æˆ·ä»“ä½é™é¢ -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #fbbf24;">
                    <h3 style="color: #78350f; margin-bottom: 12px;">ğŸ“Š è´¦æˆ·ä»“ä½é™é¢</h3>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">è´¦æˆ·åç§°</span>
                        <span class="info-value" style="color: #78350f; font-weight: bold;" id="accountName">ä¸»è´¦æˆ·</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">å¼€å§‹æ—¥æœŸ</span>
                        <span class="info-value" style="color: #78350f;" id="accountStartDate">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">å·²è¿è¡Œå¤©æ•°</span>
                        <span class="info-value" style="color: #78350f;" id="accountDaysPassed">-- å¤©</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">å½“å‰æœ€å¤§ä»“ä½</span>
                        <span class="info-value" style="color: #059669; font-weight: bold; font-size: 16px;" id="accountMaxLimit">-- USDT</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">ä¸‹æ¬¡å¢åŠ æ—¥æœŸ</span>
                        <span class="info-value" style="color: #78350f;" id="accountNextIncreaseDate">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label" style="color: #78350f;">è·ç¦»ä¸‹æ¬¡å¢åŠ </span>
                        <span class="info-value" style="color: #78350f;" id="accountDaysUntilIncrease">-- å¤©</span>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: rgba(251, 191, 36, 0.2); border-radius: 6px; border-left: 3px solid #fbbf24;">
                        <p style="color: #78350f; font-size: 11px; margin: 0; line-height: 1.5;">
                            ğŸ’¡ <strong>è§„åˆ™è¯´æ˜ï¼š</strong>è´¦æˆ·ä»å¼€å§‹æ—¥æœŸè®¡ç®—ï¼Œåˆå§‹é™é¢300 USDTï¼Œæ¯æ»¡30å¤©è‡ªåŠ¨å¢åŠ 300 USDTä»“ä½ä¸Šé™ã€‚æ­¤é™é¢ä¸ºç¡¬ç¼–ç è§„åˆ™ï¼Œä¸å¯ä¿®æ”¹ã€‚
                        </p>
                    </div>
                </div>

                <!-- æ¶¨è·Œé¢„è­¦è®¾ç½® -->
                <div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #ef4444;">
                    <h3 style="color: #991b1b; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                        ğŸ”” æ¶¨è·Œé¢„è­¦
                        <button onclick="window.open('/coin-change-tracker', '_blank')" style="margin-left: auto; padding: 4px 10px; font-size: 11px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="æ‰“å¼€è¯¦ç»†é¡µé¢">
                            ğŸ“Š è¯¦æƒ…
                        </button>
                    </h3>
                    
                    <!-- å½“å‰æ¶¨è·Œå¹… -->
                    <div class="info-row" style="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                        <span class="info-label" style="color: #991b1b;">27å¸æ€»æ¶¨è·Œå¹…</span>
                        <span class="info-value" style="font-weight: bold; font-size: 18px;" id="totalChangePercent">--</span>
                    </div>
                    
                    <!-- ä¸Šæ¶¨é¢„è­¦ -->
                    <div style="padding: 10px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid #22c55e; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #166534; font-weight: 600; font-size: 13px;">ğŸ“ˆ ä¸Šæ¶¨é¢„è­¦</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="upperAlertSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="number" id="upperThreshold" value="30" step="0.1" min="0" max="100" 
                                   style="flex: 1; padding: 6px 10px; border: 1px solid #22c55e; border-radius: 6px; font-size: 13px;">
                            <span style="color: #166534; font-size: 13px; font-weight: 600;">%</span>
                        </div>
                        <div style="font-size: 11px; color: #166534; margin-top: 6px;">
                            æ¶¨å¹…è¶…è¿‡æ­¤å€¼æ—¶è§¦å‘
                        </div>
                    </div>
                    
                    <!-- ä¸‹è·Œé¢„è­¦ -->
                    <div style="padding: 10px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid #ef4444; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #991b1b; font-weight: 600; font-size: 13px;">ğŸ“‰ ä¸‹è·Œé¢„è­¦</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                                <input type="checkbox" id="lowerAlertSwitch" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="number" id="lowerThreshold" value="-40" step="0.1" max="0" min="-100" 
                                   style="flex: 1; padding: 6px 10px; border: 1px solid #ef4444; border-radius: 6px; font-size: 13px;">
                            <span style="color: #991b1b; font-size: 13px; font-weight: 600;">%</span>
                        </div>
                        <div style="font-size: 11px; color: #991b1b; margin-top: 6px;">
                            è·Œå¹…å°äºæ­¤å€¼æ—¶è§¦å‘
                        </div>
                    </div>
                    
                    <!-- ä¿å­˜æŒ‰é’® -->
                    <button onclick="saveAlertSettingsOKX()" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);">
                        ğŸ’¾ ä¿å­˜é¢„è­¦è®¾ç½®
                    </button>
                    
                    <!-- æç¤º -->
                    <div style="margin-top: 10px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 6px; border-left: 3px solid #ef4444;">
                        <p style="color: #991b1b; font-size: 10px; margin: 0; line-height: 1.4;">
                            ğŸ’¡ è§¦å‘åå°†æ’­æ”¾éŸ³æ•ˆã€æ˜¾ç¤ºå¼¹çª—ï¼Œå¹¶è‡ªåŠ¨å…³é—­å¼€å…³ã€‚éœ€è¦é‡æ–°å¼€å¯æ‰èƒ½å†æ¬¡è§¦å‘ã€‚
                        </p>
                    </div>
                </div>

                <!-- æŒä»“åˆ—è¡¨ -->
                <div class="info-card">
                    <h3 style="margin-bottom: 12px;">
                        ğŸ“Š æŒä»“ 
                        <span id="positionsCount" style="color: #888; font-size: 14px; font-weight: normal;">(0)</span>
                        <button onclick="loadPositions()" style="float: right; padding: 4px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="åˆ·æ–°æŒä»“">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </h3>
                    
                    <!-- æ‰¹é‡å¹³ä»“æŒ‰é’®ç»„ -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 16px;">
                        <button onclick="batchClosePositions('long', 0.5)" class="batch-close-btn batch-close-long-half">
                            ğŸ“‰ å¹³ä¸€åŠå¤šå•
                        </button>
                        <button onclick="batchClosePositions('short', 0.5)" class="batch-close-btn batch-close-short-half">
                            ğŸ“ˆ å¹³ä¸€åŠç©ºå•
                        </button>
                        <button onclick="batchClosePositions('long', 1)" class="batch-close-btn batch-close-long-all">
                            ğŸš« å¹³å…¨éƒ¨å¤šå•
                        </button>
                        <button onclick="batchClosePositions('short', 1)" class="batch-close-btn batch-close-short-all">
                            â›” å¹³å…¨éƒ¨ç©ºå•
                        </button>
                    </div>
                    
                    <div id="positionsList" class="no-positions">
                        æš‚æ— æŒä»“
                    </div>
                </div>

                <!-- å½“å‰å§”æ‰˜åˆ—è¡¨ -->
                <div class="info-card" style="margin-top: 24px;">
                    <h3>
                        ğŸ“‹ å½“å‰å§”æ‰˜ 
                        <span id="pendingOrdersCount" style="color: #888; font-size: 14px; font-weight: normal;">(0)</span>
                        <button onclick="loadPendingOrders()" style="float: right; padding: 4px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="åˆ·æ–°å§”æ‰˜">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </h3>
                    <div id="pendingOrdersList" class="no-positions">
                        æš‚æ— å§”æ‰˜
                    </div>
                </div>
                
                <!-- äº¤æ˜“æ—¥å¿— -->
                <div class="info-card" style="margin-top: 24px;">
                    <h3>
                        ğŸ“œ äº¤æ˜“æ—¥å¿— 
                        <span id="logsCount" style="color: #888; font-size: 14px; font-weight: normal;">(0)</span>
                        <button onclick="loadTradingLogs()" style="float: right; padding: 4px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;" title="åˆ·æ–°æ—¥å¿—">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </h3>
                    <div style="margin-bottom: 12px; font-size: 12px; color: #64748b;">
                        ğŸ“ æ‰€æœ‰æ“ä½œå‡è‡ªåŠ¨è®°å½•ï¼Œä¸å¯ä¿®æ”¹ | æ•°æ®ä¿å­˜æ ¼å¼: JSONL
                    </div>
                    <div id="tradingLogsList" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; padding: 20px; color: #94a3b8;">
                            æš‚æ— æ—¥å¿—
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å½“å‰äº¤æ˜“æ–¹å‘
        let currentDirection = 'long';
        let currentLeverage = 10;
        let currentSymbol = 'BTC-USDT-SWAP';

        // å½“å‰è´¦æˆ·
        let currentAccount = 'account_fangfang12';
        
        // æ”¶è—çš„äº¤æ˜“å¯¹ï¼ˆä»æœåŠ¡å™¨APIè¯»å–ï¼Œå…¨å±€å…±äº«ï¼‰
        let favoriteSymbols = [];
        
        // ä»æœåŠ¡å™¨åŠ è½½å¸¸ç”¨å¸åˆ—è¡¨
        async function loadFavoriteSymbols() {
            try {
                const response = await fetch('/api/okx-trading/favorite-symbols');
                const data = await response.json();
                
                if (data.success) {
                    favoriteSymbols = data.symbols || [];
                    console.log('âœ… å·²åŠ è½½å¸¸ç”¨å¸åˆ—è¡¨:', favoriteSymbols);
                } else {
                    console.error('âŒ åŠ è½½å¸¸ç”¨å¸å¤±è´¥:', data.error);
                    // ä½¿ç”¨é»˜è®¤åˆ—è¡¨
                    favoriteSymbols = ["BTC-USDT-SWAP", "ETH-USDT-SWAP", "SOL-USDT-SWAP", 
                                      "BNB-USDT-SWAP", "XRP-USDT-SWAP", "DOGE-USDT-SWAP"];
                }
            } catch (error) {
                console.error('âŒ åŠ è½½å¸¸ç”¨å¸å¼‚å¸¸:', error);
                // ä½¿ç”¨é»˜è®¤åˆ—è¡¨
                favoriteSymbols = ["BTC-USDT-SWAP", "ETH-USDT-SWAP", "SOL-USDT-SWAP", 
                                  "BNB-USDT-SWAP", "XRP-USDT-SWAP", "DOGE-USDT-SWAP"];
            }
        }
        
        // ä¿å­˜å¸¸ç”¨å¸åˆ—è¡¨åˆ°æœåŠ¡å™¨
        async function saveFavoriteSymbols() {
            try {
                const response = await fetch('/api/okx-trading/favorite-symbols', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbols: favoriteSymbols })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('âœ… å¸¸ç”¨å¸åˆ—è¡¨å·²ä¿å­˜åˆ°æœåŠ¡å™¨');
                } else {
                    console.error('âŒ ä¿å­˜å¸¸ç”¨å¸å¤±è´¥:', data.error);
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜å¸¸ç”¨å¸å¼‚å¸¸:', error);
            }
        }
        
        // ä»localStorageåŠ è½½è´¦æˆ·åˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤è´¦æˆ·
        let accounts = JSON.parse(localStorage.getItem('okx_accounts') || JSON.stringify([
            { 
                id: 'account_main', 
                name: 'ä¸»è´¦æˆ·', 
                apiKey: 'b0c18f2d-e014-4ae8-9c3c-cb02161de4db',
                apiSecret: '92F864C599B2CE2EC5186AD14C8B4110',
                passphrase: 'Tencent@123',
                balance: 0 
            },
            { 
                id: 'account_fangfang12', 
                name: 'Fangfang12', 
                apiKey: 'e5867a9a-93b7-476f-81ce-093c3aacae0d',
                apiSecret: '4624EE63A9BF3F84250AC71C9A37F47D',
                passphrase: 'Tencent@123',
                balance: 0 
            },
            { 
                id: 'account_anchor', 
                name: 'é”šç‚¹è´¦å·', 
                apiKey: '0b05a729-40eb-4809-b3eb-eb2de75b7e9e',
                apiSecret: '4E4DA8BE3B18D01AA07185A006BF9F8E',
                passphrase: 'Tencent@123',
                balance: 0 
            },
            { 
                id: 'account_poit', 
                name: 'POIT', 
                apiKey: '8650e46c-059b-431d-93cf-55f8c79babdb',
                apiSecret: '4C2BD2AC6A08615EA7F36A6251857FCE',
                passphrase: 'Wu666666.',
                balance: 0 
            }
        ]));

        // äº¤æ˜“å¯¹æ•°æ®ï¼ˆåˆå§‹åŒ–ä¸ºç©ºï¼Œä»APIåŠ è½½ï¼‰
        let symbols = [];

        // åŠ è½½å®æ—¶è¡Œæƒ…æ•°æ®
        async function loadMarketTickers() {
            try {
                console.log('[loadMarketTickers] å¼€å§‹åŠ è½½è¡Œæƒ…æ•°æ®...');
                const response = await fetch('/api/okx-trading/market-tickers');
                const result = await response.json();
                
                if (result.success && result.data) {
                    symbols = result.data.map(ticker => ({
                        symbol: ticker.symbol,
                        name: ticker.name,
                        price: ticker.price,
                        change: ticker.change24h  // 24hæ¶¨è·Œå¹…
                    }));
                    console.log(`[loadMarketTickers] åŠ è½½æˆåŠŸï¼Œå…±${symbols.length}ä¸ªäº¤æ˜“å¯¹`);
                    
                    // é‡æ–°æ¸²æŸ“äº¤æ˜“å¯¹åˆ—è¡¨
                    renderSymbolsList();
                } else {
                    console.error('[loadMarketTickers] åŠ è½½å¤±è´¥:', result.error);
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    symbols = [
                        { symbol: 'BTC-USDT-SWAP', name: 'BTC', price: 0, change: 0 },
                        { symbol: 'ETH-USDT-SWAP', name: 'ETH', price: 0, change: 0 }
                    ];
                    renderSymbolsList();
                }
            } catch (error) {
                console.error('[loadMarketTickers] åŠ è½½å¼‚å¸¸:', error);
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                symbols = [
                    { symbol: 'BTC-USDT-SWAP', name: 'BTC', price: 0, change: 0 },
                    { symbol: 'ETH-USDT-SWAP', name: 'ETH', price: 0, change: 0 }
                ];
                renderSymbolsList();
            }
        }

        // åŠ è½½è´¦æˆ·ä¿¡æ¯
        async function loadAccountInfo() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                // æ²¡æœ‰APIå‡­è¯ï¼Œæ˜¾ç¤ºé»˜è®¤å€¼å’Œæç¤º
                document.getElementById('totalEquity').textContent = 'æœªé…ç½®';
                document.getElementById('availableBalance').textContent = 'æœªé…ç½®';
                document.getElementById('usedMargin').textContent = 'æœªé…ç½®';
                document.getElementById('unrealizedPnl').textContent = 'æœªé…ç½®';
                document.getElementById('frozenBalance').textContent = 'æœªé…ç½®';
                
                // æ˜¾ç¤ºé…ç½®æç¤º
                showApiConfigNotice();
                return;
            }
            
            // éšè—é…ç½®æç¤º
            hideApiConfigNotice();

            try {
                const response = await fetch('/api/okx-trading/account-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });

                const result = await response.json();

                if (result.success && result.data) {
                    const data = result.data;
                    document.getElementById('totalEquity').textContent = data.totalEquity.toFixed(2) + ' USDT';
                    document.getElementById('availableBalance').textContent = data.availableBalance.toFixed(2) + ' USDT';
                    document.getElementById('usedMargin').textContent = data.usedMargin.toFixed(2) + ' USDT';
                    
                    // æ›´æ–°è´¦æˆ·å¯¹è±¡ä¸­çš„ä½™é¢ï¼ˆä½¿ç”¨å¯ç”¨ä½™é¢ï¼‰
                    account.balance = data.availableBalance;
                    localStorage.setItem('okx_accounts', JSON.stringify(accounts));
                    
                    // åŒæ—¶æ›´æ–°è®¢å•è¡¨å•ä¸­çš„å¯ç”¨ä½™é¢
                    const orderBalanceEl = document.getElementById('orderAvailableBalance');
                    if (orderBalanceEl) {
                        orderBalanceEl.textContent = data.availableBalance.toFixed(2) + ' USDT';
                    }
                    
                    // æ›´æ–°è´¦æˆ·æ ‡ç­¾å¤„çš„ä½™é¢
                    const accountBalanceEl = document.getElementById('accountBalance');
                    if (accountBalanceEl) {
                        accountBalanceEl.textContent = data.availableBalance.toFixed(2) + ' USDT';
                    }
                    
                    // æœªå®ç°ç›ˆäºå¸¦é¢œè‰²
                    const uplElement = document.getElementById('unrealizedPnl');
                    const upl = data.unrealizedPnl;
                    uplElement.textContent = (upl >= 0 ? '+' : '') + upl.toFixed(2) + ' USDT';
                    uplElement.style.color = upl >= 0 ? '#10b981' : '#ef4444';
                    
                    document.getElementById('frozenBalance').textContent = data.frozenBalance.toFixed(2) + ' USDT';
                } else {
                    console.error('è·å–è´¦æˆ·ä¿¡æ¯å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('åŠ è½½è´¦æˆ·ä¿¡æ¯å¼‚å¸¸:', error);
            }
        }

        // åŠ è½½æŒä»“åˆ—è¡¨
        async function loadPositions() {
            console.log('[loadPositions] å¼€å§‹åŠ è½½æŒä»“...');
            console.log('[loadPositions] currentAccount:', currentAccount);
            console.log('[loadPositions] accounts:', accounts);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            console.log('[loadPositions] æ‰¾åˆ°çš„è´¦æˆ·:', account);
            
            if (!account) {
                console.error('[loadPositions] è´¦æˆ·ä¸å­˜åœ¨');
                document.getElementById('positionsList').innerHTML = '<div class="no-positions">è´¦æˆ·ä¸å­˜åœ¨</div>';
                document.getElementById('positionsCount').textContent = '(0)';
                return;
            }
            
            console.log('[loadPositions] APIå‡­è¯æ£€æŸ¥:', {
                hasApiKey: !!account.apiKey,
                hasApiSecret: !!account.apiSecret,
                hasPassphrase: !!account.passphrase
            });
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                console.log('[loadPositions] æœªé…ç½®APIå‡­è¯');
                document.getElementById('positionsList').innerHTML = '<div class="no-positions">è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯</div>';
                document.getElementById('positionsCount').textContent = '(0)';
                return;
            }

            try {
                console.log('[loadPositions] è°ƒç”¨API...');
                const response = await fetch('/api/okx-trading/positions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });

                const result = await response.json();
                console.log('[loadPositions] APIå“åº”:', result);

                if (result.success && result.data) {
                    const positions = result.data;
                    const positionsCount = positions.length;
                    
                    console.log('[loadPositions] æŒä»“æ•°é‡:', positionsCount);
                    console.log('[loadPositions] æŒä»“æ•°æ®:', positions);
                    
                    document.getElementById('positionsCount').textContent = `(${positionsCount})`;
                    
                    if (positionsCount === 0) {
                        document.getElementById('positionsList').innerHTML = '<div class="no-positions">æš‚æ— æŒä»“</div>';
                    } else {
                        // æ›´æ–°å·²ç”¨ä¿è¯é‡‘
                        if (result.summary) {
                            document.getElementById('usedMargin').textContent = result.summary.totalMargin.toFixed(2) + ' USDT';
                        }
                        
                        // æ¸²æŸ“æŒä»“åˆ—è¡¨
                        const html = positions.map(pos => {
                            const pnlColor = pos.unrealizedPnl >= 0 ? '#10b981' : '#ef4444';
                            const pnlSign = pos.unrealizedPnl >= 0 ? '+' : '';
                            const sideClass = pos.posSide === 'long' ? 'long' : 'short';
                            const sideName = pos.posSide === 'long' ? 'åšå¤š' : 'åšç©º';
                            
                            return `
                                <div class="position-item">
                                    <div class="position-header">
                                        <span class="position-symbol">${pos.instId}</span>
                                        <span class="position-side ${sideClass}">${sideName}</span>
                                        <button class="close-position-btn" onclick="closePosition('${pos.instId}', '${pos.posSide}')">
                                            å¹³ä»“
                                        </button>
                                    </div>
                                    <div class="position-details">
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æŒä»“é‡:</span>
                                            <span class="position-detail-value">${pos.posSize}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æ æ†:</span>
                                            <span class="position-detail-value">${pos.leverage}x</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">å¼€ä»“ä»·:</span>
                                            <span class="position-detail-value">$${pos.avgPrice.toFixed(2)}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æ ‡è®°ä»·:</span>
                                            <span class="position-detail-value">$${pos.markPrice.toFixed(2)}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">ä¿è¯é‡‘:</span>
                                            <span class="position-detail-value">${pos.margin.toFixed(2)} USDT</span>
                                        </div>
                                    </div>
                                    <div class="position-pnl">
                                        <span>æœªå®ç°ç›ˆäº:</span>
                                        <span style="color: ${pnlColor};">
                                            ${pnlSign}${pos.unrealizedPnl.toFixed(2)} USDT 
                                            (${pnlSign}${pos.unrealizedPnlRatio.toFixed(2)}%)
                                        </span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        document.getElementById('positionsList').innerHTML = html;
                    }
                } else {
                    console.error('[loadPositions] è·å–æŒä»“å¤±è´¥:', result.error);
                    console.error('[loadPositions] å®Œæ•´å“åº”:', result);
                    document.getElementById('positionsList').innerHTML = '<div class="no-positions">åŠ è½½å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('[loadPositions] åŠ è½½æŒä»“å¼‚å¸¸:', error);
                document.getElementById('positionsList').innerHTML = '<div class="no-positions">åŠ è½½å¼‚å¸¸</div>';
            }
        }

        // åˆ·æ–°è´¦æˆ·æ•°æ®ï¼ˆè´¦æˆ·ä¿¡æ¯+æŒä»“ï¼‰
        async function refreshAccountData() {
            await Promise.all([
                loadAccountInfo(),
                loadPositions()
            ]);
        }

        // åŠ è½½è´¦æˆ·ä»“ä½é™é¢
        async function loadAccountLimit() {
            console.log('[loadAccountLimit] å¼€å§‹åŠ è½½è´¦æˆ·ä»“ä½é™é¢...');
            
            const account = accounts.find(acc => acc.id === currentAccount);
            const accountName = account ? account.name : 'ä¸»è´¦æˆ·';
            
            try {
                const response = await fetch(`/api/okx-trading/account-limit?account_name=${encodeURIComponent(accountName)}`);
                const result = await response.json();
                
                console.log('[loadAccountLimit] APIå“åº”:', result);
                
                if (result.success) {
                    const data = result.data;
                    
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    document.getElementById('accountName').textContent = data.account_name;
                    document.getElementById('accountStartDate').textContent = data.start_date;
                    document.getElementById('accountDaysPassed').textContent = `${data.days_passed} å¤©`;
                    document.getElementById('accountMaxLimit').textContent = `${data.current_max_limit} USDT`;
                    document.getElementById('accountNextIncreaseDate').textContent = data.next_increase_date;
                    document.getElementById('accountDaysUntilIncrease').textContent = `${data.days_until_next_increase} å¤©`;
                    
                    console.log(`âœ… è´¦æˆ·é™é¢å·²æ›´æ–°: ${data.current_max_limit} USDT`);
                } else {
                    console.error('[loadAccountLimit] åŠ è½½å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('[loadAccountLimit] åŠ è½½å¼‚å¸¸:', error);
            }
        }

        // å¹³ä»“å‡½æ•°
        async function closePosition(instId, posSide) {
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            const sideName = posSide === 'long' ? 'åšå¤š' : 'åšç©º';
            const confirmMsg = `ç¡®è®¤å¹³ä»“ ${instId} ${sideName} æŒä»“ï¼Ÿ`;
            
            // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            const confirmed = await showConfirmDialog(confirmMsg, 'ğŸ”” æ‰¹é‡å¹³å…¨å•æç¤º');
            if (!confirmed) {
                return;
            }
            
            try {
                const response = await fetch('/api/okx-trading/close-position', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        instId: instId,
                        posSide: posSide
                    })
                });
                
                const result = await response.json();
                console.log('å¹³ä»“å“åº”:', result);
                
                if (result.success) {
                    alert('âœ… å¹³ä»“æˆåŠŸï¼');
                    // å¹³ä»“æˆåŠŸååˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
                    await refreshAccountData();
                } else {
                    const errorMsg = result.error || 'æœªçŸ¥é”™è¯¯';
                    // ç‰¹æ®Šå¤„ç†"æ²¡æœ‰æŒä»“"é”™è¯¯
                    if (errorMsg.includes('æ²¡æœ‰') && errorMsg.includes('æŒä»“')) {
                        alert(`âš ï¸ ${errorMsg}\n\nå¯èƒ½åŸå› ï¼š\nâ€¢ æŒä»“å·²è¢«å…¶ä»–æ“ä½œå¹³ä»“\nâ€¢ è´¦æˆ·åˆ‡æ¢åæŒä»“æœªåŒæ­¥\nâ€¢ æŒä»“å·²è¿‡æœŸæˆ–è¢«æ¸…ç®—\n\nå»ºè®®ï¼šç‚¹å‡»"åˆ·æ–°"æŒ‰é’®æ›´æ–°æŒä»“ä¿¡æ¯`);
                        // è‡ªåŠ¨åˆ·æ–°æŒä»“åˆ—è¡¨
                        console.log('[closePosition] æŒä»“ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ·æ–°æŒä»“åˆ—è¡¨');
                        await refreshAccountData();
                    } else {
                        alert(`âŒ å¹³ä»“å¤±è´¥: ${errorMsg}`);
                    }
                }
            } catch (error) {
                console.error('å¹³ä»“å¼‚å¸¸:', error);
                alert(`âŒ å¹³ä»“å¼‚å¸¸: ${error.message || error}`);
            }
        }

        // åŠ è½½å½“å‰å§”æ‰˜ï¼ˆæœªæˆäº¤è®¢å•ï¼‰
        async function loadPendingOrders() {
            console.log('[loadPendingOrders] å¼€å§‹åŠ è½½å§”æ‰˜è®¢å•...');
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account) {
                console.error('[loadPendingOrders] è´¦æˆ·ä¸å­˜åœ¨');
                document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">è´¦æˆ·ä¸å­˜åœ¨</div>';
                document.getElementById('pendingOrdersCount').textContent = '(0)';
                return;
            }
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                console.log('[loadPendingOrders] æœªé…ç½®APIå‡­è¯');
                document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯</div>';
                document.getElementById('pendingOrdersCount').textContent = '(0)';
                return;
            }

            try {
                console.log('[loadPendingOrders] è°ƒç”¨API...');
                const response = await fetch('/api/okx-trading/pending-orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });

                const result = await response.json();
                console.log('[loadPendingOrders] APIå“åº”:', result);

                if (result.success && result.data) {
                    const orders = result.data;
                    const ordersCount = orders.length;
                    
                    console.log('[loadPendingOrders] å§”æ‰˜æ•°é‡:', ordersCount);
                    
                    document.getElementById('pendingOrdersCount').textContent = `(${ordersCount})`;
                    
                    if (ordersCount === 0) {
                        document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">æš‚æ— å§”æ‰˜</div>';
                    } else {
                        // æ¸²æŸ“å§”æ‰˜è®¢å•åˆ—è¡¨
                        const html = orders.map(order => {
                            const sideClass = order.posSide === 'long' ? 'long' : 'short';
                            const sideName = order.posSide === 'long' ? 'åšå¤š' : 'åšç©º';
                            const sideAction = order.side === 'buy' ? 'ä¹°å…¥' : 'å–å‡º';
                            
                            // æ ¼å¼åŒ–åˆ›å»ºæ—¶é—´
                            const createTime = new Date(parseInt(order.createTime)).toLocaleString('zh-CN');
                            
                            return `
                                <div class="position-item" style="border-left: 3px solid #f59e0b;">
                                    <div class="position-header">
                                        <span class="position-symbol">${order.instId}</span>
                                        <span class="position-side ${sideClass}">${sideName}</span>
                                        <button class="cancel-order-btn" onclick="cancelOrder('${order.ordId}', '${order.instId}')">
                                            æ’¤é”€
                                        </button>
                                    </div>
                                    <div class="position-details">
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">çŠ¶æ€:</span>
                                            <span class="position-detail-value" style="color: #f59e0b;">${order.stateText}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">ç±»å‹:</span>
                                            <span class="position-detail-value">${order.ordTypeText}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">æ•°é‡:</span>
                                            <span class="position-detail-value">${order.size}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">ä»·æ ¼:</span>
                                            <span class="position-detail-value">$${parseFloat(order.price).toFixed(4)}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">å·²æˆäº¤:</span>
                                            <span class="position-detail-value">${order.filledSize}</span>
                                        </div>
                                        <div class="position-detail-item">
                                            <span class="position-detail-label">åˆ›å»ºæ—¶é—´:</span>
                                            <span class="position-detail-value" style="font-size: 11px;">${createTime}</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 8px; font-size: 11px; color: #888;">
                                        è®¢å•ID: ${order.ordId}
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        document.getElementById('pendingOrdersList').innerHTML = html;
                    }
                } else {
                    console.error('[loadPendingOrders] è·å–å§”æ‰˜åˆ—è¡¨å¤±è´¥:', result.error);
                    document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">åŠ è½½å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('[loadPendingOrders] åŠ è½½å§”æ‰˜å¼‚å¸¸:', error);
                document.getElementById('pendingOrdersList').innerHTML = '<div class="no-positions">åŠ è½½å¼‚å¸¸</div>';
            }
        }

        // æ’¤é”€è®¢å•å‡½æ•°
        async function cancelOrder(ordId, instId) {
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            const confirmMsg = `ç¡®è®¤æ’¤é”€è®¢å•ï¼Ÿ\n\näº¤æ˜“å¯¹: ${instId}\nè®¢å•ID: ${ordId}`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            try {
                const response = await fetch('/api/okx-trading/cancel-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        ordId: ordId,
                        instId: instId
                    })
                });
                
                const result = await response.json();
                console.log('æ’¤é”€å“åº”:', result);
                
                if (result.success) {
                    alert('âœ… è®¢å•å·²æ’¤é”€ï¼');
                    // æ’¤é”€æˆåŠŸååˆ·æ–°è´¦æˆ·ä¿¡æ¯ã€æŒä»“å’Œå§”æ‰˜åˆ—è¡¨
                    await refreshAccountData();
                    await loadPendingOrders();
                } else {
                    alert(`âŒ æ’¤é”€å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                console.error('æ’¤é”€å¼‚å¸¸:', error);
                alert(`âŒ æ’¤é”€å¼‚å¸¸: ${error.message || error}`);
            }
        }


        // æ˜¾ç¤ºAPIé…ç½®æç¤º
        function showApiConfigNotice() {
            const notice = document.getElementById('apiConfigNotice');
            if (notice) {
                notice.style.display = 'block';
            }
        }

        // éšè—APIé…ç½®æç¤º
        function hideApiConfigNotice() {
            const notice = document.getElementById('apiConfigNotice');
            if (notice) {
                notice.style.display = 'none';
            }
        }

        // åŠ è½½äº¤æ˜“æ—¥å¿—
        async function loadTradingLogs() {
            console.log('[loadTradingLogs] å¼€å§‹åŠ è½½äº¤æ˜“æ—¥å¿—');
            
            try {
                const response = await fetch('/api/okx-trading/logs?limit=50');
                const result = await response.json();
                
                if (result.success && result.logs) {
                    const logs = result.logs;
                    const logsCount = document.getElementById('logsCount');
                    const logsContainer = document.getElementById('tradingLogsList');
                    
                    logsCount.textContent = `(${logs.length})`;
                    
                    if (logs.length === 0) {
                        logsContainer.innerHTML = `
                            <div style="text-align: center; padding: 20px; color: #94a3b8;">
                                æš‚æ— æ—¥å¿—
                            </div>
                        `;
                        return;
                    }
                    
                    // åè½¬é¡ºåºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢
                    const reversedLogs = [...logs].reverse();
                    
                    logsContainer.innerHTML = reversedLogs.map(log => {
                        const time = new Date(log.timestamp).toLocaleString('zh-CN');
                        const actionEmoji = {
                            'open_position': 'ğŸ“ˆ',
                            'close_position': 'ğŸ“‰',
                            'cancel_order': 'ğŸš«',
                            'batch_open': 'ğŸ¯',
                            'batch_close': 'âš¡'
                        }[log.action] || 'ğŸ“';
                        
                        const actionText = {
                            'open_position': 'å¼€ä»“',
                            'close_position': 'å¹³ä»“',
                            'cancel_order': 'æ’¤å•',
                            'batch_open': 'æ‰¹é‡å¼€ä»“',
                            'batch_close': 'æ‰¹é‡å¹³ä»“'
                        }[log.action] || log.action;
                        
                        const status = log.result.status;
                        const statusColor = status === 'success' ? '#10b981' : '#ef4444';
                        const statusText = status === 'success' ? 'æˆåŠŸ' : 'å¤±è´¥';
                        const statusEmoji = status === 'success' ? 'âœ…' : 'âŒ';
                        
                        // æ„å»ºè¯¦æƒ…æ–‡æœ¬
                        let detailsText = '';
                        if (log.details.instId) {
                            const coinName = log.details.instId.replace('-USDT-SWAP', '');
                            detailsText += `${coinName} `;
                        }
                        if (log.details.posSide) {
                            detailsText += log.details.posSide === 'long' ? 'åšå¤š' : 'åšç©º';
                            detailsText += ' ';
                        }
                        if (log.details.inputUsdt) {
                            detailsText += `${log.details.inputUsdt} USDT`;
                        }
                        if (log.details.contracts) {
                            detailsText += ` (${log.details.contracts}å¼ )`;
                        }
                        if (log.details.leverage) {
                            detailsText += ` ${log.details.leverage}x`;
                        }
                        
                        // é”™è¯¯ä¿¡æ¯
                        let errorText = '';
                        if (status === 'failed' && log.result.error) {
                            errorText = `<div style="margin-top: 4px; font-size: 11px; color: #ef4444;">é”™è¯¯: ${log.result.error}</div>`;
                        }
                        
                        return `
                            <div style="padding: 12px; border-bottom: 1px solid #e5e7eb; transition: background 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='transparent'">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                                    <div>
                                        <span style="font-size: 16px;">${actionEmoji}</span>
                                        <strong style="margin-left: 6px; color: #1e293b;">${actionText}</strong>
                                        <span style="margin-left: 8px; color: #64748b; font-size: 13px;">${detailsText}</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <span style="font-size: 14px;">${statusEmoji}</span>
                                        <span style="margin-left: 4px; color: ${statusColor}; font-weight: 600; font-size: 13px;">${statusText}</span>
                                    </div>
                                </div>
                                <div style="font-size: 11px; color: #94a3b8;">
                                    ${time}
                                </div>
                                ${errorText}
                            </div>
                        `;
                    }).join('');
                    
                    console.log(`[loadTradingLogs] åŠ è½½äº† ${logs.length} æ¡æ—¥å¿—`);
                } else {
                    console.error('[loadTradingLogs] åŠ è½½å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('[loadTradingLogs] åŠ è½½å¼‚å¸¸:', error);
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        // ä»åç«¯APIåŠ è½½è´¦æˆ·åˆ—è¡¨
        async function loadAccountsList() {
            console.log('[loadAccountsList] å¼€å§‹åŠ è½½è´¦æˆ·åˆ—è¡¨...');
            try {
                const response = await fetch('/api/okx-accounts/list-with-credentials');
                const result = await response.json();
                
                if (result.success && result.accounts) {
                    console.log('[loadAccountsList] ä»åç«¯åŠ è½½æˆåŠŸ:', result);
                    
                    // å°†åç«¯è´¦æˆ·è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼
                    accounts = result.accounts.map(acc => ({
                        id: acc.id || acc.account_id,
                        name: acc.name || acc.account_name,
                        apiKey: acc.apiKey || acc.api_key,
                        apiSecret: acc.apiSecret || acc.api_secret,
                        passphrase: acc.passphrase,
                        balance: 0
                    }));
                    
                    // ä¿å­˜åˆ° localStorage
                    localStorage.setItem('okx_accounts', JSON.stringify(accounts));
                    
                    // â­ å¼ºåˆ¶ä½¿ç”¨ fangfang12 è´¦æˆ·ï¼ˆè¿™æ˜¯fangfang12ä¸“ç”¨é¡µé¢ï¼‰
                    const fangfangAcc = accounts.find(acc => acc.id === 'account_fangfang12');
                    if (fangfangAcc) {
                        currentAccount = 'account_fangfang12';
                        console.log('[loadAccountsList] âœ… å·²è®¾ç½®ä¸º Fangfang12 è´¦æˆ·');
                    } else {
                        console.error('[loadAccountsList] âŒ æœªæ‰¾åˆ° fangfang12 è´¦æˆ·');
                        // å°è¯•é»˜è®¤è´¦æˆ·
                        if (result.default_account && accounts.length > 0) {
                            const defaultAcc = accounts.find(acc => acc.id === result.default_account);
                            if (defaultAcc) {
                                currentAccount = defaultAcc.id;
                            } else {
                                currentAccount = accounts[0].id;
                            }
                        }
                    }
                    
                    console.log('[loadAccountsList] è´¦æˆ·åˆ—è¡¨å·²æ›´æ–°:', accounts);
                    console.log('[loadAccountsList] å½“å‰è´¦æˆ·:', currentAccount);
                } else {
                    console.warn('[loadAccountsList] åç«¯APIè¿”å›å¤±è´¥ï¼Œä½¿ç”¨localStorageæ•°æ®');
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä»localStorageè¯»å–
                    loadAccountsFromLocalStorage();
                }
            } catch (error) {
                console.warn('[loadAccountsList] åç«¯APIè°ƒç”¨å¼‚å¸¸ï¼Œä½¿ç”¨localStorageæ•°æ®:', error);
                // å¤‡ç”¨æ–¹æ¡ˆï¼šä»localStorageè¯»å–
                loadAccountsFromLocalStorage();
            }
        }
        
        function loadAccountsFromLocalStorage() {
            const storedAccounts = localStorage.getItem('okx_accounts');
            if (storedAccounts) {
                try {
                    accounts = JSON.parse(storedAccounts);
                    console.log('[loadAccountsFromLocalStorage] ä»localStorageåŠ è½½è´¦æˆ·:', accounts);
                    
                    // è®¾ç½®é»˜è®¤è´¦æˆ·
                    if (accounts.length > 0) {
                        currentAccount = accounts[0].id;
                    }
                } catch (error) {
                    console.error('[loadAccountsFromLocalStorage] è§£ælocalStorageå¤±è´¥:', error);
                }
            } else {
                console.warn('[loadAccountsFromLocalStorage] localStorageä¸­æ²¡æœ‰è´¦æˆ·æ•°æ®');
            }
        }

        async function init() {
            await loadAccountsList();  // é¦–å…ˆä»åç«¯åŠ è½½è´¦æˆ·åˆ—è¡¨
            
            // ç¡®ä¿accountsæ•°ç»„ä¸ä¸ºç©º
            if (!accounts || accounts.length === 0) {
                console.warn('[init] accountsä¸ºç©ºï¼Œä½¿ç”¨åˆå§‹åŒ–çš„é»˜è®¤å€¼');
                // accountså·²åœ¨ç¬¬1594è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œä¸éœ€è¦å†èµ‹å€¼
                // ä½†å¦‚æœcurrentAccountä¸ºç©ºï¼Œè®¾ç½®é»˜è®¤å€¼
                if (!currentAccount && accounts.length > 0) {
                    currentAccount = accounts[0].id;
                }
            }
            
            renderAccountTabs();
            await loadFavoriteSymbols();  // å…ˆåŠ è½½å¸¸ç”¨å¸åˆ—è¡¨ï¼ˆä»æœåŠ¡å™¨ï¼‰
            loadMarketTickers();  // åŠ è½½å®æ—¶è¡Œæƒ…æ•°æ®
            loadAccountData();
            refreshAccountData();  // åŠ è½½è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
            loadPendingOrders();   // åŠ è½½å§”æ‰˜è®¢å•
            loadTradingLogs();     // åŠ è½½äº¤æ˜“æ—¥å¿—
            loadAccountLimit();    // åŠ è½½è´¦æˆ·ä»“ä½é™é¢
            
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°è´¦æˆ·ä¿¡æ¯ã€æŒä»“ã€å§”æ‰˜å’Œæ—¥å¿—
            setInterval(() => {
                refreshAccountData();
                loadPendingOrders();
                loadTradingLogs();
            }, 30000);
            
            // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°è¡Œæƒ…æ•°æ®
            setInterval(() => {
                loadMarketTickers();
            }, 10000);
        }

        // æ¸²æŸ“è´¦æˆ·æ ‡ç­¾
        function renderAccountTabs() {
            console.log('[renderAccountTabs] å¼€å§‹æ¸²æŸ“è´¦æˆ·æ ‡ç­¾...');
            console.log('[renderAccountTabs] accounts:', accounts);
            console.log('[renderAccountTabs] currentAccount:', currentAccount);
            
            const tabsContainer = document.getElementById('accountTabs');
            if (!tabsContainer) {
                console.error('[renderAccountTabs] accountTabså…ƒç´ ä¸å­˜åœ¨ï¼');
                return;
            }
            
            if (!accounts || accounts.length === 0) {
                console.error('[renderAccountTabs] accountsæ•°ç»„ä¸ºç©ºï¼');
                tabsContainer.innerHTML = '<div class="text-gray-500">æš‚æ— è´¦æˆ·</div>';
                return;
            }
            
            tabsContainer.innerHTML = accounts.map(acc => `
                <div class="account-tab ${acc.id === currentAccount ? 'active' : ''}" onclick="selectAccount('${acc.id}')">
                    ${acc.name}
                </div>
            `).join('');
            
            console.log('[renderAccountTabs] æ¸²æŸ“å®Œæˆï¼Œå…±', accounts.length, 'ä¸ªè´¦æˆ·');
            
            // æ›´æ–°è´¦æˆ·ä½™é¢æ˜¾ç¤º
            updateAccountBalance();
        }

        // é€‰æ‹©è´¦æˆ·
        function selectAccount(accountId) {
            console.log(`[selectAccount] åˆ‡æ¢è´¦æˆ·: ${accountId}`);
            console.log(`[selectAccount] åˆ‡æ¢å‰ currentAccount: ${currentAccount}`);
            
            currentAccount = accountId;
            
            console.log(`[selectAccount] åˆ‡æ¢å currentAccount: ${currentAccount}`);
            console.log(`[selectAccount] å½“å‰è´¦æˆ·åˆ—è¡¨:`, accounts.map(a => ({id: a.id, name: a.name})));
            
            renderAccountTabs();
            loadAccountData();
            refreshAccountData();  // åˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
            
            const account = accounts.find(acc => acc.id === accountId);
            console.log(`[selectAccount] å·²åˆ‡æ¢åˆ°è´¦æˆ·: ${account ? account.name : 'æœªæ‰¾åˆ°'} (${accountId})`);
        }

        // æ›´æ–°è´¦æˆ·ä½™é¢æ˜¾ç¤º
        function updateAccountBalance() {
            const account = accounts.find(acc => acc.id === currentAccount);
            if (account) {
                // æ›´æ–°è´¦æˆ·æ ‡ç­¾å¤„çš„ä½™é¢
                document.getElementById('accountBalance').textContent = account.balance.toFixed(2) + ' USDT';
                // æ›´æ–°è®¢å•è¡¨å•ä¸­çš„å¯ç”¨ä½™é¢
                const orderBalanceEl = document.getElementById('orderAvailableBalance');
                if (orderBalanceEl) {
                    orderBalanceEl.textContent = account.balance.toFixed(2) + ' USDT';
                }
            }
        }

        // æ¸²æŸ“äº¤æ˜“å¯¹åˆ—è¡¨
        function renderSymbolsList() {
            const list = document.getElementById('symbolsList');
            
            // åˆ†ç»„ï¼šæ”¶è—çš„å’Œéæ”¶è—çš„
            const favorited = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            const notFavorited = symbols.filter(s => !favoriteSymbols.includes(s.symbol));
            
            let html = '';
            
            // æ¸²æŸ“æ”¶è—åˆ†ç»„
            if (favorited.length > 0) {
                html += '<div class="favorite-section">';
                html += '<div class="favorite-section-title">â­ å¸¸ç”¨å¸ (' + favorited.length + ')</div>';
                html += favorited.map(s => renderSymbolItem(s, true)).join('');
                html += '</div>';
            }
            
            // æ¸²æŸ“éæ”¶è—åˆ†ç»„
            html += notFavorited.map(s => renderSymbolItem(s, false)).join('');
            
            list.innerHTML = html;
        }
        
        // æ¸²æŸ“å•ä¸ªäº¤æ˜“å¯¹é¡¹
        function renderSymbolItem(s, isFavorite) {
            const isActive = s.symbol === currentSymbol;
            const favoriteClass = isFavorite ? 'favorite' : '';
            const starIcon = isFavorite ? 'â­' : 'â˜†';
            
            return `
                <div class="symbol-item ${isActive ? 'active' : ''} ${favoriteClass}" onclick="selectSymbol('${s.symbol}')">
                    <div class="symbol-content">
                        <div class="symbol-name">
                            ${s.name}/USDT
                            ${isFavorite ? '<span class="favorite-badge">â­</span>' : ''}
                        </div>
                        <div class="symbol-price">
                            $${s.price.toFixed(s.price < 1 ? 4 : 2)} 
                            <span style="color: ${s.change >= 0 ? '#10b981' : '#ef4444'}">
                                ${s.change >= 0 ? '+' : ''}${s.change}%
                            </span>
                        </div>
                    </div>
                    <button class="favorite-btn ${isFavorite ? 'favorited' : ''}" 
                            onclick="event.stopPropagation(); toggleFavorite('${s.symbol}')"
                            title="${isFavorite ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}">
                        ${starIcon}
                    </button>
                </div>
            `;
        }
        
        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        async function toggleFavorite(symbol) {
            const index = favoriteSymbols.indexOf(symbol);
            
            if (index > -1) {
                // å–æ¶ˆæ”¶è—
                favoriteSymbols.splice(index, 1);
            } else {
                // æ·»åŠ æ”¶è—
                favoriteSymbols.push(symbol);
            }
            
            // ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆå…¨å±€å…±äº«ï¼‰
            await saveFavoriteSymbols();
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderSymbolsList();
            
            console.log('æ”¶è—åˆ—è¡¨å·²æ›´æ–°:', favoriteSymbols);
        }

        // é€‰æ‹©äº¤æ˜“å¯¹
        function selectSymbol(symbol) {
            currentSymbol = symbol;
            const symbolData = symbols.find(s => s.symbol === symbol);
            
            document.getElementById('currentSymbol').textContent = symbolData.name + '-USDT';
            document.getElementById('currentPrice').textContent = symbolData.price.toFixed(2);
            
            const changeEl = document.getElementById('priceChange');
            changeEl.textContent = (symbolData.change >= 0 ? '+' : '') + symbolData.change + '%';
            changeEl.className = 'price-change ' + (symbolData.change >= 0 ? 'up' : 'down');
            
            renderSymbolsList();
        }

        // é€‰æ‹©äº¤æ˜“æ–¹å‘
        function selectDirection(direction) {
            currentDirection = direction;
            
            document.querySelectorAll('.direction-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.direction-tab.' + direction).classList.add('active');
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.className = 'submit-order ' + direction;
            submitBtn.innerHTML = direction === 'long' ? 'â¬† åšå¤š' : 'â¬‡ åšç©º';
        }

        // é€‰æ‹©æ æ†
        function selectLeverage(leverage) {
            currentLeverage = leverage;
            
            document.querySelectorAll('.leverage-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // è®¾ç½®é‡‘é¢ç™¾åˆ†æ¯”
        function setAmount(percent) {
            // ä»DOMä¸­è·å–å®æ—¶çš„å¯ç”¨ä½™é¢
            const orderBalanceEl = document.getElementById('orderAvailableBalance');
            let balance = 0;
            
            if (orderBalanceEl && orderBalanceEl.textContent) {
                // æå–æ•°å­—éƒ¨åˆ†ï¼Œä¾‹å¦‚ "101.28 USDT" -> 101.28
                const balanceText = orderBalanceEl.textContent.trim();
                const balanceMatch = balanceText.match(/[\d.]+/);
                if (balanceMatch) {
                    balance = parseFloat(balanceMatch[0]);
                }
            }
            
            // å¦‚æœæ²¡æœ‰ä»DOMè·å–åˆ°ï¼Œå°è¯•ä»è´¦æˆ·å¯¹è±¡è·å–
            if (balance === 0) {
                const account = accounts.find(acc => acc.id === currentAccount);
                balance = account ? (account.balance || 0) : 0;
            }
            
            // è®¡ç®—ä»“ä½é‡‘é¢
            const amount = (balance * percent / 100).toFixed(2);
            const orderAmountInput = document.getElementById('orderAmount');
            if (orderAmountInput) {
                orderAmountInput.value = amount;
                console.log(`è®¾ç½®${percent}%ä»“ä½: å¯ç”¨ä½™é¢=${balance} USDT, ä»“ä½é‡‘é¢=${amount} USDT`);
            }
        }

        // æ‰¹é‡å¼€ä»“å‡½æ•°
        async function batchOrder(direction, percentPerCoin) {
            console.log(`[batchOrder] å¼€å§‹æ‰¹é‡å¼€ä»“: direction=${direction}, percentPerCoin=${percentPerCoin}%`);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å¯ç”¨ä½™é¢
            const balance = account.balance || 0;
            if (balance <= 0) {
                alert('âŒ è´¦æˆ·ä½™é¢ä¸è¶³ï¼');
                return;
            }
            
            // åªä»æ”¶è—çš„å¸ç§ä¸­é€‰æ‹©
            const favoriteSymbolsData = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            
            if (favoriteSymbolsData.length === 0) {
                alert('âŒ è¯·å…ˆæ”¶è—ä¸€äº›å¸¸ç”¨å¸ç§ï¼\n\nåœ¨äº¤æ˜“å¯¹åˆ—è¡¨ä¸­ç‚¹å‡»â­æŒ‰é’®æ·»åŠ æ”¶è—ã€‚');
                return;
            }
            
            console.log('[batchOrder] å¸¸ç”¨å¸ç§æ•°é‡:', favoriteSymbolsData.length);
            console.log('[batchOrder] å¸¸ç”¨å¸ç§:', favoriteSymbolsData.map(s => s.name).join(', '));
            
            // ä»å¸¸ç”¨å¸ç§ä¸­æŒ‰æ¶¨è·Œå¹…æ’åºï¼Œè·å–å‰6å
            const sortedSymbols = [...favoriteSymbolsData].sort((a, b) => b.change - a.change);
            const top6Symbols = sortedSymbols.slice(0, 6);
            
            if (top6Symbols.length < 6) {
                alert(`âŒ å¸¸ç”¨å¸ç§ä¸è¶³6ä¸ªï¼\n\nå½“å‰å¸¸ç”¨å¸ç§ï¼š${favoriteSymbolsData.length}ä¸ª\nè¯·è‡³å°‘æ”¶è—6ä¸ªå¸ç§æ‰èƒ½ä½¿ç”¨æ‰¹é‡å¼€ä»“ã€‚`);
                return;
            }
            
            console.log('[batchOrder] å¸¸ç”¨å¸ç§æ¶¨å¹…å‰6:', top6Symbols.map(s => `${s.name} (${s.change}%)`));
            
            // è®¡ç®—æ¯ä¸ªå¸çš„ä¿è¯é‡‘å ç”¨ï¼ˆç”¨æˆ·è¾“å…¥çš„ç™¾åˆ†æ¯”æ˜¯æŒ‡ä¿è¯é‡‘å æ¯”ï¼‰
            const marginPerCoin = (balance * percentPerCoin / 100).toFixed(2);
            const totalMargin = (marginPerCoin * 6).toFixed(2);
            
            // âš ï¸ é‡è¦ï¼š10xæ æ†ä¸‹ï¼Œåˆçº¦ä»·å€¼ = ä¿è¯é‡‘ Ã— 10
            const contractValuePerCoin = (parseFloat(marginPerCoin) * 10).toFixed(2);
            const totalContractValue = (parseFloat(contractValuePerCoin) * 6).toFixed(2);
            
            console.log(`[batchOrder] ä½™é¢æ£€æŸ¥: å¯ç”¨=${balance.toFixed(2)}, æ¯å¸ä¿è¯é‡‘=${marginPerCoin}, æ¯å¸åˆçº¦ä»·å€¼=${contractValuePerCoin}, æ€»ä¿è¯é‡‘=${totalMargin}, æ€»åˆçº¦ä»·å€¼=${totalContractValue}`);
            
            // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿï¼ˆä¿å®ˆæ£€æŸ¥ï¼šéœ€è¦æ€»ä¿è¯é‡‘çš„ 1.2 å€ä½œä¸ºç¼“å†²ï¼‰
            const requiredBalance = parseFloat(totalMargin) * 1.2;
            if (balance < requiredBalance) {
                alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                    `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                    `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                    `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT (10xæ æ†)\n` +
                    `  â€¢ 6ä¸ªå¸æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                    `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `  â€¢ ç¼ºå°‘: ${(requiredBalance - balance).toFixed(2)} USDT\n\n` +
                    `ğŸ’¡ å»ºè®®ï¼š\n` +
                    `  1. é™ä½å¼€ä»“æ¯”ä¾‹ (å½“å‰æ¯å¸${percentPerCoin}%)\n` +
                    `  2. å¢åŠ è´¦æˆ·ä½™é¢\n` +
                    `  3. å‡å°‘å¼€ä»“å¸ç§æ•°é‡`);
                return;
            }
            
            // é¢å¤–æç¤ºï¼šå¦‚æœä½™é¢åˆšå¥½å¤Ÿï¼Œç»™ä¸ªè­¦å‘Š
            if (balance < requiredBalance * 1.5) {
                const warningMsg = `âš ï¸ ä½™é¢åç´§\n\n` +
                    `å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `é¢„è®¡å ç”¨ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `å‰©ä½™: ${(balance - parseFloat(totalMargin)).toFixed(2)} USDT\n\n` +
                    `å»ºè®®å¢åŠ ä½™é¢æˆ–é™ä½å¼€ä»“æ¯”ä¾‹ï¼Œé¿å…å› ä½™é¢ä¸è¶³å¯¼è‡´éƒ¨åˆ†è®¢å•å¤±è´¥ã€‚\n\n` +
                    `æ˜¯å¦ç»§ç»­ï¼Ÿ`;
                if (!confirm(warningMsg)) {
                    console.log('[batchOrder] ç”¨æˆ·å› ä½™é¢ä¸è¶³å–æ¶ˆ');
                    return;
                }
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            const directionText = direction === 'long' ? 'åšå¤š' : 'åšç©º';
            const emoji = direction === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const strategyName = direction === 'long' ? 'å¤šå•' : 'ç©ºå•';
            
            const symbolsList = top6Symbols.map(s => 
                `  â€¢ ${s.name}: $${s.price.toFixed(2)} (${s.change >= 0 ? '+' : ''}${s.change}%)`
            ).join('\n');
            
            const confirmMsg = `${emoji} æ‰¹é‡${strategyName}ç­–ç•¥\n\n` +
                `ã€å¸¸ç”¨å¸æ¶¨å¹…å‰6ã€‘\n${symbolsList}\n\n` +
                `ã€å¼€ä»“å‚æ•°ã€‘\n` +
                `  â€¢ æ–¹å‘: ${directionText}\n` +
                `  â€¢ æ æ†: 10x\n` +
                `  â€¢ è®¢å•ç±»å‹: å¸‚ä»·å•\n\n` +
                `ã€èµ„é‡‘åˆ†é…ã€‘\n` +
                `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT\n` +
                `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                `  â€¢ æ€»åˆçº¦ä»·å€¼: ${totalContractValue} USDT\n` +
                `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n\n` +
                `ç¡®è®¤æ‰¹é‡å¼€ä»“ï¼Ÿ`;
            
            if (!confirm(confirmMsg)) {
                console.log('[batchOrder] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¼€ä»“');
                return;
            }
            
            // å¼€å§‹æ‰¹é‡ä¸‹å•
            console.log('[batchOrder] å¼€å§‹æ‰¹é‡ä¸‹å•...');
            let successCount = 0;
            let failCount = 0;
            const results = [];
            
            for (const symbolData of top6Symbols) {
                try {
                    console.log(`[batchOrder] æ­£åœ¨ä¸‹å•: ${symbolData.name}...`);
                    
                    // æ„å»ºè®¢å•æ•°æ®
                    // szä¼ é€’åˆçº¦ä»·å€¼ï¼Œåç«¯ä¼šæ ¹æ®å½“å‰ä»·æ ¼è®¡ç®—åˆçº¦å¼ æ•°
                    const orderData = {
                        instId: symbolData.symbol,
                        side: direction === 'long' ? 'buy' : 'sell',
                        posSide: direction,
                        ordType: 'market',
                        sz: contractValuePerCoin,  // ä¼ é€’åˆçº¦ä»·å€¼ï¼ˆä¿è¯é‡‘ Ã— 10ï¼‰
                        lever: '10'
                    };
                    
                    // å‘é€è®¢å•è¯·æ±‚
                    const response = await fetch('/api/okx-trading/place-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase,
                            ...orderData
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        results.push(`âœ… ${symbolData.name}: æˆåŠŸ`);
                        console.log(`[batchOrder] ${symbolData.name} ä¸‹å•æˆåŠŸ`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${symbolData.name}: ${result.error || 'å¤±è´¥'}`);
                        console.error(`[batchOrder] ${symbolData.name} ä¸‹å•å¤±è´¥:`, result.error);
                    }
                    
                    // å»¶è¿Ÿ100msï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${symbolData.name}: ${error.message || 'å¼‚å¸¸'}`);
                    console.error(`[batchOrder] ${symbolData.name} ä¸‹å•å¼‚å¸¸:`, error);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultMsg = `${emoji} æ‰¹é‡å¼€ä»“å®Œæˆ\n\n` +
                `ã€ç»“æœç»Ÿè®¡ã€‘\n` +
                `  â€¢ æˆåŠŸ: ${successCount} ä¸ª\n` +
                `  â€¢ å¤±è´¥: ${failCount} ä¸ª\n\n` +
                `ã€è¯¦ç»†ç»“æœã€‘\n${results.join('\n')}`;
            
            alert(resultMsg);
            
            // åˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
            await refreshAccountData();
            await loadPendingOrders();
        }

        // æ‰¹é‡å¼€ä»“ - æ¶¨å¹…å‰8åç­–ç•¥
        async function batchOrderTop8(direction, percentPerCoin) {
            console.log(`[batchOrderTop8] å¼€å§‹æ‰¹é‡å¼€ä»“å‰8: direction=${direction}, percentPerCoin=${percentPerCoin}%`);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å¯ç”¨ä½™é¢
            const balance = account.balance || 0;
            if (balance <= 0) {
                alert('âŒ è´¦æˆ·ä½™é¢ä¸è¶³ï¼');
                return;
            }
            
            // åªä»æ”¶è—çš„å¸ç§ä¸­é€‰æ‹©
            const favoriteSymbolsData = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            
            if (favoriteSymbolsData.length === 0) {
                alert('âŒ è¯·å…ˆæ”¶è—ä¸€äº›å¸¸ç”¨å¸ç§ï¼\n\nåœ¨äº¤æ˜“å¯¹åˆ—è¡¨ä¸­ç‚¹å‡»â­æŒ‰é’®æ·»åŠ æ”¶è—ã€‚');
                return;
            }
            
            console.log('[batchOrderTop8] å¸¸ç”¨å¸ç§æ•°é‡:', favoriteSymbolsData.length);
            
            // ä»å¸¸ç”¨å¸ç§ä¸­æŒ‰æ¶¨è·Œå¹…æ’åºï¼Œè·å–å‰8å
            const sortedSymbols = [...favoriteSymbolsData].sort((a, b) => b.change - a.change);
            const top8Symbols = sortedSymbols.slice(0, 8);
            
            if (top8Symbols.length < 8) {
                alert(`âŒ å¸¸ç”¨å¸ç§ä¸è¶³8ä¸ªï¼\n\nå½“å‰å¸¸ç”¨å¸ç§ï¼š${favoriteSymbolsData.length}ä¸ª\nè¯·è‡³å°‘æ”¶è—8ä¸ªå¸ç§æ‰èƒ½ä½¿ç”¨æ­¤ç­–ç•¥ã€‚`);
                return;
            }
            
            console.log('[batchOrderTop8] å¸¸ç”¨å¸ç§æ¶¨å¹…å‰8:', top8Symbols.map(s => `${s.name} (${s.change}%)`));
            
            // è®¡ç®—æ¯ä¸ªå¸çš„ä¿è¯é‡‘å ç”¨
            const marginPerCoin = (balance * percentPerCoin / 100).toFixed(2);
            const totalMargin = (marginPerCoin * 8).toFixed(2);
            const contractValuePerCoin = (parseFloat(marginPerCoin) * 10).toFixed(2);
            const totalContractValue = (parseFloat(contractValuePerCoin) * 8).toFixed(2);
            
            console.log(`[batchOrderTop8] ä½™é¢æ£€æŸ¥: å¯ç”¨=${balance.toFixed(2)}, æ¯å¸ä¿è¯é‡‘=${marginPerCoin}, æ€»ä¿è¯é‡‘=${totalMargin}`);
            
            // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿ
            const requiredBalance = parseFloat(totalMargin) * 1.2;
            if (balance < requiredBalance) {
                alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                    `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                    `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                    `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT (10xæ æ†)\n` +
                    `  â€¢ 8ä¸ªå¸æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                    `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `  â€¢ ç¼ºå°‘: ${(requiredBalance - balance).toFixed(2)} USDT`);
                return;
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            const directionText = direction === 'long' ? 'åšå¤š' : 'åšç©º';
            const emoji = direction === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const strategyName = direction === 'long' ? 'å¤šå•' : 'ç©ºå•';
            
            const symbolsList = top8Symbols.map(s => 
                `  â€¢ ${s.name}: $${s.price.toFixed(2)} (${s.change >= 0 ? '+' : ''}${s.change}%)`
            ).join('\n');
            
            const confirmMsg = `${emoji} æ¶¨å¹…å‰8æ‰¹é‡${strategyName}ç­–ç•¥\n\n` +
                `ã€å¸¸ç”¨å¸æ¶¨å¹…å‰8ã€‘\n${symbolsList}\n\n` +
                `ã€å¼€ä»“å‚æ•°ã€‘\n` +
                `  â€¢ æ–¹å‘: ${directionText}\n` +
                `  â€¢ æ æ†: 10x\n` +
                `  â€¢ è®¢å•ç±»å‹: å¸‚ä»·å•\n\n` +
                `ã€èµ„é‡‘åˆ†é…ã€‘\n` +
                `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT\n` +
                `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                `  â€¢ æ€»åˆçº¦ä»·å€¼: ${totalContractValue} USDT\n` +
                `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n\n` +
                `ç¡®è®¤æ‰¹é‡å¼€ä»“ï¼Ÿ`;
            
            if (!confirm(confirmMsg)) {
                console.log('[batchOrderTop8] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¼€ä»“');
                return;
            }
            
            // å¼€å§‹æ‰¹é‡ä¸‹å•
            console.log('[batchOrderTop8] å¼€å§‹æ‰¹é‡ä¸‹å•...');
            let successCount = 0;
            let failCount = 0;
            const results = [];
            
            for (const symbolData of top8Symbols) {
                try {
                    console.log(`[batchOrderTop8] æ­£åœ¨ä¸‹å•: ${symbolData.name}...`);
                    
                    const orderData = {
                        instId: symbolData.symbol,
                        side: direction === 'long' ? 'buy' : 'sell',
                        posSide: direction,
                        ordType: 'market',
                        sz: contractValuePerCoin,
                        lever: '10'
                    };
                    
                    const response = await fetch('/api/okx-trading/place-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase,
                            ...orderData
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        results.push(`âœ… ${symbolData.name}: æˆåŠŸ`);
                        console.log(`[batchOrderTop8] ${symbolData.name} ä¸‹å•æˆåŠŸ`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${symbolData.name}: ${result.message || 'å¤±è´¥'}`);
                        console.error(`[batchOrderTop8] ${symbolData.name} ä¸‹å•å¤±è´¥:`, result);
                    }
                    
                    // å»¶è¿Ÿ100msé¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${symbolData.name}: ${error.message}`);
                    console.error(`[batchOrderTop8] ${symbolData.name} å¼‚å¸¸:`, error);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultMsg = `${emoji} æ‰¹é‡å¼€ä»“å®Œæˆ\n\n` +
                `æˆåŠŸ: ${successCount}/${top8Symbols.length}\n` +
                `å¤±è´¥: ${failCount}/${top8Symbols.length}\n\n` +
                `è¯¦ç»†ç»“æœ:\n${results.join('\n')}`;
            
            alert(resultMsg);
            console.log('[batchOrderTop8] æ‰¹é‡å¼€ä»“å®Œæˆ:', { successCount, failCount });
            
            // åˆ·æ–°æ•°æ®
            await refreshAccountData();
        }

        // æ‰¹é‡å¼€ä»“ - æ¶¨å¹…å8åç­–ç•¥
        async function batchOrderBottom8(direction, percentPerCoin) {
            console.log(`[batchOrderBottom8] å¼€å§‹æ‰¹é‡å¼€ä»“å8: direction=${direction}, percentPerCoin=${percentPerCoin}%`);
            
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å¯ç”¨ä½™é¢
            const balance = account.balance || 0;
            if (balance <= 0) {
                alert('âŒ è´¦æˆ·ä½™é¢ä¸è¶³ï¼');
                return;
            }
            
            // åªä»æ”¶è—çš„å¸ç§ä¸­é€‰æ‹©
            const favoriteSymbolsData = symbols.filter(s => favoriteSymbols.includes(s.symbol));
            
            if (favoriteSymbolsData.length === 0) {
                alert('âŒ è¯·å…ˆæ”¶è—ä¸€äº›å¸¸ç”¨å¸ç§ï¼\n\nåœ¨äº¤æ˜“å¯¹åˆ—è¡¨ä¸­ç‚¹å‡»â­æŒ‰é’®æ·»åŠ æ”¶è—ã€‚');
                return;
            }
            
            console.log('[batchOrderBottom8] å¸¸ç”¨å¸ç§æ•°é‡:', favoriteSymbolsData.length);
            
            // ä»å¸¸ç”¨å¸ç§ä¸­æŒ‰æ¶¨è·Œå¹…æ’åºï¼Œè·å–å8åï¼ˆè·Œå¹…æœ€å¤§ï¼‰
            const sortedSymbols = [...favoriteSymbolsData].sort((a, b) => a.change - b.change);
            const bottom8Symbols = sortedSymbols.slice(0, 8);
            
            if (bottom8Symbols.length < 8) {
                alert(`âŒ å¸¸ç”¨å¸ç§ä¸è¶³8ä¸ªï¼\n\nå½“å‰å¸¸ç”¨å¸ç§ï¼š${favoriteSymbolsData.length}ä¸ª\nè¯·è‡³å°‘æ”¶è—8ä¸ªå¸ç§æ‰èƒ½ä½¿ç”¨æ­¤ç­–ç•¥ã€‚`);
                return;
            }
            
            console.log('[batchOrderBottom8] å¸¸ç”¨å¸ç§æ¶¨å¹…å8:', bottom8Symbols.map(s => `${s.name} (${s.change}%)`));
            
            // è®¡ç®—æ¯ä¸ªå¸çš„ä¿è¯é‡‘å ç”¨
            const marginPerCoin = (balance * percentPerCoin / 100).toFixed(2);
            const totalMargin = (marginPerCoin * 8).toFixed(2);
            const contractValuePerCoin = (parseFloat(marginPerCoin) * 10).toFixed(2);
            const totalContractValue = (parseFloat(contractValuePerCoin) * 8).toFixed(2);
            
            console.log(`[batchOrderBottom8] ä½™é¢æ£€æŸ¥: å¯ç”¨=${balance.toFixed(2)}, æ¯å¸ä¿è¯é‡‘=${marginPerCoin}, æ€»ä¿è¯é‡‘=${totalMargin}`);
            
            // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿ
            const requiredBalance = parseFloat(totalMargin) * 1.2;
            if (balance < requiredBalance) {
                alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                    `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                    `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                    `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT (10xæ æ†)\n` +
                    `  â€¢ 8ä¸ªå¸æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                    `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                    `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n` +
                    `  â€¢ ç¼ºå°‘: ${(requiredBalance - balance).toFixed(2)} USDT`);
                return;
            }
            
            // é£é™©è­¦å‘Š
            const riskWarning = `âš ï¸ é«˜é£é™©ç­–ç•¥è­¦å‘Š\n\n` +
                `æ­¤ç­–ç•¥é’ˆå¯¹è·Œå¹…æœ€å¤§çš„å¸ç§ï¼Œæ³¢åŠ¨æ€§æé«˜ï¼\n\n` +
                `ã€æ¶¨å¹…å8å = è·Œå¹…æœ€å¤§ã€‘\n` +
                bottom8Symbols.map(s => 
                    `  â€¢ ${s.name}: ${s.change >= 0 ? '+' : ''}${s.change}%`
                ).join('\n') + '\n\n' +
                `âš ï¸ è¿™äº›å¸ç§å¯èƒ½ï¼š\n` +
                `  â€¢ ç»§ç»­ä¸‹è·Œï¼ˆç©ºå•è·åˆ©ï¼‰\n` +
                `  â€¢ è¶…è·Œåå¼¹ï¼ˆå¤šå•è·åˆ©ï¼‰\n` +
                `  â€¢ å‰§çƒˆæ³¢åŠ¨ï¼ˆé«˜é£é™©ï¼‰\n\n` +
                `ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`;
            
            if (!confirm(riskWarning)) {
                console.log('[batchOrderBottom8] ç”¨æˆ·å–æ¶ˆï¼ˆé£é™©è­¦å‘Šï¼‰');
                return;
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            const directionText = direction === 'long' ? 'åšå¤šï¼ˆé¢„æœŸåå¼¹ï¼‰' : 'åšç©ºï¼ˆé¢„æœŸå»¶ç»­ï¼‰';
            const emoji = direction === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const strategyName = direction === 'long' ? 'å¤šå•' : 'ç©ºå•';
            
            const symbolsList = bottom8Symbols.map(s => 
                `  â€¢ ${s.name}: $${s.price.toFixed(2)} (${s.change >= 0 ? '+' : ''}${s.change}%)`
            ).join('\n');
            
            const confirmMsg = `${emoji} æ¶¨å¹…å8æ‰¹é‡${strategyName}ç­–ç•¥\n\n` +
                `ã€å¸¸ç”¨å¸æ¶¨å¹…å8ï¼ˆè·Œå¹…æœ€å¤§ï¼‰ã€‘\n${symbolsList}\n\n` +
                `ã€å¼€ä»“å‚æ•°ã€‘\n` +
                `  â€¢ æ–¹å‘: ${directionText}\n` +
                `  â€¢ æ æ†: 10x\n` +
                `  â€¢ è®¢å•ç±»å‹: å¸‚ä»·å•\n\n` +
                `ã€èµ„é‡‘åˆ†é…ã€‘\n` +
                `  â€¢ æ¯ä¸ªå¸ä¿è¯é‡‘: ${marginPerCoin} USDT (${percentPerCoin}%)\n` +
                `  â€¢ æ¯ä¸ªå¸åˆçº¦ä»·å€¼: ${contractValuePerCoin} USDT\n` +
                `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin} USDT\n` +
                `  â€¢ æ€»åˆçº¦ä»·å€¼: ${totalContractValue} USDT\n` +
                `  â€¢ å¯ç”¨ä½™é¢: ${balance.toFixed(2)} USDT\n\n` +
                `âš ï¸ æœ€åç¡®è®¤ï¼šè¿™æ˜¯é«˜é£é™©ç­–ç•¥ï¼`;
            
            if (!confirm(confirmMsg)) {
                console.log('[batchOrderBottom8] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¼€ä»“');
                return;
            }
            
            // å¼€å§‹æ‰¹é‡ä¸‹å•
            console.log('[batchOrderBottom8] å¼€å§‹æ‰¹é‡ä¸‹å•...');
            let successCount = 0;
            let failCount = 0;
            const results = [];
            
            for (const symbolData of bottom8Symbols) {
                try {
                    console.log(`[batchOrderBottom8] æ­£åœ¨ä¸‹å•: ${symbolData.name}...`);
                    
                    const orderData = {
                        instId: symbolData.symbol,
                        side: direction === 'long' ? 'buy' : 'sell',
                        posSide: direction,
                        ordType: 'market',
                        sz: contractValuePerCoin,
                        lever: '10'
                    };
                    
                    const response = await fetch('/api/okx-trading/place-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase,
                            ...orderData
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        results.push(`âœ… ${symbolData.name}: æˆåŠŸ`);
                        console.log(`[batchOrderBottom8] ${symbolData.name} ä¸‹å•æˆåŠŸ`);
                    } else {
                        failCount++;
                        results.push(`âŒ ${symbolData.name}: ${result.message || 'å¤±è´¥'}`);
                        console.error(`[batchOrderBottom8] ${symbolData.name} ä¸‹å•å¤±è´¥:`, result);
                    }
                    
                    // å»¶è¿Ÿ100msé¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    failCount++;
                    results.push(`âŒ ${symbolData.name}: ${error.message}`);
                    console.error(`[batchOrderBottom8] ${symbolData.name} å¼‚å¸¸:`, error);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultMsg = `${emoji} æ‰¹é‡å¼€ä»“å®Œæˆ\n\n` +
                `æˆåŠŸ: ${successCount}/${bottom8Symbols.length}\n` +
                `å¤±è´¥: ${failCount}/${bottom8Symbols.length}\n\n` +
                `è¯¦ç»†ç»“æœ:\n${results.join('\n')}`;
            
            alert(resultMsg);
            console.log('[batchOrderBottom8] æ‰¹é‡å¼€ä»“å®Œæˆ:', { successCount, failCount });
            
            // åˆ·æ–°æ•°æ®
            await refreshAccountData();
        }

        // ä¸€é”®å…¨å¹³æ‰€æœ‰è´¦æˆ·çš„æ‰€æœ‰æŒä»“
        async function closeAllAccountsPositions() {
            console.log('[closeAllAccountsPositions] å¼€å§‹ä¸€é”®å…¨å¹³æ‰€æœ‰è´¦æˆ·æŒä»“');
            
            // è·å–æ‰€æœ‰è´¦æˆ·
            if (!accounts || accounts.length === 0) {
                alert('âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è´¦æˆ·ï¼\n\nè¯·å…ˆåœ¨è´¦æˆ·ç®¡ç†ä¸­æ·»åŠ è´¦æˆ·ã€‚');
                return;
            }
            
            // ç­›é€‰å‡ºæœ‰APIå‡­è¯çš„è´¦æˆ·
            const validAccounts = accounts.filter(acc => 
                acc.apiKey && acc.apiSecret && acc.passphrase
            );
            
            if (validAccounts.length === 0) {
                alert('âŒ æ²¡æœ‰é…ç½®å®Œæ•´APIå‡­è¯çš„è´¦æˆ·ï¼\n\nè¯·åœ¨è´¦æˆ·ç®¡ç†ä¸­å®Œå–„è´¦æˆ·çš„APIé…ç½®ï¼š\n- API Key\n- API Secret\n- Passphrase');
                return;
            }
            
            console.log(`[closeAllAccountsPositions] æ‰¾åˆ° ${validAccounts.length} ä¸ªæœ‰æ•ˆè´¦æˆ·`);
            
            // é¦–å…ˆæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            const confirmMsg = `ğŸš¨ ä¸€é”®å…¨å¹³æ‰€æœ‰è´¦æˆ·æŒä»“\n\n` +
                `å³å°†å¹³æ‰ä»¥ä¸‹è´¦æˆ·çš„æ‰€æœ‰æŒä»“ï¼š\n\n` +
                validAccounts.map(acc => `  â€¢ ${acc.name || acc.id}`).join('\n') +
                `\n\nâš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†å¹³æ‰æ‰€æœ‰è´¦æˆ·çš„æ‰€æœ‰å¤šå•å’Œç©ºå•ï¼\n` +
                `\nâ“ æ˜¯å¦ç»§ç»­ï¼Ÿ`;
            
            const confirmed = await showConfirmDialog(confirmMsg, 'ğŸš¨ ä¸€é”®å…¨å¹³ç¡®è®¤');
            if (!confirmed) {
                console.log('[closeAllAccountsPositions] ç”¨æˆ·å–æ¶ˆæ“ä½œ');
                return;
            }
            
            // æ”¶é›†æ‰€æœ‰è´¦æˆ·çš„æ‰€æœ‰æŒä»“
            let totalPositionsCount = 0;
            let totalSuccess = 0;
            let totalFail = 0;
            const accountResults = [];
            
            for (const account of validAccounts) {
                console.log(`[closeAllAccountsPositions] å¤„ç†è´¦æˆ·: ${account.name || account.id}`);
                
                try {
                    // è·å–è´¦æˆ·æŒä»“
                    const response = await fetch('/api/okx-trading/positions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: account.apiKey,
                            apiSecret: account.apiSecret,
                            passphrase: account.passphrase
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (!result.success || !result.data) {
                        console.error(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} è·å–æŒä»“å¤±è´¥:`, result.error);
                        accountResults.push({
                            account: account.name || account.id,
                            success: 0,
                            fail: 0,
                            error: result.error || 'è·å–æŒä»“å¤±è´¥'
                        });
                        continue;
                    }
                    
                    const positions = result.data;
                    console.log(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} æœ‰ ${positions.length} ä¸ªæŒä»“`);
                    
                    if (positions.length === 0) {
                        accountResults.push({
                            account: account.name || account.id,
                            success: 0,
                            fail: 0,
                            message: 'æ— æŒä»“'
                        });
                        continue;
                    }
                    
                    totalPositionsCount += positions.length;
                    
                    // é€ä¸ªå¹³ä»“
                    let accountSuccess = 0;
                    let accountFail = 0;
                    
                    for (const position of positions) {
                        try {
                            const coinName = position.instId.replace('-USDT-SWAP', '');
                            console.log(`[closeAllAccountsPositions] å¹³ä»“ ${account.name} - ${coinName} ${position.posSide}...`);
                            
                            const closeResponse = await fetch('/api/okx-trading/close-position', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    apiKey: account.apiKey,
                                    apiSecret: account.apiSecret,
                                    passphrase: account.passphrase,
                                    instId: position.instId,
                                    posSide: position.posSide,
                                    closeSize: position.posSize
                                })
                            });
                            
                            const closeResult = await closeResponse.json();
                            
                            if (closeResult.success) {
                                accountSuccess++;
                                totalSuccess++;
                                console.log(`[closeAllAccountsPositions] âœ… ${coinName} å¹³ä»“æˆåŠŸ`);
                            } else {
                                accountFail++;
                                totalFail++;
                                console.error(`[closeAllAccountsPositions] âŒ ${coinName} å¹³ä»“å¤±è´¥:`, closeResult.error);
                            }
                            
                            // æ·»åŠ å°å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                            await new Promise(resolve => setTimeout(resolve, 200));
                            
                        } catch (error) {
                            accountFail++;
                            totalFail++;
                            console.error(`[closeAllAccountsPositions] å¹³ä»“å¼‚å¸¸:`, error);
                        }
                    }
                    
                    accountResults.push({
                        account: account.name || account.id,
                        success: accountSuccess,
                        fail: accountFail,
                        total: positions.length
                    });
                    
                    // è´¦æˆ·ä¹‹é—´æ·»åŠ 1ç§’å»¶è¿Ÿï¼Œé¿å…APIå†²çª
                    console.log(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} å¤„ç†å®Œæˆï¼Œç­‰å¾…1ç§’åå¤„ç†ä¸‹ä¸€ä¸ªè´¦æˆ·...`);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error(`[closeAllAccountsPositions] è´¦æˆ· ${account.name} å¤„ç†å¼‚å¸¸:`, error);
                    accountResults.push({
                        account: account.name || account.id,
                        success: 0,
                        fail: 0,
                        error: error.message || 'å¤„ç†å¼‚å¸¸'
                    });
                    
                    // å³ä½¿å‡ºé”™ä¹Ÿæ·»åŠ å»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultLines = accountResults.map(r => {
                if (r.error) {
                    return `  âŒ ${r.account}: ${r.error}`;
                } else if (r.message) {
                    return `  âšª ${r.account}: ${r.message}`;
                } else {
                    const emoji = r.fail === 0 ? 'âœ…' : (r.success > 0 ? 'âš ï¸' : 'âŒ');
                    return `  ${emoji} ${r.account}: æˆåŠŸ${r.success}/${r.total}`;
                }
            }).join('\n');
            
            const resultMsg = `ğŸš¨ ä¸€é”®å…¨å¹³å®Œæˆ\n\n` +
                `ã€æ€»è®¡ã€‘\n` +
                `  â€¢ å¤„ç†è´¦æˆ·: ${validAccounts.length} ä¸ª\n` +
                `  â€¢ æ€»æŒä»“æ•°: ${totalPositionsCount} ä¸ª\n` +
                `  â€¢ æˆåŠŸå¹³ä»“: ${totalSuccess} ä¸ª\n` +
                `  â€¢ å¤±è´¥: ${totalFail} ä¸ª\n\n` +
                `ã€å„è´¦æˆ·è¯¦æƒ…ã€‘\n${resultLines}`;
            
            alert(resultMsg);
            
            // åˆ·æ–°å½“å‰è´¦æˆ·æ•°æ®
            await refreshAccountData();
            await loadPendingOrders();
            
            console.log('[closeAllAccountsPositions] ä¸€é”®å…¨å¹³å®Œæˆ');
        }

        // æ‰¹é‡å¹³ä»“å‡½æ•°
        async function batchClosePositions(posSide, ratio) {
            console.log(`========== [batchClosePositions] å¼€å§‹æ‰¹é‡å¹³ä»“ ==========`);
            console.log(`[batchClosePositions] å‚æ•°: posSide=${posSide}, ratio=${ratio}`);
            console.log(`[batchClosePositions] å…¨å±€å˜é‡ currentAccount=${currentAccount}`);
            console.log(`[batchClosePositions] å…¨å±€å˜é‡ accounts=`, accounts);
            console.log(`[batchClosePositions] accounts é•¿åº¦=${accounts.length}`);
            
            // è·å–å½“å‰è´¦æˆ·
            const account = accounts.find(acc => acc.id === currentAccount);
            console.log(`[batchClosePositions] æŸ¥æ‰¾è´¦æˆ·: currentAccount=${currentAccount}`);
            console.log(`[batchClosePositions] æ‰¾åˆ°çš„è´¦æˆ·=`, account);
            
            if (!account) {
                const availableAccounts = accounts.map(a => `${a.name}(${a.id})`).join(', ');
                alert(`âŒ æœªæ‰¾åˆ°è´¦æˆ·ï¼\n\nå½“å‰è´¦æˆ·ID: ${currentAccount}\nå¯ç”¨è´¦æˆ·: ${availableAccounts}\n\nè¯·åœ¨è´¦æˆ·ç®¡ç†ä¸­æ£€æŸ¥è´¦æˆ·é…ç½®ã€‚`);
                console.error(`[batchClosePositions] é”™è¯¯: æœªæ‰¾åˆ°è´¦æˆ· currentAccount=${currentAccount}`);
                return;
            }
            
            console.log(`[batchClosePositions] âœ… æˆåŠŸæ‰¾åˆ°è´¦æˆ·: ${account.name} (${account.id})`);
            console.log(`[batchClosePositions] APIå‡­è¯æ£€æŸ¥: hasApiKey=${!!account.apiKey}, hasApiSecret=${!!account.apiSecret}, hasPassphrase=${!!account.passphrase}`);
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                alert(`âŒ è´¦æˆ· "${account.name || account.id}" æœªé…ç½®APIå‡­è¯ï¼\n\nè¯·åœ¨è´¦æˆ·ç®¡ç†ä¸­å®Œå–„APIé…ç½®ï¼š\n- API Key\n- API Secret\n- Passphrase`);
                console.error(`[batchClosePositions] é”™è¯¯: è´¦æˆ·å‡­è¯ä¸å®Œæ•´`);
                return;
            }
            
            // è·å–å½“å‰æŒä»“
            try {
                console.log(`[batchClosePositions] å‡†å¤‡è°ƒç”¨APIè·å–æŒä»“...`);
                console.log(`[batchClosePositions] APIè¯·æ±‚å‚æ•°:`, {
                    apiKey: account.apiKey.substring(0, 8) + '...',
                    hasApiSecret: !!account.apiSecret,
                    hasPassphrase: !!account.passphrase
                });
                
                const response = await fetch('/api/okx-trading/positions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                console.log(`[batchClosePositions] APIå“åº”çŠ¶æ€: ${response.status}`);
                
                const result = await response.json();
                console.log(`[batchClosePositions] APIå“åº”æ•°æ®:`, result);
                
                if (!result.success || !result.data) {
                    console.error(`[batchClosePositions] APIè¿”å›å¤±è´¥:`, result);
                    alert(`âŒ è·å–æŒä»“å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                    return;
                }
                
                console.log(`[batchClosePositions] è·å–åˆ°æŒä»“æ•°é‡: ${result.data.length}`);
                console.log(`[batchClosePositions] å…¨éƒ¨æŒä»“:`, result.data.map(p => ({
                    instId: p.instId,
                    posSide: p.posSide,
                    posSize: p.posSize
                })));
                
                // ç­›é€‰å‡ºæŒ‡å®šæ–¹å‘çš„æŒä»“
                const targetPositions = result.data.filter(pos => pos.posSide === posSide);
                console.log(`[batchClosePositions] ç­›é€‰ posSide=${posSide} åçš„æŒä»“æ•°é‡: ${targetPositions.length}`);
                
                if (targetPositions.length === 0) {
                    const directionText = posSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                    console.warn(`[batchClosePositions] æ²¡æœ‰æ‰¾åˆ°${directionText}æŒä»“`);
                    alert(`âš ï¸ å½“å‰æ²¡æœ‰${directionText}æŒä»“ï¼`);
                    return;
                }
                
                console.log(`[batchClosePositions] æ‰¾åˆ° ${targetPositions.length} ä¸ª${posSide}æŒä»“`);
                
                // æ„å»ºç¡®è®¤ä¿¡æ¯
                const directionText = posSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                const ratioText = ratio === 1 ? 'å…¨éƒ¨' : 'ä¸€åŠ';
                const emoji = posSide === 'long' ? 'ğŸ“‰' : 'ğŸ“ˆ';
                
                const positionsList = targetPositions.map(pos => {
                    const closeSize = ratio === 1 ? pos.posSize : Math.floor(pos.posSize / 2);
                    const unrealizedPnl = pos.unrealizedPnl || 0;
                    const pnlColor = unrealizedPnl >= 0 ? 'ğŸŸ¢' : 'ğŸ”´';
                    return `  ${pnlColor} ${pos.instId.replace('-USDT-SWAP', '')}: ${closeSize}å¼  (ç›ˆäº: ${unrealizedPnl >= 0 ? '+' : ''}${unrealizedPnl.toFixed(2)} USDT)`;
                }).join('\n');
                
                const totalUnrealizedPnl = targetPositions.reduce((sum, pos) => sum + (pos.unrealizedPnl || 0), 0);
                const totalMargin = targetPositions.reduce((sum, pos) => sum + (pos.margin || 0), 0);
                
                const confirmMsg = `${emoji} æ‰¹é‡å¹³${ratioText}${directionText}\n\n` +
                    `ã€æŒä»“åˆ—è¡¨ã€‘\n${positionsList}\n\n` +
                    `ã€ç»Ÿè®¡ä¿¡æ¯ã€‘\n` +
                    `  â€¢ æŒä»“æ•°é‡: ${targetPositions.length} ä¸ª\n` +
                    `  â€¢ æ€»ä¿è¯é‡‘: ${totalMargin.toFixed(2)} USDT\n` +
                    `  â€¢ æ€»æµ®åŠ¨ç›ˆäº: ${totalUnrealizedPnl >= 0 ? '+' : ''}${totalUnrealizedPnl.toFixed(2)} USDT\n` +
                    `  â€¢ å¹³ä»“æ¯”ä¾‹: ${ratio === 1 ? '100%' : '50%'}\n\n` +
                    `ç¡®è®¤æ‰¹é‡å¹³ä»“ï¼Ÿ`;
                
                // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                const confirmed = await showConfirmDialog(confirmMsg, 'ğŸ”” æ‰¹é‡å¹³ä»“ç¡®è®¤');
                if (!confirmed) {
                    console.log('[batchClosePositions] ç”¨æˆ·å–æ¶ˆæ‰¹é‡å¹³ä»“');
                    return;
                }
                
                // å¼€å§‹æ‰¹é‡å¹³ä»“
                console.log('[batchClosePositions] å¼€å§‹æ‰¹é‡å¹³ä»“...');
                let successCount = 0;
                let failCount = 0;
                const results = [];
                
                for (const position of targetPositions) {
                    try {
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        console.log(`[batchClosePositions] æ­£åœ¨å¹³ä»“: ${coinName}...`);
                        
                        // è®¡ç®—å¹³ä»“æ•°é‡
                        let closeSize = position.posSize;
                        if (ratio !== 1) {
                            // å¹³ä¸€åŠï¼šå‘ä¸‹å–æ•´
                            closeSize = Math.floor(position.posSize / 2);
                            // è‡³å°‘å¹³1å¼ 
                            if (closeSize < 1) {
                                closeSize = 1;
                            }
                        }
                        
                        // è°ƒç”¨å¹³ä»“API
                        const closeResponse = await fetch('/api/okx-trading/close-position', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                apiKey: account.apiKey,
                                apiSecret: account.apiSecret,
                                passphrase: account.passphrase,
                                instId: position.instId,
                                posSide: position.posSide,
                                closeSize: closeSize  // æŒ‡å®šå¹³ä»“æ•°é‡
                            })
                        });
                        
                        const closeResult = await closeResponse.json();
                        
                        if (closeResult.success) {
                            successCount++;
                            const pnl = position.unrealizedPnl || 0;
                            results.push(`âœ… ${coinName}: ${closeSize}å¼  (${pnl >= 0 ? '+' : ''}${pnl.toFixed(2)} USDT)`);
                            console.log(`[batchClosePositions] ${coinName} å¹³ä»“æˆåŠŸ`);
                        } else {
                            failCount++;
                            results.push(`âŒ ${coinName}: ${closeResult.error || 'å¤±è´¥'}`);
                            console.error(`[batchClosePositions] ${coinName} å¹³ä»“å¤±è´¥:`, closeResult.error);
                        }
                        
                        // å»¶è¿Ÿ100msï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        failCount++;
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        results.push(`âŒ ${coinName}: ${error.message || 'å¼‚å¸¸'}`);
                        console.error(`[batchClosePositions] ${coinName} å¹³ä»“å¼‚å¸¸:`, error);
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                const resultMsg = `${emoji} æ‰¹é‡å¹³ä»“å®Œæˆ\n\n` +
                    `ã€ç»“æœç»Ÿè®¡ã€‘\n` +
                    `  â€¢ æˆåŠŸ: ${successCount} ä¸ª\n` +
                    `  â€¢ å¤±è´¥: ${failCount} ä¸ª\n\n` +
                    `ã€è¯¦ç»†ç»“æœã€‘\n${results.join('\n')}`;
                
                alert(resultMsg);
                
                // åˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
                await refreshAccountData();
                
            } catch (error) {
                console.error('[batchClosePositions] æ‰¹é‡å¹³ä»“å¼‚å¸¸:', error);
                alert(`âŒ æ‰¹é‡å¹³ä»“å¼‚å¸¸: ${error.message}`);
            }
        }

        // 1:1å¯¹å†²é…å¯¹å‡½æ•°
        async function hedgePositions(basePosSide) {
            console.log(`[hedgePositions] å¼€å§‹å¯¹å†²é…å¯¹: basePosSide=${basePosSide}`);
            
            // è·å–å½“å‰è´¦æˆ·
            const account = accounts.find(acc => acc.id === currentAccount);
            if (!account) {
                alert('âŒ è¯·å…ˆé€‰æ‹©è´¦æˆ·ï¼');
                return;
            }
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('âŒ è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // è·å–å½“å‰æŒä»“
            try {
                const response = await fetch('/api/okx-trading/positions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                const result = await response.json();
                
                if (!result.success || !result.data) {
                    alert(`âŒ è·å–æŒä»“å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                    return;
                }
                
                // ç­›é€‰å‡ºæŒ‡å®šæ–¹å‘çš„æŒä»“
                const basePositions = result.data.filter(pos => pos.posSide === basePosSide);
                
                if (basePositions.length === 0) {
                    const directionText = basePosSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                    alert(`âš ï¸ å½“å‰æ²¡æœ‰${directionText}æŒä»“ï¼Œæ— æ³•è¿›è¡Œå¯¹å†²é…å¯¹ï¼`);
                    return;
                }
                
                console.log(`[hedgePositions] æ‰¾åˆ° ${basePositions.length} ä¸ª${basePosSide}æŒä»“`);
                
                // è·å–è´¦æˆ·ä½™é¢
                const balanceResponse = await fetch('/api/okx-trading/account', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase
                    })
                });
                
                const balanceResult = await balanceResponse.json();
                let availableBalance = 0;
                if (balanceResult.success && balanceResult.data) {
                    availableBalance = parseFloat(balanceResult.data.availBal || 0);
                }
                
                // è®¡ç®—å¯¹å†²æ‰€éœ€çš„æ€»é‡‘é¢ï¼ˆå®é™…å ç”¨ä¿è¯é‡‘ï¼Œ10xæ æ†ï¼‰
                const totalMarginNeeded = basePositions.reduce((sum, pos) => sum + (pos.margin || 0), 0);
                
                // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿï¼ˆç•™20%ç¼“å†²ï¼‰
                const requiredBalance = totalMarginNeeded * 1.2;
                if (availableBalance < requiredBalance) {
                    alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\n` +
                        `ã€èµ„é‡‘éœ€æ±‚ã€‘\n` +
                        `  â€¢ å¯¹å†²æ‰€éœ€ä¿è¯é‡‘: ${totalMarginNeeded.toFixed(2)} USDT\n` +
                        `  â€¢ å»ºè®®ä½™é¢: ${requiredBalance.toFixed(2)} USDT\n\n` +
                        `ã€å½“å‰çŠ¶æ€ã€‘\n` +
                        `  â€¢ å¯ç”¨ä½™é¢: ${availableBalance.toFixed(2)} USDT\n` +
                        `  â€¢ ç¼ºå°‘: ${(requiredBalance - availableBalance).toFixed(2)} USDT\n\n` +
                        `ğŸ’¡ å»ºè®®ï¼šå¢åŠ è´¦æˆ·ä½™é¢æˆ–å…ˆå¹³æ‰éƒ¨åˆ†æŒä»“`);
                    return;
                }
                
                // æ„å»ºç¡®è®¤ä¿¡æ¯
                const baseDirectionText = basePosSide === 'long' ? 'å¤šå•' : 'ç©ºå•';
                const hedgeDirectionText = basePosSide === 'long' ? 'ç©ºå•' : 'å¤šå•';
                const emoji = basePosSide === 'long' ? 'âš–ï¸' : 'âš–ï¸';
                
                const positionsList = basePositions.map(pos => {
                    const coinName = pos.instId.replace('-USDT-SWAP', '');
                    // è®¡ç®—åˆçº¦ä»·å€¼ï¼ˆå¼ æ•° Ã— æ¯å¼ ä»·å€¼ï¼‰
                    const contractValue = pos.posSize * pos.avgPrice * (pos.instId.includes('BTC') ? 0.01 : pos.instId.includes('ETH') ? 0.1 : 1.0);
                    return `  â€¢ ${coinName}: ${pos.posSize}å¼  â‰ˆ ${contractValue.toFixed(2)} USDT (ä¿è¯é‡‘: ${pos.margin.toFixed(2)} USDT)`;
                }).join('\n');
                
                const totalContractValue = basePositions.reduce((sum, pos) => {
                    const contractValue = pos.posSize * pos.avgPrice * (pos.instId.includes('BTC') ? 0.01 : pos.instId.includes('ETH') ? 0.1 : 1.0);
                    return sum + contractValue;
                }, 0);
                
                const confirmMsg = `${emoji} 1:1å¯¹å†²é…å¯¹\n\n` +
                    `ã€ç°æœ‰${baseDirectionText}æŒä»“ã€‘\n${positionsList}\n\n` +
                    `ã€å¯¹å†²æ–¹æ¡ˆã€‘\n` +
                    `  â€¢ æŒä»“æ•°é‡: ${basePositions.length} ä¸ª\n` +
                    `  â€¢ åˆçº¦æ€»å€¼: ${totalContractValue.toFixed(2)} USDT\n` +
                    `  â€¢ éœ€è¦ä¿è¯é‡‘: ${totalMarginNeeded.toFixed(2)} USDT (10xæ æ†)\n` +
                    `  â€¢ å¯ç”¨ä½™é¢: ${availableBalance.toFixed(2)} USDT\n\n` +
                    `ã€å¯¹å†²æ“ä½œã€‘\n` +
                    `  å°†å¼€${basePositions.length}ä¸ª${hedgeDirectionText}ï¼Œæ¯ä¸ªå¸ç§å¼€ç­‰é¢å¯¹å†²ä»“ä½\n\n` +
                    `âš ï¸ å¯¹å†²åå°†é”å®šå½“å‰ç›ˆäºï¼ŒåŒå‘æŒä»“ï¼\n\n` +
                    `ç¡®è®¤æ‰§è¡Œå¯¹å†²é…å¯¹ï¼Ÿ`;
                
                if (!confirm(confirmMsg)) {
                    console.log('[hedgePositions] ç”¨æˆ·å–æ¶ˆå¯¹å†²é…å¯¹');
                    return;
                }
                
                // å¼€å§‹æ‰¹é‡å¯¹å†²å¼€ä»“
                console.log('[hedgePositions] å¼€å§‹æ‰¹é‡å¯¹å†²å¼€ä»“...');
                let successCount = 0;
                let failCount = 0;
                const results = [];
                
                // å¯¹å†²æ–¹å‘ï¼šå¤šå•é…ç©ºå•ï¼Œç©ºå•é…å¤šå•
                const hedgeDirection = basePosSide === 'long' ? 'short' : 'long';
                
                for (const position of basePositions) {
                    try {
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        console.log(`[hedgePositions] æ­£åœ¨å¯¹å†²: ${coinName}...`);
                        
                        // è®¡ç®—å¯¹å†²é‡‘é¢ï¼ˆä½¿ç”¨ç›¸åŒçš„ä¿è¯é‡‘ï¼‰
                        const hedgeAmount = position.margin.toFixed(2);
                        
                        // æ„å»ºè®¢å•æ•°æ®
                        const orderData = {
                            instId: position.instId,
                            side: hedgeDirection === 'long' ? 'buy' : 'sell',
                            posSide: hedgeDirection,
                            ordType: 'market',
                            sz: hedgeAmount,  // USDTé‡‘é¢
                            lever: '10'
                        };
                        
                        // å‘é€è®¢å•è¯·æ±‚
                        const orderResponse = await fetch('/api/okx-trading/place-order', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                apiKey: account.apiKey,
                                apiSecret: account.apiSecret,
                                passphrase: account.passphrase,
                                ...orderData
                            })
                        });
                        
                        const orderResult = await orderResponse.json();
                        
                        if (orderResult.success) {
                            successCount++;
                            results.push(`âœ… ${coinName}: ${hedgeAmount} USDT`);
                            console.log(`[hedgePositions] ${coinName} å¯¹å†²æˆåŠŸ`);
                        } else {
                            failCount++;
                            results.push(`âŒ ${coinName}: ${orderResult.error || 'å¤±è´¥'}`);
                            console.error(`[hedgePositions] ${coinName} å¯¹å†²å¤±è´¥:`, orderResult.error);
                        }
                        
                        // å»¶è¿Ÿ100msï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        failCount++;
                        const coinName = position.instId.replace('-USDT-SWAP', '');
                        results.push(`âŒ ${coinName}: ${error.message || 'å¼‚å¸¸'}`);
                        console.error(`[hedgePositions] ${coinName} å¯¹å†²å¼‚å¸¸:`, error);
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                const resultMsg = `${emoji} å¯¹å†²é…å¯¹å®Œæˆ\n\n` +
                    `ã€ç»“æœç»Ÿè®¡ã€‘\n` +
                    `  â€¢ æˆåŠŸ: ${successCount} ä¸ª\n` +
                    `  â€¢ å¤±è´¥: ${failCount} ä¸ª\n\n` +
                    `ã€è¯¦ç»†ç»“æœã€‘\n${results.join('\n')}\n\n` +
                    `âœ… å¯¹å†²åæŒä»“ï¼š${baseDirectionText} ${basePositions.length}ä¸ª + ${hedgeDirectionText} ${successCount}ä¸ª`;
                
                alert(resultMsg);
                
                // åˆ·æ–°è´¦æˆ·ä¿¡æ¯ã€æŒä»“å’Œæ—¥å¿—
                await refreshAccountData();
                await loadTradingLogs();
                
            } catch (error) {
                console.error('[hedgePositions] å¯¹å†²é…å¯¹å¼‚å¸¸:', error);
                alert(`âŒ å¯¹å†²é…å¯¹å¼‚å¸¸: ${error.message}`);
            }
        }

        // æäº¤è®¢å•
        // æäº¤è®¢å•
        async function submitOrder(event) {
            event.preventDefault();
            
            const amount = document.getElementById('orderAmount').value;
            const priceType = document.getElementById('priceType').value;
            
            if (!amount || parseFloat(amount) <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ˜“æ•°é‡');
                return;
            }
            
            const symbolData = symbols.find(s => s.symbol === currentSymbol);
            const account = accounts.find(acc => acc.id === currentAccount);
            
            if (!account || !account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯·å…ˆé…ç½®è´¦æˆ·APIå‡­è¯ï¼');
                return;
            }
            
            // æ„å»ºè®¢å•æ•°æ®
            const orderData = {
                instId: currentSymbol,  // äº¤æ˜“å¯¹
                side: currentDirection === 'long' ? 'buy' : 'sell',  // buy/sell
                posSide: currentDirection,  // long/short
                ordType: priceType,  // market/limit
                sz: parseFloat(amount),  // æ•°é‡ï¼ˆUSDTï¼‰
                lever: currentLeverage  // æ æ†å€æ•°
            };
            
            // é™ä»·å•éœ€è¦ä»·æ ¼
            if (priceType === 'limit') {
                orderData.px = symbolData.price;
            }
            
            console.log('å‡†å¤‡æäº¤è®¢å•:', orderData);
            
            const confirmMsg = `ç¡®è®¤${currentDirection === 'long' ? 'åšå¤š' : 'åšç©º'} ${symbolData.name}ï¼Ÿ
äº¤æ˜“å¯¹: ${currentSymbol}
å¼€ä»“é‡‘é¢: ${amount} USDT
æ æ†: ${currentLeverage}x
å ç”¨ä¿è¯é‡‘: ${(parseFloat(amount) / currentLeverage).toFixed(2)} USDT
${priceType === 'limit' ? 'ä»·æ ¼: ' + symbolData.price : 'å¸‚ä»·å•'}

âš ï¸ è¿™å°†åœ¨OKXçœŸå®ä¸‹å•ï¼Œè¯·ç¡®è®¤æ— è¯¯ï¼`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            try {
                // è°ƒç”¨çœŸå®ä¸‹å•API
                const response = await fetch('/api/okx-trading/place-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: account.apiKey,
                        apiSecret: account.apiSecret,
                        passphrase: account.passphrase,
                        ...orderData
                    })
                });
                
                const result = await response.json();
                console.log('ä¸‹å•å“åº”:', result);
                
                if (result.success) {
                    const data = result.data;
                    alert(`âœ… è®¢å•æäº¤æˆåŠŸï¼

è®¢å•ID: ${data.ordId || ''}
åˆçº¦å¼ æ•°: ${data.contracts || ''} å¼ 
å¼€ä»“é‡‘é¢: ${data.inputUsdt} USDT
å ç”¨ä¿è¯é‡‘: ${data.actualUsdt || (data.inputUsdt / data.leverage).toFixed(2)} USDT
æ æ†å€æ•°: ${data.leverage || currentLeverage}x
å½“å‰ä»·æ ¼: ${data.price || ''}

${data.sMsg || result.message || ''}`);
                    
                    // ä¸‹å•æˆåŠŸååˆ·æ–°è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“
                    await refreshAccountData();
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    document.getElementById('orderAmount').value = '';
                } else {
                    alert(`âŒ ä¸‹å•å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}
é”™è¯¯ä»£ç : ${result.code || ''}`);
                }
            } catch (error) {
                console.error('ä¸‹å•å¼‚å¸¸:', error);
                alert(`âŒ ä¸‹å•å¼‚å¸¸: ${error.message || error}`);
            }
        }

        // åŠ è½½è´¦æˆ·æ•°æ®
        function loadAccountData() {
            // è¿™é‡Œåº”è¯¥ä»APIåŠ è½½çœŸå®æ•°æ®
            console.log('åŠ è½½è´¦æˆ·æ•°æ®...');
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            console.log('åˆ·æ–°æ•°æ®...');
            loadAccountData();
        }

        // æœç´¢äº¤æ˜“å¯¹
        document.getElementById('symbolSearch').addEventListener('input', function(e) {
            const search = e.target.value.toLowerCase();
            document.querySelectorAll('.symbol-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'block' : 'none';
            });
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>

    <!-- è´¦æˆ·ç®¡ç†å¯¹è¯æ¡† -->
    <div class="modal" id="accountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ è´¦æˆ·ç®¡ç†</h2>
                <button class="btn-close" onclick="closeAccountModal()">Ã—</button>
            </div>
            
            <div class="account-list" id="accountList">
                <!-- è´¦æˆ·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>

            <button class="btn-add-account" onclick="showAddAccountForm()">
                â• æ·»åŠ æ–°è´¦æˆ·
            </button>
            
            <!-- å¿«é€Ÿé…ç½®POITè´¦æˆ·æŒ‰é’® -->
            <button class="btn-add-account" onclick="quickAddPoitAccount()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); margin-top: 10px;">
                âš¡ å¿«é€Ÿé…ç½®POITå­è´¦æˆ·
            </button>

            <!-- æ·»åŠ /ç¼–è¾‘è´¦æˆ·è¡¨å• -->
            <div class="account-form" id="accountForm" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #2d3748;" id="formTitle">æ·»åŠ è´¦æˆ·</h3>
                <form onsubmit="saveAccount(event)">
                    <input type="hidden" id="editAccountId">
                    <div class="form-group">
                        <label for="accountName">è´¦æˆ·åç§°</label>
                        <input type="text" id="accountName" required placeholder="ä¾‹å¦‚ï¼šä¸»è´¦æˆ·ã€å­è´¦æˆ·1">
                    </div>
                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="text" id="apiKey" placeholder="è¾“å…¥OKX API Key">
                    </div>
                    <div class="form-group">
                        <label for="apiSecret">API Secret</label>
                        <input type="password" id="apiSecret" placeholder="è¾“å…¥OKX API Secret">
                    </div>
                    <div class="form-group">
                        <label for="passphrase">Passphrase</label>
                        <input type="password" id="passphrase" placeholder="è¾“å…¥OKX Passphrase">
                    </div>
                    <div class="form-group">
                        <label for="accountBalance">è´¦æˆ·ä½™é¢ (USDT) <small style="color: #888;">[å¯é€‰ï¼Œé…ç½®APIåè‡ªåŠ¨è·å–]</small></label>
                        <input type="number" id="accountBalance" placeholder="é…ç½®APIå‡­è¯åå°†è‡ªåŠ¨è·å–ä½™é¢" step="0.01" min="0" style="background-color: #f7fafc;">
                        <small style="color: #888; display: block; margin-top: 5px;">
                            ğŸ’¡ æç¤ºï¼šå¡«å†™API Keyã€Secretå’ŒPassphraseåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»OKXè·å–æœ€æ–°ä½™é¢
                        </small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="hideAccountForm()">å–æ¶ˆ</button>
                        <button type="submit" class="btn-primary">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="modal" id="confirmDialog">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="border-bottom: none; padding-bottom: 10px;">
                <h2 id="confirmDialogTitle" style="font-size: 18px;">âš ï¸ ç¡®è®¤æ“ä½œ</h2>
            </div>
            <div id="confirmDialogMessage" style="white-space: pre-wrap; line-height: 1.8; color: #2d3748; margin: 20px 0; font-size: 14px;">
                <!-- æ¶ˆæ¯å†…å®¹ -->
            </div>
            <div class="form-actions" style="margin-top: 25px; gap: 10px;">
                <button type="button" class="btn-secondary" onclick="closeConfirmDialog(false)" style="flex: 1;">å–æ¶ˆ</button>
                <button type="button" class="btn-primary" onclick="closeConfirmDialog(true)" style="flex: 1;">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
        let confirmDialogResolve = null;

        function showConfirmDialog(message, title = 'âš ï¸ ç¡®è®¤æ“ä½œ') {
            return new Promise((resolve) => {
                confirmDialogResolve = resolve;
                document.getElementById('confirmDialogTitle').textContent = title;
                document.getElementById('confirmDialogMessage').textContent = message;
                document.getElementById('confirmDialog').classList.add('active');
            });
        }

        function closeConfirmDialog(result) {
            document.getElementById('confirmDialog').classList.remove('active');
            if (confirmDialogResolve) {
                confirmDialogResolve(result);
                confirmDialogResolve = null;
            }
        }

        // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('confirmDialog').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfirmDialog(false);
            }
        });
        
        // æ‰“å¼€è´¦æˆ·ç®¡ç†å¯¹è¯æ¡†
        function openAccountModal() {
            document.getElementById('accountModal').classList.add('active');
            renderAccountList();
        }

        // å…³é—­è´¦æˆ·ç®¡ç†å¯¹è¯æ¡†
        function closeAccountModal() {
            document.getElementById('accountModal').classList.remove('active');
            hideAccountForm();
        }

        // åˆ·æ–°è´¦æˆ·ä½™é¢
        async function refreshAccountBalance(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) {
                alert('è´¦æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            if (!account.apiKey || !account.apiSecret || !account.passphrase) {
                alert('è¯¥è´¦æˆ·æœªé…ç½®APIå‡­è¯ï¼Œæ— æ³•è‡ªåŠ¨è·å–ä½™é¢ï¼');
                return;
            }
            
            const balance = await fetchAccountBalance(account.apiKey, account.apiSecret, account.passphrase);
            
            if (balance > 0) {
                account.balance = balance;
                localStorage.setItem('okx_accounts', JSON.stringify(accounts));
                renderAccountList();
                renderAccountTabs();
                
                // å¦‚æœæ˜¯å½“å‰è´¦æˆ·ï¼Œæ›´æ–°ä½™é¢æ˜¾ç¤º
                if (accountId === currentAccount) {
                    updateAccountBalance();
                }
                
                alert(`ä½™é¢åˆ·æ–°æˆåŠŸï¼å½“å‰ä½™é¢: ${balance.toFixed(2)} USDT`);
            } else {
                alert('è·å–ä½™é¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIå‡­è¯æ˜¯å¦æ­£ç¡®ï¼');
            }
        }

        // æ¸²æŸ“è´¦æˆ·åˆ—è¡¨
        function renderAccountList() {
            const accountList = document.getElementById('accountList');
            accountList.innerHTML = accounts.map((account, index) => {
                const hasApi = account.apiKey && account.apiSecret && account.passphrase;
                const apiStatus = hasApi ? 
                    '<span style="color: #10b981; font-size: 12px;">âœ“ APIå·²é…ç½®</span>' : 
                    '<span style="color: #ef4444; font-size: 12px;">âœ— APIæœªé…ç½®</span>';
                return `
                <div class="account-item">
                    <div class="account-item-info">
                        <div class="account-item-name">${account.name}</div>
                        <div class="account-item-balance">${account.balance.toFixed(2)} USDT</div>
                        <div style="margin-top: 4px;">${apiStatus}</div>
                    </div>
                    <div class="account-item-actions">
                        ${hasApi ? `<button class="btn-small" onclick="refreshAccountBalance('${account.id}')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); margin-bottom: 5px;">ğŸ”„ åˆ·æ–°ä½™é¢</button>` : ''}
                        <button class="btn-small btn-edit" onclick="editAccount('${account.id}')">ç¼–è¾‘</button>
                        ${accounts.length > 1 ? `<button class="btn-small btn-delete" onclick="deleteAccount('${account.id}')">åˆ é™¤</button>` : ''}
                    </div>
                </div>
            `}).join('');
        }

        // æ˜¾ç¤ºæ·»åŠ è´¦æˆ·è¡¨å•
        function showAddAccountForm() {
            document.getElementById('formTitle').textContent = 'æ·»åŠ è´¦æˆ·';
            document.getElementById('editAccountId').value = '';
            document.getElementById('accountName').value = '';
            document.getElementById('apiKey').value = '';
            document.getElementById('apiSecret').value = '';
            document.getElementById('passphrase').value = '';
            document.getElementById('accountBalance').value = '';
            document.getElementById('accountForm').style.display = 'block';
        }

        // éšè—è´¦æˆ·è¡¨å•
        function hideAccountForm() {
            document.getElementById('accountForm').style.display = 'none';
        }

        // ç¼–è¾‘è´¦æˆ·
        function editAccount(accountId) {
            const account = accounts.find(a => a.id === accountId);
            if (!account) return;

            document.getElementById('formTitle').textContent = 'ç¼–è¾‘è´¦æˆ·';
            document.getElementById('editAccountId').value = accountId;
            document.getElementById('accountName').value = account.name;
            document.getElementById('apiKey').value = account.apiKey || '';
            document.getElementById('apiSecret').value = account.apiSecret || '';
            document.getElementById('passphrase').value = account.passphrase || '';
            document.getElementById('accountBalance').value = account.balance;
            document.getElementById('accountForm').style.display = 'block';
        }

        // åˆ é™¤è´¦æˆ·
        function deleteAccount(accountId) {
            if (accounts.length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªè´¦æˆ·ï¼');
                return;
            }

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦æˆ·å—ï¼Ÿ')) return;

            accounts = accounts.filter(a => a.id !== accountId);
            
            // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰è´¦æˆ·ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªè´¦æˆ·
            if (currentAccount === accountId) {
                currentAccount = accounts[0].id;
                selectAccount(currentAccount);
            }

            localStorage.setItem('okx_accounts', JSON.stringify(accounts));
            renderAccountList();
            renderAccountTabs();
        }

        // ä»APIè·å–è´¦æˆ·ä½™é¢
        async function fetchAccountBalance(apiKey, apiSecret, passphrase) {
            try {
                const response = await fetch('/api/okx-trading/account-balance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiSecret: apiSecret,
                        passphrase: passphrase
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    return result.balance;
                } else {
                    console.error('è·å–ä½™é¢å¤±è´¥:', result.error);
                    return 0;
                }
            } catch (error) {
                console.error('è·å–ä½™é¢å¼‚å¸¸:', error);
                return 0;
            }
        }

        // ä¿å­˜è´¦æˆ·
        async function saveAccount(event) {
            event.preventDefault();

            const accountId = document.getElementById('editAccountId').value;
            const name = document.getElementById('accountName').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiSecret = document.getElementById('apiSecret').value.trim();
            const passphrase = document.getElementById('passphrase').value.trim();

            if (!name) {
                alert('è¯·å¡«å†™è´¦æˆ·åç§°ï¼');
                return;
            }

            // å¦‚æœæä¾›äº†APIå‡­è¯ï¼Œè‡ªåŠ¨è·å–ä½™é¢
            let balance = 0;
            if (apiKey && apiSecret && passphrase) {
                // æ˜¾ç¤ºåŠ è½½æç¤º
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'æ­£åœ¨è·å–ä½™é¢...';
                submitBtn.disabled = true;
                
                balance = await fetchAccountBalance(apiKey, apiSecret, passphrase);
                
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                
                if (balance === 0) {
                    const confirm = window.confirm('æ— æ³•è·å–è´¦æˆ·ä½™é¢ï¼Œå¯èƒ½æ˜¯APIå‡­è¯é”™è¯¯ã€‚æ˜¯å¦ç»§ç»­ä¿å­˜ï¼Ÿ');
                    if (!confirm) {
                        return;
                    }
                }
            } else {
                // å¦‚æœæ²¡æœ‰APIå‡­è¯ï¼Œä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„ä½™é¢ï¼ˆå¦‚æœæœ‰ï¼‰
                const balanceInput = document.getElementById('accountBalance');
                if (balanceInput && balanceInput.value) {
                    balance = parseFloat(balanceInput.value);
                }
            }

            if (accountId) {
                // ç¼–è¾‘ç°æœ‰è´¦æˆ·
                const account = accounts.find(a => a.id === accountId);
                if (account) {
                    account.name = name;
                    account.apiKey = apiKey;
                    account.apiSecret = apiSecret;
                    account.passphrase = passphrase;
                    account.balance = balance;
                }
            } else {
                // æ·»åŠ æ–°è´¦æˆ·
                const newId = 'account_' + Date.now();
                accounts.push({
                    id: newId,
                    name: name,
                    apiKey: apiKey,
                    apiSecret: apiSecret,
                    passphrase: passphrase,
                    balance: balance
                });
            }

            localStorage.setItem('okx_accounts', JSON.stringify(accounts));
            renderAccountList();
            renderAccountTabs();
            hideAccountForm();
            
            // å¦‚æœç¼–è¾‘çš„æ˜¯å½“å‰è´¦æˆ·ï¼Œæ›´æ–°ä½™é¢æ˜¾ç¤º
            if (accountId === currentAccount) {
                updateAccountBalance();
            }
            
            alert(`è´¦æˆ·ä¿å­˜æˆåŠŸï¼${balance > 0 ? `å½“å‰ä½™é¢: ${balance.toFixed(2)} USDT` : 'æœªè·å–åˆ°ä½™é¢'}`);
        }

        // å¿«é€Ÿé…ç½®POITå­è´¦æˆ·
        async function quickAddPoitAccount() {
            const confirmed = confirm('ç¡®è®¤è¦å¿«é€Ÿé…ç½®POITå­è´¦æˆ·å—ï¼Ÿ\n\nè´¦æˆ·ä¿¡æ¯ï¼š\n- è´¦æˆ·åç§°: POIT (å­è´¦æˆ·)\n- API Key: 8650e46c-***\n- ç³»ç»Ÿå°†è‡ªåŠ¨ä»OKXè·å–è´¦æˆ·ä½™é¢');
            
            if (!confirmed) return;
            
            // POITè´¦æˆ·é…ç½®
            const poitAccount = {
                id: 'account_poit_' + Date.now(),
                name: 'POIT (å­è´¦æˆ·)',
                apiKey: '8650e46c-059b-431d-93cf-55f8c79babdb',
                apiSecret: '4C2BD2AC6A08615EA7F36A6251857FCE',
                passphrase: 'Wu666666.',
                balance: 0
            };
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const existingIndex = accounts.findIndex(acc => 
                acc.apiKey === poitAccount.apiKey || acc.name === poitAccount.name
            );
            
            if (existingIndex > -1) {
                const update = confirm('æ£€æµ‹åˆ°åŒåæˆ–ç›¸åŒAPI Keyçš„è´¦æˆ·ï¼Œæ˜¯å¦æ›´æ–°ï¼Ÿ');
                if (!update) return;
                
                accounts[existingIndex] = poitAccount;
                console.log('âœ… POITè´¦æˆ·å·²æ›´æ–°');
            } else {
                accounts.push(poitAccount);
                console.log('âœ… POITè´¦æˆ·å·²æ·»åŠ ');
            }
            
            // è·å–è´¦æˆ·ä½™é¢
            alert('æ­£åœ¨ä»OKXè·å–è´¦æˆ·ä½™é¢ï¼Œè¯·ç¨å€™...');
            const balance = await fetchAccountBalance(
                poitAccount.apiKey,
                poitAccount.apiSecret,
                poitAccount.passphrase
            );
            
            if (balance > 0) {
                poitAccount.balance = balance;
                alert(`âœ… POITå­è´¦æˆ·é…ç½®æˆåŠŸï¼\n\nè´¦æˆ·ä½™é¢: ${balance.toFixed(2)} USDT`);
            } else {
                alert('âš ï¸ POITå­è´¦æˆ·å·²æ·»åŠ ï¼Œä½†æ— æ³•è·å–ä½™é¢ã€‚\nè¯·æ£€æŸ¥APIæƒé™è®¾ç½®ã€‚\n\nè´¦æˆ·å·²ä¿å­˜ï¼Œæ‚¨å¯ä»¥ç¨åæ‰‹åŠ¨åˆ·æ–°ä½™é¢ã€‚');
            }
            
            // ä¿å­˜å¹¶åˆ·æ–°
            localStorage.setItem('okx_accounts', JSON.stringify(accounts));
            renderAccountList();
            renderAccountTabs();
            
            // åˆ‡æ¢åˆ°POITè´¦æˆ·
            if (existingIndex > -1) {
                selectAccount(accounts[existingIndex].id);
            } else {
                selectAccount(accounts[accounts.length - 1].id);
            }
            
            // å…³é—­å¯¹è¯æ¡†
            closeAccountModal();
        }
        
        // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('accountModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAccountModal();
            }
        });

        // ==================== é¢„è­¦åŠŸèƒ½ ====================
        
        // åŠ è½½é¢„è­¦è®¾ç½®
        async function loadAlertSettingsOKX() {
            try {
                const response = await fetch('/api/coin-tracker/alert-settings');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.settings) {
                        const settings = result.settings;
                        
                        // æ›´æ–°UI
                        document.getElementById('upperThreshold').value = settings.upperThreshold || 30;
                        document.getElementById('lowerThreshold').value = settings.lowerThreshold || -40;
                        document.getElementById('upperAlertSwitch').checked = settings.upperEnabled || false;
                        document.getElementById('lowerAlertSwitch').checked = settings.lowerEnabled || false;
                        
                        console.log('âœ… OKXé¡µé¢ï¼šé¢„è­¦è®¾ç½®å·²åŠ è½½', settings);
                    }
                }
            } catch (e) {
                console.warn('âš ï¸ OKXé¡µé¢ï¼šåŠ è½½é¢„è­¦è®¾ç½®å¤±è´¥', e);
            }
        }
        
        // ä¿å­˜é¢„è­¦è®¾ç½®
        async function saveAlertSettingsOKX() {
            try {
                const settings = {
                    upperThreshold: parseFloat(document.getElementById('upperThreshold').value),
                    lowerThreshold: parseFloat(document.getElementById('lowerThreshold').value),
                    upperEnabled: document.getElementById('upperAlertSwitch').checked,
                    lowerEnabled: document.getElementById('lowerAlertSwitch').checked,
                    tgEnabled: false, // OKXé¡µé¢é»˜è®¤ä¸å¯ç”¨TGé€šçŸ¥
                    upperTriggered: false,
                    lowerTriggered: false,
                    lastCheckTime: null
                };
                
                const response = await fetch('/api/coin-tracker/alert-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert('âœ… é¢„è­¦è®¾ç½®å·²ä¿å­˜ï¼');
                        console.log('âœ… OKXé¡µé¢ï¼šé¢„è­¦è®¾ç½®å·²ä¿å­˜', settings);
                    }
                }
            } catch (e) {
                console.error('âŒ OKXé¡µé¢ï¼šä¿å­˜é¢„è­¦è®¾ç½®å¤±è´¥', e);
                alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // æ›´æ–°æ€»æ¶¨è·Œå¹…æ˜¾ç¤º
        async function updateTotalChangeOKX() {
            try {
                const response = await fetch('/api/coin-change-tracker/latest');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        const totalChange = result.data.total_change;
                        const element = document.getElementById('totalChangePercent');
                        if (element) {
                            element.textContent = `${totalChange > 0 ? '+' : ''}${totalChange.toFixed(2)}%`;
                            element.style.color = totalChange > 0 ? '#10b981' : totalChange < 0 ? '#ef4444' : '#6b7280';
                        }
                    }
                }
            } catch (e) {
                console.warn('âš ï¸ OKXé¡µé¢ï¼šæ›´æ–°æ€»æ¶¨è·Œå¹…å¤±è´¥', e);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        init();
        
        // åŠ è½½é¢„è­¦è®¾ç½®
        loadAlertSettingsOKX();
        
        // æ›´æ–°æ€»æ¶¨è·Œå¹…
        updateTotalChangeOKX();

        // å®šæ—¶åˆ·æ–°è´¦æˆ·æ•°æ®ï¼ˆæ¯30ç§’ï¼‰
        setInterval(() => {
            refreshAccountData();
            updateTotalChangeOKX(); // åŒæ—¶æ›´æ–°æ¶¨è·Œå¹…
        }, 30000);
    </script>
</body>
</html>
