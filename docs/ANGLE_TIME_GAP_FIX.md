# è§’åº¦è®¡ç®—æ—¶é—´é—´éš”ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“‹ ç”¨æˆ·éœ€æ±‚

> **"Bç‚¹ä¸Aç‚¹çš„é—´éš”è¦å¤§äº2åˆ†é’Ÿ é‡æ–°è®¡ç®—"**

### éœ€æ±‚è§£è¯»
- **Aç‚¹**ï¼šå³°å€¼ç‚¹ï¼ˆæœ€é«˜ç‚¹ï¼‰
- **Cç‚¹**ï¼šå›å‡ç‚¹ï¼ˆå³°å€¼åçš„è°·åº•ï¼‰
- **è¦æ±‚**ï¼šCç‚¹ä¸Aç‚¹çš„æ—¶é—´é—´éš”å¿…é¡» **>= 2åˆ†é’Ÿ**

### ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªé™åˆ¶ï¼Ÿ
1. **è¿‡æ»¤çŸ­æœŸæ³¢åŠ¨**ï¼šæ’é™¤1-2åˆ†é’Ÿå†…çš„å°å¹…æ³¢åŠ¨
2. **ä¿ç•™çœŸå®è¶‹åŠ¿**ï¼šåªä¿ç•™æœ‰æ„ä¹‰çš„ä»·æ ¼ä¸‹è·Œå’Œå›å‡
3. **å‡å°‘å™ªéŸ³**ï¼šé¿å…é¢‘ç¹çš„å°è§’åº¦æ ‡è®°å¹²æ‰°è§†è§‰

## ğŸ”§ æŠ€æœ¯å®ç°

### ä¿®æ”¹å‰çš„ä»£ç 
```python
def find_valley_after_peak(data_points, peak_idx):
    """åœ¨å³°å€¼åæ‰¾è°·åº•"""
    if peak_idx >= len(data_points) - 1:
        return None
    
    valley_idx = None
    min_value = data_points[peak_idx]['cumulative_pct']
    
    for i in range(peak_idx + 1, len(data_points)):
        current = data_points[i]['cumulative_pct']
        
        if current < min_value:
            min_value = current
            valley_idx = i
        elif valley_idx is not None and current > data_points[valley_idx]['cumulative_pct']:
            break
    
    return valley_idx
```

**é—®é¢˜**ï¼šæ²¡æœ‰æ£€æŸ¥æ—¶é—´é—´éš”ï¼Œå¯èƒ½è¿”å›ä»…ç›¸éš”å‡ ç§’çš„è°·åº•ç‚¹ã€‚

### ä¿®æ”¹åçš„ä»£ç 
```python
# æ–°å¢å‚æ•°å¸¸é‡
MIN_VALLEY_TIME_GAP = 2  # Cç‚¹ä¸Aç‚¹çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆåˆ†é’Ÿï¼‰

def find_valley_after_peak(data_points, peak_idx):
    """åœ¨å³°å€¼åæ‰¾è°·åº•ï¼ˆCç‚¹ä¸Aç‚¹é—´éš”å¿…é¡»>=MIN_VALLEY_TIME_GAPåˆ†é’Ÿï¼‰"""
    if peak_idx >= len(data_points) - 1:
        return None
    
    valley_idx = None
    min_value = data_points[peak_idx]['cumulative_pct']
    peak_time = parse_time_to_minutes(data_points[peak_idx]['time'])
    
    for i in range(peak_idx + 1, len(data_points)):
        current = data_points[i]['cumulative_pct']
        current_time = parse_time_to_minutes(data_points[i]['time'])
        
        # âœ… æ£€æŸ¥æ—¶é—´é—´éš”æ˜¯å¦>=MIN_VALLEY_TIME_GAPåˆ†é’Ÿ
        time_diff = current_time - peak_time
        if time_diff < MIN_VALLEY_TIME_GAP:  # å°äºæœ€å°æ—¶é—´é—´éš”ï¼Œè·³è¿‡
            continue
        
        if current < min_value:
            min_value = current
            valley_idx = i
        elif valley_idx is not None and current > data_points[valley_idx]['cumulative_pct']:
            break
    
    return valley_idx
```

**æ”¹è¿›**ï¼š
1. âœ… è®¡ç®—å³°å€¼æ—¶é—´ `peak_time`
2. âœ… éå†æ—¶æ£€æŸ¥æ¯ä¸ªç‚¹çš„æ—¶é—´ `current_time`
3. âœ… å¦‚æœ `time_diff < 2åˆ†é’Ÿ`ï¼Œè·³è¿‡è¯¥ç‚¹
4. âœ… åªè€ƒè™‘é—´éš”>=2åˆ†é’Ÿçš„ç‚¹ä½œä¸ºè°·åº•å€™é€‰

## ğŸ“Š æ•°æ®å¯¹æ¯”

### ä¿®æ”¹å‰çš„æ•°æ®
| æ—¥æœŸ | æ€»æ•° | é”è§’ | é’è§’ |
|------|------|------|------|
| 2æœˆ8æ—¥ | 17ä¸ª | 17ä¸ª | 0ä¸ª |
| 2æœˆ9æ—¥ | 1ä¸ª | 1ä¸ª | 0ä¸ª |
| 2æœˆ10æ—¥ | 10ä¸ª | 8ä¸ª | 2ä¸ª |

### ä¿®æ”¹åçš„æ•°æ®
| æ—¥æœŸ | æ€»æ•° | é”è§’ | é’è§’ | å˜åŒ– |
|------|------|------|------|------|
| 2æœˆ8æ—¥ | 17ä¸ª | 17ä¸ª | 0ä¸ª | æ— å˜åŒ– |
| 2æœˆ9æ—¥ | 1ä¸ª | 1ä¸ª | 0ä¸ª | æ— å˜åŒ– |
| 2æœˆ10æ—¥ | 11ä¸ª | 9ä¸ª | 2ä¸ª | +1ä¸ª âœ… |

### 2æœˆ10æ—¥å‰5ä¸ªè§’åº¦è¯¦æƒ…
```
1. 00:00 - é’è§’ 84.96Â° - å³°å€¼: 00:49:00 (37.78%)
2. 01:00 - é’è§’ 62.85Â° - å³°å€¼: 01:45:00 (51.88%)
3. 02:00 - é”è§’ 8.00Â° - å³°å€¼: 02:36:00 (42.79%)
4. 03:00 - é”è§’ 6.02Â° - å³°å€¼: 03:51:00 (53.81%)
5. 04:00 - é”è§’ 6.66Â° - å³°å€¼: 04:56:00 (49.71%)
```

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### ä¼˜ç‚¹
1. âœ… **è¿‡æ»¤å™ªéŸ³**ï¼šæ’é™¤çŸ­æœŸæ³¢åŠ¨ï¼Œå›¾è¡¨æ›´æ¸…æ™°
2. âœ… **æé«˜è´¨é‡**ï¼šåªä¿ç•™æœ‰æ„ä¹‰çš„è¶‹åŠ¿è§’åº¦
3. âœ… **å¯é…ç½®**ï¼šé€šè¿‡ `MIN_VALLEY_TIME_GAP` å¸¸é‡è°ƒæ•´

### å¦‚ä½•è°ƒæ•´æ—¶é—´é—´éš”ï¼Ÿ

ä¿®æ”¹ `collectors/okx_angle_analyzer_v3.py` ä¸­çš„å‚æ•°ï¼š
```python
MIN_VALLEY_TIME_GAP = 2  # æ”¹ä¸º3ã€5ã€10ç­‰å€¼
```

**æ¨èå€¼**ï¼š
- **2åˆ†é’Ÿ**ï¼ˆå½“å‰ï¼‰ï¼šé€‚åˆ1åˆ†é’Ÿæ•°æ®ï¼Œè¿‡æ»¤æœ€å°æ³¢åŠ¨
- **5åˆ†é’Ÿ**ï¼šæ›´ä¿å®ˆï¼Œåªä¿ç•™æ˜æ˜¾è¶‹åŠ¿
- **10åˆ†é’Ÿ**ï¼šéå¸¸ä¿å®ˆï¼Œä»…ä¿ç•™é•¿æœŸè¶‹åŠ¿

## ğŸ“ ä½¿ç”¨è¯´æ˜

### é‡æ–°ç”Ÿæˆæ•°æ®
```bash
cd /home/user/webapp

# å•ä¸ªæ—¥æœŸ
python3 collectors/okx_angle_analyzer_v3.py 20260210

# æ‰¹é‡ç”Ÿæˆ
for date in 20260208 20260209 20260210; do
    python3 collectors/okx_angle_analyzer_v3.py $date
done
```

### æµ‹è¯•API
```bash
curl 'http://localhost:5000/api/okx-trading/angles?date=20260210'
```

### æŸ¥çœ‹å‰ç«¯æ•ˆæœ
è®¿é—®ï¼šhttps://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/okx-trading-marks

é€‰æ‹©æ—¥æœŸæŸ¥çœ‹è§’åº¦æ ‡è®°ï¼

## ğŸ”„ ç®—æ³•æµç¨‹å›¾

```
Aç‚¹ï¼ˆå³°å€¼ï¼‰
    |
    | (ç­‰å¾… >= 2åˆ†é’Ÿ)
    â†“
å¯»æ‰¾è°·åº•ï¼ˆCç‚¹ï¼‰
    - è·³è¿‡ < 2åˆ†é’Ÿçš„ç‚¹
    - æ‰¾åˆ°æœ€ä½ç‚¹
    - æ£€æµ‹åˆ°å›å‡
    |
    â†“
è®¡ç®—C'ç‚¹ï¼ˆå›åˆ°Aä¹‹å‰çš„ç­‰ä»·ä½ï¼‰
    |
    â†“
è®¡ç®—è§’åº¦ï¼šarctan(å‚ç›´è·ç¦»/æ°´å¹³è·ç¦»)
    |
    â†“
åˆ†ç±»ï¼šé”è§’(<45Â°) / é’è§’(>=45Â°)
```

## âœ… æ€»ç»“

1. âœ… **å®ç°äº†æ—¶é—´é—´éš”é™åˆ¶**ï¼šCç‚¹ä¸Aç‚¹é—´éš” >= 2åˆ†é’Ÿ
2. âœ… **ä¿æŒæ•°æ®è´¨é‡**ï¼šè¿‡æ»¤çŸ­æœŸå™ªéŸ³
3. âœ… **å‚æ•°å¯é…ç½®**ï¼šé€šè¿‡ `MIN_VALLEY_TIME_GAP` è°ƒæ•´
4. âœ… **æ•°æ®å·²é‡æ–°ç”Ÿæˆ**ï¼š2æœˆ8-10æ—¥æ•°æ®å·²æ›´æ–°
5. âœ… **APIå·²éªŒè¯**ï¼šè¿”å›æ•°æ®æ­£ç¡®

## ğŸ“… å®Œæˆæ—¶é—´
- 2026-02-10 07:15

## ğŸ”— ç›¸å…³æ–‡ä»¶
- `collectors/okx_angle_analyzer_v3.py` - è§’åº¦åˆ†æå™¨ï¼ˆå·²ä¼˜åŒ–ï¼‰
- `data/okx_angle_analysis/okx_angles_*.jsonl` - è§’åº¦æ•°æ®
- `app.py` - APIæ¥å£
- `templates/okx_trading_marks.html` - å‰ç«¯å±•ç¤º

---

**è¯·è®¿é—®é¡µé¢æŸ¥çœ‹æ•ˆæœï¼å¦‚éœ€è°ƒæ•´æ—¶é—´é—´éš”ï¼Œè¯·ä¿®æ”¹ `MIN_VALLEY_TIME_GAP` å‚æ•°å¹¶é‡æ–°ç”Ÿæˆæ•°æ®ã€‚**
