# C点判断逻辑说明

## ✅ C点判断条件（已验证正确）

### 核心逻辑
C点的判断条件是：**从A点下跌超过(B→A振幅)的一半**

### 数学表达式
```
振幅 = A点值 - B点值
目标回落值 = A点值 - (振幅 / 2)
C点条件 = 当前值 <= 目标回落值 且 下一点开始反弹
```

### 实际例子（2026-02-18数据）

#### 已知条件
- **B点**：-19.24%
- **A点**：34.96%
- **振幅**：34.96 - (-19.24) = **54.2%**

#### 计算过程
1. **振幅的一半**：54.2 / 2 = **27.1%**
2. **目标回落值**：34.96 - 27.1 = **7.86%**
3. **C点条件**：当前值 <= 7.86% 且下一点开始反弹

#### 实际结果
- **C点实际值**：6.56% ✅（满足 6.56 <= 7.86）
- **实际回落幅度**：34.96 - 6.56 = 28.4%
- **回落占振幅比例**：28.4 / 54.2 = **52.4%** ✅

### 代码实现
```python
# source_code/wave_peak_detector.py 第238-244行
amplitude = a_candidate['value'] - b_candidate['value']  # B到A的差值
half_amplitude = amplitude / 2                            # 差值的一半
target_decline = a_candidate['value'] - half_amplitude   # A点 - 差值的一半

# 检查是否已经回落超过一半
if current_value <= target_decline:
    # 检查是否止跌反弹
    if i + 1 < len(data) and data[i + 1]['total_change'] > current_value:
        # 找到C点
```

### 不同场景验证

#### 场景1：B负A正（最常见）
```
B = -50%, A = 10%
振幅 = 10 - (-50) = 60%
目标回落 = 10 - 30 = -20%
C点需要 <= -20%
```

#### 场景2：B负A负
```
B = -80%, A = -20%
振幅 = -20 - (-80) = 60%
目标回落 = -20 - 30 = -50%
C点需要 <= -50%
```

#### 场景3：B正A正
```
B = 10%, A = 70%
振幅 = 70 - 10 = 60%
目标回落 = 70 - 30 = 40%
C点需要 <= 40%
```

### 为什么这样设计？

#### 1. 符号无关性
无论B、A是正是负，公式都适用：
```
目标 = A - (A - B) / 2 = A - A/2 + B/2 = (A + B) / 2
```
即：C点需要回落到A和B的**中点**或更低

#### 2. 波峰特征
真正的波峰需要满足：
- **上涨**：从B到A，振幅≥35%
- **显著回调**：从A回落超过振幅的一半
- **止跌反弹**：C点之后开始反弹

这样才能称为一个完整的"波峰-回调"结构

### 与假突破的关系

#### 假突破判断
连续3个波峰的A点都没有突破第一个波峰的前高，判断为假突破

#### 举例
```
波峰1：B1(-50%) → A1(20%) → C1(-10%)
波峰2：B2(-10%) → A2(15%) → C2(-5%)   # A2(15%) < A1(20%) ⚠️
波峰3：B3(-5%)  → A3(18%) → C3(0%)    # A3(18%) < A1(20%) ⚠️

结果：连续3个波峰，A2和A3都没突破A1的20%，判断为假突破
```

### 总结

✅ **代码逻辑完全正确**  
✅ **C点判断：从A点下跌超过(B→A振幅)的一半**  
✅ **数学等价：C点 <= (A + B) / 2**  
✅ **符号无关：适用于所有正负数组合**  
✅ **实际验证：2月份16个波峰全部通过**  

---

_说明文档生成时间：2026-02-18_  
_版本：v1.0_
