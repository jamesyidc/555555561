# 情况8：暴跌幅度递增预警

## 功能概览

**情况8** 是一个日线级别的暴跌预警信号，专门检测连续波峰的暴跌幅度递增模式。当每次下跌的力度持续增强时，说明市场正在加速下跌，极可能即将暴跌。

## 检测原理

### 核心逻辑
监控连续波峰的**暴跌幅度**（从A点跌到下一个B点的跌幅），当跌幅持续递增时触发预警。

### 暴跌幅度定义
```
暴跌幅度 = |A点 - B点| (取绝对值)
```

其中：
- **A点**：波峰的顶部（局部最高点）
- **B点**：波峰的底部（局部最低点）

### 检测模式

#### 模式1：连续3波递增
```
条件: 第1波跌幅 < 第2波跌幅 < 第3波跌幅
符号: a1→b1 < a2→b2 < a3→b3
```

**示例**:
```
波峰1: A1=-10, B1=-30  → 跌幅 20
波峰2: A2=-20, B2=-50  → 跌幅 30  ✓ (30 > 20)
波峰3: A3=-30, B3=-75  → 跌幅 45  ✓ (45 > 30)

结论: 触发情况8预警（跌幅递增：20 → 30 → 45）
```

#### 模式2：后3波递增（4波数据）
```
条件: 第2波跌幅 < 第3波跌幅 < 第4波跌幅
符号: a2→b2 < a3→b3 < a4→b4
```

**示例**:
```
波峰1: A1=-10, B1=-20  → 跌幅 10
波峰2: A2=-15, B2=-45  → 跌幅 30
波峰3: A3=-25, B3=-70  → 跌幅 45  ✓ (45 > 30)
波峰4: A4=-35, B4=-100 → 跌幅 65  ✓ (65 > 45)

结论: 触发情况8预警（后3波跌幅递增：30 → 45 → 65）
```

## 预警级别

### Critical（极度危险）
- **等级**: 最高级别预警
- **优先级**: 高于所有其他暴跌预警（顶部递减、底部递增）
- **严重性**: 每次下跌力度在增强，市场加速崩溃

## 操作建议

### 逢高做空
- **时机**: 发现预警后，等待反弹至相对高点
- **策略**: 分批做空，设置止损
- **风控**: 严格控制仓位，避免重仓

## 预警信息格式

### API返回结构
```json
{
  "signal_type": "crash_warning_amplifying",
  "pattern_name": "情况8：暴跌幅度递增",
  "consecutive_peaks": 3,
  "peak_indices": "2-3-4",
  "warning_level": "critical",
  "warning": "🚨🚨🚨 【情况8】极度危险！波峰2-3-4暴跌幅度递增，每次下跌力度在增强，即将暴跌！",
  "operation_tip": "逢高做空",
  "peaks": [...],
  "pattern": {
    "crash_amplifying": true,
    "description": "暴跌幅度递增：第2波跌幅 < 第3波跌幅 < 第4波跌幅"
  },
  "comparisons": {
    "crash_amplitudes": {
      "amplitude_2": 30,
      "amplitude_3": 45,
      "amplitude_4": 65,
      "amp3_vs_amp2": {
        "increase": true,
        "diff": 15,
        "diff_pct": 50.0
      },
      "amp4_vs_amp3": {
        "increase": true,
        "diff": 20,
        "diff_pct": 44.44
      }
    },
    "a_values": {
      "a2": -20,
      "a3": -30,
      "a4": -40
    },
    "b_values": {
      "b2": -50,
      "b3": -75,
      "b4": -105
    }
  }
}
```

### 预警消息示例
```
🚨🚨🚨 【情况8】极度危险！波峰2-3-4暴跌幅度递增，每次下跌力度在增强，即将暴跌！
操作提示：逢高做空

暴跌幅度详情：
  第2波: 30 (从-20跌到-50)
  第3波: 45 (从-30跌到-75, +50.0%)
  第4波: 65 (从-40跌到-105, +44.4%)
```

## 技术实现

### 检测流程
1. **数据要求**: 至少3个完整波峰（BAC结构）
2. **扫描顺序**: 
   - 优先检测4波后3波模式（如果有≥4个波峰）
   - 再检测连续3波模式
3. **计算跌幅**: 对每个波峰计算 `abs(A点 - B点)`
4. **判断递增**: 检查跌幅是否严格递增
5. **返回结果**: 第一个匹配的模式

### 优先级设计
```python
# 检测顺序（优先级从高到低）
1. 情况8：暴跌幅度递增  ← 最高优先级
2. 顶部递减模式
3. 底部递增模式
```

### 代码位置
```
文件: source_code/wave_peak_detector.py
类: WavePeakDetector
方法: detect_crash_warning(wave_peaks: List[Dict])
```

## 使用方式

### API调用
```bash
# 获取当日波峰和预警
curl http://localhost:9002/api/coin-change-tracker/wave-peaks

# 查看crash_warning字段
{
  "success": true,
  "peaks_count": 4,
  "crash_warning": {
    "signal_type": "crash_warning_amplifying",
    ...
  }
}
```

### 前端显示
情况8预警会显示在：
1. **总涨跌幅趋势图**: 波峰详情面板
2. **预警卡片**: 独立的暴跌预警卡片（如有）
3. **Telegram通知**: 实时推送（如配置）

## 与其他预警的区别

| 预警类型 | 检测指标 | 触发条件 | 危险程度 |
|---------|---------|---------|---------|
| **情况8**<br>暴跌幅度递增 | 跌幅大小 | 跌幅递增 | ⚠️⚠️⚠️ Critical |
| 顶部递减 | A点高度 | A1>A2>A3 | ⚠️⚠️ High |
| 底部递增 | A点高度 | A1<A2<A3 | ⚠️ Medium |
| 假突破 | A点位置 | 无法突破前高 | ⚠️ Medium |

### 核心差异
- **情况8** 关注的是**下跌力度**（跌幅大小），而非价格绝对位置
- **顶部递减** 关注的是**反弹高点**是否降低
- **底部递增** 关注的是**反弹高点**是否升高

## 历史案例

### 案例1：2月23日测试数据
```
波峰配置:
  波峰1: A=-10, B=-30  → 跌幅 20
  波峰2: A=-20, B=-50  → 跌幅 30 (+50%)
  波峰3: A=-30, B=-75  → 跌幅 45 (+50%)
  波峰4: A=-40, B=-105 → 跌幅 65 (+44%)

检测结果:
  ✓ 触发情况8（后3波递增）
  ✓ 跌幅: 30 → 45 → 65
  ✓ 预警级别: critical
  ✓ 操作提示: 逢高做空
```

**市场表现**: 
- 预警后价格继续下跌
- 第4波跌幅达到65，验证了预警的准确性

## 注意事项

### ⚠️ 重要提醒

1. **全天监控**: 这是日线级别预警，需要全天实时监控波峰形成
2. **不是分钟级**: 与日内模式（10分钟柱子）不同，这是基于完整波峰（BAC结构）
3. **等待确认**: 波峰需要C点确认后才算完整，预警基于已确认的波峰
4. **结合其他指标**: 建议配合市场情绪、RSI等指标综合判断

### 🎯 最佳实践

1. **及时响应**: 发现情况8预警后立即评估市场
2. **分批操作**: 不要一次性重仓做空，分批建仓
3. **设置止损**: 严格止损，避免反弹爆仓
4. **保留记录**: 记录每次预警的准确性，优化策略

## 后续优化方向

- [ ] 增加历史准确率统计
- [ ] 支持预警阈值配置（跌幅增幅百分比）
- [ ] 添加Telegram实时推送
- [ ] 前端独立预警卡片展示
- [ ] 结合大周期预判做二次确认

## 版本历史

### v1.0 (2026-02-23)
- ✅ 初始版本发布
- ✅ 支持连续3波和后3波（4波数据）检测
- ✅ 预警级别：critical
- ✅ 操作提示：逢高做空
- ✅ 单元测试通过

## 相关文档

- [波峰检测说明](./波峰检测说明.md)
- [假突破检测说明](./假突破检测说明.md)
- [市场情绪分析](./市场情绪分析.md)

## 联系方式

- **项目仓库**: https://github.com/jamesyidc/25669889956
- **提交记录**: 5640539 - feat: 添加日线级别暴跌预警 - 情况8：暴跌幅度递增

---

**更新时间**: 2026-02-23  
**文档版本**: v1.0  
**作者**: AI Assistant
