# 情况8：暴跌预警 - A点递减模式

## 概述

情况8是日内基于波峰A点的暴跌预警系统，全天实时监控波峰的A点（反弹高点）变化趋势。当检测到连续的A点递减时，触发暴跌预警。

## 触发条件

### 情况8a: A1 > A2 > A3
- **条件**: 连续3个波峰的A点递减
- **含义**: 每次反弹的高点越来越低，上攻力量持续减弱
- **预警**: 🚨 【情况8】暴跌预警！波峰X-Y-Z A点递减（A1 > A2 > A3），即将暴跌
- **操作**: 逢高做空

### 情况8b: A2 > A3 > A4  
- **条件**: 最近4个波峰中，后3个波峰的A点递减
- **含义**: 即使最近有一个较高的反弹，但后续的反弹高点持续降低
- **预警**: 🚨 【情况8】暴跌预警！波峰X-Y-Z A点递减（A2 > A3 > A4），即将暴跌
- **操作**: 逢高做空

## 优先级

情况8预警的优先级：
1. **最高优先**: A2 > A3 > A4（如果有4个以上波峰）
2. **次优先**: A1 > A2 > A3（如果有3个以上波峰）

两种模式都是 **critical** 级别预警。

## 技术细节

### 波峰定义
- **A点（峰顶）**: 反弹的最高点，总涨跌幅的局部极大值
- **B点（谷底）**: 下跌的最低点，总涨跌幅的局部极小值
- **完整波峰**: B → A → B'（谷底 → 峰顶 → 下一个谷底）

### 检测逻辑
```python
# 情况8b: A2 > A3 > A4（优先检测）
if i + 3 < len(wave_peaks):
    peak2, peak3, peak4 = wave_peaks[i+1], wave_peaks[i+2], wave_peaks[i+3]
    a2, a3, a4 = peak2['a_point']['value'], peak3['a_point']['value'], peak4['a_point']['value']
    
    if (a2 > a3) and (a3 > a4):
        return {
            'signal_type': 'crash_warning_case8_a234',
            'pattern_name': '情况8：暴跌预警（A2 > A3 > A4）',
            'warning_level': 'critical',
            'operation_tip': '逢高做空',
            ...
        }

# 情况8a: A1 > A2 > A3
peak1, peak2, peak3 = wave_peaks[i], wave_peaks[i+1], wave_peaks[i+2]
a1, a2, a3 = peak1['a_point']['value'], peak2['a_point']['value'], peak3['a_point']['value']

if (a1 > a2) and (a2 > a3):
    return {
        'signal_type': 'crash_warning_case8_a123',
        'pattern_name': '情况8：暴跌预警（A1 > A2 > A3）',
        'warning_level': 'critical',
        'operation_tip': '逢高做空',
        ...
    }
```

### 数据来源
- **实时监控**: 总涨跌幅数据流
- **波峰检测**: `WavePeakDetector.detect_crash_warning()`
- **更新频率**: 每分钟检测一次
- **覆盖范围**: 当天所有波峰（从0:00至当前时间）

## 预警信息结构

```json
{
  "signal_type": "crash_warning_case8_a123",
  "pattern_name": "情况8：暴跌预警（A1 > A2 > A3）",
  "consecutive_peaks": 3,
  "peak_indices": "5-6-7",
  "warning_level": "critical",
  "warning": "🚨 【情况8】暴跌预警！波峰5-6-7 A点递减（A1 > A2 > A3），即将暴跌",
  "operation_tip": "逢高做空",
  "peaks": [
    {"a_point": {"value": 5.2, "beijing_time": "..."}, ...},
    {"a_point": {"value": 3.8, "beijing_time": "..."}, ...},
    {"a_point": {"value": 1.5, "beijing_time": "..."}, ...}
  ],
  "pattern": {
    "a_descending": true,
    "description": "情况8：A点递减（A1 > A2 > A3），反弹高点逐渐降低，即将暴跌"
  },
  "comparisons": {
    "a_values": {
      "a1": 5.2,
      "a2": 3.8,
      "a3": 1.5,
      "a2_vs_a1": {
        "decrease": true,
        "diff": -1.4,
        "diff_pct": -26.92
      },
      "a3_vs_a2": {
        "decrease": true,
        "diff": -2.3,
        "diff_pct": -60.53
      }
    }
  }
}
```

## 前端显示

### 1. 预警提示框
- 位置：页面顶部
- 样式：红色背景 + 警告图标
- 内容：预警信息 + 操作提示

### 2. 图表标记
- **A点标记**: 橙色三角形（峰顶）
- **连线**: 连接A1-A2-A3，显示递减趋势
- **悬浮提示**: 显示完整预警信息

### 3. 波峰详情面板
- 显示连续3个波峰的完整信息
- 高亮显示A点递减的对比数据
- 百分比变化显示

## 使用示例

### 案例1：A1 > A2 > A3 预警
```
时间轴：
10:00 - B1点: -50%
10:30 - A1点: -10% (反弹到-10%)
11:00 - B2点: -45%
11:30 - A2点: -20% (反弹到-20%，比A1低)
12:00 - B3点: -55%
12:30 - A3点: -35% (反弹到-35%，比A2更低)

触发预警：
🚨 【情况8】暴跌预警！波峰4-5-6 A点递减（A1 > A2 > A3），即将暴跌
操作提示：逢高做空
```

### 案例2：A2 > A3 > A4 预警
```
时间轴：
09:00 - A1点: -5%  (较高的反弹)
09:30 - A2点: -15% (反弹降低)
10:00 - A3点: -25% (继续降低)
10:30 - A4点: -40% (持续走低)

触发预警：
🚨 【情况8】暴跌预警！波峰5-6-7 A点递减（A2 > A3 > A4），即将暴跌
操作提示：逢高做空

说明：虽然A1较高，但后续A2、A3、A4持续递减，市场趋势向下
```

## 与其他预警的区别

| 特征 | 情况8 (A点递减) | 暴跌幅度递增 | 市场情绪预警 |
|------|----------------|--------------|--------------|
| **监控对象** | 波峰A点位置 | 波峰跌幅大小 | RSI背离 |
| **时间级别** | 日内波峰 | 日内波峰 | 实时数据 |
| **触发条件** | A1>A2>A3 或 A2>A3>A4 | 跌幅1<跌幅2<跌幅3 | RSI与价格背离 |
| **预警含义** | 反弹力量减弱 | 下跌加速 | 情绪转变 |
| **操作建议** | 逢高做空 | 逢高做空 | 见顶止盈 |

## 注意事项

1. **日内预警**: 这是日内（当天）的预警，不是跨天的日线预警
2. **全天监控**: 从0:00开始检测，实时更新
3. **不重复发送**: 同一模式的预警在检测到后，1小时内不重复发送
4. **需要波峰**: 至少需要3个完整波峰才能触发
5. **优先级**: A2>A3>A4 优先于 A1>A2>A3

## API接口

### 获取当前预警状态
```bash
GET /api/coin-change-tracker/wave-peaks
```

响应包含 `crash_warning` 字段：
```json
{
  "success": true,
  "peaks": [...],
  "crash_warning": {
    "signal_type": "crash_warning_case8_a123",
    "warning": "🚨 【情况8】暴跌预警！...",
    ...
  }
}
```

## 版本历史

### v1.0 (2026-02-23)
- ✅ 支持 A1 > A2 > A3 检测
- ✅ 支持 A2 > A3 > A4 检测
- ✅ 预警级别设置为 critical
- ✅ 统一命名为"情况8"
- ✅ 操作提示：逢高做空

## 相关文档

- [波峰检测算法](./波峰检测算法说明.md)
- [暴跌预警系统](./暴跌预警系统说明.md)
- [市场情绪监控](./市场情绪监控说明.md)

---

**更新时间**: 2026-02-23  
**文档版本**: v1.0  
**维护者**: Wave Peak Detector Team
