# Query系统问题诊断报告

**生成时间**: 2026-01-14 18:15:00  
**问题描述**: 页面显示数据与TXT文件内容不匹配

---

## 🔍 问题分析

### 用户截图显示的数据
```
计次: 4
急涨: 34
急跌: 5
比值: 5.8
差值: 29
```

### Google Drive最新TXT文件
**文件**: `2026-01-13_1710.txt`  
**文件夹ID**: `1yRFiM9u8pjwAGCth_milrOOO3v3rC47A`  
**日期**: 2026-01-13  

**文件内容**:
```
透明标签_急涨总和=急涨：0
透明标签_急跌总和=急跌：0
透明标签_计次=1
透明标签_差值结果=差值：0 数据不足
透明标签_急涨急跌比值=比值：数据不足
```

**导入记录**: 29条币种记录

### 系统当前数据
**JSONL最新快照**: `2026-01-14 17:30:01`
```
急涨: 14
急跌: 18
计次: 3
差值: -4
比值: 0
```

**API返回**: 同上（测试数据）

---

## 🚨 问题根源

### 1. 日期不匹配
- **Google Drive最新日期**: 2026-01-13  
- **今天日期**: 2026-01-14  
- **状态**: Google Drive中还没有2026-01-14的文件夹

### 2. 数据完全不匹配
三组数据完全不同：
- 截图数据: 计次=4, 急涨=34, 急跌=5
- TXT文件: 计次=1, 急涨=0, 急跌=0
- JSONL数据: 计次=3, 急涨=14, 急跌=18

### 3. 可能的原因

#### 原因A: 截图来自不同的时间点
用户截图可能是从一个更早或更晚的TXT文件获取的数据，而不是最新的`2026-01-13_1710.txt`

#### 原因B: 页面显示的是实时计算结果
截图中的数据可能不是从TXT文件读取的，而是实时从某个API计算得到的

#### 原因C: TXT文件更新延迟
Google Drive中的TXT文件可能还没有更新到包含截图数据的版本

---

## 📊 数据对比表

| 数据源 | 时间 | 计次 | 急涨 | 急跌 | 差值 | 比值 |
|--------|------|------|------|------|------|------|
| **用户截图** | ??? | 4 | 34 | 5 | 29 | 5.8 |
| **TXT文件** | 2026-01-13 17:10 | 1 | 0 | 0 | 0 | N/A |
| **JSONL数据** | 2026-01-14 17:30 | 3 | 14 | 18 | -4 | 0 |
| **API返回** | 2026-01-14 17:30 | 3 | 14 | 18 | -4 | 0 |

---

## 🔧 解决方案

### 方案1: 查找匹配的TXT文件

需要在Google Drive中找到包含以下数据的TXT文件：
- 急涨: 34
- 急跌: 5  
- 计次: 4
- 差值: 29
- 比值: 5.8

**建议步骤**:
1. 检查2026-01-13文件夹中的所有TXT文件
2. 检查2026-01-14文件夹（如果已创建）
3. 查看更早日期的文件夹

### 方案2: 确认数据来源

**需要用户确认**:
1. 截图中的页面URL是什么？
2. 截图拍摄的时间是什么？
3. 数据是从哪个文件夹/文件获取的？

### 方案3: 重新导入正确的文件

一旦找到正确的TXT文件：
```bash
cd /home/user/webapp
python3 migrate_query_to_jsonl.py \
  --txt-file=/path/to/correct/file.txt \
  --time="YYYY-MM-DD HH:MM:SS"
```

---

## 🐛 系统卡顿问题

### 可能原因

1. **数据库查询**  
   如果页面仍在使用SQLite而不是JSONL，可能会很慢

2. **大量数据渲染**  
   26,557条快照记录可能导致前端渲染变慢

3. **API响应慢**  
   JSONL读取整个文件可能比数据库索引查询慢

### 优化建议

1. **确认API已切换到JSONL**
   ```bash
   curl "http://localhost:5000/api/query/latest"
   ```

2. **添加索引或缓存**
   - 为最新的N条记录添加内存缓存
   - 只加载必要的字段

3. **前端优化**
   - 使用虚拟滚动
   - 延迟加载
   - 分页显示

---

## 📝 下一步行动

### 立即需要做的：

1. ✅ **确认数据来源**  
   找到截图数据对应的TXT文件

2. ✅ **检查2026-01-14文件夹**  
   确认Google Drive中是否有今天的数据

3. ✅ **重新导入正确数据**  
   使用正确的TXT文件更新JSONL

4. ✅ **验证API输出**  
   确认API返回的数据正确

---

## 📞 需要用户提供的信息

1. **截图详情**:
   - 截图拍摄的确切时间
   - 页面URL
   - 数据更新时间（页面上显示的"运算时间"）

2. **文件信息**:
   - 确认使用的TXT文件名称
   - 文件夹日期
   - 文件修改时间

3. **期望行为**:
   - 应该显示什么数据
   - 数据更新频率
   - 最新数据的时间点

---

**报告生成时间**: 2026-01-14 18:15:00  
**诊断工程师**: AI Assistant  
**状态**: 等待用户确认数据来源
