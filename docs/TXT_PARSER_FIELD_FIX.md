# TXTè§£æå™¨å­—æ®µç¼ºå¤±ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆ**: V5.5çš„å¸ç§è¯¦ç»†æ•°æ®å¾ˆå¤šæ˜¯ç©ºçš„æˆ–é”™è¯¯çš„

**é—®é¢˜è¡¨ç°**:
- å½“å‰ä»·æ ¼ (current_price): None
- å†å²é«˜ä½ (high_price): None  
- é«˜ä½æ—¶é—´ (high_time): None
- è·ç¦»é«˜ä½è·Œå¹… (drop_from_high): None
- æ›´æ–°æ—¶é—´ (update_time): None
- æ’è¡Œ (ranking): None

---

## ğŸ” é—®é¢˜æ ¹æºåˆ†æ

### 1. TXTæ–‡ä»¶å®é™…æ ¼å¼

```
æ ¼å¼: åºå·|å¸å|?|?|?|æ›´æ–°æ—¶é—´|å½“å‰ä»·æ ¼|å†å²é«˜ä½æ—¥æœŸ|è·ç¦»é«˜ä½è·Œå¹…|24hæ¶¨è·Œå¹…|?|?|æ’è¡Œ|å†å²é«˜ä½ä»·æ ¼|æœ€é«˜å æ¯”|æœ€ä½å æ¯”
ç´¢å¼•:  0   1   2 3 4     5           6          7             8          9       10 11  12       13         14      15
```

**ç¤ºä¾‹æ•°æ®**:
```
1|BTC|0|0|0|2026-01-14 00:04:39|126259.48|2025-10-07|-25.79|2.08|||17|92094.69155|73.46%|113.2%
```

### 2. è§£æå™¨é”™è¯¯

**æ–‡ä»¶**: `/home/user/webapp/txt_parser_enhanced.py`

**é”™è¯¯çš„å­—æ®µç´¢å¼•æ˜ å°„**:
```python
# âŒ é”™è¯¯çš„ä»£ç  (ç¬¬131-139è¡Œ)
rush_up = int(parts[3])      # åº”è¯¥æ˜¯ parts[2]
rush_down = int(parts[4])    # åº”è¯¥æ˜¯ parts[3]
last_price = float(parts[6]) # æ­£ç¡®ï¼Œä½†ç¼ºå°‘å…¶ä»–å­—æ®µ
change_24h = parts[8]        # åº”è¯¥æ˜¯ parts[9]
count = int(parts[12])       # åº”è¯¥æ˜¯ parts[4]
vol_24h = float(parts[13])   # TXTä¸­æ²¡æœ‰è¿™ä¸ªå­—æ®µ
# ç¼ºå°‘: high_price, high_time, drop_from_high, update_time, ranking
```

**ç¼ºå¤±çš„å­—æ®µæå–**:
- parts[5] - æ›´æ–°æ—¶é—´ (update_time) âŒ æœªæå–
- parts[6] - å½“å‰ä»·æ ¼ (current_price) âœ… æå–äº†ä½†å‘½åä¸º last_price
- parts[7] - å†å²é«˜ä½æ—¥æœŸ (high_time) âŒ æœªæå–
- parts[8] - è·ç¦»é«˜ä½è·Œå¹… (drop_from_high) âŒ æœªæå–
- parts[12] - æ’è¡Œ (ranking) âŒ æœªæå–
- parts[13] - å†å²é«˜ä½ä»·æ ¼ (high_price) âŒ æœªæå–

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ›´æ­£å­—æ®µç´¢å¼•æ˜ å°„

```python
# âœ… æ­£ç¡®çš„ä»£ç 
rush_up = int(parts[2])                          # æ€¥æ¶¨ (ç´¢å¼•2)
rush_down = int(parts[3])                        # æ€¥è·Œ (ç´¢å¼•3)
update_time = parts[5].strip()                   # æ›´æ–°æ—¶é—´ (ç´¢å¼•5)
current_price = float(parts[6])                  # å½“å‰ä»·æ ¼ (ç´¢å¼•6)
high_time = parts[7].strip()                     # é«˜ä½æ—¶é—´ (ç´¢å¼•7)
drop_from_high = float(parts[8].replace('%','')) # è·é«˜ä½è·Œå¹… (ç´¢å¼•8)
change_24h = float(parts[9].replace('%',''))     # 24hæ¶¨å¹… (ç´¢å¼•9)
ranking = int(parts[12])                         # æ’è¡Œ (ç´¢å¼•12)
high_price = float(parts[13])                    # å†å²é«˜ä½ä»·æ ¼ (ç´¢å¼•13)
count = int(parts[4])                            # è®¡æ¬¡ (ç´¢å¼•4)
```

### 2. æ·»åŠ ç¼ºå¤±å­—æ®µåˆ°è®°å½•

```python
# âœ… å®Œæ•´çš„è®°å½•ç»“æ„
record = {
    'snapshot_date': snapshot_date,
    'snapshot_time': snapshot_time,
    'inst_id': inst_id,
    'symbol': inst_id,                # æ–°å¢
    'current_price': current_price,   # æ–°å¢
    'last_price': current_price,      # å…¼å®¹æ€§
    'high_price': high_price,         # æ–°å¢
    'high_time': high_time,           # æ–°å¢
    'drop_from_high': drop_from_high, # æ–°å¢
    'update_time': update_time,       # æ–°å¢
    'ranking': ranking,               # æ–°å¢
    'rush_up': rush_up,
    'rush_down': rush_down,
    'diff': diff,
    'status': status,
    'change_24h': change_24h,
    'max_ratio': max_ratio,
    'min_ratio': min_ratio,
    'count': count,
    'vol_24h': vol_24h,
    'high_24h': None,
    'low_24h': None,
    'created_at': datetime.now().isoformat()
}
```

---

## ğŸ§ª ä¿®å¤éªŒè¯

### æµ‹è¯•æ•°æ®

**è¾“å…¥**: `/tmp/latest_txt_2026-01-14.txt`

```
1|BTC|0|0|0|2026-01-14 00:04:39|126259.48|2025-10-07|-25.79|2.08|||17|92094.69155|73.46%|113.2%
```

### ä¿®å¤å‰

```python
{
    'inst_id': 'BTC',
    'current_price': None,      # âŒ ç©º
    'high_price': None,         # âŒ ç©º
    'high_time': None,          # âŒ ç©º
    'drop_from_high': None,     # âŒ ç©º
    'update_time': None,        # âŒ ç©º
    'ranking': None,            # âŒ ç©º
    'change_24h': -64.07        # âŒ é”™è¯¯å€¼
}
```

### ä¿®å¤å

```python
{
    'inst_id': 'BTC',
    'current_price': 126259.48,        # âœ… æ­£ç¡®
    'high_price': 92094.69155,         # âœ… æ­£ç¡®
    'high_time': '2025-10-07',         # âœ… æ­£ç¡®
    'drop_from_high': -25.79,          # âœ… æ­£ç¡®
    'update_time': '2026-01-14 00:04:39', # âœ… æ­£ç¡®
    'ranking': 17,                     # âœ… æ­£ç¡®
    'change_24h': 2.08                 # âœ… æ­£ç¡®
}
```

---

## ğŸ“Š å­—æ®µæ˜ å°„å¯¹ç…§è¡¨

| å­—æ®µå | ç´¢å¼• | ç¤ºä¾‹å€¼ | ç”¨é€” |
|--------|------|--------|------|
| åºå· | 0 | 1 | è¡Œå· |
| å¸å | 1 | BTC | å¸ç§æ ‡è¯† |
| ~~æœªçŸ¥~~ | 2 | 0 | æ€¥æ¶¨æ•°é‡ |
| ~~æœªçŸ¥~~ | 3 | 0 | æ€¥è·Œæ•°é‡ |
| è®¡æ¬¡ | 4 | 0 | è®¡æ¬¡å€¼ |
| æ›´æ–°æ—¶é—´ | 5 | 2026-01-14 00:04:39 | æ•°æ®æ›´æ–°æ—¶é—´ |
| å½“å‰ä»·æ ¼ | 6 | 126259.48 | å®æ—¶ä»·æ ¼ |
| é«˜ä½æ—¶é—´ | 7 | 2025-10-07 | å†å²æœ€é«˜ä»·æ—¥æœŸ |
| è·é«˜ä½è·Œå¹… | 8 | -25.79 | ä»é«˜ä½ä¸‹è·Œç™¾åˆ†æ¯” |
| 24hæ¶¨å¹… | 9 | 2.08 | 24å°æ—¶æ¶¨è·Œå¹… |
| ~~æœªçŸ¥~~ | 10 | (ç©º) | - |
| ~~æœªçŸ¥~~ | 11 | (ç©º) | - |
| æ’è¡Œ | 12 | 17 | æ’å |
| å†å²é«˜ä½ä»·æ ¼ | 13 | 92094.69155 | å†å²æœ€é«˜ä»· |
| æœ€é«˜å æ¯” | 14 | 73.46% | æœ€é«˜å æ¯” |
| æœ€ä½å æ¯” | 15 | 113.2% | æœ€ä½å æ¯” |

---

## ğŸš€ éƒ¨ç½²çŠ¶æ€

### ä¿®æ”¹çš„æ–‡ä»¶

- **æ–‡ä»¶**: `/home/user/webapp/txt_parser_enhanced.py`
- **ä¿®æ”¹å†…å®¹**: 
  1. æ›´æ­£å­—æ®µç´¢å¼•æ˜ å°„ (ç¬¬131-153è¡Œ)
  2. æ·»åŠ ç¼ºå¤±å­—æ®µåˆ°è®°å½• (ç¬¬165-189è¡Œ)

### æœåŠ¡é‡å¯

```bash
pm2 restart gdrive-detector  # âœ… å·²é‡å¯
```

**GDriveæ£€æµ‹å™¨çŠ¶æ€**:
- è¿›ç¨‹ID: 15
- çŠ¶æ€: online âœ…
- é‡å¯æ¬¡æ•°: 1
- å†…å­˜: 5.4 MB

---

## âš ï¸ é‡è¦è¯´æ˜

### 1. æ•°æ®ç”Ÿæ•ˆæ—¶é—´

- âœ… è§£æå™¨å·²ä¿®å¤
- â³ **æ–°æ•°æ®**: ä¸‹æ¬¡TXTæ–‡ä»¶ä¸Šä¼ æ—¶ç”Ÿæ•ˆ
- ğŸ”’ **æ—§æ•°æ®**: ä¿æŒåŸæ ·ï¼ˆä¸ä¼šå›å¡«ï¼‰

### 2. æ•°æ®æµç¨‹

```
Windowså®¢æˆ·ç«¯
    â†“ ä¸Šä¼ 
Google Drive (TXTæ–‡ä»¶)
    â†“ æ£€æµ‹
GDriveæ£€æµ‹å™¨ (æ¯30ç§’æ‰«æ)
    â†“ è§£æ (ä½¿ç”¨ä¿®å¤åçš„txt_parser_enhanced.py)
JSONLæ–‡ä»¶ (ä¿å­˜å®Œæ•´å­—æ®µ)
    â†“ è¯»å–
Flask API
    â†“ å±•ç¤º
å‰ç«¯é¡µé¢
```

### 3. éªŒè¯æ–¹æ³•

**æŸ¥çœ‹ä¸‹ä¸€æ¬¡æ•°æ®é‡‡é›†**:
```bash
# ç­‰å¾…æ–°çš„TXTæ–‡ä»¶è¢«å¤„ç†å
tail -5 data/gdrive_jsonl/crypto_snapshots.jsonl | python3 -c "
import json
import sys
for line in sys.stdin:
    data = json.loads(line.strip())
    print(f'{data[\"inst_id\"]}: current_price={data.get(\"current_price\")}')
"
```

**é¢„æœŸè¾“å‡º** (ä¿®å¤å):
```
BTC: current_price=126259.48 âœ…
ETH: current_price=4954.59 âœ…
XRP: current_price=3.8419 âœ…
```

---

## ğŸ“ˆ å½±å“èŒƒå›´

### å—å½±å“çš„ç³»ç»Ÿ

1. **æ€¥æ¶¨/æ€¥è·Œå†å²è¶‹åŠ¿å›¾** - å¸ç§è¯¦ç»†æ•°æ®
2. **æŸ¥è¯¢é¡µé¢** - å¸ç§åˆ—è¡¨å±•ç¤º
3. **APIæ¥å£** - `/api/latest`, `/api/chart`

### å—ç›ŠåŠŸèƒ½

ä¿®å¤åï¼Œä»¥ä¸‹å­—æ®µå°†æ­£ç¡®æ˜¾ç¤ºï¼š
- âœ… å½“å‰ä»·æ ¼
- âœ… å†å²é«˜ä½ä»·æ ¼
- âœ… é«˜ä½æ—¶é—´
- âœ… è·ç¦»é«˜ä½è·Œå¹…
- âœ… æ›´æ–°æ—¶é—´
- âœ… æ’è¡Œ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- è®¡æ¬¡é”™è¯¯ä¿®å¤: `/home/user/webapp/COUNT_FIX_SUMMARY.md`
- æ—¥æœŸåˆ†éš”çº¿åŠŸèƒ½: `/home/user/webapp/DATE_SEPARATOR_FEATURE.md`
- TXTè§£æå™¨: `/home/user/webapp/txt_parser_enhanced.py`
- GDriveæ£€æµ‹å™¨: `/home/user/webapp/gdrive_detector_jsonl.py`

---

## âœ… æ€»ç»“

**é—®é¢˜**: V5.5å¸ç§è¯¦ç»†æ•°æ®ç¼ºå¤±æˆ–é”™è¯¯

**åŸå› **: TXTè§£æå™¨å­—æ®µç´¢å¼•æ˜ å°„é”™è¯¯ï¼Œæœªæå–6ä¸ªå…³é”®å­—æ®µ

**ä¿®å¤**: æ›´æ­£å­—æ®µç´¢å¼•æ˜ å°„ï¼Œæ·»åŠ å®Œæ•´çš„å­—æ®µæå–é€»è¾‘

**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶éƒ¨ç½²

**ç”Ÿæ•ˆ**: â³ ç­‰å¾…ä¸‹æ¬¡TXTæ–‡ä»¶ä¸Šä¼ 

**æµ‹è¯•**: âœ… æœ¬åœ°æµ‹è¯•é€šè¿‡

---

**ä¿®å¤äºº**: Claude AI  
**ä¿®å¤æ—¶é—´**: 2026-01-15 11:52  
**éªŒè¯çŠ¶æ€**: âœ… è§£æå™¨æµ‹è¯•é€šè¿‡ï¼Œç­‰å¾…å®é™…æ•°æ®éªŒè¯
