# 10分钟涨速统计功能说明

## 功能概述

在价格位置预警系统中新增了**10分钟涨速**统计功能，实时监控28个主流币种在过去10分钟的价格变化速度。

## 新增功能（v1.1）

### 每个币种的当日涨速统计

为每个币种添加了**4列统计数据**，记录当天在各涨速区间出现的次数：

| 列名 | 区间范围 | 说明 | 颜色 |
|------|----------|------|------|
| 今日+4%次数 | **> +4%** | 当天涨速大于+4%的采集次数 | 🟢 绿色 |
| 今日+1%次数 | **+1% < 涨速 ≤ +4%** | 当天涨速大于+1%且小于等于+4%的采集次数 | 🔵 青色 |
| 今日-1%次数 | **-3% < 涨速 < -1%** | 当天涨速大于-3%且小于-1%的采集次数 | 🟠 橙色 |
| 今日-3%次数 | **≤ -3%** | 当天涨速小于等于-3%的采集次数 | 🔴 红色 |

**注意**：-1% ≤ 涨速 ≤ +1% 区间（横盘）**不计入任何统计**！

**特点**：
- ✅ 每个币种独立统计
- ✅ 每天0点自动清零（通过日期JSONL文件隔离）
- ✅ 累计计数，只要触发一次就+1
- ✅ 表格中实时显示当前累计值

**使用场景**：
1. **波动频率统计**：查看某币种今天有几次大幅波动
2. **异常预警**：如果某币种今日-3%次数过多，可能有持续下跌风险
3. **强势币种识别**：今日+4%次数多的币种，可能有持续上涨动能
4. **交易策略参考**：结合波动次数和当前涨速，做出更精准判断

## 数据说明

### 1. 涨速分类

系统将10分钟涨速分为5个区间，并使用不同颜色标识：

| 涨速区间 | 标识 | 颜色 | 说明 |
|---------|------|------|------|
| > +4% | 🚀 | 绿色 | 强力上涨，可能存在FOMO行情 |
| +1% < 涨速 ≤ +4% | 📈 | 青色 | 温和上涨，市场情绪积极 |
| -1% ≤ 涨速 ≤ +1% | 📊 | 灰色 | 横盘震荡，价格波动不大 |
| -3% < 涨速 < -1% | 📉 | 橙色 | 温和下跌，可能是回调 |
| ≤ -3% | 💥 | 红色 | 急速下跌，可能有恐慌盘 |

**重要说明 - 边界值处理**：
- **+4%、+1%、-3%**：这些边界值归入"较大"区间
  - `+4.00%` → `+1%` 区间（+1% < 4% ≤ +4%）
  - `+4.01%` → `+4%` 区间（> +4%）
  - `+1.00%` → `0%` 区间（-1% ≤ 1% ≤ +1%）
  - `+1.01%` → `+1%` 区间（+1% < 1.01% ≤ +4%）
  - `-3.00%` → `-3%` 区间（≤ -3%）
  - `-2.99%` → `-1%` 区间（-3% < -2.99% < -1%）
- **-1%**：边界值归入横盘区间
  - `-1.00%` → `0%` 区间（-1% ≤ -1% ≤ +1%）
  - `-1.01%` → `-1%` 区间（-3% < -1.01% < -1%）

### 2. 数据采集

- **采集频率**: 每3分钟采集一次
- **采集器**: `source_code/price_speed_10m_collector.py`
- **数据源**: OKX交易所K线数据（1分钟级别）
- **计算方法**: 对比当前价格与10分钟前价格，计算百分比变化

### 3. 数据存储

#### JSONL文件格式

**存储路径**: `/home/user/webapp/data/price_speed_10m/`

**文件命名**: `price_speed_10m_YYYYMMDD.jsonl` (例如: `price_speed_10m_20260215.jsonl`)

**数据结构**:
```json
{
    "time": "2026-02-15 14:04:41",
    "total_coins": 28,
    "statistics": {
        "+4%": 0,
        "+1%": 0,
        "0%": 28,
        "-1%": 0,
        "-3%": 0
    },
    "daily_counts": {
        "BTC": {
            "+4%": 0,
            "+1%": 2,
            "-1%": 1,
            "-3%": 0
        },
        "ETH": {
            "+4%": 1,
            "+1%": 3,
            "-1%": 0,
            "-3%": 0
        },
        ...
    },
    "coins": [
        {
            "symbol": "BTC",
            "current_price": 70195.9,
            "price_10m_ago": 70303.4,
            "speed_10m": -0.153,
            "category": "0%"
        },
        ...
    ]
}
```

#### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `time` | string | 采集时间（北京时间，格式: YYYY-MM-DD HH:MM:SS） |
| `total_coins` | int | 采集的币种总数 |
| `statistics` | object | 各区间币种数量统计（当前时刻） |
| `daily_counts` | object | **每个币种的当日累计统计（新增）** |
| `daily_counts[symbol]` | object | 某币种的当日统计，包含4个字段：+4%, +1%, -1%, -3% |
| `daily_counts[symbol]['+4%']` | int | 当天涨速 > +4% 的次数 |
| `daily_counts[symbol]['+1%']` | int | 当天涨速在 +1% < speed ≤ +4% 的次数 |
| `daily_counts[symbol]['-1%']` | int | 当天涨速在 -3% < speed < -1% 的次数 |
| `daily_counts[symbol]['-3%']` | int | 当天涨速 ≤ -3% 的次数 |
| `coins` | array | 所有币种详细数据 |
| `coins[].symbol` | string | 币种符号（如: BTC, ETH） |
| `coins[].current_price` | float | 当前价格（USD） |
| `coins[].price_10m_ago` | float | 10分钟前价格（USD） |
| `coins[].speed_10m` | float | 10分钟涨速（百分比） |
| `coins[].category` | string | 涨速分类（+4%, +1%, 0%, -1%, -3%） |

### 4. 历史数据存储

- 每日数据单独存储在一个JSONL文件中
- 每行一条JSON记录（时间序列数据）
- 历史数据不会被覆盖或修改
- 可用于历史回测和趋势分析

## 页面展示

### 1. 顶部统计卡片

页面顶部新增5个统计卡片，实时显示各涨速区间的币种数量：

```
🚀 10分钟涨速 +4%及以上: X 个
📈 10分钟涨速 +1%~+4%: X 个
📊 10分钟涨速 -1%~+1%: X 个
📉 10分钟涨速 -1%~-3%: X 个
💥 10分钟涨速 -3%及以下: X 个
```

### 2. 表格新增列

在"27个币种实时位置"表格中，新增了**5列**（位于"当前价格"之后）：

1. **10分钟涨速**列：显示当前涨速（带颜色）
2. **今日+4%次数**列：绿色，显示当天涨速≥+4%的次数
3. **今日+1%次数**列：青色，显示当天涨速在+1%~+4%的次数
4. **今日-1%次数**列：橙色，显示当天涨速在-1%~-3%的次数
5. **今日-3%次数**列：红色，显示当天涨速≤-3%的次数

**表格列顺序**：
```
币种 | 当前价格 | 10分钟涨速 | +4%次 | +1%次 | -1%次 | -3%次 | 支撑线1 | ... | 预警
```

**展示特点**：
- 涨速根据区间显示不同颜色和背景
- 当日统计次数用粗体显示
- 当日统计为0时显示"0"
- 正数显示+号，负数显示-号

### 3. 页面宽度调整

为了容纳新增的5列（10分钟涨速 + 4列统计），页面最大宽度从**1800px**扩展到**2200px**。

## API接口

### 获取最新10分钟涨速数据

**端点**: `/api/price-speed-10m/latest`

**方法**: GET

**返回示例**:
```json
{
    "success": true,
    "time": "2026-02-15 14:04:41",
    "total_coins": 28,
    "statistics": {
        "+4%": 0,
        "+1%": 0,
        "0%": 28,
        "-1%": 0,
        "-3%": 0
    },
    "daily_counts": {
        "BTC": {
            "+4%": 0,
            "+1%": 2,
            "-1%": 1,
            "-3%": 0
        },
        "ETH": {
            "+4%": 1,
            "+1%": 3,
            "-1%": 0,
            "-3%": 0
        },
        ...
    },
    "coins": [
        {
            "symbol": "BTC",
            "current_price": 70195.9,
            "price_10m_ago": 70303.4,
            "speed_10m": -0.153,
            "category": "0%"
        },
        ...
    ]
}
```

## 后台服务

### 启动采集器

```bash
# 启动daemon模式（后台运行）
cd /home/user/webapp
nohup python3 source_code/price_speed_10m_collector.py --daemon > price_speed_10m_collector.log 2>&1 &

# 查看进程状态
ps aux | grep price_speed_10m_collector

# 查看日志
tail -f price_speed_10m_collector.log
```

### 停止采集器

```bash
# 查找进程ID
ps aux | grep price_speed_10m_collector | grep -v grep | awk '{print $2}'

# 终止进程
kill <PID>
```

### 回填历史数据

```bash
# 回填今日数据
cd /home/user/webapp
python3 source_code/price_speed_10m_collector.py --backfill
```

## 使用场景

1. **短线交易参考**: 10分钟涨速可以快速识别短期强势/弱势币种
2. **风险预警**: 
   - 当前急速下跌（≤-3%）可能预示恐慌抛售
   - 今日-3%次数多的币种，可能处于持续下跌趋势
3. **套利机会**: 
   - 当前强力上涨（≥+4%）可能存在短期超买，有回调机会
   - 今日+4%次数多的币种，可能有持续上涨动能
4. **市场情绪**: 统计各区间币种数量，判断整体市场情绪（多头/空头）
5. **波动频率分析**: 
   - 查看某币种今天的波动频率（4列统计之和）
   - 波动频繁的币种可能更适合短线交易
6. **异常识别**: 
   - 如果某币种今日+4%和-3%次数都很多，说明波动剧烈
   - 适合追踪是否有庄家操盘或重大新闻

## 注意事项

1. **数据延迟**: 数据每3分钟更新一次，可能存在3分钟内的延迟
2. **市场波动**: 10分钟涨速仅供参考，不作为投资建议
3. **极端行情**: 极端行情下（如交易所故障、大规模停机），数据可能不准确
4. **JSONL文件**: 不要手动修改JSONL文件，以免破坏数据完整性

## 版本信息

- **功能版本**: v1.1
- **发布日期**: 2026-02-15
- **页面版本**: v2.0.5
- **系统版本**: 价格位置预警系统 v2.0.5 + 10分钟涨速

---

**更新记录**:
- 2026-02-15 v1.1: 为每个币种添加当日涨速统计4列（+4%次、+1%次、-1%次、-3%次），自动累加，每天0点清零
- 2026-02-15 v1.0: 初始版本发布，支持28个主流币种的10分钟涨速监控
