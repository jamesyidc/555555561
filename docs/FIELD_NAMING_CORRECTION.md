# TXT字段名称修正说明

## 📅 修正日期：2026-01-15 13:45

## 🎯 问题描述

之前的TXT解析器中，字段变量名与实际含义不匹配，导致理解上的混淆。

### 错误的变量命名（修正前）

```python
# 错误的映射
rush_up = parts[2]      # ❌ 实际是"涨速"，不是"急涨"
rush_down = parts[3]    # ❌ 实际是"急涨"，不是"急跌"
count = parts[4]        # ❌ 实际是"急跌"，不是"计次"
```

### 正确的字段含义

根据TXT文件格式和Web界面显示：

```
序号|币名|涨速|急涨|急跌|更新时间|当前价格|历史高位日期|...
 0   1   2   3   4      5        6          7
```

**字段说明**：
- **parts[2]**: 涨速 (speed/change_rate) - 浮点数，如 -0.03, 0.05
- **parts[3]**: 急涨次数 (rush_up_count) - 整数，如 0, 1, 2
- **parts[4]**: 急跌次数 (rush_down_count) - 整数，如 0, 3, 4

## 🔧 修正方案

### 1. 正确的变量命名（修正后）

```python
# 正确的映射
speed = parts[2]           # ✅ 涨速 (浮点数)
rush_up = parts[3]         # ✅ 急涨次数 (整数)
rush_down = parts[4]       # ✅ 急跌次数 (整数)
```

### 2. 数据库字段

```python
record = {
    'speed': speed,              # 新增：涨速
    'rush_up': rush_up,          # 急涨次数
    'rush_down': rush_down,      # 急跌次数
    'count': rush_down,          # 向后兼容：保留count字段
    # ... 其他字段
}
```

## 📊 实际案例验证

### 案例1：SUI

**TXT数据**：
```
8|SUI|-0.1|2|4|2026-01-15 13:29:15|5.3537|2025-01-07|-66.31|-2.2|||15|1.7703|44.47%|135.05%
```

**字段解析**：
- parts[2] = `-0.1`  → **涨速** = -0.1
- parts[3] = `2`     → **急涨** = 2次
- parts[4] = `4`     → **急跌** = 4次

**Web界面显示**：
- 涨速：-0.1 ✅
- 急涨：2 ✅
- 急跌：4 ✅

### 案例2：LDO

**TXT数据**：
```
26|LDO|0.05|1|3|2026-01-15 13:29:16|155.26|2021-07-01|-99.59|-5.14|||26|0.6202|45.77%|122.51%
```

**字段解析**：
- parts[2] = `0.05`  → **涨速** = 0.05
- parts[3] = `1`     → **急涨** = 1次
- parts[4] = `3`     → **急跌** = 3次

**Web界面显示**：
- 涨速：0.05 ✅
- 急涨：1 ✅
- 急跌：3 ✅

## ✅ 修正后的完整字段映射

```python
# TXT格式（完整16字段）
格式: 序号|币名|涨速|急涨|急跌|更新时间|当前价格|历史高位日期|距离高位跌幅|24h涨跌幅|?|?|排行|历史高位价格|最高占比|最低占比
索引:  0   1   2   3   4     5        6          7             8          9       10 11  12       13         14      15

# Python变量映射
parts[0]  → 序号 (sequence_number)
parts[1]  → 币种 (inst_id / symbol)
parts[2]  → 涨速 (speed) - 浮点数
parts[3]  → 急涨次数 (rush_up) - 整数
parts[4]  → 急跌次数 (rush_down) - 整数
parts[5]  → 更新时间 (update_time)
parts[6]  → 当前价格 (current_price)
parts[7]  → 历史高位日期 (high_time)
parts[8]  → 距离高位跌幅 (drop_from_high)
parts[9]  → 24h涨跌幅 (change_24h)
parts[10] → (空)
parts[11] → (空)
parts[12] → 排行 (ranking)
parts[13] → 历史高位价格 (high_price)
parts[14] → 最高占比 (max_ratio)
parts[15] → 最低占比 (min_ratio)
```

## 🔍 修正的关键点

### 1. 字段类型

```python
speed: float        # 涨速，可以是负数或小数
rush_up: int        # 急涨次数，非负整数
rush_down: int      # 急跌次数，非负整数
```

### 2. 数值范围

```python
# 涨速范围
speed: -∞ ~ +∞ (实际常见范围: -1.0 ~ 1.0)

# 急涨/急跌次数范围
rush_up: 0 ~ N (非负整数)
rush_down: 0 ~ N (非负整数)
```

### 3. 向后兼容

```python
# 为了向后兼容，保留count字段
count = rush_down  # count字段保存急跌次数
```

## 📝 对前端的影响

### 前端显示列

Web界面的列名与字段的对应关系：

| 列名 | 字段名 | 数据类型 | 示例 |
|------|--------|----------|------|
| 涨速 | speed | float | -0.1, 0.05 |
| 急涨 | rush_up | int | 0, 1, 2 |
| 急跌 | rush_down | int | 0, 3, 4 |

### API返回字段

```json
{
  "coin": {
    "symbol": "SUI",
    "speed": -0.1,
    "rush_up": 2,
    "rush_down": 4,
    "count": 4
  }
}
```

## ⚠️ 重要提醒

### 1. 命名的历史遗留

之前的变量命名虽然有误导性，但**数据本身是正确的**。只是字段名称与实际含义不匹配。

### 2. 数据验证

修正后的解析器已通过以下验证：
- ✅ 13:29快照：所有29个币种数据与Windows客户端100%一致
- ✅ 字段类型正确：speed为float，rush_up/rush_down为int
- ✅ Web界面显示正确

### 3. 后续维护

在修改解析器代码时，请注意：
- 保持字段名称与实际含义一致
- 添加清晰的注释说明字段类型和范围
- 进行充分的测试验证

## 🎯 修正总结

| 项目 | 修正前 | 修正后 | 状态 |
|------|--------|--------|------|
| parts[2]变量名 | rush_up | speed | ✅ |
| parts[3]变量名 | rush_down | rush_up | ✅ |
| parts[4]变量名 | count | rush_down | ✅ |
| 数据正确性 | ✅ | ✅ | 保持 |
| 字段语义清晰度 | ❌ | ✅ | 提升 |
| 代码可维护性 | ❌ | ✅ | 提升 |

---

**修正完成时间**：2026-01-15 13:45  
**修正提交**：commit 93f901b  
**验证状态**：✅ 通过  
**影响范围**：仅变量命名，数据本身正确无误
