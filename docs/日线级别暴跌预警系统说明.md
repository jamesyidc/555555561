# 日线级别暴跌预警系统说明

## 功能概述

日线级别暴跌预警系统是一个独立的全天候监控工具，专门检测连续波峰A点递减模式（情况8：原委缩信号），用于预警市场可能发生的暴跌。

**重要区别**：
- ⚠️ **不是0-2点预判**：这是一个独立的日线级别预警系统
- 🔄 **全天监控**：可随时运行，监控当天或历史数据
- 📊 **基于波峰分析**：使用完整的B-A-C波峰数据进行分析

## 检测原理

### 情况8：原委缩信号 - 市场可能接跌

系统检测连续波峰A点（反弹高点）的RSI总和是否呈现递减趋势：

#### 模式1：A1 > A2 > A3
连续3个A点递减，反弹高点越来越低，上攻力量减弱。

```
示例：
A1 = -23.5  @ 06:00  (第1个反弹高点)
A2 = -35.8  @ 10:00  (第2个反弹高点，比A1低)
A3 = -48.3  @ 14:00  (第3个反弹高点，比A2更低)

结论：✅ 触发暴跌预警
```

#### 模式2：A2 > A3 > A4
后3个A点递减（需要4个以上完整波峰）。

```
示例：
A2 = -35.8  @ 10:00
A3 = -48.3  @ 14:00
A4 = -58.7  @ 18:00

结论：✅ 触发暴跌预警
```

### 为什么是"递减"？

- **负数比较**：-23 > -35 > -48（绝对值递增，但作为负数递减）
- **含义**：反弹高点离零点越来越远，表明市场持续走弱
- **RSI总和**：优先使用A点的RSI总和，如果不存在则使用总涨跌幅

## 使用方法

### 1. 命令行运行

#### 监控今天
```bash
cd /home/user/webapp
python3 scripts/daily_crash_warning_monitor.py
```

#### 监控指定日期
```bash
python3 scripts/daily_crash_warning_monitor.py 20260220
```

### 2. 定时任务（建议配置）

添加到crontab，每小时监控一次：
```bash
# 每小时执行一次日线预警监控
0 * * * * cd /home/user/webapp && python3 scripts/daily_crash_warning_monitor.py >> logs/crash_warning.log 2>&1
```

或者每30分钟：
```bash
*/30 * * * * cd /home/user/webapp && python3 scripts/daily_crash_warning_monitor.py >> logs/crash_warning.log 2>&1
```

### 3. 手动触发（用于测试）

```bash
# 查看帮助
python3 scripts/daily_crash_warning_monitor.py --help

# 查看最近5天的预警
for date in 20260219 20260220 20260221 20260222 20260223; do
    python3 scripts/daily_crash_warning_monitor.py $date
done
```

## 输出示例

### 有预警时

```
============================================================
🔍 日线级别暴跌预警监控
⏰ 检测时间: 2026-02-23 15:32:59
📅 监控日期: 20260220
============================================================

✅ 加载波峰数据: 4 个波峰
📊 完整波峰数量: 4 个

🚨 检测到 3 个暴跌预警！

预警 1:
  类型: A点递减_3波
  波峰编号: 1-2-3
  信号: 即将暴跌
  操作建议: 逢高做空
  描述: 连续3个A点RSI总和递减：A1(-23.50) > A2(-35.80) > A3(-48.30)
  🚨 暴跌预警！连续3个A点递减，市场可能接跌

  A点数据:
    A1: -23.50 @ 2026-02-20 06:00:00
    A2: -35.80 @ 2026-02-20 10:00:00
    A3: -48.30 @ 2026-02-20 14:00:00

  递减对比:
    ✅ A2_vs_A1: -35.80 vs -23.50 (降幅: 52.34%)
    ✅ A3_vs_A2: -48.30 vs -35.80 (降幅: 34.92%)

💾 预警信息已保存到: crash_warning_20260220.json

============================================================
🚨 预警总结: 检测到 3 个暴跌预警信号
⚠️ 建议: 逢高做空，注意风险控制
============================================================
```

### 无预警时

```
============================================================
🔍 日线级别暴跌预警监控
⏰ 检测时间: 2026-02-23 15:31:35
📅 监控日期: 20260216
============================================================

✅ 加载波峰数据: 4 个波峰
📊 完整波峰数量: 4 个
✅ 暂无暴跌预警

============================================================
✅ 监控完成: 暂无暴跌预警
============================================================
```

## 数据文件格式

### 预警文件位置
```
data/daily_crash_warnings/crash_warning_YYYYMMDD.json
```

### 文件结构
```json
{
  "date": "20260220",
  "check_time": "2026-02-23 15:32:59",
  "has_warning": true,
  "warning_count": 3,
  "warnings": [
    {
      "pattern_type": "A点递减_3波",
      "peak_indices": "1-2-3",
      "detection_time": "2026-02-23 15:32:59",
      "warning_level": "high",
      "signal": "即将暴跌",
      "operation_tip": "逢高做空",
      "peaks": [
        {
          "index": 1,
          "a_point_time": "2026-02-20 06:00:00",
          "a_point_value": -23.5,
          "label": "A1"
        },
        {
          "index": 2,
          "a_point_time": "2026-02-20 10:00:00",
          "a_point_value": -35.8,
          "label": "A2"
        },
        {
          "index": 3,
          "a_point_time": "2026-02-20 14:00:00",
          "a_point_value": -48.3,
          "label": "A3"
        }
      ],
      "comparisons": {
        "A2_vs_A1": {
          "values": "-35.80 vs -23.50",
          "decline_rate": "52.34%",
          "is_declining": true
        },
        "A3_vs_A2": {
          "values": "-48.30 vs -35.80",
          "decline_rate": "34.92%",
          "is_declining": true
        }
      },
      "description": "连续3个A点RSI总和递减：A1(-23.50) > A2(-35.80) > A3(-48.30)",
      "warning_message": "🚨 暴跌预警！连续3个A点递减，市场可能接跌"
    }
  ]
}
```

## 前端集成（待开发）

### API端点
```
GET /api/daily-crash-warning/<date>
GET /api/daily-crash-warning/latest
```

### 前端显示建议

1. **预警卡片**
   - 显示在页面顶部
   - 红色背景，醒目展示
   - 包含：预警信号、操作建议、A点数据

2. **趋势图标记**
   - 在A点位置添加特殊标记
   - 用不同颜色区分不同预警组合
   - Tooltip显示详细信息

3. **历史预警列表**
   - 可查看历史预警记录
   - 过滤、排序功能
   - 统计预警准确率

## 技术细节

### 依赖数据

1. **波峰数据文件**
   ```
   data/coin_change_tracker/wave_peaks/wave_peaks_YYYYMMDD.json
   ```

2. **波峰结构**
   ```json
   {
     "b_point": {"value": -60.5, "beijing_time": "..."},
     "a_point": {"value": -23.5, "rsi_sum": 1234.5, "beijing_time": "..."},
     "c_point": {"value": -40.2, "beijing_time": "..."}
   }
   ```

### 检测条件

- **最少波峰数**：3个完整波峰（有A、B、C点）
- **数据来源**：优先使用 `rsi_sum`，不存在时使用 `value`
- **递减判断**：`a1 > a2 and a2 > a3`（对于负数）

### 退出码

- **0**：成功完成，无预警
- **1**：成功完成，有预警
- **2**：执行失败，出现错误

## 与其他功能的关系

### vs 0-2点预判
| 特性 | 0-2点预判 | 日线预警 |
|------|----------|---------|
| 时间范围 | 0:00-2:00 | 全天 |
| 检测频率 | 每日一次 | 可随时 |
| 数据基础 | 10分钟柱 | 波峰 |
| 预判周期 | 当天全天 | 即时预警 |
| 用途 | 日内策略 | 风险预警 |

### vs 波峰检测
- 波峰检测：识别B-A-C结构
- 日线预警：分析连续波峰的A点趋势

### vs 市场情绪
- 市场情绪：基于RSI短期波动
- 日线预警：基于波峰长期趋势

## 实战建议

### 1. 预警确认

收到预警后应该：
- ✅ 检查A点数据的准确性
- ✅ 查看递减幅度是否显著（>20%）
- ✅ 结合其他指标（RSI、市场情绪）
- ✅ 观察后续波峰是否继续递减

### 2. 操作策略

- **预警触发时**：逢高做空，设置止损
- **多个预警**：加强警惕，减少多单
- **预警解除**：A点开始回升，可考虑平空

### 3. 风险控制

- **不要过度依赖**：预警是参考，不是交易信号
- **结合其他指标**：RSI、MACD、成交量等
- **设置止损**：即使有预警，也要控制风险
- **分批建仓**：不要一次性全仓做空

## 常见问题

### Q1: 为什么今天没有预警？
A: 可能原因：
1. 波峰数量不足3个
2. A点没有呈现递减趋势
3. 波峰数据还未生成

### Q2: 预警的准确率如何？
A: 需要长期统计验证。建议：
1. 记录每次预警后的实际走势
2. 统计预警后1小时、3小时、6小时的涨跌
3. 调整预警参数以提高准确率

### Q3: 如何自动接收预警？
A: 可以集成：
1. Telegram bot 推送
2. 邮件通知
3. 短信提醒
4. 前端页面弹窗

### Q4: 预警数据存储多久？
A: 默认永久存储在 `data/daily_crash_warnings/`，建议：
1. 定期备份重要预警数据
2. 清理6个月以前的数据
3. 保留统计分析用的汇总数据

## 后续改进计划

### 短期（1-2周）
- [ ] 添加API接口
- [ ] 前端预警卡片展示
- [ ] Telegram推送集成

### 中期（1个月）
- [ ] 预警准确率统计
- [ ] 参数优化（递减幅度阈值）
- [ ] 多级预警（低、中、高）

### 长期（3个月）
- [ ] 机器学习模型优化
- [ ] 多币种独立预警
- [ ] 预警回测系统

## 相关文档

- [波峰检测说明](./波峰检测说明.md)
- [市场情绪分析](./市场情绪分析.md)
- [日内模式监控](./日内模式监控功能说明.md)

## 联系方式

- **项目仓库**: https://github.com/jamesyidc/25669889956
- **Pull Request**: https://github.com/jamesyidc/25669889956/pull/4
- **提交记录**: b2992ad - feat: 添加日线级别暴跌预警监控系统

---

**更新时间**: 2026-02-23  
**文档版本**: v1.0  
**作者**: AI Assistant
