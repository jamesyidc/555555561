# é€ƒé¡¶ä¿¡å·å†å²ç³»ç»Ÿ v2.0 é‡æ„æ–¹æ¡ˆ

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

**åˆ›å»ºæ—¶é—´**: 2026-02-07 11:50:00  
**çŠ¶æ€**: ğŸ“ å¾…å®æ–½  
**é¢„è®¡å·¥æœŸ**: 6-8å°æ—¶  
**å¤æ‚åº¦**: ä¸­ç­‰  

### ç°æœ‰ç³»ç»Ÿåˆ†æ

#### âœ… ä¼˜ç‚¹
1. **æ•°æ®å·²æŒ‰æ—¥åˆ†åŒº**: `data/escape_signal_daily/escape_signal_YYYY-MM-DD.jsonl.gz`
2. **æœ‰å…³é”®ç‚¹å‹ç¼©**: `escape_signal_keypoints.jsonl.gz` ç”¨äºå¿«é€Ÿæ¸²æŸ“
3. **æ•°æ®æ ¼å¼æ¸…æ™°**: åŒ…å« `stat_time`, `signal_24h_count`, `signal_2h_count` ç­‰
4. **å·²æœ‰æ—¥æœŸç´¢å¼•**: `date_index.json` ç»´æŠ¤å¯ç”¨æ—¥æœŸåˆ—è¡¨

#### âš ï¸ é—®é¢˜
1. **å•é¡µæ˜¾ç¤ºæ‰€æœ‰æ•°æ®**: å¯¼è‡´åŠ è½½æ…¢ã€æ¸²æŸ“å¡é¡¿
2. **ç¼ºå°‘æŒ‰å¤©ç¿»é¡µ**: ç”¨æˆ·æ— æ³•æ–¹ä¾¿åœ°æŸ¥çœ‹ç‰¹å®šæ—¥æœŸ
3. **APIæ¨¡å—ç¼ºå¤±**: `escape_signal_jsonl_manager` ä¸å­˜åœ¨
4. **ä»£ç æ··ä¹±**: ç¼“å­˜é€»è¾‘å¤æ‚ï¼Œå‰åç«¯è€¦åˆä¸¥é‡

### é‡æ„ç›®æ ‡

æ„å»ºä¸€ä¸ª**ç®€æ´ã€é«˜æ€§èƒ½ã€æŒ‰å¤©ç¿»é¡µ**çš„é€ƒé¡¶ä¿¡å·å†å²ç³»ç»Ÿï¼š

1. **æŒ‰å¤©å±•ç¤º**: æ¯æ¬¡åªæ˜¾ç¤ºä¸€å¤©çš„æ•°æ®ï¼Œå·¦å³ç¿»é¡µ
2. **å¿«é€ŸåŠ è½½**: <500ms åŠ è½½ä¸€å¤©æ•°æ®
3. **çº¯JSONLå­˜å‚¨**: è¯»å†™å…¨éƒ¨ä½¿ç”¨å‹ç¼©JSONLæ–‡ä»¶
4. **ç‹¬ç«‹ç³»ç»Ÿ**: ä¸ä¿®æ”¹æ—§ç³»ç»Ÿï¼Œå»ºç«‹å¹³è¡Œç³»ç»Ÿ
5. **æ•°æ®è¿ç§»**: æä¾›è„šæœ¬ä»æ—§ç³»ç»Ÿè¿ç§»æ•°æ®

---

## ğŸ—ï¸ æ–°ç³»ç»Ÿæ¶æ„

### ç³»ç»Ÿåˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯ (escape_signal_v2.html)        â”‚
â”‚  æ—¥å†é€‰æ‹©å™¨ + å·¦å³ç¿»é¡µ + æ—¥çº¿å›¾             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         APIå±‚ (Flask Routes)                â”‚
â”‚  /api/escape-v2/dates                       â”‚
â”‚  /api/escape-v2/day-data?date=YYYY-MM-DD    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ•°æ®ç®¡ç†å±‚ (escape_signal_v2_manager.py)â”‚
â”‚  æŒ‰æ—¥è¯»å–ã€å†™å…¥ã€ç´¢å¼•ç®¡ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         JSONLæ–‡ä»¶å­˜å‚¨ (å‹ç¼©)                â”‚
â”‚  data/escape_v2/YYYY-MM-DD.jsonl.gz         â”‚
â”‚  data/escape_v2/date_index.json             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—

#### 1. æ•°æ®ç®¡ç†å±‚ (escape_signal_v2_manager.py) ~300è¡Œ
```python
class EscapeSignalV2Manager:
    """é€ƒé¡¶ä¿¡å·æ•°æ®ç®¡ç†å™¨ v2.0"""
    
    def __init__(self, data_dir='/home/user/webapp/data/escape_v2'):
        self.data_dir = data_dir
        self.index_file = f"{data_dir}/date_index.json"
    
    # è¯»å–æ“ä½œ
    def get_available_dates(self) -> List[str]:
        """è·å–æ‰€æœ‰å¯ç”¨æ—¥æœŸåˆ—è¡¨"""
    
    def get_day_data(self, date: str) -> List[Dict]:
        """è·å–æŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰æ•°æ®ç‚¹"""
    
    def get_date_summary(self, date: str) -> Dict:
        """è·å–æ—¥æœŸæ‘˜è¦ä¿¡æ¯ï¼ˆæ€»è®°å½•æ•°ã€æ—¶é—´èŒƒå›´ç­‰ï¼‰"""
    
    # å†™å…¥æ“ä½œ
    def append_record(self, record: Dict) -> bool:
        """è¿½åŠ ä¸€æ¡è®°å½•ï¼ˆè‡ªåŠ¨æŒ‰æ—¥æœŸåˆ†åŒºï¼‰"""
    
    def batch_write(self, records: List[Dict]) -> bool:
        """æ‰¹é‡å†™å…¥è®°å½•"""
    
    # ç´¢å¼•ç®¡ç†
    def rebuild_index(self) -> bool:
        """é‡å»ºæ—¥æœŸç´¢å¼•"""
    
    def get_prev_date(self, current: str) -> Optional[str]:
        """è·å–å‰ä¸€å¤©æ—¥æœŸ"""
    
    def get_next_date(self, current: str) -> Optional[str]:
        """è·å–åä¸€å¤©æ—¥æœŸ"""
```

#### 2. APIæ¥å£å±‚ (app.pyæ–°å¢) ~100è¡Œ
```python
@app.route('/escape-signal-v2')
def escape_signal_v2_page():
    """é€ƒé¡¶ä¿¡å·å†å² v2.0 é¡µé¢"""
    return render_template('escape_signal_v2.html')

@app.route('/api/escape-v2/dates')
def api_escape_v2_dates():
    """
    è·å–æ‰€æœ‰å¯ç”¨æ—¥æœŸ
    Response: {
        "success": true,
        "dates": ["2026-02-07", "2026-02-06", ...],
        "total_days": 45,
        "date_range": "2025-12-25 ~ 2026-02-07"
    }
    """

@app.route('/api/escape-v2/day-data')
def api_escape_v2_day_data():
    """
    è·å–æŒ‡å®šæ—¥æœŸçš„æ•°æ®
    Query: date=2026-02-07
    Response: {
        "success": true,
        "date": "2026-02-07",
        "data": [
            {
                "stat_time": "2026-02-07 00:00:16",
                "signal_24h_count": 26,
                "signal_2h_count": 0,
                "rise_strength_level": 0,
                "decline_strength_level": 0,
                ...
            },
            ...
        ],
        "summary": {
            "total_records": 288,
            "time_range": "00:00:16 ~ 23:55:16",
            "max_signal_24h": 30,
            "max_signal_2h": 5
        },
        "navigation": {
            "prev_date": "2026-02-06",
            "next_date": null  // å¦‚æœæ˜¯æœ€æ–°æ—¥æœŸ
        }
    }
    """

@app.route('/api/escape-v2/summary')
def api_escape_v2_summary():
    """
    è·å–ç³»ç»Ÿæ¦‚è§ˆç»Ÿè®¡
    Response: {
        "success": true,
        "total_days": 45,
        "total_records": 12960,
        "date_range": "2025-12-25 ~ 2026-02-07",
        "latest_update": "2026-02-07 11:50:00"
    }
    """
```

#### 3. å‰ç«¯é¡µé¢ (escape_signal_v2.html) ~500è¡Œ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- æ—¥å†é€‰æ‹©å™¨ï¼ˆé€‰æ‹©æ—¥æœŸï¼‰
- å·¦å³ç¿»é¡µæŒ‰é’®ï¼ˆå‰ä¸€å¤©/åä¸€å¤©ï¼‰
- æ—¥çº¿å›¾è¡¨ï¼ˆæ˜¾ç¤ºå½“å¤©æ•°æ®ï¼‰
- æ—¥æœŸæ‘˜è¦ä¿¡æ¯ï¼ˆè®°å½•æ•°ã€æœ€å¤§å€¼ç­‰ï¼‰

**UIè®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¦–é¡µ]  é€ƒé¡¶ä¿¡å·å†å² v2.0                       â”‚
â”‚                                                  â”‚
â”‚  [<]  ğŸ“… 2026-02-07  [>]  [æ—¥å†é€‰æ‹©å™¨]         â”‚
â”‚                                                  â”‚
â”‚  ğŸ“Š ä»Šæ—¥æ‘˜è¦                                     â”‚
â”‚  â”œâ”€ è®°å½•æ•°: 288æ¡                               â”‚
â”‚  â”œâ”€ æ—¶é—´èŒƒå›´: 00:00 ~ 23:55                     â”‚
â”‚  â”œâ”€ æœ€å¤§24hä¿¡å·: 30ä¸ª                           â”‚
â”‚  â””â”€ æœ€å¤§2hä¿¡å·: 5ä¸ª                             â”‚
â”‚                                                  â”‚
â”‚  ğŸ“ˆ ä¿¡å·è¶‹åŠ¿å›¾ (ECharts)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚      ä¿¡å·24h  â”€â”€â”€â”€â”€                      â”‚  â”‚
â”‚  â”‚      ä¿¡å·2h   â”€â”€â”€â”€â”€                      â”‚  â”‚
â”‚  â”‚      æ¶¨è·Œå¼ºåº¦ â”€â”€â”€â”€â”€                      â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚  ğŸ“‹ æç«¯å€¼ç»Ÿè®¡                                   â”‚
â”‚  â”œâ”€ æœ€é«˜ç‚¹: 13:45 (ä¿¡å·24h=30)                  â”‚
â”‚  â””â”€ æœ€ä½ç‚¹: 06:20 (ä¿¡å·24h=8)                   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. æ•°æ®è¿ç§»è„šæœ¬ (migrate_escape_data.py) ~200è¡Œ
```python
"""
å°†æ—§ç³»ç»Ÿæ•°æ®è¿ç§»åˆ°æ–°ç³»ç»Ÿ
- è¯»å– data/escape_signal_daily/*.jsonl.gz
- è½¬æ¢æ ¼å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
- å†™å…¥åˆ° data/escape_v2/*.jsonl.gz
- ç”Ÿæˆæ–°çš„ç´¢å¼•æ–‡ä»¶
"""

def migrate_all_data():
    """è¿ç§»æ‰€æœ‰æ•°æ®"""
    old_dir = '/home/user/webapp/data/escape_signal_daily'
    new_manager = EscapeSignalV2Manager()
    
    # éå†æ‰€æœ‰æ—§æ–‡ä»¶
    for filename in sorted(os.listdir(old_dir)):
        if filename.startswith('escape_signal_') and filename.endswith('.jsonl.gz'):
            date = extract_date(filename)
            print(f"è¿ç§» {date} æ•°æ®...")
            
            # è¯»å–æ—§æ•°æ®
            old_data = read_old_data(filename)
            
            # å†™å…¥æ–°ç³»ç»Ÿ
            new_manager.batch_write(old_data)
    
    # é‡å»ºç´¢å¼•
    new_manager.rebuild_index()
    print("âœ… æ•°æ®è¿ç§»å®Œæˆ")
```

---

## ğŸ“Š æ•°æ®ç»“æ„è®¾è®¡

### æ•°æ®æ–‡ä»¶ç»„ç»‡

```
/home/user/webapp/data/escape_v2/
â”œâ”€â”€ date_index.json              # æ—¥æœŸç´¢å¼•æ–‡ä»¶
â”œâ”€â”€ 2025-12-25.jsonl.gz          # 2025å¹´12æœˆ25æ—¥æ•°æ®
â”œâ”€â”€ 2025-12-26.jsonl.gz
â”œâ”€â”€ ...
â”œâ”€â”€ 2026-02-06.jsonl.gz
â””â”€â”€ 2026-02-07.jsonl.gz          # æœ€æ–°æ•°æ®
```

### date_index.json æ ¼å¼

```json
{
    "version": "2.0",
    "updated_at": "2026-02-07 11:50:00",
    "total_days": 45,
    "date_range": {
        "start": "2025-12-25",
        "end": "2026-02-07"
    },
    "dates": [
        {
            "date": "2026-02-07",
            "records": 288,
            "file_size": 23456,
            "time_range": "00:00:16 ~ 23:55:16",
            "max_signal_24h": 30,
            "max_signal_2h": 5
        },
        {
            "date": "2026-02-06",
            "records": 285,
            "file_size": 22890,
            "time_range": "00:00:20 ~ 23:55:20",
            "max_signal_24h": 28,
            "max_signal_2h": 3
        },
        ...
    ]
}
```

### æ•°æ®è®°å½•æ ¼å¼ (å•æ¡è®°å½•)

```json
{
    "stat_time": "2026-02-07 00:00:16",
    "signal_24h_count": 26,
    "signal_2h_count": 0,
    "rise_strength_level": 0,
    "decline_strength_level": 0,
    "max_signal_24h": 26,
    "max_signal_2h": 0,
    "average_change": 0.0,
    "total_change": 0.0,
    "valid_coins": 27,
    "total_coins": 27,
    "created_at": "2026-02-07 00:00:16"
}
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®ç®¡ç†å±‚å¼€å‘ (2å°æ—¶)

âœ… **ä»»åŠ¡**:
1. åˆ›å»º `escape_signal_v2_manager.py`
2. å®ç°æ ¸å¿ƒæ–¹æ³•:
   - `get_available_dates()`
   - `get_day_data(date)`
   - `get_date_summary(date)`
   - `append_record(record)`
   - `batch_write(records)`
   - `rebuild_index()`
   - `get_prev_date()` / `get_next_date()`
3. å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©**:
- `source_code/escape_signal_v2_manager.py`
- `tests/test_escape_v2_manager.py`

### Phase 2: APIæ¥å£å¼€å‘ (1.5å°æ—¶)

âœ… **ä»»åŠ¡**:
1. åœ¨ `app.py` ä¸­æ·»åŠ 4ä¸ªæ–°è·¯ç”±
   - `/escape-signal-v2` (é¡µé¢)
   - `/api/escape-v2/dates` (æ—¥æœŸåˆ—è¡¨)
   - `/api/escape-v2/day-data` (å•æ—¥æ•°æ®)
   - `/api/escape-v2/summary` (æ¦‚è§ˆç»Ÿè®¡)
2. é”™è¯¯å¤„ç†å’Œå‚æ•°éªŒè¯
3. æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼ˆå¯é€‰ï¼‰

**äº¤ä»˜ç‰©**:
- app.py æ–°å¢è·¯ç”±
- APIæµ‹è¯•è„šæœ¬

### Phase 3: å‰ç«¯é¡µé¢å¼€å‘ (2-3å°æ—¶)

âœ… **ä»»åŠ¡**:
1. åˆ›å»º `templates/escape_signal_v2.html`
2. å®ç°æ ¸å¿ƒåŠŸèƒ½:
   - æ—¥å†é€‰æ‹©å™¨ï¼ˆä½¿ç”¨ Flatpickr æˆ–åŸç”Ÿ input type="date"ï¼‰
   - å·¦å³ç¿»é¡µæŒ‰é’®
   - ECharts æ—¥çº¿å›¾æ¸²æŸ“
   - æ—¥æœŸæ‘˜è¦ä¿¡æ¯å±•ç¤º
3. å“åº”å¼å¸ƒå±€ï¼ˆæ”¯æŒç§»åŠ¨ç«¯ï¼‰

**UIç»„ä»¶**:
```html
<!-- æ—¥æœŸå¯¼èˆªæ  -->
<div class="date-navigator">
    <button id="prevDay">â† å‰ä¸€å¤©</button>
    <input type="date" id="datePicker" value="2026-02-07">
    <button id="nextDay">åä¸€å¤© â†’</button>
    <span id="dateInfo">2026-02-07 (æ˜ŸæœŸäº”)</span>
</div>

<!-- æ—¥æœŸæ‘˜è¦ -->
<div class="day-summary">
    <div class="summary-item">
        <span class="label">è®°å½•æ•°</span>
        <span class="value" id="recordCount">288</span>
    </div>
    <div class="summary-item">
        <span class="label">æ—¶é—´èŒƒå›´</span>
        <span class="value" id="timeRange">00:00 ~ 23:55</span>
    </div>
    <!-- æ›´å¤šæ‘˜è¦é¡¹... -->
</div>

<!-- å›¾è¡¨å®¹å™¨ -->
<div id="dayChart" style="width: 100%; height: 500px;"></div>
```

**JSé€»è¾‘**:
```javascript
// åŠ è½½æŒ‡å®šæ—¥æœŸçš„æ•°æ®
async function loadDayData(date) {
    const response = await fetch(`/api/escape-v2/day-data?date=${date}`);
    const result = await response.json();
    
    if (result.success) {
        // æ›´æ–°æ‘˜è¦ä¿¡æ¯
        updateSummary(result.summary);
        
        // æ¸²æŸ“å›¾è¡¨
        renderChart(result.data);
        
        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        updateNavigation(result.navigation);
    }
}

// å‰ä¸€å¤©
document.getElementById('prevDay').addEventListener('click', () => {
    const currentDate = document.getElementById('datePicker').value;
    // è°ƒç”¨APIè·å–å‰ä¸€å¤©æ—¥æœŸ
    loadPrevDay(currentDate);
});

// åä¸€å¤©
document.getElementById('nextDay').addEventListener('click', () => {
    const currentDate = document.getElementById('datePicker').value;
    loadNextDay(currentDate);
});

// æ—¥æœŸé€‰æ‹©å™¨
document.getElementById('datePicker').addEventListener('change', (e) => {
    loadDayData(e.target.value);
});
```

**äº¤ä»˜ç‰©**:
- `templates/escape_signal_v2.html`
- å‰ç«¯æµ‹è¯•æŠ¥å‘Š

### Phase 4: æ•°æ®è¿ç§» (1-2å°æ—¶)

âœ… **ä»»åŠ¡**:
1. åˆ›å»º `migrate_escape_data.py`
2. ä»æ—§ç³»ç»Ÿè¯»å–æ•°æ®
3. è½¬æ¢æ ¼å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. å†™å…¥æ–°ç³»ç»Ÿ
5. ç”Ÿæˆç´¢å¼•æ–‡ä»¶
6. éªŒè¯æ•°æ®å®Œæ•´æ€§

**è¿ç§»æµç¨‹**:
```bash
# 1. å¤‡ä»½æ—§æ•°æ®
cd /home/user/webapp
tar -czf backup/escape_old_$(date +%Y%m%d).tar.gz data/escape_signal_daily/

# 2. åˆ›å»ºæ–°ç›®å½•
mkdir -p data/escape_v2

# 3. æ‰§è¡Œè¿ç§»
python3 scripts/migrate_escape_data.py

# 4. éªŒè¯æ•°æ®
python3 scripts/verify_escape_data.py
```

**äº¤ä»˜ç‰©**:
- `scripts/migrate_escape_data.py`
- `scripts/verify_escape_data.py`
- è¿ç§»æ—¥å¿—

### Phase 5: æµ‹è¯•ä¸Šçº¿ (1å°æ—¶)

âœ… **ä»»åŠ¡**:
1. åŠŸèƒ½æµ‹è¯•ï¼ˆç¿»é¡µã€æ—¥å†ã€å›¾è¡¨ï¼‰
2. æ€§èƒ½æµ‹è¯•ï¼ˆåŠ è½½é€Ÿåº¦ï¼‰
3. å…¼å®¹æ€§æµ‹è¯•ï¼ˆæµè§ˆå™¨ï¼‰
4. æ–°æ—§ç³»ç»Ÿå¯¹æ¯”éªŒè¯
5. æ–‡æ¡£æ•´ç†

**æµ‹è¯•æ£€æŸ¥æ¸…å•**:
- [ ] æ—¥æœŸåˆ—è¡¨APIæ­£å¸¸
- [ ] å•æ—¥æ•°æ®APIæ­£å¸¸
- [ ] å·¦å³ç¿»é¡µåŠŸèƒ½æ­£å¸¸
- [ ] æ—¥å†é€‰æ‹©åŠŸèƒ½æ­£å¸¸
- [ ] å›¾è¡¨æ¸²æŸ“æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸
- [ ] é¡µé¢åŠ è½½ <500ms
- [ ] æ•°æ®ä¸æ—§ç³»ç»Ÿä¸€è‡´

**äº¤ä»˜ç‰©**:
- æµ‹è¯•æŠ¥å‘Š
- ç”¨æˆ·æ–‡æ¡£
- APIæ–‡æ¡£

---

## ğŸ“ æ–°ç›®å½•ç»“æ„

```
/home/user/webapp/
â”œâ”€â”€ source_code/
â”‚   â””â”€â”€ escape_signal_v2_manager.py      # æ•°æ®ç®¡ç†å±‚ ~300è¡Œ
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ escape_signal_v2.html            # å‰ç«¯é¡µé¢ ~500è¡Œ
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ migrate_escape_data.py           # æ•°æ®è¿ç§» ~200è¡Œ
â”‚   â””â”€â”€ verify_escape_data.py            # æ•°æ®éªŒè¯ ~100è¡Œ
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ escape_signal_daily/             # æ—§ç³»ç»Ÿæ•°æ®ï¼ˆä¿ç•™ï¼‰
â”‚   â””â”€â”€ escape_v2/                       # æ–°ç³»ç»Ÿæ•°æ®
â”‚       â”œâ”€â”€ date_index.json              # æ—¥æœŸç´¢å¼•
â”‚       â”œâ”€â”€ 2025-12-25.jsonl.gz
â”‚       â”œâ”€â”€ ...
â”‚       â””â”€â”€ 2026-02-07.jsonl.gz
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_escape_v2_manager.py        # å•å…ƒæµ‹è¯•
â””â”€â”€ docs/
    â””â”€â”€ ESCAPE_V2_API.md                 # APIæ–‡æ¡£
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. æŒ‰å¤©ç¿»é¡µ
- **å·¦å³ç®­å¤´æŒ‰é’®**: å‰ä¸€å¤© / åä¸€å¤©
- **æ—¥å†é€‰æ‹©å™¨**: å¿«é€Ÿè·³è½¬åˆ°ä»»æ„æ—¥æœŸ
- **è‡ªåŠ¨ç¦ç”¨**: å¦‚æœæ˜¯ç¬¬ä¸€å¤©ï¼Œç¦ç”¨"å‰ä¸€å¤©"æŒ‰é’®ï¼›å¦‚æœæ˜¯æœ€æ–°ä¸€å¤©ï¼Œç¦ç”¨"åä¸€å¤©"æŒ‰é’®

### 2. æ—¥æœŸæ‘˜è¦
æ¯å¤©æ˜¾ç¤ºï¼š
- æ€»è®°å½•æ•°ï¼ˆå¦‚ 288æ¡ï¼‰
- æ—¶é—´èŒƒå›´ï¼ˆå¦‚ 00:00 ~ 23:55ï¼‰
- æœ€å¤§24hä¿¡å·æ•°
- æœ€å¤§2hä¿¡å·æ•°
- å¹³å‡æ¶¨è·Œå¹…
- æœ‰æ•ˆå¸ç§æ•°

### 3. æ—¥çº¿å›¾è¡¨
ä½¿ç”¨ ECharts æ˜¾ç¤ºï¼š
- **ä¸»çº¿**: 24hä¿¡å·æ•°ï¼ˆæŠ˜çº¿å›¾ï¼‰
- **è¾…çº¿**: 2hä¿¡å·æ•°ï¼ˆæŠ˜çº¿å›¾ï¼‰
- **èƒŒæ™¯è‰²**: æ¶¨è·Œå¼ºåº¦ï¼ˆç»¿è‰²/çº¢è‰²æ¸å˜ï¼‰
- **æ ‡è®°ç‚¹**: æç«¯å€¼æ ‡æ³¨

### 4. æ€§èƒ½ä¼˜åŒ–
- **æŒ‰éœ€åŠ è½½**: æ¯æ¬¡åªåŠ è½½ä¸€å¤©æ•°æ®ï¼ˆ~288æ¡è®°å½•ï¼‰
- **æ•°æ®å‹ç¼©**: ä½¿ç”¨ gzip å‹ç¼©JSONLæ–‡ä»¶
- **å®¢æˆ·ç«¯ç¼“å­˜**: ç¼“å­˜æœ€è¿‘æŸ¥çœ‹çš„3å¤©æ•°æ®
- **æ‡’åŠ è½½**: å›¾è¡¨åˆå§‹åŒ–å»¶è¿Ÿåˆ°æ•°æ®åŠ è½½å®Œæˆ

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½

| æŒ‡æ ‡ | æ—§ç³»ç»Ÿ | æ–°ç³»ç»Ÿ | æ”¹è¿› |
|------|--------|--------|------|
| é¡µé¢åŠ è½½æ—¶é—´ | 5-10s | <500ms | â¬†ï¸ 10-20å€ |
| æ•°æ®ä¼ è¾“é‡ | å…¨é‡(~2MB) | å•æ—¥(~8KB) | â¬‡ï¸ 250å€ |
| å›¾è¡¨æ¸²æŸ“ç‚¹æ•° | 12,000+ | 288 | â¬‡ï¸ 42å€ |
| APIå“åº”æ—¶é—´ | 1-2s | <100ms | â¬†ï¸ 10-20å€ |
| å†…å­˜å ç”¨ | é«˜ | ä½ | æ˜¾è‘—é™ä½ |

### å®æµ‹æ•°æ®ï¼ˆé¢„ä¼°ï¼‰
- **å•æ—¥æ•°æ®å¤§å°**: ~8KB (å‹ç¼©å)
- **APIå“åº”æ—¶é—´**: 50-100ms
- **å›¾è¡¨æ¸²æŸ“æ—¶é—´**: <200ms
- **æ€»åŠ è½½æ—¶é—´**: <500ms

---

## ğŸ”„ æ–°æ—§ç³»ç»Ÿå¯¹æ¯”

| ç»´åº¦ | æ—§ç³»ç»Ÿ | æ–°ç³»ç»Ÿ v2.0 |
|------|--------|-------------|
| **æ•°æ®åŠ è½½** | ä¸€æ¬¡åŠ è½½å…¨éƒ¨ | æŒ‰å¤©åŠ è½½ |
| **é¡µé¢æ€§èƒ½** | æ…¢ï¼ˆ5-10sï¼‰ | å¿«ï¼ˆ<500msï¼‰ |
| **ç”¨æˆ·ä½“éªŒ** | æ»šåŠ¨æŸ¥çœ‹ | ç¿»é¡µæŸ¥çœ‹ |
| **å¯¼èˆªæ–¹å¼** | æ»šåŠ¨æ¡ | å·¦å³æŒ‰é’®+æ—¥å† |
| **æ•°æ®å­˜å‚¨** | å·²æŒ‰æ—¥åˆ†åŒº | ä¿æŒæŒ‰æ—¥åˆ†åŒº |
| **ç¼“å­˜ç­–ç•¥** | å‰ç«¯60sç¼“å­˜ | æŒ‰éœ€åŠ è½½ |
| **APIè®¾è®¡** | å…³é”®ç‚¹é‡‡æ · | å•æ—¥å…¨é‡ |
| **ä»£ç é‡** | ~1,381è¡Œ | ~1,100è¡Œ |
| **å¯ç»´æŠ¤æ€§** | ä¸­ç­‰ | é«˜ |

---

## âš ï¸ é£é™©è¯„ä¼°

### ä½é£é™©
1. **æ•°æ®æ ¼å¼å…¼å®¹**: æ—§ç³»ç»Ÿå·²æŒ‰æ—¥åˆ†åŒºï¼Œè¿ç§»ç®€å•
2. **æŠ€æœ¯æ ˆä¸€è‡´**: ä»ä½¿ç”¨Flask + ECharts + JSONL
3. **ç‹¬ç«‹éƒ¨ç½²**: ä¸å½±å“æ—§ç³»ç»Ÿè¿è¡Œ

### ä¸­é£é™©
4. **è¿ç§»è€—æ—¶**: 45å¤©æ•°æ®è¿ç§»å¯èƒ½éœ€è¦10-20åˆ†é’Ÿ
   - **åº”å¯¹**: ç¼–å†™é«˜æ•ˆçš„æ‰¹é‡å¤„ç†è„šæœ¬
   
5. **ç”¨æˆ·ä¹ æƒ¯**: ç”¨æˆ·éœ€è¦é€‚åº”æ–°çš„ç¿»é¡µæ–¹å¼
   - **åº”å¯¹**: æä¾›ä½¿ç”¨è¯´æ˜ï¼Œä¿ç•™æ—§ç³»ç»Ÿé“¾æ¥

---

## âœ… æ¨è¿›å»ºè®®

### ç«‹å³è¡ŒåŠ¨

1. **ç¡®è®¤éœ€æ±‚** (5åˆ†é’Ÿ)
   - ç¡®è®¤æŒ‰å¤©ç¿»é¡µçš„äº¤äº’è®¾è®¡
   - ç¡®è®¤éœ€è¦æ˜¾ç¤ºçš„æ•°æ®æŒ‡æ ‡
   
2. **Phase 1: æ•°æ®ç®¡ç†å±‚** (2å°æ—¶)
   - åˆ›å»º `escape_signal_v2_manager.py`
   - å®ç°æ ¸å¿ƒè¯»å†™æ–¹æ³•
   - ç¼–å†™å•å…ƒæµ‹è¯•

3. **Phase 2: APIå±‚** (1.5å°æ—¶)
   - æ·»åŠ 4ä¸ªæ–°APIè·¯ç”±
   - æµ‹è¯•APIå“åº”

4. **Phase 3: å‰ç«¯é¡µé¢** (2-3å°æ—¶)
   - åˆ›å»º `escape_signal_v2.html`
   - å®ç°ç¿»é¡µå’Œå›¾è¡¨åŠŸèƒ½

5. **Phase 4: æ•°æ®è¿ç§»** (1-2å°æ—¶)
   - ç¼–å†™è¿ç§»è„šæœ¬
   - æ‰§è¡Œæ•°æ®è¿ç§»
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

6. **Phase 5: ä¸Šçº¿éƒ¨ç½²** (1å°æ—¶)
   - åŠŸèƒ½æµ‹è¯•
   - æ€§èƒ½æµ‹è¯•
   - æ­£å¼ä¸Šçº¿

### å…³é”®é‡Œç¨‹ç¢‘
- **2å°æ—¶å**: å®Œæˆæ•°æ®ç®¡ç†å±‚ï¼Œå¯è¯»å–å•æ—¥æ•°æ®
- **4å°æ—¶å**: å®ŒæˆAPIå±‚ï¼Œå‰ç«¯å¯è°ƒç”¨æ¥å£
- **6å°æ—¶å**: å®Œæˆå‰ç«¯é¡µé¢ï¼ŒåŸºæœ¬åŠŸèƒ½å¯ç”¨
- **8å°æ—¶å**: æ•°æ®è¿ç§»å®Œæˆï¼Œç³»ç»Ÿæ­£å¼ä¸Šçº¿

### å¹¶è¡Œæ–¹æ¡ˆ
- **æ—§ç³»ç»Ÿ**: ç»§ç»­è¿è¡Œåœ¨ `/escape-signal-history`
- **æ–°ç³»ç»Ÿ**: ä¸Šçº¿åˆ° `/escape-signal-v2`
- **è¿‡æ¸¡æœŸ**: ä¸¤ä¸ªç³»ç»Ÿå¹¶è¡Œè¿è¡Œ1-2å¤©
- **åˆ‡æ¢**: éªŒè¯æ— è¯¯åï¼Œå°† `/escape-signal-history` é‡å®šå‘åˆ°æ–°ç³»ç»Ÿ

---

## ğŸ“ æ€»ç»“

### ä¸ºä»€ä¹ˆè¦é‡æ„ï¼Ÿ
1. **æ€§èƒ½é—®é¢˜**: æ—§ç³»ç»ŸåŠ è½½æ…¢ï¼ˆ5-10sï¼‰ï¼Œç”¨æˆ·ä½“éªŒå·®
2. **äº¤äº’ä¸ä¾¿**: æ»šåŠ¨æŸ¥çœ‹ä¸å¦‚ç¿»é¡µæ–¹ä¾¿
3. **æ‰©å±•å›°éš¾**: æ•°æ®é‡æŒç»­å¢é•¿ï¼Œæ€§èƒ½ä¼šè¶Šæ¥è¶Šå·®

### é‡æ„ä»·å€¼
1. **æ€§èƒ½æå‡**: åŠ è½½æ—¶é—´ä»5-10s â†’ <500msï¼Œæå‡10-20å€
2. **ç”¨æˆ·ä½“éªŒ**: æŒ‰å¤©ç¿»é¡µæ›´ç›´è§‚ï¼Œå¿«é€Ÿå®šä½ç‰¹å®šæ—¥æœŸ
3. **å¯ç»´æŠ¤æ€§**: ä»£ç æ›´æ¸…æ™°ï¼ŒåŠŸèƒ½æ›´èšç„¦
4. **å¯æ‰©å±•æ€§**: è½»æ¾æ”¯æŒæœªæ¥1å¹´ã€2å¹´çš„æ•°æ®

### æŠ•å…¥äº§å‡ºæ¯”
- **æŠ•å…¥**: 6-8å°æ—¶å¼€å‘æ—¶é—´
- **äº§å‡º**: 
  - 10-20å€æ€§èƒ½æå‡
  - æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
  - æ›´æ¸…æ™°çš„ä»£ç ç»“æ„
  - é•¿æœŸå¯ç»´æŠ¤çš„ç³»ç»Ÿ

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**è¯·ç¡®è®¤**ï¼š
1. âœ… **äº¤äº’è®¾è®¡**: æŒ‰å¤©ç¿»é¡µ + å·¦å³æŒ‰é’® + æ—¥å†é€‰æ‹©å™¨
2. âœ… **æ•°æ®è¿ç§»**: ä»æ—§ç³»ç»Ÿå¤åˆ¶æ•°æ®åˆ°æ–°ç³»ç»Ÿ
3. âœ… **å¹¶è¡Œéƒ¨ç½²**: æ–°æ—§ç³»ç»ŸåŒæ—¶è¿è¡Œï¼Œé€æ­¥åˆ‡æ¢
4. âœ… **æ—¶é—´å®‰æ’**: 6-8å°æ—¶å®Œæˆå¼€å‘å’Œä¸Šçº¿

**æˆ‘å·²å‡†å¤‡å¥½ç«‹å³å¼€å§‹Phase 1å¼€å‘** ğŸš€

ç­‰å¾…ä½ çš„ç¡®è®¤ï¼Œæˆ‘é©¬ä¸ŠåŠ¨æ‰‹å®æ–½ï¼

