# 逃顶信号Telegram监控系统

## 功能说明

自动监控以下信号并发送Telegram通知：

### 1. 空单盈利≥120% 
- **触发条件**: 数量≥3个
- **标记位置**: 图表底部，绿色标记 🟢
- **冷却时间**: 1小时（同一类型信号）
- **消息内容**: 
  - 当前时间
  - 空单数量
  - 市场状态提示
  - 操作建议

### 2. 空单亏损
- **触发条件**: 数量≥3个
- **标记位置**: 图表底部，红色标记 🔴
- **冷却时间**: 1小时
- **消息内容**:
  - 当前时间
  - 亏损空单数量
  - 风险警告
  - 调整建议

### 3. 2小时逃顶信号 - 每日极值
- **触发条件**: 单日2h信号最高值 >50
- **标记位置**: 图表上，红色火焰标记 🔥
- **冷却时间**: 1小时
- **消息内容**:
  - 极值时间
  - 信号强度
  - 日期标识
  - 风险提示

### 4. 24小时逃顶信号 - 48小时极值
- **触发条件**: 48小时窗口内的最大值 >200
- **标记位置**: 图表上，紫色星标记 ⭐
- **冷却时间**: 1小时
- **消息内容**:
  - 极值时间
  - 信号强度
  - 窗口说明
  - 重要警告

## 技术实现

### 数据来源
- 空单盈亏数据: `/api/anchor-profit/latest`
- 逃顶信号数据: `/api/escape-signal-stats`

### 检查频率
- 每60秒检查一次
- 自动去重（按小时）
- 智能冷却机制

### 部署方式
- PM2进程管理: `escape-tg-monitor`
- 自动重启机制
- 内存限制: 300MB

## 查看日志

```bash
# 实时查看日志
pm2 logs escape-tg-monitor

# 查看最近50条
pm2 logs escape-tg-monitor --lines 50 --nostream

# 重启监控
pm2 restart escape-tg-monitor
```

## 配置信息

- **Telegram Bot**: jamesyi9999_bot
- **Chat ID**: -1003227444260
- **冷却时间**: 3600秒（60分钟）
- **检查间隔**: 60秒

## 页面访问

- 逃顶信号历史: https://5000-igsydcyqs9jlcot56rnqk-18e660f9.sandbox.novita.ai/escape-signal-history
- 锚点系统实盘: https://5000-igsydcyqs9jlcot56rnqk-18e660f9.sandbox.novita.ai/anchor-system-real

## 性能优化

- 24h极值检测限制在最近100条数据
- 只检查最新10条记录作为候选峰值
- CPU占用控制在2%以下
- 标记缓存限制100条，自动清理

## 注意事项

1. **冷却机制**: 同一类型信号1小时内只推送一次
2. **去重逻辑**: 按小时维度去重，避免重复标记
3. **性能考虑**: 优化了24h峰值检测算法
4. **Telegram限流**: 注意Telegram API的频率限制
