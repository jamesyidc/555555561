# æ•°æ®é‡‡é›†å¥åº·ç›‘æ§ç³»ç»Ÿå®Œæ•´æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [è¿è¡Œé€»è¾‘æµç¨‹](#2-è¿è¡Œé€»è¾‘æµç¨‹)
3. [ç›‘æ§é¡¹ç›®æ¸…å•](#3-ç›‘æ§é¡¹ç›®æ¸…å•17ä¸ª)
4. [JSONLæ•°æ®å­˜å‚¨æ ¼å¼](#4-jsonlæ•°æ®å­˜å‚¨æ ¼å¼)
5. [ç³»ç»Ÿä¾èµ–è¯¦ç»†æ¸…å•](#5-ç³»ç»Ÿä¾èµ–è¯¦ç»†æ¸…å•)
6. [åŠŸèƒ½è¯¦ç»†è¯´æ˜](#6-åŠŸèƒ½è¯¦ç»†è¯´æ˜)
7. [ä½¿ç”¨æŒ‡å—](#7-ä½¿ç”¨æŒ‡å—)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#8-æ•…éšœæ’æŸ¥æŒ‡å—)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿå®šä½
å…¨è‡ªåŠ¨æ•°æ®é‡‡é›†å¥åº·ç›‘æ§ç³»ç»Ÿï¼Œé€šè¿‡ PM2 è¿›ç¨‹ç®¡ç†å™¨ç›‘æ§ 17 ä¸ªæ•°æ®é‡‡é›†å™¨ï¼Œè‡ªåŠ¨æ£€æµ‹å¼‚å¸¸å¹¶ä¿®å¤ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… **ç›‘æ§å¯¹è±¡ï¼š** Flask Web åº”ç”¨ + 16 ä¸ªæ•°æ®é‡‡é›†å™¨
- âœ… **æ£€æŸ¥é¢‘ç‡ï¼š** æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
- âœ… **ä¿®å¤æœºåˆ¶ï¼š** è‡ªåŠ¨é‡å¯å¼‚å¸¸è¿›ç¨‹ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- âœ… **é€šçŸ¥æœºåˆ¶ï¼š** Telegram é€šçŸ¥æ— æ³•è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜
- âœ… **æ•°æ®å­˜å‚¨ï¼š** JSONL æ ¼å¼æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶å­˜å‚¨

---

## 2. è¿è¡Œé€»è¾‘æµç¨‹

### ç›‘æ§å¾ªç¯ï¼ˆæ¯5åˆ†é’Ÿï¼‰

```
æ­¥éª¤1: æ£€æŸ¥ Flask åº”ç”¨çŠ¶æ€
  â””â”€ HTTP è¯·æ±‚ http://localhost:9002/
  â””â”€ å¤±è´¥ â†’ é‡å¯ flask-app â†’ æˆåŠŸ/é€šçŸ¥TG

æ­¥éª¤2: æ£€æŸ¥æ‰€æœ‰é‡‡é›†å™¨è¿›ç¨‹çŠ¶æ€
  â””â”€ pm2 jlist è·å–è¿›ç¨‹åˆ—è¡¨
  â””â”€ çŠ¶æ€ = stopped/errored â†’ é‡å¯è¿›ç¨‹ â†’ æˆåŠŸ/é€šçŸ¥TG
  â””â”€ çŠ¶æ€ = online â†’ ç»§ç»­æ­¥éª¤3

æ­¥éª¤3: æ£€æŸ¥æ•°æ®æ–°é²œåº¦
  â””â”€ è¯»å–æœ€æ–° JSONL æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
  â””â”€ è®¡ç®—å»¶è¿Ÿ = å½“å‰æ—¶é—´ - æ–‡ä»¶ä¿®æ”¹æ—¶é—´
  â””â”€ å»¶è¿Ÿ > é˜ˆå€¼ â†’ é‡å¯è¿›ç¨‹ â†’ æˆåŠŸ/é€šçŸ¥TG

æ­¥éª¤4: ç»Ÿè®¡ç»“æœå¹¶è¾“å‡º
  â””â”€ å·²ä¿®å¤é—®é¢˜åˆ—è¡¨
  â””â”€ æœªè§£å†³é—®é¢˜åˆ—è¡¨ï¼ˆå‘é€ Telegram é€šçŸ¥ï¼‰
  â””â”€ é‡ç½®æˆåŠŸä¿®å¤çš„è¿›ç¨‹çš„é‡å¯è®¡æ•°å™¨
```

### å·¥ä½œæµç¨‹å›¾

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   æ¯5åˆ†é’Ÿç›‘æ§å¾ªç¯å¼€å§‹             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ£€æŸ¥ Flask åº”ç”¨ï¼ˆHTTPï¼‰          â”‚
   â”‚  â”œâ”€ æ­£å¸¸ â†’ ç»§ç»­                   â”‚
   â”‚  â””â”€ å¼‚å¸¸ â†’ é‡å¯ â†’ è®°å½•ç»“æœ        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  éå†16ä¸ªé‡‡é›†å™¨                   â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚ æ£€æŸ¥è¿›ç¨‹çŠ¶æ€ï¼ˆPM2ï¼‰         â”‚  â”‚
   â”‚  â”‚ â”œâ”€ online â†’ ç»§ç»­            â”‚  â”‚
   â”‚  â”‚ â””â”€ stopped/errored â†’ é‡å¯   â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â”‚               â”‚                   â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚ æ£€æŸ¥æ•°æ®æ–°é²œåº¦              â”‚  â”‚
   â”‚  â”‚ â”œâ”€ å»¶è¿Ÿ â‰¤ é˜ˆå€¼ â†’ æ­£å¸¸       â”‚  â”‚
   â”‚  â”‚ â””â”€ å»¶è¿Ÿ > é˜ˆå€¼ â†’ é‡å¯       â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ç»Ÿè®¡å¹¶è¾“å‡ºç»“æœ                   â”‚
   â”‚  â”œâ”€ å·²ä¿®å¤é—®é¢˜ï¼ˆæ—¥å¿—è¾“å‡ºï¼‰        â”‚
   â”‚  â””â”€ æœªè§£å†³é—®é¢˜ï¼ˆTelegramé€šçŸ¥ï¼‰    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç›‘æ§é¡¹ç›®æ¸…å•ï¼ˆ17ä¸ªï¼‰

| åºå· | ç³»ç»Ÿåç§° | PM2è¿›ç¨‹å | å»¶è¿Ÿé˜ˆå€¼ | æ•°æ®ç›®å½• |
|------|---------|----------|---------|---------|
| 1 | Flask Webåº”ç”¨ | flask-app | HTTPæ£€æŸ¥ | - |
| 2 | ä¿¡å·é‡‡é›†å™¨ | signal-collector | 10åˆ†é’Ÿ | data/signal_timeline/*.jsonl |
| 3 | ä»·æ ¼ä½ç½®é‡‡é›†å™¨ | price-position-collector | 10åˆ†é’Ÿ | data/price_position_10m/*.jsonl |
| 4 | ä»·æ ¼é€Ÿåº¦é‡‡é›†å™¨ | price-speed-collector | 5åˆ†é’Ÿ | data/price_speed_10m/*.jsonl |
| 5 | SARæ–œç‡é‡‡é›†å™¨ | sar-slope-collector | 10åˆ†é’Ÿ | data/sar_slope_jsonl/latest_sar_slope.jsonl |
| 6 | SARåå‘ç»Ÿè®¡é‡‡é›†å™¨ | sar-bias-stats-collector | 10åˆ†é’Ÿ | data/sar_bias_stats/*.jsonl |
| 7 | 1å°æ—¶æ¸…ç®—æ•°æ®é‡‡é›†å™¨ | liquidation-1h-collector | 120åˆ†é’Ÿ | data/liquidation_1h/*.jsonl |
| 8 | æ—¥æ¶¨è·Œå¹…é‡‡é›†å™¨ | okx-day-change-collector | 1500åˆ†é’Ÿ | data/okx_day_change/*.jsonl |
| 9 | ä»·æ ¼å¯¹æ¯”é‡‡é›†å™¨ | price-comparison-collector | 10åˆ†é’Ÿ | data/price_comparison/*.jsonl |
| 10 | V1V2æ¯”ç‡é‡‡é›†å™¨ | v1v2-collector | 10åˆ†é’Ÿ | data/v1v2_ratios/*.jsonl |
| 11 | ææ…Œæ¸…æ´—é‡‡é›†å™¨ | panic-wash-collector | 10åˆ†é’Ÿ | data/panic_wash/*.jsonl |
| 12 | å¸ç§å˜åŒ–è¿½è¸ªå™¨ | coin-change-tracker | 10åˆ†é’Ÿ | data/coin_changes/*.jsonl |
| 13 | åŠ å¯†æŒ‡æ•°é‡‡é›†å™¨ | crypto-index-collector | 10åˆ†é’Ÿ | data/crypto_index/*.jsonl |
| 14 | é‡‘èæŒ‡æ ‡é‡‡é›†å™¨ | financial-indicators-collector | 1500åˆ†é’Ÿ | data/financial_indicators/*.jsonl |
| 15 | OKXäº¤æ˜“å†å²é‡‡é›†å™¨ | okx-trade-history-collector | 10åˆ†é’Ÿ | data/okx_trade_history/*.jsonl |
| 16 | OKXäº¤æ˜“æ ‡è®°é‡‡é›†å™¨ | okx-trading-marks-collector | 10åˆ†é’Ÿ | data/okx_trading_marks/*.jsonl |
| 17 | æ¸…ç®—å‘Šè­¦ç›‘æ§å™¨ | liquidation-alert-monitor | 10åˆ†é’Ÿ | data/liquidation_alerts/*.jsonl |
| 18 | ä»·æ ¼åŸºçº¿é‡‡é›†å™¨ | price-baseline-collector | 1500åˆ†é’Ÿ | data/price_baselines/*.jsonl |

### å»¶è¿Ÿé˜ˆå€¼è¯´æ˜

- **5åˆ†é’Ÿï¼š** é«˜é¢‘é‡‡é›†å™¨ï¼ˆå¦‚ä»·æ ¼é€Ÿåº¦ï¼Œæ¯3åˆ†é’Ÿé‡‡é›†ï¼‰
- **10åˆ†é’Ÿï¼š** å¸¸è§„é‡‡é›†å™¨ï¼ˆå¤§éƒ¨åˆ†é‡‡é›†å™¨ï¼‰
- **120åˆ†é’Ÿï¼š** å°æ—¶çº§é‡‡é›†å™¨ï¼ˆæ¯å°æ—¶é‡‡é›†ï¼‰
- **1500åˆ†é’Ÿï¼š** æ—¥çº§é‡‡é›†å™¨ï¼ˆæ¯24å°æ—¶é‡‡é›†ï¼‰

---

## 4. JSONLæ•°æ®å­˜å‚¨æ ¼å¼

### å­˜å‚¨ç‰¹ç‚¹

âœ… **æ¯è¡Œä¸€æ¡å®Œæ•´çš„ JSON è®°å½•ï¼Œç‹¬ç«‹è§£æ**  
âœ… **æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶å­˜å‚¨ï¼Œæ–‡ä»¶åæ ¼å¼ï¼š** `system_name_YYYYMMDD.jsonl`  
âœ… **è¿½åŠ å†™å…¥æ¨¡å¼ï¼Œä¸ä¿®æ”¹å†å²æ•°æ®**  
âœ… **UTF-8 ç¼–ç ï¼Œæ”¯æŒä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦**  
âœ… **å•è¡ŒæŸåä¸å½±å“å…¶ä»–æ•°æ®çš„è¯»å–**  

### ç¤ºä¾‹1ï¼šä¿¡å·é‡‡é›†å™¨ (signal_timeline_YYYYMMDD.jsonl)

```json
{"time":"2026-02-15 15:30:00","coins":[{"symbol":"BTC","signals":{"buy":0,"sell":1}}],"statistics":{"+4%":5,"+1%":12,"0%":8,"-1%":2,"-3%":1},"total_coins":28}
{"time":"2026-02-15 15:33:00","coins":[{"symbol":"BTC","signals":{"buy":0,"sell":1}}],"statistics":{"+4%":5,"+1%":12,"0%":9,"-1%":1,"-3%":1},"total_coins":28}
```

**å­—æ®µè¯´æ˜ï¼š**
- `time`: é‡‡é›†æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
- `coins`: å¸ç§åˆ—è¡¨åŠå…¶ä¿¡å·
- `statistics`: å„é€Ÿåº¦åŒºé—´çš„å¸ç§æ•°é‡ç»Ÿè®¡
- `total_coins`: æ€»ç›‘æ§å¸ç§æ•°

### ç¤ºä¾‹2ï¼šSARåå‘ç»Ÿè®¡ (bias_stats_YYYYMMDD.jsonl)

```json
{"timestamp":1771139400,"beijing_time":"2026-02-15 15:10:00","bullish_count":12,"bearish_count":16,"bullish_symbols":[{"symbol":"BTC","ratio":85.2}],"bearish_symbols":[],"total_monitored":28}
{"timestamp":1771139700,"beijing_time":"2026-02-15 15:15:00","bullish_count":13,"bearish_count":15,"bullish_symbols":[{"symbol":"BTC","ratio":86.1}],"bearish_symbols":[],"total_monitored":28}
```

**å­—æ®µè¯´æ˜ï¼š**
- `timestamp`: Unixæ—¶é—´æˆ³
- `beijing_time`: åŒ—äº¬æ—¶é—´å­—ç¬¦ä¸²
- `bullish_count`: åå¤šå¸ç§æ•°é‡
- `bearish_count`: åç©ºå¸ç§æ•°é‡
- `bullish_symbols`: åå¤š>80%çš„å¸ç§åˆ—è¡¨
- `bearish_symbols`: åç©º>80%çš„å¸ç§åˆ—è¡¨
- `total_monitored`: æ€»ç›‘æ§å¸ç§æ•°

### ç¤ºä¾‹3ï¼šä»·æ ¼ä½ç½®æ•°æ® (price_position_10m_YYYYMMDD.jsonl)

```json
{"time":"2026-02-15 15:00:00","coins":[{"symbol":"BTC","price":70195.9,"position":"ä¸­ä½","support1":68500,"support2":67000,"resistance1":71500,"resistance2":73000}],"count":28}
```

**å­—æ®µè¯´æ˜ï¼š**
- `time`: é‡‡é›†æ—¶é—´
- `coins`: å¸ç§ä»·æ ¼ä½ç½®æ•°æ®
- `position`: ä»·æ ¼ä½ç½®ï¼ˆåº•éƒ¨/ä¸­ä¸‹/ä¸­ä½/ä¸­ä¸Š/é¡¶éƒ¨ï¼‰
- `support1/2`: æ”¯æ’‘çº¿1/2
- `resistance1/2`: å‹åŠ›çº¿1/2
- `count`: é‡‡é›†å¸ç§æ•°

---

## 5. ç³»ç»Ÿä¾èµ–è¯¦ç»†æ¸…å•

### ğŸ Python ä¾èµ–åŒ…

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| flask | â‰¥2.3.0 | Webæ¡†æ¶ã€APIè·¯ç”±ã€æ¨¡æ¿æ¸²æŸ“ |
| flask-cors | â‰¥4.0.0 | è·¨åŸŸèµ„æºå…±äº«æ”¯æŒ |
| requests | â‰¥2.28.0 | HTTPè¯·æ±‚ã€OKX APIè°ƒç”¨ |
| numpy | â‰¥1.21.0 | æ•°å€¼è®¡ç®—ã€SARæŒ‡æ ‡è®¡ç®—ã€çº¿æ€§å›å½’ |
| pytz | â‰¥2023.3 | æ—¶åŒºå¤„ç†ã€åŒ—äº¬æ—¶é—´è½¬æ¢ |
| subprocess | å†…ç½® | PM2è¿›ç¨‹ç®¡ç†ã€ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ |

### ğŸ“¦ Node.js ä¾èµ–åŒ…

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| pm2 | â‰¥5.3.0 | è¿›ç¨‹ç®¡ç†å™¨ã€å®ˆæŠ¤Pythonè„šæœ¬ã€è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç† |

### ğŸ”— API è·¯ç”±åˆ—è¡¨

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | å‚æ•° |
|------|------|------|------|
| /data-health-monitor | GET | ç›‘æ§ä¸»é¡µé¢ | - |
| /api/data-health-monitor/status | GET | è·å–æ‰€æœ‰ç›‘æ§å™¨çŠ¶æ€ | - |
| /api/data-health-monitor/logs | GET | è·å–æœ€è¿‘æ—¥å¿— | limitï¼ˆé»˜è®¤50ï¼‰ |
| /api/data-health-monitor/restart | POST | æ‰‹åŠ¨é‡å¯æœåŠ¡ | pm2_name |
| /api/data-health-monitor/service-logs | GET | è·å–æœåŠ¡æ—¥å¿— | pm2_name, lines |

### ğŸ—‚ï¸ æ•°æ®ç›®å½•ç»“æ„

```
/home/user/webapp/
â”œâ”€â”€ source_code/
â”‚   â””â”€â”€ system_health_monitor_v2.py    # ç›‘æ§è„šæœ¬
â”œâ”€â”€ config/
â”‚   â””â”€â”€ telegram_config.py             # Telegramé…ç½®
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ signal_timeline/               # ä¿¡å·æ•°æ®
â”‚   â”œâ”€â”€ price_position_10m/            # ä»·æ ¼ä½ç½®æ•°æ®
â”‚   â”œâ”€â”€ price_speed_10m/               # ä»·æ ¼é€Ÿåº¦æ•°æ®
â”‚   â”œâ”€â”€ sar_slope_jsonl/               # SARæ–œç‡æ•°æ®
â”‚   â”œâ”€â”€ sar_bias_stats/                # SARåå‘ç»Ÿè®¡
â”‚   â”œâ”€â”€ liquidation_1h/                # æ¸…ç®—æ•°æ®
â”‚   â”œâ”€â”€ okx_day_change/                # æ—¥æ¶¨è·Œå¹…
â”‚   â”œâ”€â”€ price_comparison/              # ä»·æ ¼å¯¹æ¯”
â”‚   â”œâ”€â”€ v1v2_ratios/                   # V1V2æ¯”ç‡
â”‚   â”œâ”€â”€ panic_wash/                    # ææ…Œæ¸…æ´—
â”‚   â”œâ”€â”€ coin_changes/                  # å¸ç§å˜åŒ–
â”‚   â”œâ”€â”€ crypto_index/                  # åŠ å¯†æŒ‡æ•°
â”‚   â”œâ”€â”€ financial_indicators/          # é‡‘èæŒ‡æ ‡
â”‚   â”œâ”€â”€ okx_trade_history/             # äº¤æ˜“å†å²
â”‚   â”œâ”€â”€ okx_trading_marks/             # äº¤æ˜“æ ‡è®°
â”‚   â”œâ”€â”€ liquidation_alerts/            # æ¸…ç®—å‘Šè­¦
â”‚   â””â”€â”€ price_baselines/               # ä»·æ ¼åŸºçº¿
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ data_health_monitor.log        # ç›‘æ§æ—¥å¿—
â””â”€â”€ ~/.pm2/logs/                       # PM2æ—¥å¿—ç›®å½•
    â”œâ”€â”€ system-health-monitor-v2-out.log
    â””â”€â”€ system-health-monitor-v2-error.log
```

### ğŸ” ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| TELEGRAM_BOT_TOKEN | Telegram Bot Token | - |
| TELEGRAM_CHAT_ID | Telegram Chat ID | - |
| FLASK_PORT | Flaskåº”ç”¨ç«¯å£ | 9002 |
| MONITOR_INTERVAL | ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰ | 300 |

**æ³¨æ„ï¼š** Telegramé…ç½®å¯åœ¨ `config/telegram_config.py` ä¸­è®¾ç½®ï¼Œæ— éœ€ç¯å¢ƒå˜é‡ã€‚

---

## 6. åŠŸèƒ½è¯¦ç»†è¯´æ˜

### ğŸ“Š 1. è¿›ç¨‹çŠ¶æ€ç›‘æ§

**åŠŸèƒ½æè¿°ï¼š**
- é€šè¿‡ PM2 API (`pm2 jlist`) è·å–æ‰€æœ‰è¿›ç¨‹çŠ¶æ€
- æ£€æµ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦åœ¨çº¿
- è®°å½•è¿›ç¨‹ PIDã€å¯åŠ¨æ—¶é—´ã€é‡å¯æ¬¡æ•°

**çŠ¶æ€ç±»å‹ï¼š**
| çŠ¶æ€ | è¯´æ˜ | å¤„ç†æ–¹å¼ |
|------|------|----------|
| online | è¿›ç¨‹æ­£å¸¸è¿è¡Œ | ç»§ç»­æ£€æŸ¥æ•°æ®æ–°é²œåº¦ |
| stopped | è¿›ç¨‹å·²åœæ­¢ | ç«‹å³é‡å¯ |
| errored | è¿›ç¨‹å¼‚å¸¸é€€å‡º | ç«‹å³é‡å¯ |
| not_found | è¿›ç¨‹ä¸å­˜åœ¨ | è®°å½•è­¦å‘Šï¼ˆä¸é‡å¯ï¼‰ |

### ğŸ’¾ 2. æ•°æ®æ–°é²œåº¦æ£€æŸ¥

**æ£€æŸ¥æµç¨‹ï¼š**
1. æŸ¥æ‰¾æ•°æ®ç›®å½•ä¸‹çš„æ‰€æœ‰ JSONL æ–‡ä»¶
2. è·å–æœ€æ–°æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ (`st_mtime`)
3. è®¡ç®—å»¶è¿Ÿï¼šå½“å‰æ—¶é—´ - æ–‡ä»¶ä¿®æ”¹æ—¶é—´
4. å¯¹æ¯”é¢„è®¾é˜ˆå€¼ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦æ–°é²œ

**å»¶è¿Ÿåˆ¤å®šï¼š**
```python
if å»¶è¿Ÿ <= é˜ˆå€¼:
    çŠ¶æ€ = "æ­£å¸¸"
elif é˜ˆå€¼ < å»¶è¿Ÿ <= é˜ˆå€¼*1.5:
    çŠ¶æ€ = "è­¦å‘Š"ï¼ˆé»„è‰²ï¼‰
else:
    çŠ¶æ€ = "å¼‚å¸¸"ï¼ˆçº¢è‰²ï¼Œè§¦å‘é‡å¯ï¼‰
```

### ğŸ”„ 3. è‡ªåŠ¨ä¿®å¤æœºåˆ¶

**ä¿®å¤ç­–ç•¥ï¼š**
1. æ£€æµ‹åˆ°å¼‚å¸¸ â†’ æ‰§è¡Œ `pm2 restart è¿›ç¨‹å`
2. è®°å½•é‡å¯æ¬¡æ•°åˆ°è®¡æ•°å™¨
3. é‡å¯æˆåŠŸ â†’ ç­‰å¾…5åˆ†é’ŸéªŒè¯
4. é‡å¯å¤±è´¥æˆ–è¶…è¿‡3æ¬¡ â†’ å‘é€Telegramé€šçŸ¥

**é‡å¯è®¡æ•°å™¨é€»è¾‘ï¼š**
```python
restart_counter = {
    'process-name': 0  # åˆå§‹ä¸º0
}

# æ¯æ¬¡é‡å¯
restart_counter['process-name'] += 1

# é‡å¯æˆåŠŸåéªŒè¯æ­£å¸¸
if æ•°æ®æ¢å¤æ­£å¸¸:
    restart_counter['process-name'] = 0  # é‡ç½®è®¡æ•°å™¨

# è¶…è¿‡3æ¬¡
if restart_counter['process-name'] >= 3:
    å‘é€Telegramé€šçŸ¥
    ä¸å†è‡ªåŠ¨é‡å¯
```

### ğŸ“± 4. Telegram é€šçŸ¥

**é€šçŸ¥æ—¶æœºï¼š**
- âŒ è¿›ç¨‹é‡å¯å¤±è´¥
- âŒ é‡å¯è¶…è¿‡3æ¬¡ä»æ— æ³•æ¢å¤
- âŒ è¿›ç¨‹ä¸å­˜åœ¨ï¼ˆé…ç½®é”™è¯¯ï¼‰

**é€šçŸ¥å†…å®¹ï¼š**
```
ğŸš¨ ç³»ç»Ÿå¥åº·ç›‘æ§å‘Šè­¦

æ—¶é—´: 2026-02-15 15:30:00

âŒ æœªè§£å†³é—®é¢˜ (2):
â€¢ signal-collector: æ•°æ®å»¶è¿Ÿ - å»¶è¿Ÿ 25.3 åˆ†é’Ÿï¼Œå·²é‡å¯3æ¬¡ä»å¤±è´¥
â€¢ flask-app: æ— å“åº”ä¸”é‡å¯å¤±è´¥ - é‡å¯å¤±è´¥: Connection refused

âœ… å·²ä¿®å¤ (1):
â€¢ sar-slope-collector: æ•°æ®å»¶è¿Ÿï¼Œé‡å¯æˆåŠŸ (ç¬¬ 1 æ¬¡)
```

### ğŸ“ˆ 5. å®æ—¶ç»Ÿè®¡

**ç»Ÿè®¡æŒ‡æ ‡ï¼š**
| æŒ‡æ ‡ | è¯´æ˜ | è®¡ç®—æ–¹å¼ |
|------|------|----------|
| æ€»ç›‘æ§æ•°é‡ | ç›‘æ§çš„ç³»ç»Ÿæ€»æ•° | len(MONITOR_CONFIG) + 1 (Flask) |
| å¥åº·æ•°é‡ | çŠ¶æ€æ­£å¸¸çš„æ•°é‡ | sum(status == 'healthy') |
| å¼‚å¸¸æ•°é‡ | çŠ¶æ€å¼‚å¸¸çš„æ•°é‡ | æ€»æ•° - å¥åº·æ•°é‡ |
| ä»Šæ—¥é‡å¯æ¬¡æ•° | ä»Šå¤©è‡ªåŠ¨é‡å¯çš„æ€»æ¬¡æ•° | ç»Ÿè®¡æ‰€æœ‰è¿›ç¨‹çš„ä»Šæ—¥é‡å¯è®°å½• |

---

## 7. ä½¿ç”¨æŒ‡å—

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹ç›‘æ§å™¨çŠ¶æ€
pm2 status system-health-monitor-v2

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs system-health-monitor-v2

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
pm2 logs system-health-monitor-v2 --nostream --lines 50

# é‡å¯ç›‘æ§å™¨
pm2 restart system-health-monitor-v2

# åœæ­¢ç›‘æ§å™¨
pm2 stop system-health-monitor-v2

# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€
pm2 list

# æ¸…ç†PM2æ—¥å¿—
pm2 flush

# ä¿å­˜PM2é…ç½®
pm2 save

# æŸ¥çœ‹æŸä¸ªé‡‡é›†å™¨çš„æ—¥å¿—
pm2 logs signal-collector --lines 100
```

### é…ç½® Telegram é€šçŸ¥

**æ­¥éª¤1ï¼šåˆ›å»º Telegram Bot**
```
1. æ‰“å¼€ Telegramï¼Œæœç´¢ @BotFather
2. å‘é€ /newbot åˆ›å»ºæœºå™¨äºº
3. æŒ‰æç¤ºè®¾ç½®æœºå™¨äººåç§°
4. å¤åˆ¶ Bot Tokenï¼ˆæ ¼å¼ï¼š1234567890:ABCdefGHIjklMNOpqrsTUVwxyzï¼‰
```

**æ­¥éª¤2ï¼šè·å– Chat ID**
```
æ–¹æ³•1ï¼š
  1. æœç´¢ @userinfobot
  2. ç‚¹å‡» Start è·å–æ‚¨çš„ Chat ID

æ–¹æ³•2ï¼š
  1. ç»™æ‚¨çš„ Bot å‘é€ä»»æ„æ¶ˆæ¯
  2. æµè§ˆå™¨è®¿é—®ï¼š
     https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
  3. æŸ¥æ‰¾ "chat":{"id": æ•°å­—} å­—æ®µ
```

**æ­¥éª¤3ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶**
```bash
vi /home/user/webapp/config/telegram_config.py

# å¡«å†™ï¼š
TELEGRAM_BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
TELEGRAM_CHAT_ID = "123456789"
```

**æ­¥éª¤4ï¼šé‡å¯ç›‘æ§å™¨**
```bash
pm2 restart system-health-monitor-v2
```

### æ‰‹åŠ¨æµ‹è¯• Telegram é€šçŸ¥

```bash
# æµ‹è¯• Bot Token
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getMe"

# å‘é€æµ‹è¯•æ¶ˆæ¯
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage" \
  -d "chat_id=<YOUR_CHAT_ID>" \
  -d "text=æµ‹è¯•æ¶ˆæ¯"
```

---

## 8. æ•…éšœæ’æŸ¥æŒ‡å—

### é—®é¢˜1ï¼šç›‘æ§å™¨ä¸å·¥ä½œ

**ç—‡çŠ¶ï¼š** ç›‘æ§é¡µé¢æ²¡æœ‰æ›´æ–°ï¼Œæˆ–æ˜¾ç¤ºæ•°æ®ä¸ºç©º

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
pm2 status system-health-monitor-v2

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs system-health-monitor-v2 --err --lines 50

# 3. æ£€æŸ¥Pythonä¾èµ–
python3 -c "import requests, numpy, pytz, flask; print('âœ… ä¾èµ–æ­£å¸¸')"

# 4. æ‰‹åŠ¨é‡å¯
pm2 restart system-health-monitor-v2

# 5. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
pm2 logs system-health-monitor-v2 --lines 100
```

**å¸¸è§åŸå› ï¼š**
- âŒ Python ä¾èµ–åŒ…ç¼ºå¤± â†’ å®‰è£…ï¼š`pip3 install -r requirements.txt`
- âŒ æƒé™é—®é¢˜ â†’ æ£€æŸ¥ï¼š`ls -la /home/user/webapp/source_code/system_health_monitor_v2.py`
- âŒ PM2 å®ˆæŠ¤å¤±è´¥ â†’ é‡æ–°å¯åŠ¨ï¼š`pm2 delete system-health-monitor-v2 && pm2 start ...`

### é—®é¢˜2ï¼šæ•°æ®é‡‡é›†å™¨é¢‘ç¹é‡å¯

**ç—‡çŠ¶ï¼š** æŸä¸ªé‡‡é›†å™¨ä¸æ–­è¢«é‡å¯ï¼Œä½†æ•°æ®ä»ç„¶å»¶è¿Ÿ

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æŸ¥çœ‹é‡‡é›†å™¨æ—¥å¿—
pm2 logs <é‡‡é›†å™¨å> --lines 200

# 2. æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
ls -la /home/user/webapp/data/<å¯¹åº”ç›®å½•>/

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 4. æ£€æŸ¥OKX APIè¿æ¥
curl "https://www.okx.com/api/v5/market/tickers?instType=SPOT"

# 5. æ‰‹åŠ¨è¿è¡Œé‡‡é›†å™¨è„šæœ¬
python3 /home/user/webapp/source_code/<é‡‡é›†å™¨è„šæœ¬>.py
```

**å¸¸è§åŸå› ï¼š**
- âŒ OKX API é™æµ â†’ å¢åŠ è¯·æ±‚é—´éš”
- âŒ æ•°æ®ç›®å½•ä¸å­˜åœ¨ â†’ åˆ›å»ºï¼š`mkdir -p /home/user/webapp/data/<ç›®å½•>`
- âŒ ç£ç›˜ç©ºé—´ä¸è¶³ â†’ æ¸…ç†æ—§æ—¥å¿—
- âŒ ç½‘ç»œé—®é¢˜ â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥

### é—®é¢˜3ï¼šTelegram é€šçŸ¥ä¸å‘é€

**ç—‡çŠ¶ï¼š** æœ‰å¼‚å¸¸ä½†æ²¡æœ‰æ”¶åˆ° Telegram é€šçŸ¥

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /home/user/webapp/config/telegram_config.py

# 2. æµ‹è¯•Bot Token
curl "https://api.telegram.org/bot<TOKEN>/getMe"

# 3. æµ‹è¯•å‘é€æ¶ˆæ¯
curl -X POST "https://api.telegram.org/bot<TOKEN>/sendMessage" \
  -d "chat_id=<CHAT_ID>" \
  -d "text=æµ‹è¯•"

# 4. æŸ¥çœ‹ç›‘æ§å™¨æ—¥å¿—ä¸­çš„Telegramç›¸å…³è¾“å‡º
pm2 logs system-health-monitor-v2 | grep -i telegram

# 5. é‡å¯ç›‘æ§å™¨
pm2 restart system-health-monitor-v2
```

**å¸¸è§åŸå› ï¼š**
- âŒ Bot Token é”™è¯¯ â†’ é‡æ–°ä» @BotFather è·å–
- âŒ Chat ID é”™è¯¯ â†’ é‡æ–°ä» @userinfobot è·å–
- âŒ Bot è¢«å°ç¦ â†’ åˆ›å»ºæ–°çš„ Bot
- âŒ ç½‘ç»œé—®é¢˜ â†’ æ£€æŸ¥èƒ½å¦è®¿é—® `api.telegram.org`

### é—®é¢˜4ï¼šé¡µé¢æ˜¾ç¤ºæ•°æ®å¼‚å¸¸

**ç—‡çŠ¶ï¼š** ç›‘æ§é¡µé¢æ˜¾ç¤ºçš„æ•°æ®ä¸å‡†ç¡®æˆ–ä¸ºç©º

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥ Flask åº”ç”¨çŠ¶æ€
pm2 status flask-app

# 2. æµ‹è¯• API æ¥å£
curl "http://localhost:9002/api/data-health-monitor/status"

# 3. æŸ¥çœ‹ Flask æ—¥å¿—
pm2 logs flask-app --lines 100

# 4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
# æ‰“å¼€æµè§ˆå™¨ F12 â†’ Console æ ‡ç­¾

# 5. æ¸…ç†æµè§ˆå™¨ç¼“å­˜
# Ctrl+Shift+Del â†’ æ¸…é™¤ç¼“å­˜
```

**å¸¸è§åŸå› ï¼š**
- âŒ Flask åº”ç”¨æœªè¿è¡Œ â†’ é‡å¯ï¼š`pm2 restart flask-app`
- âŒ API æ¥å£é”™è¯¯ â†’ æŸ¥çœ‹ Flask é”™è¯¯æ—¥å¿—
- âŒ æµè§ˆå™¨ç¼“å­˜ â†’ å¼ºåˆ¶åˆ·æ–°ï¼šCtrl+F5
- âŒ CORS é—®é¢˜ â†’ æ£€æŸ¥ flask-cors é…ç½®

### é—®é¢˜5ï¼šæ•°æ®ç›®å½•ä¸å­˜åœ¨

**ç—‡çŠ¶ï¼š** ç›‘æ§å™¨æŠ¥å‘Š"ç›®å½•ä¸å­˜åœ¨"

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åˆ›å»ºæ‰€æœ‰æ•°æ®ç›®å½•
mkdir -p /home/user/webapp/data/{signal_timeline,price_position_10m,price_speed_10m,sar_slope_jsonl,sar_bias_stats,liquidation_1h,okx_day_change,price_comparison,v1v2_ratios,panic_wash,coin_changes,crypto_index,financial_indicators,okx_trade_history,okx_trading_marks,liquidation_alerts,price_baselines}

# è®¾ç½®æƒé™
chmod 755 /home/user/webapp/data/*

# é‡å¯æ‰€æœ‰é‡‡é›†å™¨
pm2 restart all
```

---

## é™„å½•Aï¼šç›‘æ§å™¨å‘½ä»¤é€ŸæŸ¥è¡¨

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pm2 status` | æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çŠ¶æ€ |
| `pm2 logs <name>` | æŸ¥çœ‹å®æ—¶æ—¥å¿— |
| `pm2 restart <name>` | é‡å¯è¿›ç¨‹ |
| `pm2 stop <name>` | åœæ­¢è¿›ç¨‹ |
| `pm2 delete <name>` | åˆ é™¤è¿›ç¨‹ |
| `pm2 flush` | æ¸…ç†æ‰€æœ‰æ—¥å¿— |
| `pm2 save` | ä¿å­˜è¿›ç¨‹åˆ—è¡¨ |
| `pm2 resurrect` | æ¢å¤å·²ä¿å­˜çš„è¿›ç¨‹ |
| `pm2 monit` | å®æ—¶ç›‘æ§é¢æ¿ |

---

## é™„å½•Bï¼šæ•°æ®æ–‡ä»¶å‘½åè§„èŒƒ

| ç³»ç»Ÿ | æ–‡ä»¶åæ ¼å¼ | ç¤ºä¾‹ |
|------|-----------|------|
| ä¿¡å·é‡‡é›†å™¨ | signal_timeline_YYYYMMDD.jsonl | signal_timeline_20260215.jsonl |
| ä»·æ ¼ä½ç½® | price_position_10m_YYYYMMDD.jsonl | price_position_10m_20260215.jsonl |
| ä»·æ ¼é€Ÿåº¦ | price_speed_10m_YYYYMMDD.jsonl | price_speed_10m_20260215.jsonl |
| SARåå‘ | bias_stats_YYYYMMDD.jsonl | bias_stats_20260215.jsonl |

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0.0  
**æ›´æ–°æ—¶é—´ï¼š** 2026-02-15 16:00  
**ç»´æŠ¤è€…ï¼š** GenSpark AI Developer
