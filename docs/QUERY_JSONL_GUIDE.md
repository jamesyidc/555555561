# ğŸ“Š Queryç³»ç»ŸJSONLåŒ–ä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

Queryç³»ç»Ÿå·²å®ŒæˆJSONLåŒ–æ”¹é€ ï¼Œæ”¯æŒï¼š
1. **å¿«ç…§æ•°æ®ç®¡ç†** - æ€¥æ¶¨æ€¥è·Œã€çŠ¶æ€ã€è®¡æ¬¡ç­‰æ±‡æ€»æ•°æ®
2. **å¸ç§æ•°æ®ç®¡ç†** - 29ä¸ªå¸ç§çš„è¯¦ç»†æ•°æ®
3. **ä¼˜å…ˆçº§è‡ªåŠ¨è®¡ç®—** - 6çº§ä¼˜å…ˆçº§è‡ªåŠ¨åˆ†ç±»
4. **TXTæ–‡ä»¶è§£æ** - ä»Google Drive TXTæ–‡ä»¶å¯¼å…¥
5. **æ•°æ®æŸ¥è¯¢** - æŒ‰æ—¶é—´æŸ¥è¯¢å¿«ç…§å’Œå¸ç§

---

## ğŸ“¦ å·²å®Œæˆ

### 1. æ•°æ®è¿ç§»
```
âœ… å¿«ç…§æ•°æ®è¿ç§»ï¼š26,557æ¡è®°å½•
âœ… å¸ç§æ•°æ®ï¼šæ”¯æŒåŠ¨æ€å¯¼å…¥
âœ… æ•°æ®æºï¼šdata/query_jsonl/
   - snapshots.jsonl (å¿«ç…§æ•°æ®)
   - coins.jsonl (å¸ç§æ•°æ®)
```

### 2. ä¼˜å…ˆçº§è®¡ç®—è§„åˆ™

| ç­‰çº§ | æœ€é«˜å æ¯” | æœ€ä½å æ¯” | è¯´æ˜ |
|------|---------|---------|------|
| **1** | > 90% | > 120% | æœ€ä¼˜å…ˆ |
| **2** | > 80% | > 120% | é«˜ä¼˜å…ˆ |
| **3** | > 90% | > 110% | è¾ƒé«˜ä¼˜å…ˆ |
| **4** | > 70% | > 120% | ä¸­ä¼˜å…ˆ |
| **5** | > 80% | > 110% | ä¸€èˆ¬ä¼˜å…ˆ |
| **6** | å…¶ä»– | å…¶ä»– | ä½ä¼˜å…ˆ |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ä»TXTæ–‡ä»¶å¯¼å…¥ï¼ˆæ¨èï¼‰

```bash
# 1. å‡†å¤‡TXTæ–‡ä»¶ï¼ˆä»Google Driveè·å–æœ€æ–°æ–‡ä»¶ï¼‰
# æ–‡ä»¶æ ¼å¼ç¤ºä¾‹ï¼š
#   é€æ˜æ ‡ç­¾_æ€¥æ¶¨æ€»å’Œ=æ€¥æ¶¨ï¼š14
#   é€æ˜æ ‡ç­¾_æ€¥è·Œæ€»å’Œ=æ€¥è·Œï¼š18
#   ...
#   1|BTC|2|3|2026-01-14 17:30:00|95000|...|95.5|125.3

# 2. å¯¼å…¥TXTæ–‡ä»¶
cd /home/user/webapp
python3 migrate_query_to_jsonl.py <txtæ–‡ä»¶è·¯å¾„> "<å¿«ç…§æ—¶é—´>"

# ç¤ºä¾‹
python3 migrate_query_to_jsonl.py latest_data.txt "2026-01-14 17:30:00"
```

### æ–¹æ³•2: ä½¿ç”¨Python API

```python
from source_code.query_jsonl_manager import QueryJSONLManager

manager = QueryJSONLManager()

# æŸ¥è¯¢æœ€æ–°å¿«ç…§
latest_time = manager.get_latest_snapshot_time()
print(f"æœ€æ–°æ—¶é—´: {latest_time}")

# è·å–å¿«ç…§æ•°æ®
snapshot = manager.get_snapshot_by_time(latest_time)
print(f"æ€¥æ¶¨: {snapshot['rush_up']}")
print(f"æ€¥è·Œ: {snapshot['rush_down']}")
print(f"çŠ¶æ€: {snapshot['status']}")

# è·å–å¸ç§åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
coins = manager.get_coins_by_time(latest_time)
for coin in coins:
    print(f"ç­‰çº§{coin['priority']}: {coin['symbol']} "
          f"- æœ€é«˜{coin['ratio1']}% æœ€ä½{coin['ratio2']}%")
```

---

## ğŸ“ TXTæ–‡ä»¶æ ¼å¼è¯´æ˜

### å¿«ç…§æ•°æ®éƒ¨åˆ†
```
é€æ˜æ ‡ç­¾_æ€¥æ¶¨æ€»å’Œ=æ€¥æ¶¨ï¼š14       â†’ rush_up = 14
é€æ˜æ ‡ç­¾_æ€¥è·Œæ€»å’Œ=æ€¥è·Œï¼š18       â†’ rush_down = 18
é€æ˜æ ‡ç­¾_äº”ç§çŠ¶æ€=çŠ¶æ€ï¼šéœ‡è¡æ— åº  â†’ status = éœ‡è¡æ— åº
é€æ˜æ ‡ç­¾_è®¡æ¬¡=3                â†’ count = 3
é€æ˜æ ‡ç­¾_å·®å€¼ç»“æœ=å·®å€¼ï¼š-4       â†’ diff = -4
é€æ˜æ ‡ç­¾_æ¯”ä»·æœ€ä½å¾—åˆ†=æ¯”ä»·æœ€ä½ 0 0 â†’ price_lowest = 0
é€æ˜æ ‡ç­¾_ä»“ä½å¾—åˆ†=æ¯”ä»·åˆ›æ–°é«˜ ä»“ä½åŠ 10% 1 â†’ price_newhigh = 1
```

### å¸ç§æ•°æ®éƒ¨åˆ†
```
æ ¼å¼ï¼šåºå·|å¸å|æ€¥æ¶¨|æ€¥è·Œ|æ›´æ–°æ—¶é—´|å†å²é«˜ä½|é«˜ä½æ—¶é—´|è·ç¦»é«˜ä½è·Œå¹…|24æ¶¨å¹…|æ’è¡Œ|å½“å‰ä»·æ ¼|æœ€é«˜å æ¯”|æœ€ä½å æ¯”

ç¤ºä¾‹ï¼š
1|BTC|2|3|2026-01-14 17:30:00|95000|2026-01-10|-5.2|+2.3|1|92345.67|95.5|125.3
2|ETH|3|1|2026-01-14 17:30:00|4500|2026-01-12|-3.1|+1.8|2|4360.23|88.2|118.5

å­—æ®µè¯´æ˜ï¼š
- åºå·ï¼šåŸå§‹åºå·ï¼ˆä¼šæ ¹æ®ä¼˜å…ˆçº§é‡æ–°æ’åºï¼‰
- å¸åï¼šå¦‚ BTC, ETH, SOL ç­‰
- æ€¥æ¶¨ï¼šæ€¥æ¶¨æ¬¡æ•°
- æ€¥è·Œï¼šæ€¥è·Œæ¬¡æ•°
- æ›´æ–°æ—¶é—´ï¼šæ•°æ®æ›´æ–°æ—¶é—´
- å†å²é«˜ä½ï¼šå†å²æœ€é«˜ä»·æ ¼
- é«˜ä½æ—¶é—´ï¼šæœ€é«˜ä»·æ ¼æ—¶é—´
- è·ç¦»é«˜ä½è·Œå¹…ï¼šå½“å‰ä»·æ ¼è·å†å²é«˜ä½çš„è·Œå¹…ï¼ˆ%ï¼‰
- 24æ¶¨å¹…ï¼š24å°æ—¶æ¶¨è·Œå¹…ï¼ˆ%ï¼‰
- æ’è¡Œï¼šå½“å‰æ’å
- å½“å‰ä»·æ ¼ï¼šå½“å‰ä»·æ ¼
- æœ€é«˜å æ¯”ï¼šæœ€é«˜å æ¯”ï¼ˆ%ï¼‰â† ç”¨äºè®¡ç®—ä¼˜å…ˆçº§
- æœ€ä½å æ¯”ï¼šæœ€ä½å æ¯”ï¼ˆ%ï¼‰â† ç”¨äºè®¡ç®—ä¼˜å…ˆçº§
```

---

## ğŸ”§ å¸¸è§æ“ä½œ

### 1. æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
```bash
cd /home/user/webapp
python3 -c "
from source_code.query_jsonl_manager import QueryJSONLManager
import json
manager = QueryJSONLManager()
stats = manager.get_statistics()
print(json.dumps(stats, indent=2, ensure_ascii=False))
"
```

### 2. æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ•°æ®
```bash
python3 << 'EOF'
from source_code.query_jsonl_manager import QueryJSONLManager
manager = QueryJSONLManager()

# æŸ¥è¯¢ç‰¹å®šæ—¶é—´
time = "2026-01-14 17:30"
snapshot = manager.get_snapshot_by_time(time)
coins = manager.get_coins_by_time(time)

print(f"å¿«ç…§: {snapshot['status']}")
print(f"å¸ç§æ•°: {len(coins)}")
EOF
```

### 3. æŒ‰ä¼˜å…ˆçº§åˆ†ç»„ç»Ÿè®¡
```bash
python3 << 'EOF'
from source_code.query_jsonl_manager import QueryJSONLManager
manager = QueryJSONLManager()

latest_time = manager.get_latest_snapshot_time()
coins = manager.get_coins_by_time(latest_time)

# ç»Ÿè®¡å„ä¼˜å…ˆçº§æ•°é‡
priority_count = {}
for coin in coins:
    p = coin['priority']
    priority_count[p] = priority_count.get(p, 0) + 1

print("ä¼˜å…ˆçº§åˆ†å¸ƒ:")
for level in sorted(priority_count.keys()):
    print(f"  ç­‰çº§{level}: {priority_count[level]}ä¸ª")
EOF
```

---

## ğŸ“Š æ•°æ®ç¤ºä¾‹

### å¿«ç…§æ•°æ®
```json
{
  "snapshot_date": "2026-01-14",
  "snapshot_time": "2026-01-14 17:30:01",
  "rush_up": 14,
  "rush_down": 18,
  "diff": -4,
  "count": 3,
  "status": "éœ‡è¡æ— åº",
  "price_lowest": 0,
  "price_newhigh": 1
}
```

### å¸ç§æ•°æ®ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
```json
{
  "priority": 1,
  "symbol": "BTC",
  "rush_up": 2,
  "rush_down": 3,
  "current_price": 92345.67,
  "change_24h": 2.3,
  "ratio1": 95.5,
  "ratio2": 125.3,
  "index_order": 1
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®å¯¼å…¥
- TXTæ–‡ä»¶å¿…é¡»åŒ…å«å®Œæ•´çš„å¿«ç…§æ•°æ®å’Œå¸ç§æ•°æ®
- æ—¶é—´æ ¼å¼å¿…é¡»ä¸ºï¼š`YYYY-MM-DD HH:MM:SS`
- å¸ç§æ•°æ®è‡³å°‘éœ€è¦13åˆ—ï¼ˆç”¨`|`åˆ†éš”ï¼‰

### 2. ä¼˜å…ˆçº§è®¡ç®—
- ä¼˜å…ˆçº§è‡ªåŠ¨æ ¹æ® ratio1(æœ€é«˜å æ¯”) å’Œ ratio2(æœ€ä½å æ¯”) è®¡ç®—
- å¯¼å…¥åä¼šè‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§æ’åº
- index_order ä¼šæ ¹æ®æ’åºè‡ªåŠ¨æ›´æ–°

### 3. å­—æ®µè¦æ±‚
- å¿…éœ€å­—æ®µï¼š
  - å¿«ç…§ï¼šrush_up, rush_down, status, diff, count
  - å¸ç§ï¼šsymbol, ratio1, ratio2, current_price
- å¯é€‰å­—æ®µä¼šä½¿ç”¨é»˜è®¤å€¼

---

## ğŸ”„ ä¸æ—§ç³»ç»Ÿå¯¹æ¯”

| åŠŸèƒ½ | æ—§ç³»ç»Ÿï¼ˆSQLiteï¼‰ | æ–°ç³»ç»Ÿï¼ˆJSONLï¼‰ |
|------|-----------------|----------------|
| æ•°æ®å­˜å‚¨ | crypto_data.db | data/query_jsonl/*.jsonl |
| æŸ¥è¯¢é€Ÿåº¦ | ä¸­ç­‰ | å¿«é€Ÿ |
| å¤‡ä»½æœºåˆ¶ | æ—  | è‡ªåŠ¨å¤‡ä»½ |
| ä¼˜å…ˆçº§ | æ‰‹åŠ¨è®¡ç®— | è‡ªåŠ¨è®¡ç®— |
| TXTå¯¼å…¥ | ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| æ•°æ®è¿ç§» | å¤æ‚ | ç®€å• |

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. **æ›´æ–°APIç«¯ç‚¹** - ä¿®æ”¹ `/api/query` ä½¿ç”¨JSONLæ•°æ®æº
2. **å‰ç«¯å¯¹æ¥** - æ›´æ–°queryé¡µé¢è¯»å–æ–°æ•°æ®æ ¼å¼
3. **å®šæ—¶ä»»åŠ¡** - è®¾ç½®è‡ªåŠ¨ä»gdriveè·å–æœ€æ–°TXTå¹¶å¯¼å…¥
4. **æ•°æ®æ¸…ç†** - å®šæœŸæ¸…ç†æ—§æ•°æ®ï¼ˆä¿ç•™æœ€è¿‘30å¤©ï¼‰

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### Q1: å¯¼å…¥TXTæ–‡ä»¶å¤±è´¥
**A**: æ£€æŸ¥TXTæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œç‰¹åˆ«æ³¨æ„ï¼š
- æ ‡ç­¾æ ¼å¼ï¼š`é€æ˜æ ‡ç­¾_æ€¥æ¶¨æ€»å’Œ=æ€¥æ¶¨ï¼š14`
- å¸ç§æ•°æ®åˆ†éš”ç¬¦ï¼šå¿…é¡»ä½¿ç”¨`|`
- åˆ—æ•°ï¼šè‡³å°‘13åˆ—

### Q2: ä¼˜å…ˆçº§è®¡ç®—ä¸æ­£ç¡®
**A**: æ£€æŸ¥ratio1å’Œratio2çš„å€¼ï¼š
```python
manager.calculate_priority(ratio1, ratio2)
# ratio1: æœ€é«˜å æ¯”ï¼ˆåº”è¯¥æ˜¯0-100+çš„æ•°å­—ï¼‰
# ratio2: æœ€ä½å æ¯”ï¼ˆåº”è¯¥æ˜¯0-200+çš„æ•°å­—ï¼‰
```

### Q3: æŸ¥è¯¢ä¸åˆ°æ•°æ®
**A**: ç¡®è®¤æ—¶é—´æ ¼å¼å’Œæ•°æ®æ˜¯å¦å­˜åœ¨ï¼š
```python
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ—¶é—´
snapshots = manager.read_all_snapshots()
times = [s['snapshot_time'] for s in snapshots]
print(sorted(times, reverse=True)[:10])
```

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2026-01-14  
**ç³»ç»ŸçŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ
