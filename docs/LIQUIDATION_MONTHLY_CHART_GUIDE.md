# 1小时爆仓金额月线图 使用指南

## 📊 功能概述

本页面是针对**1小时爆仓金额**的月线图可视化工具，支持：
- 30分钟K线聚合显示
- 智能标记≥1.5亿的爆仓高点
- 多空标记功能（多头爆仓/空头爆仓）
- 区间着色（主跌/主升）

## 🎯 核心规则

### 1. 数据聚合规则
- **原始数据**：每2分钟一个数据点
- **聚合周期**：30分钟一个K线点
- **聚合方式**：取30分钟内的最大爆仓金额
- **时间范围**：向前30天（不按自然月）

### 2. 高点标记规则
- **阈值**：≥1.5亿的爆仓金额
- **间隔限制**：标记点左右各1小时内只允许一个高点
- **标记样式**：
  - 🔴 红色pin：多头爆仓（后续主跌）
  - 🟢 绿色pin：空头爆仓（后续主升）
  - 📍 灰色pin：未设置类型

### 3. 区间着色规则
- **多头爆仓后** → 主跌趋势 → 红色线段
- **空头爆仓后** → 主升趋势 → 绿色线段
- **未标记区间** → 默认蓝色线段

## 🖱️ 使用方法

### 标记多空类型

1. **点击标记点**
   - 点击图表上的pin标记（红色/绿色/灰色）
   - 弹出编辑窗口

2. **选择类型**
   - 点击"多头爆仓"按钮 → 设置为多头爆仓（后续主跌，红色线）
   - 点击"空头爆仓"按钮 → 设置为空头爆仓（后续主升，绿色线）

3. **自动保存**
   - 标记会自动保存到浏览器本地存储
   - 下次打开页面会自动加载之前的标记

### 查看详情

- **悬浮查看**：鼠标悬停在曲线上查看详细数据
  - 时间
  - 爆仓金额
  - 标记类型（如已标记）

## 📈 数据说明

### 统计信息
页面顶部显示关键统计：
- **数据点数**：聚合后的K线点数
- **标记点数**：符合条件的高点数量
- **最大值**：时间范围内的最大爆仓金额
- **平均值**：时间范围内的平均爆仓金额

### 阈值线
- **红色虚线**：1.5亿阈值线，便于识别高点

## 🔄 数据更新

### 自动更新
- 数据每2分钟由后端采集器更新
- 页面需要**手动刷新**查看最新数据

### 数据来源
- API端点：`/api/panic/hour1-curve`
- 数据字段：`hour_1_amount`（1小时爆仓金额）
- 时间字段：`record_time`

## 💾 数据持久化

### 本地存储
- 使用浏览器的 `localStorage` 保存标记
- 存储键：`liquidation_marks`
- 数据格式：
```json
[
  {
    "time": "2026-02-06T15:30:00",
    "markType": "long"  // 或 "short"
  }
]
```

### 清除标记
如需重置所有标记，在浏览器控制台执行：
```javascript
localStorage.removeItem('liquidation_marks');
location.reload();
```

## 🎨 颜色说明

### 线段颜色
- 🔴 **红色**：多头爆仓后的主跌区间
- 🟢 **绿色**：空头爆仓后的主升区间
- 🔵 **蓝色**：未标记的默认区间

### 标记颜色
- 🔴 **红色pin**：多头爆仓标记
- 🟢 **绿色pin**：空头爆仓标记
- 📍 **灰色pin**：未设置类型的标记

### 面积颜色
- 面积图使用对应线段颜色的渐变填充
- 顶部：30%透明度
- 底部：5%透明度

## 📊 技术细节

### 数据处理流程
1. **获取原始数据**：从API获取最近30天的2分钟数据
2. **时间筛选**：只保留最近30天的数据
3. **30分钟聚合**：按30分钟分组，取最大值
4. **高点标记**：
   - 筛选≥1.5亿的点
   - 按1小时间隔规则过滤
   - 保留每小时内的最高点
5. **多空标记**：从localStorage加载用户标记
6. **区间分割**：根据标记点分割线段
7. **颜色渲染**：根据标记类型设置颜色

### 性能优化
- **数据限制**：最多显示30天数据
- **聚合减少**：从~21,600点聚合到~106点
- **按需渲染**：只在标记变化时重新渲染

## 🔧 故障排除

### 问题：图表不显示
**解决方案**：
1. 检查控制台是否有错误
2. 确认API可访问：`/api/panic/hour1-curve`
3. 刷新页面重试

### 问题：标记无法保存
**解决方案**：
1. 检查浏览器是否支持localStorage
2. 检查浏览器是否启用了隐私模式
3. 清除浏览器缓存后重试

### 问题：颜色显示异常
**解决方案**：
1. 清除localStorage并刷新
2. 重新设置标记类型
3. 检查浏览器控制台错误

## 🌐 访问地址

**开发环境**：
```
https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/liquidation-monthly
```

**生产环境**：
```
https://your-domain.com/liquidation-monthly
```

## 📝 版本历史

### v2.0 - 2026-02-08
- ✅ 实现多空标记功能
- ✅ 实现区间着色（红色主跌/绿色主升）
- ✅ 添加标记编辑弹窗
- ✅ 实现本地存储持久化
- ✅ 修复颜色转换bug

### v1.0 - 2026-02-08
- ✅ 基础月线图展示
- ✅ 30分钟K线聚合
- ✅ 高点自动标记（≥1.5亿）
- ✅ 1小时间隔规则

## 📚 相关文档

- [备份部署指南](./BACKUP_AND_DEPLOYMENT_GUIDE.md)
- [系统健康检查报告](./SYSTEM_HEALTH_CHECK_REPORT.md)
- [完整数据备份报告](./FULL_DATA_BACKUP_REPORT.md)

## 🙋 常见问题

### Q: 为什么是30分钟一个点？
A: 为了平衡数据精度和图表性能。30分钟可以有效展示趋势，同时保持图表流畅。

### Q: 如何判断多头还是空头爆仓？
A: 需要结合当时的市场情况手动标记：
- 价格下跌时的大额爆仓 → 多头爆仓
- 价格上涨时的大额爆仓 → 空头爆仓

### Q: 标记会影响其他用户吗？
A: 不会。标记保存在浏览器本地，只影响当前浏览器。

### Q: 能否导出标记数据？
A: 当前版本不支持导出。可在控制台使用以下代码查看：
```javascript
console.log(JSON.parse(localStorage.getItem('liquidation_marks')));
```

## 📞 技术支持

如有问题，请联系开发团队或查看系统日志：
```bash
pm2 logs flask-app --lines 100
```

---

**最后更新**：2026-02-08  
**版本**：v2.0  
**状态**：✅ 可用
