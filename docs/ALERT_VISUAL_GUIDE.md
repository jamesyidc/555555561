# 预警功能 - 可视化说明

## 📊 UI布局示意图

```
┌─────────────────────────────────────────────────────────────┐
│  27币涨跌幅追踪系统 v2.0.1                      [首页]      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  ⚡ 预警设置                                                 │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 上限预警（涨幅）：[ 300 ] %  [●━━━○] 开启 ✅          │  │
│  │ 下限预警（跌幅）：[-300 ] %  [●━━━○] 开启 ✅          │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  📊 实时数据                                                 │
│  ┌────────────┬────────────┬────────────┬────────────┐      │
│  │ 累计涨跌幅 │ 平均涨跌幅 │ 最高涨幅   │ 最低跌幅   │      │
│  │  +45.23%   │  +1.68%    │  +25.6%    │  -15.2%    │      │
│  └────────────┴────────────┴────────────┴────────────┘      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  📈 涨跌趋势图（24小时）                                     │
│                                                               │
│   400% ┤                                    ✱ 关键压力线     │
│   300% ┤━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 上限阈值 🔴     │
│   200% ┤                             ╱╲                      │
│   100% ┤                    ╱╲      ╱  ╲                     │
│     0% ┼━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━            │
│  -100% ┤         ╲╱                      ╲╱                  │
│  -200% ┤                                                      │
│  -300% ┤━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 下限阈值 🟢     │
│  -400% ┤                                    ✱ 关键支撑线     │
│        └──────────────────────────────────────────────→      │
│         00:00  04:00  08:00  12:00  16:00  20:00  24:00      │
└─────────────────────────────────────────────────────────────┘
```

## 🔔 预警触发流程

```
┌─────────────┐
│ 系统监控    │  每10秒检查一次
│ (自动运行)  │
└──────┬──────┘
       │
       ▼
┌─────────────────────┐
│ 检查累计涨跌幅      │
│ current_pct = ?     │
└──────┬──────────────┘
       │
       ├──[上限预警开启 & current_pct ≥ upperThreshold]──┐
       │                                                   │
       ├──[下限预警开启 & current_pct ≤ lowerThreshold]──┤
       │                                                   │
       └──[未达到阈值]──────────────────────────────┐    │
                                                     │    │
       ┌─────────────────────────────────────────────┘    │
       │                                                   │
       │ 继续监控                                          │
       │                                                   │
       └──────────────────────────────────────────────────┤
                                                           │
                                                           ▼
       ┌───────────────────────────────────────────────────────┐
       │                    预警触发！                         │
       ├───────────────────────────────────────────────────────┤
       │  1. 播放音效 🔊                                       │
       │     ├─ 第1次：哔～ (800Hz, 0.5s)                      │
       │     ├─ 第2次：哔～ (1000Hz, 0.5s)                     │
       │     └─ 第3次：哔～ (800Hz, 0.5s)                      │
       │                                                       │
       │  2. 显示弹窗 💬                                       │
       │     ┌─────────────────────────────────────┐          │
       │     │ 🔴 涨幅预警触发 / 🟢 跌幅预警触发   │          │
       │     ├─────────────────────────────────────┤          │
       │     │ 当前累计涨跌幅: +320.5%             │          │
       │     │ 阈值: +300%                         │          │
       │     │                                     │          │
       │     │ 触发币种:                           │          │
       │     │ BTC: +15.50%                        │          │
       │     │ ETH: +12.30%                        │          │
       │     │ SOL: +18.20%                        │          │
       │     │                                     │          │
       │     │ [关闭]  [刷新数据]                  │          │
       │     └─────────────────────────────────────┘          │
       │     (5秒后自动关闭)                                  │
       │                                                       │
       │  3. 发送Telegram 📱                                   │
       │     ┌─────────────────────────────────────┐          │
       │     │ 🤖 YourBot                          │          │
       │     │ 🔴 涨幅预警触发！                    │          │
       │     │                                     │          │
       │     │ 当前累计涨跌幅: +320.5%             │          │
       │     │ 阈值: +300%                         │          │
       │     │                                     │          │
       │     │ 触发币种:                           │          │
       │     │ BTC: +15.50%                        │          │
       │     │ ETH: +12.30%                        │          │
       │     │ SOL: +18.20%                        │          │
       │     │                                     │          │
       │     │ 🕐 2026-02-09 15:30:00              │          │
       │     └─────────────────────────────────────┘          │
       │                                                       │
       │  4. 关闭开关 🔒                                       │
       │     上限开关: [●━━━○] 开启 ✅                        │
       │              ↓                                        │
       │     上限开关: [○━━━●] 关闭 ⚪                        │
       │     (颜色: 绿色 → 灰色)                               │
       │     (需手动重新开启)                                  │
       │                                                       │
       └───────────────────────────────────────────────────────┘
```

## 🎛️ 开关状态变化

```
【初始状态】
上限开关: [○━━━●] 关闭 ⚪ (灰色)
下限开关: [○━━━●] 关闭 ⚪ (灰色)

      ↓ 用户点击开启

【预警就绪】
上限开关: [●━━━○] 开启 ✅ (绿色)
下限开关: [●━━━○] 开启 ✅ (绿色)

      ↓ 系统监控中...

【触发预警】
上限开关: [●━━━○] 开启 ✅ → 自动关闭 → [○━━━●] 关闭 ⚪
(播放音效 + 显示弹窗 + 发送Telegram)

      ↓ 用户确认后

【需要重启】
上限开关: [○━━━●] 关闭 ⚪ (灰色)
(需要手动点击才能再次开启)

      ↓ 用户点击重启

【再次就绪】
上限开关: [●━━━○] 开启 ✅ (绿色)
(可以再次触发预警)
```

## 📱 Telegram配置流程

```
步骤1: 创建Bot
┌────────────────────┐
│  @BotFather        │
│  /newbot           │ → 输入Bot名称
│  YourBotName       │ → 输入Bot用户名
│  yourbot_bot       │ → 获取Token
│  123456:ABC...     │
└────────────────────┘

步骤2: 获取Chat ID
┌────────────────────┐
│  @userinfobot      │
│  /start            │ → 获取ID
│  Your ID: 987654   │
└────────────────────┘

步骤3: 保存配置
┌────────────────────────────────┐
│  系统配置页面                  │
│  /system-config                │
│  ┌──────────────────────────┐  │
│  │ Bot Token:               │  │
│  │ [123456:ABC...]          │  │
│  │                          │  │
│  │ Chat ID:                 │  │
│  │ [987654]                 │  │
│  │                          │  │
│  │  [保存配置]              │  │
│  └──────────────────────────┘  │
└────────────────────────────────┘

步骤4: 测试通知
┌────────────────────────────────┐
│  curl -X POST                  │
│  /api/telegram/send-alert      │
│  -d '{"message":"测试"}'        │
│  → ✅ 成功发送                 │
└────────────────────────────────┘
```

## 🔍 预警检查逻辑

```javascript
// 伪代码
function checkAlerts(currentData) {
  const currentValue = currentData.cumulative_pct
  
  // 检查上限
  if (上限开关开启 && 
      未触发 && 
      currentValue >= 上限阈值) {
    
    触发预警('upper', currentValue)
    关闭上限开关()
    标记已触发()
  }
  
  // 检查下限
  if (下限开关开启 && 
      未触发 && 
      currentValue <= 下限阈值) {
    
    触发预警('lower', currentValue)
    关闭下限开关()
    标记已触发()
  }
}

// 每10秒调用一次
setInterval(checkAlerts, 10000)
```

## 📊 数据流向

```
┌──────────────┐
│ OKX API      │  实时行情数据
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 数据采集器   │  收集27个币种
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 数据处理     │  计算涨跌幅
│              │  cumulative_pct
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ API接口      │  /api/coin-change-tracker/latest
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 前端页面     │  显示数据
│              │  更新图表
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ 预警系统     │  检查阈值
│              │  ├─ 播放音效
│              │  ├─ 显示弹窗
│              │  └─ 发送Telegram
└──────────────┘
```

## 🎯 典型使用场景

### 场景1：捕捉大涨
```
配置:
  上限: 300%
  下限: (不开启)
  
状态:
  [●━━━○] 上限开启 ✅
  [○━━━●] 下限关闭 ⚪
  
当市场涨幅达到300%时:
  🔊 哔哔哔 (音效)
  💬 "涨幅预警触发" (弹窗)
  📱 Telegram通知
  
结果:
  及时知晓做多机会
```

### 场景2：防范大跌
```
配置:
  上限: (不开启)
  下限: -300%
  
状态:
  [○━━━●] 上限关闭 ⚪
  [●━━━○] 下限开启 ✅
  
当市场跌幅达到-300%时:
  🔊 哔哔哔 (音效)
  💬 "跌幅预警触发" (弹窗)
  📱 Telegram通知
  
结果:
  及时止损或抄底
```

### 场景3：双向监控
```
配置:
  上限: 300%
  下限: -300%
  
状态:
  [●━━━○] 上限开启 ✅
  [●━━━○] 下限开启 ✅
  
当市场波动达到阈值时:
  自动预警，不错过任何机会
```

---

## 💡 温馨提示

1. **首次使用建议**
   - 先用低阈值（±50%）测试
   - 确认功能正常后再调整

2. **阈值设置建议**
   - 根据历史数据调整
   - 避免过低导致频繁预警
   - 可以查看趋势图参考

3. **预警响应**
   - 收到预警后及时查看
   - 分析市场情况
   - 根据策略决策

4. **开关管理**
   - 定期检查开关状态
   - 触发后记得重新开启
   - 不需要时可以关闭

---

**访问系统**：https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/coin-change-tracker
