# 27币涨跌幅追踪系统 V2 测试版说明

## 📍 访问地址

### V2 测试版（全新独立版本）
**🎯 推荐使用这个地址测试：**
```
https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/coin-change-tracker-v2
```

### V1 原版（原有功能）
```
https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/coin-change-tracker
```

---

## 🎯 为什么创建 V2 版本？

1. **完全独立**：V2 是原页面的完整复制，避免缓存干扰
2. **便于测试**：可以对比 V1 和 V2，快速定位问题
3. **清晰识别**：标题显示"v3.0 - 全新测试版"，一眼可辨
4. **功能一致**：所有功能完全相同，包括预警设置

---

## ✅ V2 包含的所有功能

### 1. 核心功能
- ✅ 27个币种实时涨跌幅监控
- ✅ 趋势图表展示（ECharts）
- ✅ 排名图表（横向柱状图）
- ✅ 策略筛选器（一键筛选）
- ✅ 自动刷新（可配置间隔）

### 2. 预警功能（完整）
- ✅ 上涨预警设置（阈值 + 开关）
- ✅ 下跌预警设置（阈值 + 开关）
- ✅ 全局预警开关
- ✅ Telegram 通知开关
- ✅ 保存按钮（后端 JSONL 存储）
- ✅ 恢复默认按钮
- ✅ 触发时的声音提示
- ✅ 触发时的弹窗提示
- ✅ 自动关闭开关（触发后）

### 3. 数据持久化
- ✅ 后端 JSONL 文件存储
- ✅ localStorage 本地缓存
- ✅ 双重存储机制
- ✅ 刷新不丢失设置

---

## 🧪 测试步骤

### 第一步：打开 V2 页面
```
https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/coin-change-tracker-v2
```

### 第二步：检查预警设置面板
1. 找到"涨跌预警设置"面板（橙红色渐变背景）
2. 查看当前阈值显示：
   - 上涨阈值：应该显示 **30%**（如果之前保存过）
   - 下跌阈值：应该显示 **-40%**（如果之前保存过）

### 第三步：测试保存功能
1. 修改阈值（比如改成 50% 和 -60%）
2. 点击"💾 保存预警设置"按钮
3. 应该看到绿色提示："✅ 预警设置已保存！"
4. 刷新页面（F5）
5. 检查阈值是否保持为 50% 和 -60%

### 第四步：测试恢复默认
1. 点击"恢复默认"按钮
2. 应该看到黄色提示
3. 阈值恢复为：
   - 上涨阈值：5%
   - 下跌阈值：-5%
4. 所有开关关闭

### 第五步：打开浏览器控制台
按 `F12` 打开开发者工具，查看 Console 标签页：
- 应该看到："✅ 预警设置从服务器加载"
- 应该看到："✅ 阈值更新为 上限: XX 下限: XX"
- 应该没有红色错误信息

---

## 🔍 对比 V1 和 V2

### 相同点
- 所有功能完全一致
- 使用相同的后端 API
- 使用相同的 JSONL 存储

### 不同点
- **页面标题**：V2 显示"v3.0 - 全新测试版"
- **URL 地址**：V2 使用 `/coin-change-tracker-v2`
- **缓存**：V2 是全新创建，没有旧缓存

---

## 📊 当前保存的设置

根据后端数据，当前最新的设置是：

```json
{
  "upperEnabled": true,
  "lowerEnabled": true,
  "upperThreshold": 30,
  "lowerThreshold": -40,
  "tgEnabled": true,
  "upperTriggered": false,
  "lowerTriggered": false,
  "lastCheckTime": null,
  "timestamp": "2026-02-09T04:51:36.116879"
}
```

**V2 页面打开后应该显示：**
- 上涨阈值：30%（开关打开，绿色）
- 下跌阈值：-40%（开关打开，绿色）
- Telegram 通知：已开启

---

## 🐛 如果还是显示错误的值

### 可能的原因
1. **浏览器缓存**：清除缓存并强制刷新（Ctrl+Shift+R）
2. **JavaScript 加载顺序**：检查控制台是否有错误
3. **API 延迟**：等待 1-2 秒后再检查

### 调试方法
1. 打开 F12 控制台
2. 查看是否有红色错误
3. 查看 Network 标签，确认 `/api/coin-tracker/alert-settings` 请求成功
4. 截图控制台输出，我可以帮您分析

---

## 📁 相关文件

### 后端
- **路由**：`/coin-change-tracker-v2` 在 `app.py`
- **模板**：`templates/coin_change_tracker_v2.html`
- **API**：`/api/coin-tracker/alert-settings`（GET/POST）
- **数据存储**：`data/coin_alert_settings/settings.jsonl`

### 前端
- **JavaScript**：内嵌在 HTML 中
- **样式**：使用 Tailwind CSS
- **图表**：ECharts 5.4.3

---

## 📞 反馈方式

测试完成后，请告诉我：
1. ✅ V2 页面能否正常打开？
2. ✅ 阈值是否正确显示（30% 和 -40%）？
3. ✅ 保存按钮是否有绿色提示？
4. ✅ 刷新后设置是否保持？
5. ❌ 如果有问题，请截图控制台（F12）

---

## 🎉 期望结果

**完美情况下，您应该看到：**
1. V2 页面正常打开，标题显示"v3.0 - 全新测试版"
2. 预警设置面板显示：
   - 上涨阈值：30%（绿色开关）
   - 下跌阈值：-40%（绿色开关）
   - Telegram 通知：已开启
3. 点击保存后，显示绿色提示"✅ 预警设置已保存！"
4. 刷新页面后，设置完全保持不变

**如果 V2 还是有问题，说明不是缓存问题，需要深入排查代码逻辑。**

---

生成时间：2026-02-09  
版本：V2 测试版说明 v1.0
