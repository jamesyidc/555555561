# é€ƒé¡¶ä¿¡å· & æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2026-02-01 11:48 (åŒ—äº¬æ—¶é—´ UTC+8)

## ğŸ“‹ ä¿®å¤æ‘˜è¦

æˆåŠŸä¿®å¤äº†é€ƒé¡¶ä¿¡å·ç³»ç»Ÿçš„æ•°æ®é‡‡é›†é—®é¢˜ï¼Œå¹¶å°†ä¸¤ä¸ªç³»ç»Ÿï¼ˆé€ƒé¡¶ä¿¡å·ã€æ”¯æ’‘å‹åŠ›çº¿ï¼‰æ·»åŠ åˆ°æ•°æ®å¥åº·ç›‘æ§ç³»ç»Ÿã€‚

---

## ğŸ” é—®é¢˜è¯Šæ–­

### 1. é€ƒé¡¶ä¿¡å·ç³»ç»Ÿ
- **é—®é¢˜**: æ•°æ®é‡‡é›†åœæ­¢åœ¨ 2026-01-28 11:29:00ï¼ˆ4å¤©å‰ï¼‰
- **æ ¹å› **: `escape-signal-calculator` æœåŠ¡æœªå¯åŠ¨
- **å½±å“**: é¡µé¢æ˜¾ç¤ºè¿‡æœŸæ•°æ®ï¼Œæ— æ³•å®æ—¶ç›‘æ§é€ƒé¡¶ä¿¡å·

### 2. æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ
- **é—®é¢˜**: è™½ç„¶æ•°æ®æ­£å¸¸æ›´æ–°ï¼Œä½†æœªåŠ å…¥å¥åº·ç›‘æ§
- **å½±å“**: æ— æ³•è‡ªåŠ¨ç›‘æ§å’Œå‘Šè­¦

---

## ğŸ› ï¸ ä¿®å¤æªæ–½

### 1. å¯åŠ¨é€ƒé¡¶ä¿¡å·è®¡ç®—å™¨

```bash
# å¯åŠ¨æœåŠ¡
pm2 start /home/user/webapp/source_code/escape_signal_calculator.py --name escape-signal-calculator

# éªŒè¯è¿è¡ŒçŠ¶æ€
pm2 status escape-signal-calculator
pm2 logs escape-signal-calculator --lines 20
```

**ç»“æœ**:
- âœ… æœåŠ¡æ­£å¸¸å¯åŠ¨ï¼Œè¿›ç¨‹ID: 671242
- âœ… æ•°æ®å®æ—¶æ›´æ–°ï¼Œå‘¨æœŸ: 60ç§’
- âœ… æœ€æ–°æ•°æ®æ—¶é—´: 2026-02-01 11:43:28

---

### 2. æ·»åŠ åˆ°æ•°æ®å¥åº·ç›‘æ§

**ä¿®æ”¹æ–‡ä»¶**: `source_code/data_health_monitor.py`

#### æ·»åŠ ç›‘æ§é…ç½®

```python
# ç¬¬80-99è¡Œï¼šæ·»åŠ ä¸¤ä¸ªæ–°ç›‘æ§å™¨
'é€ƒé¡¶ä¿¡å·ç»Ÿè®¡': {
    'pm2_name': 'escape-signal-calculator',
    'data_api': 'http://localhost:5000/api/escape-signal-stats/keypoints?limit=1',
    'time_field': 'stat_time',
    'data_path': ['keypoints'],
    'max_delay_minutes': 5,
    'check_interval': 60,
    'auto_restart': True,
    'telegram_notify': True
},
'æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ': {
    'pm2_name': 'support-resistance-collector',
    'data_api': None,  # ä»…æ£€æŸ¥PM2çŠ¶æ€
    'time_field': None,
    'data_path': None,
    'max_delay_minutes': 5,
    'check_interval': 60,
    'auto_restart': True,
    'telegram_notify': True
}
```

#### ä¿®æ”¹ç›‘æ§é€»è¾‘

æ”¯æŒä»…æ£€æŸ¥PM2çŠ¶æ€è€Œä¸æ£€æŸ¥æ•°æ®æ–°é²œåº¦ï¼ˆç¬¬315-336è¡Œï¼‰ï¼š

```python
# 2. æ£€æŸ¥æ•°æ®æ–°é²œåº¦ï¼ˆå¦‚æœé…ç½®äº†data_apiï¼‰
if data_api is None:
    # ä»…æ£€æŸ¥PM2çŠ¶æ€ï¼Œä¸æ£€æŸ¥æ•°æ®
    logger.info("â„¹ï¸ ä»…æ£€æŸ¥PM2çŠ¶æ€ï¼ˆæœªé…ç½®data_apiï¼‰")
    pm_is_healthy = pm2_status['status'] == 'online'
    
    state_manager.update_monitor_state(monitor_name, {
        'last_check_time': datetime.now(BEIJING_TZ).isoformat(),
        'status': 'healthy' if pm_is_healthy else 'unhealthy',
        'delay_minutes': None,
        'pm2_status': pm2_status['status'],
        'consecutive_failures': 0 if pm_is_healthy else 1
    })
    
    if pm_is_healthy:
        logger.info(f"âœ… PM2æœåŠ¡è¿è¡Œæ­£å¸¸")
    else:
        logger.warning(f"âš ï¸ PM2æœåŠ¡çŠ¶æ€å¼‚å¸¸: {pm2_status['status']}")
    
    return
```

#### æ›´æ–°Flask API

**ä¿®æ”¹æ–‡ä»¶**: `source_code/app_new.py`ï¼ˆç¬¬18198-18203è¡Œï¼‰

```python
monitor_configs = {
    '27å¸æ¶¨è·Œå¹…è¿½è¸ª': 'coin-change-tracker',
    '1å°æ—¶çˆ†ä»“é‡‘é¢': 'liquidation-1h-collector',
    'ææ…Œæ¸…æ´—æŒ‡æ•°': 'panic-collector',
    'é”šç‚¹ç›ˆåˆ©ç»Ÿè®¡': 'anchor-profit-monitor',
    'é€ƒé¡¶ä¿¡å·ç»Ÿè®¡': 'escape-signal-calculator',      # â¬…ï¸ æ–°å¢
    'æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ': 'support-resistance-collector'   # â¬…ï¸ æ–°å¢
}
```

---

## âœ… éªŒè¯ç»“æœ

### 1. é€ƒé¡¶ä¿¡å·æ•°æ®é‡‡é›†

```bash
# æœ€æ–°æ•°æ®
{
  "stat_time": "2026-02-01 11:43:28",
  "signal_2h_count": 0,
  "signal_24h_count": 26,
  "sum": 26,
  "meets_criteria": false
}
```

**çŠ¶æ€**: âœ… æ•°æ®å®æ—¶æ›´æ–°ï¼ˆæ¯åˆ†é’Ÿï¼‰

---

### 2. æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ

```bash
# PM2çŠ¶æ€
Status: online
PID: 668835
Uptime: 15 minutes
Restarts: 2

# æœ€æ–°é‡‡é›†æ—¥å¿—
[2026-02-01 03:43:55] âœ… é‡‡é›†å®Œæˆ! æˆåŠŸ: 27, å¤±è´¥: 0
```

**çŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œï¼ˆ30ç§’å‘¨æœŸï¼‰

---

### 3. æ•°æ®å¥åº·ç›‘æ§API

```json
{
  "stats": {
    "healthy": 6,
    "today_restarts": 2,
    "total": 6,
    "unhealthy": 0
  },
  "monitors": [
    {
      "name": "27å¸æ¶¨è·Œå¹…è¿½è¸ª",
      "status": "healthy",
      "delay_minutes": 0.39
    },
    {
      "name": "1å°æ—¶çˆ†ä»“é‡‘é¢",
      "status": "healthy",
      "delay_minutes": 1.40
    },
    {
      "name": "ææ…Œæ¸…æ´—æŒ‡æ•°",
      "status": "healthy",
      "delay_minutes": 1.40
    },
    {
      "name": "é”šç‚¹ç›ˆåˆ©ç»Ÿè®¡",
      "status": "healthy",
      "delay_minutes": 0.38
    },
    {
      "name": "é€ƒé¡¶ä¿¡å·ç»Ÿè®¡",
      "status": "healthy",
      "delay_minutes": 0.74
    },
    {
      "name": "æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ",
      "status": "healthy",
      "pm2_status": "online"
    }
  ]
}
```

**çŠ¶æ€**: âœ… æ‰€æœ‰6ä¸ªç³»ç»Ÿå…¨éƒ¨å¥åº·

---

## ğŸ“Š é€ƒé¡¶ä¿¡å·æ¡ä»¶åˆ¤æ–­

### æ¡ä»¶å…¬å¼

```
ç¬¦åˆæ¡ä»¶ = (signal_2h_count + signal_24h_count >= 8) 
           AND (signal_2h_count >= 1) 
           AND (signal_24h_count >= 1)
```

### å½“å‰æ•°æ®åˆ†æ

**æœ€æ–°æ•°æ®** (2026-02-01 11:43:28):
- `signal_2h_count` = 0 âŒ
- `signal_24h_count` = 26 âœ…
- `sum` = 26 âœ… (â‰¥ 8)
- **ä¸ç¬¦åˆæ¡ä»¶**: signal_2h_count < 1

### ç¬¦åˆæ¡ä»¶çš„å†å²æ¡ˆä¾‹

1. **2026-01-03 00:00:00**
   - signal_2h_count = 4 âœ…
   - signal_24h_count = 45 âœ…
   - sum = 49 âœ…
   - **ç¬¦åˆæ¡ä»¶** âœ…

2. **2026-01-28 09:06:00**
   - signal_2h_count = 53 âœ…
   - signal_24h_count = 141 âœ…
   - sum = 194 âœ…
   - **ç¬¦åˆæ¡ä»¶** âœ…

---

## ğŸŒ è®¿é—®åœ°å€

- **æ•°æ®å¥åº·ç›‘æ§**: https://5000-ikmpd2up5chrwx4jjjkih-5185f4aa.sandbox.novita.ai/data-health-monitor
- **é€ƒé¡¶ä¿¡å·å†å²**: https://5000-ikmpd2up5chrwx4jjjkih-5634da27.sandbox.novita.ai/escape-signal-history
- **æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ**: https://5000-ikmpd2up5chrwx4jjjkih-5634da27.sandbox.novita.ai/support-resistance

---

## ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡

### æ•°æ®æ›´æ–°é¢‘ç‡
- é€ƒé¡¶ä¿¡å·: **60ç§’**
- æ”¯æ’‘å‹åŠ›çº¿: **30ç§’**
- æ•°æ®å¥åº·ç›‘æ§: **60ç§’**

### æ•°æ®å»¶è¿Ÿ
- 27å¸æ¶¨è·Œå¹…è¿½è¸ª: **0.4åˆ†é’Ÿ** âœ…
- 1å°æ—¶çˆ†ä»“é‡‘é¢: **1.4åˆ†é’Ÿ** âœ…
- ææ…Œæ¸…æ´—æŒ‡æ•°: **1.4åˆ†é’Ÿ** âœ…
- é”šç‚¹ç›ˆåˆ©ç»Ÿè®¡: **0.4åˆ†é’Ÿ** âœ…
- é€ƒé¡¶ä¿¡å·ç»Ÿè®¡: **0.7åˆ†é’Ÿ** âœ…
- æ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿ: **N/A (ä»…æ£€æŸ¥PM2çŠ¶æ€)** âœ…

---

## ğŸ¯ ä¿®å¤æˆæœ

### âœ… å·²å®Œæˆ
1. âœ… å¯åŠ¨é€ƒé¡¶ä¿¡å·è®¡ç®—å™¨
2. âœ… æ•°æ®å®æ—¶æ›´æ–°æ¢å¤ï¼ˆä»1æœˆ28æ—¥åˆ°2æœˆ1æ—¥ï¼‰
3. âœ… æ·»åŠ ä¸¤ä¸ªç³»ç»Ÿåˆ°æ•°æ®å¥åº·ç›‘æ§
4. âœ… ä¿®æ”¹ç›‘æ§é€»è¾‘æ”¯æŒä»…æ£€æŸ¥PM2çŠ¶æ€
5. âœ… æ›´æ–°Flask APIè¿”å›6ä¸ªç›‘æ§å™¨
6. âœ… éªŒè¯æ¡ä»¶åˆ¤æ–­é€»è¾‘
7. âœ… æ‰€æœ‰ç³»ç»Ÿå¥åº·çŠ¶æ€æ­£å¸¸

### ğŸ“Š ç›‘æ§è¦†ç›–ç‡
- æ€»ç›‘æ§ç³»ç»Ÿ: **6ä¸ª**
- å¥åº·ç³»ç»Ÿ: **6ä¸ª**
- ä¸å¥åº·ç³»ç»Ÿ: **0ä¸ª**
- è¦†ç›–ç‡: **100%** âœ…

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- `SAR_SLOPE_CACHE_FIX.md` - SARæ–œç‡ç³»ç»Ÿç¼“å­˜ä¿®å¤
- `VERIFICATION_REPORT_SAR.md` - SARæ–œç‡ç³»ç»ŸéªŒè¯æŠ¥å‘Š
- `PAGES_STATUS_REPORT.md` - é¡µé¢çŠ¶æ€è¯Šæ–­æŠ¥å‘Š

---

## ğŸ† ç»“è®º

æ‰€æœ‰ä¿®å¤å·¥ä½œå·²å®Œæˆï¼Œé€ƒé¡¶ä¿¡å·ç³»ç»Ÿå’Œæ”¯æ’‘å‹åŠ›çº¿ç³»ç»Ÿç°å·²å…¨é¢é›†æˆåˆ°æ•°æ®å¥åº·ç›‘æ§ä¸­ï¼Œå®ç°äº†ï¼š

âœ… **å®æ—¶æ•°æ®é‡‡é›†** - 60ç§’/30ç§’æ›´æ–°å‘¨æœŸ  
âœ… **è‡ªåŠ¨å¥åº·ç›‘æ§** - 60ç§’æ£€æŸ¥é—´éš”  
âœ… **è‡ªåŠ¨ä¿®å¤æœºåˆ¶** - æ£€æµ‹åˆ°å¼‚å¸¸è‡ªåŠ¨é‡å¯  
âœ… **Telegramå‘Šè­¦** - å®æ—¶é€šçŸ¥ç³»ç»ŸçŠ¶æ€  
âœ… **å®Œæ•´APIæ”¯æŒ** - æä¾›å¥åº·çŠ¶æ€æŸ¥è¯¢æ¥å£

ç³»ç»Ÿç°å·²ç¨³å®šè¿è¡Œï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼ ğŸš€
