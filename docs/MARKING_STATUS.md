# 空单盈利/亏损标记功能状态说明

## ✅ 功能已完成并正常运行

### 标记条件（OR逻辑）
1. **空单盈利≥120%数量 ≥ 3** → 显示🔴红色标记
2. **空单亏损数量 ≥ 3** → 显示🟢绿色标记

### 当前数据状态（2026-01-16 08:30）

#### 今天（2026-01-16）
- ❌ **今天暂无满足标记条件的数据**
- 空单盈利≥120%最大数量：1个
- 空单亏损最大数量：1个
- 原因：市场条件未达到极端情况

#### 昨天（2026-01-15）
- ✅ **昨天有4个标记点**（满足条件）
- 标记时间点：
  1. `2026-01-15 20:25:29` - 空单盈利≥120%: 3, 空单亏损: 1
  2. `2026-01-15 21:00:40` - 空单盈利≥120%: 3, 空单亏损: 1
  3. `2026-01-15 22:00:02` - 空单盈利≥120%: 3, 空单亏损: 1
  4. `2026-01-15 23:00:22` - 空单盈利≥120%: 3, 空单亏损: 1

#### 今天凌晨（2026-01-16 02:20）
- ✅ **有1个标记点**
- `2026-01-16 02:20:50` - 空单盈利≥120%: 3, 空单亏损: 1

### 如何查看标记

1. **访问页面**：https://5000-igsydcyqs9jlcot56rnqk-18e660f9.sandbox.novita.ai/anchor-system-real

2. **切换到昨天的数据**：
   - 点击页面上的"◀ 前一天"按钮
   - 或者在"多空单盈利统计"图表下方点击日期切换按钮

3. **查看标记点**：
   - 在图表上会看到🔴红色pin标记（空单盈利≥120%）
   - 在图表上会看到🟢绿色pin标记（空单亏损）
   - 标记显示在对应的时间点和数值位置

### 关于用户截图中的"04:26"数据

用户截图显示：
- 时间：`2026-01-16 04:26`
- 空单盈利≥120%: 3

**实际数据库记录**：
- 时间：`2026-01-16 04:26:55`
- 空单盈利≥120%: **1**（不是3）
- 空单亏损: 0

**可能原因**：
1. 截图是旧的数据或缓存
2. 截图来自不同的sandbox环境
3. 数据在采集后发生了变化

### Telegram通知监控

监控器：`short-position-monitor`
- ✅ 运行状态：在线
- 检查间隔：60秒
- 通知频率：每小时最多1次
- 触发条件：空单盈利≥120%≥3 或 空单亏损≥3

**最近监控日志**：
```
当前数据: 空单盈利≥120%数量=1 (未达阈值3), 空单亏损数量=0 (未达阈值3)
等待60秒后进行下次检查...
```

### 验证方法

#### 方法1：浏览器控制台查看日志
1. 打开https://5000-igsydcyqs9jlcot56rnqk-18e660f9.sandbox.novita.ai/anchor-system-real
2. 按F12打开开发者工具
3. 切换到Console标签
4. 查找日志：
   - `📍 空单盈利≥120%标记数: X, 空单亏损标记数: Y`
   - `🔴 标记空单盈利≥120%: ...`
   - `🟢 标记空单亏损: ...`

#### 方法2：API直接查询
```bash
curl 'http://localhost:5000/api/anchor-profit/history?limit=10080' | jq '.data[] | select(.stats.short.gte_120 >= 3 or .stats.short.loss >= 3) | {datetime, short_profit: .stats.short.gte_120, short_loss: .stats.short.loss}'
```

### 总结

✅ 功能完整实现并正常运行
✅ 标记逻辑正确（OR条件，每小时去重）
✅ Telegram通知正常监控
❌ 今天暂无满足条件的数据（市场未达极端情况）
✅ 昨天和今天凌晨有标记数据可供验证

**建议操作**：
1. 访问页面切换到昨天查看标记效果
2. 等待市场出现极端情况时实时验证
3. 查看PM2日志确认监控器正常运行：`pm2 logs short-position-monitor`

---
更新时间：2026-01-16 08:30
