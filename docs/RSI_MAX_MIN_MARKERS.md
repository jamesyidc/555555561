# RSI之和曲线最高最低点标记功能

## 📅 更新信息

- **更新日期**: 2026-02-18
- **功能**: 为RSI之和曲线添加最高点和最低点标记
- **Git提交**: `b368e97`

## 🎯 功能说明

在趋势图中，RSI之和曲线现在会自动标记当天的最高点和最低点，便于快速识别RSI的极值位置。

### 标记样式

| 标记类型 | 颜色 | 符号 | 显示内容 |
|---------|------|------|---------|
| **RSI最高点** | 🟣 紫色 (#9333EA) | 📍 Pin | "RSI最高\n[数值]" |
| **RSI最低点** | 🟢 绿色 (#059669) | 📍 Pin | "RSI最低\n[数值]" |

### 视觉效果

- **符号大小**: 50px
- **字体大小**: 12px
- **字体样式**: 加粗
- **标签格式**: 两行显示（标记名称 + 数值）

## 💡 功能亮点

### 1. 智能计算
- 自动从当天所有RSI数据点中计算最高值和最低值
- 过滤null值，仅对有效数据点进行计算
- 实时更新，随着新数据的采集动态调整标记位置

### 2. 视觉一致性
- 与涨跌幅曲线的最高/最低点标记风格一致
- 使用不同颜色区分RSI和涨跌幅的标记
- 清晰的标签显示，避免信息混淆

### 3. 实用价值
- **快速定位**: 一眼看出当天RSI的极值位置
- **趋势判断**: 结合极值位置判断市场强弱
- **时间参考**: 可以看到极值出现的具体时间点

## 📊 示例数据 (2026-02-18)

### 当天RSI数据统计
```
RSI最高点: 1820.72 @ 15:48:08
RSI最低点: 1108.81 @ 15:24:08
RSI振幅: 711.91 (从最低到最高的跨度)
数据点数: 14 (每5分钟采集一次)
```

### 标记位置
- **紫色Pin标记**: 在 15:48:08 时间点，标记 RSI 1820.72（最高点）
- **绿色Pin标记**: 在 15:24:08 时间点，标记 RSI 1108.81（最低点）

## 🔧 技术实现

### 核心代码逻辑

```javascript
markPoint: {
    data: (() => {
        // 计算RSI的最高点和最低点（排除null值）
        const validRsiValues = rsiValues.filter(v => v !== null && v !== undefined);
        if (validRsiValues.length === 0) return [];
        
        let maxRsi = -Infinity;
        let minRsi = Infinity;
        let maxRsiIndex = -1;
        let minRsiIndex = -1;
        
        rsiValues.forEach((value, index) => {
            if (value !== null && value !== undefined) {
                if (value > maxRsi) {
                    maxRsi = value;
                    maxRsiIndex = index;
                }
                if (value < minRsi) {
                    minRsi = value;
                    minRsiIndex = index;
                }
            }
        });
        
        const markPoints = [];
        
        if (maxRsiIndex >= 0) {
            markPoints.push({
                name: 'RSI最高',
                value: maxRsi.toFixed(2),
                xAxis: maxRsiIndex,
                yAxis: maxRsi,
                itemStyle: { color: '#9333EA' },
                label: {
                    formatter: '{b}\n{c}',
                    fontSize: 12,
                    fontWeight: 'bold',
                    color: '#9333EA'
                }
            });
        }
        
        if (minRsiIndex >= 0) {
            markPoints.push({
                name: 'RSI最低',
                value: minRsi.toFixed(2),
                xAxis: minRsiIndex,
                yAxis: minRsi,
                itemStyle: { color: '#059669' },
                label: {
                    formatter: '{b}\n{c}',
                    fontSize: 12,
                    fontWeight: 'bold',
                    color: '#059669'
                }
            });
        }
        
        return markPoints;
    })(),
    symbol: 'pin',
    symbolSize: 50
}
```

### 关键特性

1. **IIFE (立即执行函数)**: 使用 `(() => { ... })()` 在配置时立即计算极值
2. **null值过滤**: 确保只对有效RSI数据进行计算
3. **动态生成**: 每次图表更新时重新计算，保证数据最新
4. **容错处理**: 如果没有有效数据，返回空数组，不显示标记

## 📈 使用场景

### 1. RSI极值分析
- **最高点接近1890**: 市场处于超买状态，警惕回调
- **最低点接近810**: 市场处于超卖状态，关注反弹机会
- **振幅较大**: 市场波动剧烈，情绪变化大

### 2. 时间点分析
- 查看最高/最低点出现的具体时间
- 结合当时的涨跌幅数据，分析市场行为
- 对比不同时间段的RSI变化趋势

### 3. 策略参考
```
当前示例 (2026-02-18):
- RSI最高: 1820.72 (接近超买线1890)
- RSI最低: 1108.81 (处于中性区域)
- 判断: 当天市场从中性转为接近超买，多头力量较强
- 建议: 关注1890超买线，如突破需谨慎追高
```

## 🔄 与涨跌幅标记的对比

### 相同点
- 都使用 Pin 标记
- 都显示具体数值
- 都在图表上直观标注

### 不同点

| 特征 | 涨跌幅标记 | RSI标记 |
|------|----------|---------|
| **颜色** | 红色(最高)、绿色(最低) | 紫色(最高)、绿色(最低) |
| **Y轴** | 左轴 (涨跌幅 %) | 右轴 (RSI 0-2700) |
| **符号大小** | 60px | 50px |
| **数据周期** | 每1分钟 | 每5分钟 |
| **标记名称** | "最高价"、"最低价" | "RSI最高"、"RSI最低" |

## ✅ 部署信息

- **文件修改**: `templates/coin_change_tracker.html`
- **Git提交**: `b368e97 - feat: 为RSI之和曲线添加最高点和最低点标记`
- **Flask应用**: 已重启 (PID 35145)
- **PM2配置**: 已保存
- **功能状态**: ✓ 正常运行

## 🌐 访问地址

https://9002-ixuizzbk8b8iyhwfxb9rl-5634da27.sandbox.novita.ai/coin-change-tracker

## 🎯 验证清单

- [x] RSI最高点正确标记（紫色Pin）
- [x] RSI最低点正确标记（绿色Pin）
- [x] 标记显示正确的RSI数值
- [x] null值被正确过滤
- [x] 标记与数据点位置对齐
- [x] 字体大小和颜色符合设计
- [x] 与涨跌幅标记风格一致

## 💡 后续优化建议

1. **历史对比**
   - 显示历史同期的RSI极值
   - 对比不同日期的RSI振幅

2. **预警功能**
   - RSI突破1890超买线时触发预警
   - RSI跌破810超卖线时触发预警

3. **统计分析**
   - 计算RSI平均值
   - 统计超买/超卖持续时间

4. **交互优化**
   - 鼠标悬停显示更多信息
   - 点击标记跳转到对应时间点的详细数据

## 📞 常见问题

### Q1: 为什么有时候看不到标记？
A: 如果当天RSI数据点较少（刚开盘），或者数据全为null，标记可能不显示。等待5-10分钟后刷新页面。

### Q2: RSI最高点的紫色和涨跌幅最高点的红色会混淆吗？
A: 不会。RSI标记在右侧Y轴，涨跌幅标记在左侧Y轴，位置不同。且标记名称分别为"RSI最高"和"最高价"。

### Q3: 标记数值为什么是两行显示？
A: 第一行显示标记名称（如"RSI最高"），第二行显示具体数值（如"1820.72"），更清晰易读。

### Q4: 标记会随着新数据更新吗？
A: 是的。每次图表更新（每分钟自动刷新或用户手动刷新）时，标记位置和数值会重新计算。

## 🎉 总结

为RSI之和曲线添加最高最低点标记，进一步提升了系统的可视化能力和分析价值。用户现在可以：

1. **快速识别**: 一眼看出当天RSI的极值位置
2. **趋势判断**: 结合极值判断市场强弱和超买超卖状态
3. **时间分析**: 查看极值出现的具体时间点
4. **组合分析**: 与涨跌幅的极值标记配合，多维度分析市场

这个功能与V2.2版本的其他功能（RSI卡片、BTC状态框）形成完整的RSI分析体系，为用户提供全面的市场状态判断工具。

---

**更新日期**: 2026-02-18  
**作者**: GenSpark AI Developer  
**版本**: V2.2.1
