# é”šç‚¹ç³»ç»Ÿæå€¼ç›‘æ§JSONLåŒ–æ”¹é€ æŠ¥å‘Š

## ğŸ“‹ æ”¹é€ æ¦‚è§ˆ

**æ”¹é€ æ—¶é—´**: 2026-01-14 15:35  
**æ”¹é€ ç±»å‹**: æ•°æ®å­˜å‚¨æ–¹å¼å‡çº§  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶ä¸Šçº¿

---

## ğŸ¯ æ”¹é€ ç›®æ ‡

### åŸéœ€æ±‚
1. å°†æå€¼æ•°æ®ä»æ•°æ®åº“è½¬å­˜åˆ°JSONL
2. æ‰€æœ‰è¯»å–å’Œå†™å…¥éƒ½è½¬ç§»åˆ°JSONL
3. å®æ—¶ç›‘æ§ä¸»è´¦å·ç›ˆäºï¼Œè‡ªåŠ¨æ›´æ–°æå€¼
4. åˆ›æ–°é«˜/æ–°ä½æ—¶å‘é€Telegramé€šçŸ¥

### å®ç°ç›®æ ‡
- âœ… å®Œå…¨åŸºäºJSONLçš„æ•°æ®å­˜å‚¨
- âœ… å®æ—¶ç›‘æ§ï¼ˆæ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
- âœ… è‡ªåŠ¨æå€¼æ›´æ–°
- âœ… Telegramå³æ—¶é€šçŸ¥
- âœ… æ”¯æŒè‡ªåŠ¨å¤‡ä»½

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ•°æ®å­˜å‚¨æ”¹é€ 

#### ä¹‹å‰ï¼šæ•°æ®åº“å­˜å‚¨
```python
# ä»æ•°æ®åº“è¯»å–
cursor.execute("SELECT * FROM anchor_real_profit_records")

# å†™å…¥æ•°æ®åº“
cursor.execute("INSERT INTO anchor_real_profit_records VALUES ...")
```

#### ç°åœ¨ï¼šJSONLå­˜å‚¨
```python
# ä»JSONLè¯»å–
with open('data/extreme_jsonl/extreme_real.jsonl', 'r') as f:
    for line in f:
        record = json.loads(line)

# å†™å…¥JSONL
with open('data/extreme_jsonl/extreme_real.jsonl', 'w') as f:
    for record in records:
        f.write(json.dumps(record, ensure_ascii=False) + '\n')
```

**ä¼˜åŠ¿**:
- æ— éœ€æ•°æ®åº“ä¾èµ–
- æ–‡ä»¶æ ¼å¼ç®€å•ï¼Œæ˜“äºå¤‡ä»½å’Œæ¢å¤
- æ”¯æŒæµå¼è¯»å–ï¼Œå†…å­˜æ•ˆç‡é«˜
- è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

### 2. æ ¸å¿ƒç»„ä»¶

#### ExtremeMonitorJSONL ç±»
```python
source_code/extreme_monitor_jsonl.py
```

**ä¸»è¦åŠŸèƒ½**:
- è¯»å–/å†™å…¥JSONLæå€¼æ•°æ®
- ä»OKEx APIè·å–å®æ—¶æŒä»“
- è®¡ç®—å½“å‰ç›ˆäºç‡
- å¯¹æ¯”å†å²æå€¼ï¼Œæ£€æµ‹åˆ›æ–°é«˜/æ–°ä½
- å‘é€Telegramé€šçŸ¥

**å…³é”®æ–¹æ³•**:
```python
read_all_extremes()           # è¯»å–æ‰€æœ‰æå€¼è®°å½•
write_all_extremes(records)   # å†™å…¥æ‰€æœ‰æå€¼è®°å½•
get_extreme(inst_id, pos_side, record_type)  # è·å–ç‰¹å®šæå€¼
update_extreme(...)           # æ›´æ–°æå€¼è®°å½•
check_and_update_extreme()    # æ£€æŸ¥å¹¶æ›´æ–°æå€¼
send_telegram_notification()  # å‘é€TGé€šçŸ¥
```

### 3. ç›‘æ§é€»è¾‘

#### æ•°æ®æµç¨‹
```
æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡:
1. ä»OKEx APIè·å–ä¸»è´¦å·æ‰€æœ‰æŒä»“
2. éå†æ¯ä¸ªæŒä»“:
   a. è®¡ç®—å½“å‰ç›ˆäºç‡ = (æœªå®ç°ç›ˆäº / ä¿è¯é‡‘) Ã— 100%
   b. è¯»å–è¯¥å¸ç§è¯¥æ–¹å‘çš„å†å²æå€¼
   c. åˆ¤æ–­æ˜¯å¦åˆ›æ–°é«˜/æ–°ä½:
      - ç›ˆåˆ©ç‡ > 0 ä¸” å¤§äºå†å²æœ€å¤§ç›ˆåˆ© â†’ åˆ›æ–°é«˜
      - ç›ˆåˆ©ç‡ < 0 ä¸” å°äºå†å²æœ€å¤§äºæŸ â†’ åˆ›æ–°ä½
   d. å¦‚æœè¾¾åˆ°æå€¼ï¼Œæ›´æ–°JSONLå¹¶å‘é€é€šçŸ¥
3. ç­‰å¾…60ç§’ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
```

#### æå€¼åˆ¤æ–­é€»è¾‘
```python
# åˆ›æ–°é«˜åˆ¤æ–­ï¼ˆä»…é’ˆå¯¹ç›ˆåˆ©ï¼‰
if current_profit_rate > 0:
    if current_max_profit is None or current_profit_rate > current_max_profit:
        update_extreme(..., 'max_profit', ...)
        send_telegram_notification(...)

# åˆ›æ–°ä½åˆ¤æ–­ï¼ˆä»…é’ˆå¯¹äºæŸï¼‰
elif current_profit_rate < 0:
    if current_max_loss is None or current_profit_rate < current_max_loss:
        update_extreme(..., 'max_loss', ...)
        send_telegram_notification(...)
```

### 4. Telegramé€šçŸ¥æ ¼å¼

```
ğŸ‰ é”šç‚¹ç³»ç»Ÿæå€¼æé†’ ğŸ‰

ğŸ“Š å¸ç§: CFX-USDT-SWAP
ğŸŸ¢ æ–¹å‘: åšå¤š
ğŸ”” ç±»å‹: æœ€å¤§ç›ˆåˆ©åˆ›æ–°é«˜

ğŸ’° å½“å‰ç›ˆäºç‡: +185.23%
ğŸ“ˆ å˜åŒ–å¹…åº¦: +2.64%

ğŸ“Œ æŒä»“è¯¦æƒ…:
  â€¢ æŒä»“é‡: 428
  â€¢ å¼€ä»“ä»·: 0.0698
  â€¢ æ ‡è®°ä»·: 0.0723
  â€¢ æœªå®ç°ç›ˆäº: 107.00 USDT
  â€¢ ä¿è¯é‡‘: 29.95 USDT
  â€¢ æ æ†: 10x

ğŸ• æ›´æ–°æ—¶é—´: 2026-01-14 15:35:42
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶
```bash
source_code/
  â””â”€â”€ extreme_monitor_jsonl.py   # æå€¼ç›‘æ§è„šæœ¬ï¼ˆä¸»ç¨‹åºï¼‰

data/extreme_jsonl/
  â””â”€â”€ extreme_real.jsonl         # å®ç›˜æå€¼æ•°æ®
  â””â”€â”€ extreme_real.jsonl.backup_* # è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶

test_extreme_monitor.py          # æµ‹è¯•è„šæœ¬
```

### JSONLæ•°æ®æ ¼å¼
```json
{
  "inst_id": "CFX-USDT-SWAP",
  "pos_side": "long",
  "record_type": "max_profit",
  "profit_rate": 182.59,
  "timestamp": "2026-01-14 15:35:42",
  "pos_size": 428.0,
  "avg_price": 0.06998,
  "mark_price": 0.07016,
  "upl": 0.7704,
  "margin": 29.95144,
  "leverage": 10,
  "created_at": "2026-01-14 15:08:56",
  "updated_at": "2026-01-14 15:35:42"
}
```

---

## ğŸš€ éƒ¨ç½²è¿è¡Œ

### 1. å¯åŠ¨ç›‘æ§å™¨
```bash
cd /home/user/webapp
pm2 start source_code/extreme_monitor_jsonl.py \
  --name extreme-monitor \
  --interpreter python3 \
  --log logs/extreme_monitor.log \
  --error logs/extreme_monitor_error.log
```

### 2. æŸ¥çœ‹çŠ¶æ€
```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 status extreme-monitor

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs extreme-monitor --lines 50

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 describe extreme-monitor
```

### 3. ç®¡ç†å‘½ä»¤
```bash
# é‡å¯
pm2 restart extreme-monitor

# åœæ­¢
pm2 stop extreme-monitor

# åˆ é™¤
pm2 delete extreme-monitor
```

---

## âœ… åŠŸèƒ½éªŒè¯

### 1. æµ‹è¯•è„šæœ¬éªŒè¯
```bash
cd /home/user/webapp
python3 test_extreme_monitor.py
```

**æµ‹è¯•ç»“æœ**:
```
âœ… åˆ›æ–°é«˜æ£€æµ‹æ­£å¸¸
âœ… åˆ›æ–°ä½æ£€æµ‹æ­£å¸¸
âœ… JSONLè¯»å†™æ­£å¸¸
âœ… Telegramé€šçŸ¥å‘é€æˆåŠŸ
```

### 2. APIéªŒè¯
```bash
# æŸ¥è¯¢æ‰€æœ‰æå€¼è®°å½•
curl "http://localhost:5000/api/anchor-system/profit-records?trade_mode=real"

# æŸ¥è¯¢ç‰¹å®šå¸ç§
curl "http://localhost:5000/api/anchor-system/profit-records?trade_mode=real&inst_id=CFX-USDT-SWAP"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "records": [
    {
      "inst_id": "CFX-USDT-SWAP",
      "pos_side": "long",
      "record_type": "max_profit",
      "profit_rate": 182.59,
      "timestamp": "2026-01-14 15:08:56"
    }
  ],
  "total": 1,
  "trade_mode": "real",
  "data_source": "JSONL"
}
```

### 3. ç›‘æ§è¿è¡ŒéªŒè¯
```bash
# æŸ¥çœ‹ç›‘æ§æ—¥å¿—
tail -f logs/extreme_monitor.log

# é¢„æœŸè¾“å‡º:
[2026-01-14 15:35:42] ğŸš€ æå€¼ç›‘æ§å™¨å¯åŠ¨ï¼ˆJSONLæ¨¡å¼ï¼‰
[2026-01-14 15:35:42] ğŸ”„ ç›‘æ§å¾ªç¯å¯åŠ¨ï¼Œæ£€æŸ¥é—´éš”: 60ç§’
[2026-01-14 15:35:42] ğŸ” å¼€å§‹æ£€æŸ¥æå€¼...
[2026-01-14 15:35:45] ğŸ“Š è·å–åˆ° 24 ä¸ªæŒä»“
[2026-01-14 15:35:45] âœ… æœ¬æ¬¡æ£€æŸ¥å®Œæˆ
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
- æ¯æ¬¡å†™å…¥JSONLå‰è‡ªåŠ¨å¤‡ä»½
- å¤‡ä»½æ–‡ä»¶å‘½åæ ¼å¼: `extreme_real.jsonl.backup_YYYYMMDD_HHMMSS`
- ä¿ç•™æ‰€æœ‰å†å²å¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±

### 2. å†…å­˜ä¼˜åŒ–
- ä½¿ç”¨æµå¼è¯»å–ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
- åªåœ¨éœ€è¦æ—¶è¯»å–æ–‡ä»¶ï¼Œä¸å¸¸é©»å†…å­˜
- å®šæœŸæ¸…ç†è¿‡æœŸå¤‡ä»½ï¼ˆæ‰‹åŠ¨ï¼‰

### 3. å¹¶å‘å®‰å…¨
- å•è¿›ç¨‹è¿è¡Œï¼Œé¿å…å¹¶å‘å†™å…¥å†²çª
- å†™å…¥æ—¶å…ˆå¤‡ä»½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
- ä½¿ç”¨æ–‡ä»¶é”ï¼ˆTODO: æœªæ¥å¯ä»¥æ·»åŠ ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Telegramé…ç½®
éœ€è¦é…ç½®æ–‡ä»¶: `configs/telegram_config.json`
```json
{
  "bot_token": "YOUR_BOT_TOKEN",
  "chat_id": "YOUR_CHAT_ID",
  "api_base_url": "https://api.telegram.org"
}
```

### 2. OKEx APIé…ç½®
éœ€è¦é…ç½®æ–‡ä»¶: `configs/okex_config.json`
```json
{
  "api_key": "YOUR_API_KEY",
  "secret_key": "YOUR_SECRET_KEY",
  "passphrase": "YOUR_PASSPHRASE"
}
```

### 3. æ•°æ®å¤‡ä»½
- å»ºè®®å®šæœŸå¤‡ä»½ `data/extreme_jsonl/` ç›®å½•
- å¯ä»¥ä½¿ç”¨ `rsync` æˆ– `cp` å‘½ä»¤
- å¤‡ä»½é¢‘ç‡: æ¯å¤©æˆ–æ¯å‘¨

### 4. ç›‘æ§å‘Šè­¦
- å¦‚æœç›‘æ§å™¨åœæ­¢è¿è¡Œï¼ŒæŒä»“å°†ä¸ä¼šè¢«ç›‘æ§
- å»ºè®®é…ç½®PM2è‡ªåŠ¨é‡å¯ï¼š`pm2 startup`
- å¯ä»¥é…ç½®é‚®ä»¶/çŸ­ä¿¡å‘Šè­¦

---

## ğŸ”„ åç»­ä¼˜åŒ–è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
- [ ] æ·»åŠ æ–‡ä»¶é”ï¼Œç¡®ä¿å¹¶å‘å®‰å…¨
- [ ] å®ç°æ•°æ®å‹ç¼©ï¼Œå‡å°‘å­˜å‚¨ç©ºé—´
- [ ] æ·»åŠ æå€¼å†å²è¶‹åŠ¿å›¾è¡¨
- [ ] æ”¯æŒè‡ªå®šä¹‰ç›‘æ§é—´éš”

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
- [ ] å®ç°æå€¼é¢„è­¦ï¼ˆæ¥è¿‘å†å²æå€¼æ—¶æå‰é€šçŸ¥ï¼‰
- [ ] æ·»åŠ æå€¼ç»Ÿè®¡åˆ†æåŠŸèƒ½
- [ ] æ”¯æŒå¤šè´¦å·ç›‘æ§
- [ ] Webç•Œé¢æŸ¥çœ‹æå€¼å†å²

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰
- [ ] æœºå™¨å­¦ä¹ é¢„æµ‹æå€¼
- [ ] æå€¼é£é™©è¯„ä¼°ç³»ç»Ÿ
- [ ] è‡ªåŠ¨æ­¢ç›ˆæ­¢æŸå»ºè®®
- [ ] æå€¼å›æµ‹åŠŸèƒ½

---

## ğŸ“ˆ ç›‘æ§æ•°æ®ç»Ÿè®¡

### å½“å‰çŠ¶æ€
```bash
æ–‡ä»¶è·¯å¾„: data/extreme_jsonl/extreme_real.jsonl
æ–‡ä»¶å¤§å°: ~27KB
è®°å½•æ•°é‡: 81æ¡ï¼ˆ24ä¸ªå¸ç§ Ã— å¹³å‡3.4æ¡/å¸ç§ï¼‰
ç›‘æ§é—´éš”: 60ç§’
Telegramé€šçŸ¥: âœ… æ­£å¸¸
PM2çŠ¶æ€: online
è¿è¡Œæ—¶é—´: å®æ—¶ç»Ÿè®¡
```

### æ•°æ®å¢é•¿é¢„ä¼°
```
å‡è®¾å¹³å‡æ¯å¤©æ›´æ–°3ä¸ªæå€¼:
- 1ä¸ªæœˆ: 81 + 90 = 171æ¡
- 3ä¸ªæœˆ: 81 + 270 = 351æ¡
- 1å¹´: 81 + 1095 = 1176æ¡

æ–‡ä»¶å¤§å°å¢é•¿:
- 1ä¸ªæœˆ: ~56KB
- 3ä¸ªæœˆ: ~115KB
- 1å¹´: ~385KB
```

---

## ğŸ“ Gitæäº¤è®°å½•

```bash
Commit: [å¾…æäº¤]
Message: feat: æå€¼ç›‘æ§JSONLåŒ–æ”¹é€ 

- å°†æå€¼æ•°æ®å­˜å‚¨ä»æ•°æ®åº“è¿ç§»åˆ°JSONL
- å®ç°å®æ—¶ç›‘æ§ï¼Œæ¯åˆ†é’Ÿæ£€æŸ¥ä¸»è´¦å·ç›ˆäº
- è‡ªåŠ¨æ£€æµ‹åˆ›æ–°é«˜/æ–°ä½å¹¶æ›´æ–°æå€¼
- åˆ›æ–°æå€¼æ—¶å‘é€Telegramé€šçŸ¥
- æ·»åŠ è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
- APIå®Œå…¨åŸºäºJSONLè¯»å†™
- æ·»åŠ æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½

æŠ€æœ¯æ ˆ:
- Python 3 + JSONL
- OKEx API
- Telegram Bot API
- PM2è¿›ç¨‹ç®¡ç†

æ–‡ä»¶:
- source_code/extreme_monitor_jsonl.py (æ–°å¢)
- test_extreme_monitor.py (æ–°å¢)
- data/extreme_jsonl/extreme_real.jsonl (æ•°æ®æ–‡ä»¶)
```

---

## ğŸ¯ æ€»ç»“

### æ”¹é€ æˆæœ
1. âœ… å®Œæˆæ•°æ®åº“åˆ°JSONLçš„è¿ç§»
2. âœ… å®ç°å®æ—¶æå€¼ç›‘æ§
3. âœ… é›†æˆTelegramå³æ—¶é€šçŸ¥
4. âœ… å»ºç«‹è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
5. âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

### å…³é”®ä¼˜åŠ¿
- **ç®€å•**: æ— éœ€æ•°æ®åº“ï¼Œä»…æ–‡ä»¶æ“ä½œ
- **å¯é **: è‡ªåŠ¨å¤‡ä»½ï¼Œæ•°æ®å®‰å…¨
- **å®æ—¶**: æ¯åˆ†é’Ÿæ£€æŸ¥ï¼ŒåŠæ—¶é€šçŸ¥
- **çµæ´»**: JSONLæ ¼å¼æ˜“äºæ‰©å±•

### ç¨³å®šæ€§ä¿éšœ
- PM2è‡ªåŠ¨é‡å¯
- å¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•
- è‡ªåŠ¨å¤‡ä»½é˜²æ­¢æ•°æ®ä¸¢å¤±
- Telegramé€šçŸ¥ç¡®ä¿åŠæ—¶å“åº”

---

**æ”¹é€ å®Œæˆæ—¶é—´**: 2026-01-14 15:40  
**çŠ¶æ€**: âœ… å·²ä¸Šçº¿è¿è¡Œ  
**è´Ÿè´£äºº**: AI Assistant
