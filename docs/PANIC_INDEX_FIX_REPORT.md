# ææ…Œæ¸…æ´—æŒ‡æ•°æ•°æ®æ˜¾ç¤ºä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
**æ—¥æœŸ**: 2026-02-07  
**é—®é¢˜**: ææ…Œæ¸…æ´—æŒ‡æ•°é¡µé¢æ˜¾ç¤ºæ‰€æœ‰æ•°æ®ä¸º0ï¼Œä½†é‡‡é›†å™¨æ­£å¸¸è¿è¡Œ

## åŸå› åˆ†æ

### æ•°æ®æµæ–­è£‚
```
é‡‡é›†å™¨ â†’ SQLiteæ•°æ®åº“ âœ“
é‡‡é›†å™¨ â†’ JSONLæ–‡ä»¶ âœ— (ç¼ºå¤±)
APIè¯»å– â† JSONLæ–‡ä»¶ (æ—§æ•°æ®/ç©ºæ•°æ®)
```

### å…³é”®é—®é¢˜
1. **æ•°æ®æºä¸ä¸€è‡´**: é‡‡é›†å™¨åªå†™å…¥SQLiteï¼ŒAPIä»JSONLè¯»å–
2. **è·¯å¾„é”™è¯¯**: APIä½¿ç”¨ `/home/user/webapp` è€Œä¸æ˜¯ `/home/user/webapp/source_code`
3. **æ•°æ®å­—æ®µæå–é”™è¯¯**: æœªæ­£ç¡®æå– `data` å­—æ®µ

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹é‡‡é›†å™¨åŒå†™æœºåˆ¶
**æ–‡ä»¶**: `source_code/panic_wash_collector.py`

æ·»åŠ JSONLå†™å…¥é€»è¾‘ï¼š
```python
def save_data(self, data):
    # 1. ä¿å­˜åˆ°SQLiteæ•°æ®åº“
    conn.execute(INSERT INTO panic_wash_index ...)
    
    # 2. ä¿å­˜åˆ°JSONLæ–‡ä»¶ï¼ˆä½¿ç”¨PanicDailyManagerï¼‰
    from panic_daily_manager import PanicDailyManager
    manager = PanicDailyManager()
    
    # è½¬æ¢æ•°æ®å•ä½
    panic_data = {
        'hour_1_amount': data['hour_1_amount'] / 10000,      # ç¾å…ƒ -> ä¸‡ç¾å…ƒ
        'hour_24_amount': data['hour_24_amount'] / 10000,    # ç¾å…ƒ -> ä¸‡ç¾å…ƒ
        'hour_24_people': data['hour_24_people'] / 10000,    # äºº -> ä¸‡äºº
        'total_position': data['total_position'] / 100000000, # ç¾å…ƒ -> äº¿ç¾å…ƒ
        'panic_index': data['panic_index'],                   # ä¿æŒç™¾åˆ†æ¯”
        ...
    }
    manager.write_panic_record(panic_data)
```

### 2. ä¿®å¤APIè·¯å¾„å’Œæ•°æ®æå–
**æ–‡ä»¶**: `app.py`

**ä¿®æ”¹å‰**:
```python
sys.path.insert(0, '/home/user/webapp')
panic_index = latest.get('panic_index', 0)
```

**ä¿®æ”¹å**:
```python
sys.path.insert(0, '/home/user/webapp/source_code')
data = latest.get('data', {})
panic_index = data.get('panic_index', 0)
```

## æ•°æ®å•ä½å¯¹ç…§è¡¨

| å­—æ®µ | åŸå§‹API | æ•°æ®åº“å­˜å‚¨ | JSONLå­˜å‚¨ | å‰ç«¯æ˜¾ç¤º |
|------|---------|-----------|----------|---------|
| hour_1_amount | $4,208,894.60 | 4208894.60 | 420.89 | 420.89ä¸‡ç¾å…ƒ |
| hour_24_amount | $376,626,557.69 | 376626557.69 | 37662.66 | 37662.66ä¸‡ç¾å…ƒ (3.7663äº¿) |
| hour_24_people | 106,985äºº | 106985 | 10.7 | 10.7ä¸‡äºº |
| total_position | $6,179,783,353.18 | 6179783353.18 | 61.77 | 61.77äº¿ç¾å…ƒ |
| panic_index | è®¡ç®—ç»“æœ | 17.32 | 17.32 | 17.32% |

## éªŒè¯ç»“æœ

### APIæµ‹è¯•
```bash
$ curl http://localhost:5000/api/panic/latest
{
  "success": true,
  "data": {
    "record_time": "2026-02-07 09:59:49",
    "panic_index": 17.32,
    "panic_level": "é«˜åº¦ææ…Œ",
    "level_color": "red",
    "hour_1_amount": 420.9,
    "hour_24_amount": 37662.66,
    "hour_24_people": 10.7,
    "total_position": 61.77,
    "market_zone": "10.7ä¸‡äºº/61.77äº¿ç¾å…ƒ"
  }
}
```

### JSONLæ–‡ä»¶éªŒè¯
```bash
$ tail -1 data/panic_daily/panic_20260207.jsonl
{
  "type": "panic",
  "timestamp": "2026-02-07T09:59:00+08:00",
  "time": "09:59:00",
  "data": {
    "record_time": "2026-02-07 09:59:49",
    "panic_index": 17.32,
    "hour_1_amount": 420.9,
    "hour_24_amount": 37662.66,
    "hour_24_people": 10.7,
    "total_position": 61.77
  }
}
```

### é‡‡é›†å™¨æ—¥å¿—
```
2026-02-07 09:59:49 - INFO - ğŸ’¾ æ•°æ®ä¿å­˜æˆåŠŸ: 2026-02-07 09:59:49
2026-02-07 09:59:49 - INFO - ğŸ“„ JSONLæ•°æ®ä¿å­˜æˆåŠŸ: 2026-02-07 09:59:49
2026-02-07 09:59:49 - INFO - âœ… æœ¬æ¬¡é‡‡é›†æˆåŠŸï¼
```

## å‰ç«¯æ˜¾ç¤ºæ•ˆæœ

### ææ…Œæ¸…æ´—æŒ‡æ•°å¡ç‰‡
- **æŒ‡æ•°**: 17.32% âœ“
- **ç­‰çº§**: é«˜åº¦ææ…Œï¼ˆçº¢è‰²ï¼‰âœ“
- **æ›´æ–°æ—¶é—´**: 2026-02-07 09:59:49 âœ“

### å„é¡¹æ•°æ®å¡ç‰‡
- **1å°æ—¶çˆ†ä»“é‡‘é¢**: $420.9ä¸‡ç¾å…ƒ âœ“
- **24å°æ—¶çˆ†ä»“é‡‘é¢**: $37662.66ä¸‡ç¾å…ƒ âœ“
- **24å°æ—¶çˆ†ä»“äººæ•°**: 10.7ä¸‡äºº âœ“
- **å…¨ç½‘æŒä»“é‡**: $61.77äº¿ç¾å…ƒ âœ“

### è‡ªåŠ¨æ›´æ–°
- **é‡‡é›†é¢‘ç‡**: æ¯3åˆ†é’Ÿ âœ“
- **å‰ç«¯åˆ·æ–°**: æ¯10ç§’ âœ“
- **æ•°æ®å»¶è¿Ÿ**: < 3åˆ†é’Ÿ âœ“

## æŠ€æœ¯ç»†èŠ‚

### ææ…ŒæŒ‡æ•°è®¡ç®—å…¬å¼
```
ææ…ŒæŒ‡æ•° = (24å°æ—¶çˆ†ä»“äººæ•°(ä¸‡äºº) / å…¨ç½‘æŒä»“é‡(äº¿ç¾å…ƒ)) Ã— 100%
        = (10.7 / 61.77) Ã— 100%
        = 17.32%
```

### ç­‰çº§åˆ¤å®š
- **ä½ææ…Œ** (ç»¿è‰²): < 5%
- **ä¸­åº¦ææ…Œ** (é»„è‰²): 5% ~ 10%
- **é«˜åº¦ææ…Œ** (çº¢è‰²): â‰¥ 10%

### æ•°æ®é‡‡é›†å‘¨æœŸ
- **çˆ†ä»“æ•°æ®**: å®æ—¶API
- **æŒä»“æ•°æ®**: å®æ—¶API
- **é‡‡é›†é—´éš”**: 180ç§’ï¼ˆ3åˆ†é’Ÿï¼‰
- **å­˜å‚¨æ–¹å¼**: SQLite + æŒ‰æ—¥åˆ†åŒºJSONL

## ç³»ç»ŸçŠ¶æ€

### PM2è¿›ç¨‹
```
panic-wash-collector   | online | âœ“ æ­£å¸¸è¿è¡Œ
flask-app              | online | âœ“ æ­£å¸¸å“åº”
```

### æ•°æ®æ–‡ä»¶
```
data/panic_daily/panic_20260207.jsonl  | 168K | âœ“ æŒç»­å¢é•¿
crypto_data.db                          | 56K  | âœ“ SQLiteå¤‡ä»½
```

### APIç«¯ç‚¹
```
/api/panic/latest           | âœ“ æ­£å¸¸
/api/panic/history          | âœ“ æ­£å¸¸
/panic                      | âœ“ å‰ç«¯æ­£å¸¸
```

## è®¿é—®åœ°å€
https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/panic

## Gitæäº¤
```
commit 54dace4
fix: ä¿®å¤ææ…Œæ¸…æ´—æŒ‡æ•°æ•°æ®é‡‡é›†å’ŒAPI

- ä¿®æ”¹é‡‡é›†å™¨åŒæ—¶å†™å…¥SQLiteå’ŒJSONLæ–‡ä»¶
- ä¿®æ­£æ•°æ®å•ä½è½¬æ¢ï¼šåŸå§‹ç¾å…ƒ -> ä¸‡ç¾å…ƒ/äº¿ç¾å…ƒ
- ä¿®å¤APIè·¯å¾„å’Œæ•°æ®å­—æ®µæå–
- å®æ—¶æ•°æ®ç°åœ¨å¯ä»¥æ­£å¸¸æ˜¾ç¤º
```

## æ€»ç»“
âœ… **ä¿®å¤å®Œæˆ**: ææ…Œæ¸…æ´—æŒ‡æ•°æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºå·²å®Œå…¨æ¢å¤  
âœ… **æ•°æ®å‡†ç¡®**: æ‰€æœ‰å•ä½è½¬æ¢å’Œæ•°å€¼è®¡ç®—æ­£ç¡®  
âœ… **ç³»ç»Ÿç¨³å®š**: é‡‡é›†å™¨å’ŒAPIæŒç»­æ­£å¸¸è¿è¡Œ  
âœ… **ç”¨æˆ·ä½“éªŒ**: å‰ç«¯å®æ—¶æ›´æ–°ï¼Œæ•°æ®å®Œæ•´æ¸…æ™°  

---
**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-02-07 10:02:00 (åŒ—äº¬æ—¶é—´)  
**çŠ¶æ€**: ğŸŸ¢ 100%æ­£å¸¸è¿è¡Œ
