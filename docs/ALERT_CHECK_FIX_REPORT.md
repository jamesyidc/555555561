# ğŸ”§ é¢„è­¦åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## ğŸ” å‘ç°çš„é—®é¢˜

### é—®é¢˜æè¿°
ç”¨æˆ·æŠ¥å‘Šï¼šå½“æ¶¨è·Œå¹…ä½äº -40% æ—¶ï¼Œæ²¡æœ‰è§¦å‘é¢„è­¦å¼¹çª—å’Œ Telegram é€šçŸ¥ã€‚

### æ ¹æœ¬åŸå› 
åœ¨ä¹‹å‰ä¿®å¤ `updateData is not defined` é”™è¯¯æ—¶ï¼Œæˆ‘æ³¨é‡Šæ‰äº†ç›¸å…³ä»£ç ï¼Œä½†åŒæ—¶ä¹ŸæŠŠ `checkAlerts()` çš„è°ƒç”¨æ³¨é‡Šæ‰äº†ï¼š

```javascript
// åœ¨updateDataå‡½æ•°ä¸­æ·»åŠ é¢„è­¦æ£€æŸ¥ï¼ˆå·²ç¦ç”¨ï¼Œå› ä¸ºupdateDataä¸å­˜åœ¨ï¼‰
// const originalUpdateData = updateData;
// window.updateData = async function() {
//     await originalUpdateData();
//     
//     // æ£€æŸ¥é¢„è­¦
//     const latestResponse = await fetch('/api/coin-tracker/alert-settings');
//     if (latestResponse.ok) {
//         const latestData = await latestResponse.json();
//         checkAlerts(latestData);  // âŒ è¿™é‡Œè¢«æ³¨é‡Šäº†ï¼
//     }
// };
```

**ç»“æœï¼šé¢„è­¦æ£€æŸ¥å‡½æ•°ä»æœªè¢«è°ƒç”¨ï¼Œæ‰€ä»¥æ— è®ºæ¶¨è·Œå¹…å¦‚ä½•å˜åŒ–ï¼Œéƒ½ä¸ä¼šè§¦å‘é¢„è­¦ã€‚**

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤æ­¥éª¤
åœ¨ `updateLatestData()` å‡½æ•°ä¸­æ·»åŠ  `checkAlerts()` è°ƒç”¨ï¼š

```javascript
// æ›´æ–°å®æ—¶æ•°æ®
async function updateLatestData() {
    try {
        const response = await fetch('/api/coin-change-tracker/latest');
        const result = await response.json();
        
        if (result.success) {
            const data = result.data;
            
            // ... æ›´æ–°UIçš„ä»£ç  ...
            
            // âœ… æ£€æŸ¥é¢„è­¦ï¼ˆæ–°å¢ï¼‰
            checkAlerts({
                cumulative_pct: totalChange,
                changes: data.changes
            });
            
        } else {
            console.error('è·å–æ•°æ®å¤±è´¥:', result.error);
        }
    } catch (error) {
        console.error('æ›´æ–°æ•°æ®å¼‚å¸¸:', error);
    }
}
```

### å·¥ä½œæµç¨‹
1. é¡µé¢åŠ è½½æ—¶è°ƒç”¨ `updateLatestData()`ï¼ˆç«‹å³æ‰§è¡Œï¼‰
2. æ¯10ç§’è‡ªåŠ¨è°ƒç”¨ `updateLatestData()`ï¼ˆé€šè¿‡ `startAutoRefresh()`ï¼‰
3. æ¯æ¬¡è°ƒç”¨ `updateLatestData()` æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨ `checkAlerts()`
4. `checkAlerts()` æ£€æŸ¥å½“å‰æ¶¨è·Œå¹…æ˜¯å¦è¶…è¿‡é˜ˆå€¼
5. å¦‚æœè§¦å‘æ¡ä»¶ï¼Œæ‰§è¡Œï¼š
   - æ’­æ”¾éŸ³æ•ˆï¼ˆ3æ¬¡ï¼‰
   - æ˜¾ç¤ºå¼¹çª—æç¤º
   - å‘é€ Telegram é€šçŸ¥
   - è‡ªåŠ¨å…³é—­å¼€å…³

---

## ğŸ“‹ é¢„è­¦è§¦å‘æ¡ä»¶

### ä¸Šæ¶¨é¢„è­¦
```javascript
if (alertState.upperEnabled &&          // ä¸Šæ¶¨å¼€å…³å·²å¼€å¯
    !alertState.upperTriggered &&       // æ²¡æœ‰è§¦å‘è¿‡
    currentValue >= alertState.upperThreshold)  // å½“å‰å€¼ >= é˜ˆå€¼
{
    // è§¦å‘é¢„è­¦
}
```

**å½“å‰è®¾ç½®ï¼š**
- é˜ˆå€¼ï¼š30%
- çŠ¶æ€ï¼šå·²å¼€å¯
- è§¦å‘æ¡ä»¶ï¼šæ€»æ¶¨è·Œå¹… >= 30%

### ä¸‹è·Œé¢„è­¦
```javascript
if (alertState.lowerEnabled &&          // ä¸‹è·Œå¼€å…³å·²å¼€å¯
    !alertState.lowerTriggered &&       // æ²¡æœ‰è§¦å‘è¿‡
    currentValue <= alertState.lowerThreshold)  // å½“å‰å€¼ <= é˜ˆå€¼
{
    // è§¦å‘é¢„è­¦
}
```

**å½“å‰è®¾ç½®ï¼š**
- é˜ˆå€¼ï¼š-40%
- çŠ¶æ€ï¼šå·²å¼€å¯
- è§¦å‘æ¡ä»¶ï¼šæ€»æ¶¨è·Œå¹… <= -40%

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1ï¼šç­‰å¾…å®é™…è§¦å‘
1. ä¿æŒé¡µé¢æ‰“å¼€
2. ç­‰å¾…æ€»æ¶¨è·Œå¹…è¾¾åˆ°é˜ˆå€¼ï¼ˆ30% æˆ– -40%ï¼‰
3. æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
4. è§¦å‘æ—¶ä¼šçœ‹åˆ°éŸ³æ•ˆ + å¼¹çª— + Telegram é€šçŸ¥

### æ–¹æ³•2ï¼šé™ä½é˜ˆå€¼æµ‹è¯•
ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼Œå¯ä»¥ä¸´æ—¶é™ä½é˜ˆå€¼ï¼š

1. **æ‰“å¼€é¡µé¢**ï¼š
   ```
   https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/coin-change-tracker
   ```

2. **ä¿®æ”¹é˜ˆå€¼**ï¼š
   - ä¸Šæ¶¨é˜ˆå€¼æ”¹ä¸ºï¼š`0.5`ï¼ˆå½“å‰å€¼æ¥è¿‘çš„å°æ­£æ•°ï¼‰
   - ä¸‹è·Œé˜ˆå€¼æ”¹ä¸ºï¼š`-36`ï¼ˆç•¥é«˜äºå½“å‰å€¼ -35.88%ï¼‰

3. **ç‚¹å‡»ä¿å­˜**

4. **ç­‰å¾…10ç§’**ï¼ˆä¸‹ä¸€æ¬¡è‡ªåŠ¨æ›´æ–°ï¼‰

5. **è§‚å¯Ÿ**ï¼š
   - æ§åˆ¶å°æ—¥å¿—ï¼š`ğŸŸ¢ è§¦å‘ä¸‹é™é¢„è­¦: -35.88 <= -36`
   - éŸ³æ•ˆæ’­æ”¾3æ¬¡
   - å¼¹çª—æ˜¾ç¤º
   - Telegram é€šçŸ¥ï¼ˆå¦‚æœå·²é…ç½®ï¼‰

### æ–¹æ³•3ï¼šæ‰‹åŠ¨è§¦å‘æµ‹è¯•
åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ä¸­è¿è¡Œï¼š

```javascript
// æ‰‹åŠ¨è°ƒç”¨é¢„è­¦æ£€æŸ¥
checkAlerts({
    cumulative_pct: -41,  // æ¨¡æ‹Ÿ -41% çš„è·Œå¹…
    changes: window.currentCoinsData || {}
});
```

**æœŸæœ›ç»“æœï¼š**
- æ§åˆ¶å°è¾“å‡ºï¼š`ğŸŸ¢ è§¦å‘ä¸‹é™é¢„è­¦: -41 <= -40`
- æ’­æ”¾éŸ³æ•ˆ
- æ˜¾ç¤ºå¼¹çª—
- å‘é€ Telegram é€šçŸ¥

---

## ğŸ” è°ƒè¯•æ£€æŸ¥

### 1. æ£€æŸ¥ checkAlerts å‡½æ•°æ˜¯å¦å­˜åœ¨
åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
typeof checkAlerts
```
åº”è¯¥è¿”å›ï¼š`"function"`

### 2. æ£€æŸ¥é¢„è­¦çŠ¶æ€
åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
alertState
```
åº”è¯¥è¿”å›ï¼š
```javascript
{
  upperEnabled: true,
  lowerEnabled: true,
  upperThreshold: 30,
  lowerThreshold: -40,
  upperTriggered: false,
  lowerTriggered: false,
  lastCheckTime: null,
  tgEnabled: true
}
```

### 3. æŸ¥çœ‹å½“å‰æ¶¨è·Œå¹…
åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
document.getElementById('totalChange').textContent
```
åº”è¯¥æ˜¾ç¤ºå½“å‰çš„æ€»æ¶¨è·Œå¹…ï¼ˆä¾‹å¦‚ï¼š`-35.88%`ï¼‰

### 4. æ£€æŸ¥è‡ªåŠ¨æ›´æ–°æ˜¯å¦è¿è¡Œ
åœ¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—ï¼Œæ¯10ç§’åº”è¯¥æœ‰ï¼š
```
æ›´æ–°å®æ—¶æ•°æ®...
ï¼ˆå¦‚æœè§¦å‘ï¼‰ğŸŸ¢ è§¦å‘ä¸‹é™é¢„è­¦: -40.5 <= -40
```

---

## ğŸ“Š é¢„è­¦æ‰§è¡Œæµç¨‹

```
é¡µé¢åŠ è½½
   â†“
startAutoRefresh()  â† å¯åŠ¨å®šæ—¶å™¨
   â†“
æ¯10ç§’è°ƒç”¨ä¸€æ¬¡
   â†“
updateLatestData()  â† è·å–æœ€æ–°æ•°æ®
   â†“
checkAlerts()  â† æ£€æŸ¥æ˜¯å¦è§¦å‘é¢„è­¦
   â†“
   â”œâ”€ ä¸Šæ¶¨é¢„è­¦ï¼Ÿâ†’ æ’­æ”¾éŸ³æ•ˆ â†’ æ˜¾ç¤ºå¼¹çª— â†’ Telegram â†’ å…³é—­å¼€å…³
   â”œâ”€ ä¸‹è·Œé¢„è­¦ï¼Ÿâ†’ æ’­æ”¾éŸ³æ•ˆ â†’ æ˜¾ç¤ºå¼¹çª— â†’ Telegram â†’ å…³é—­å¼€å…³
   â””â”€ å¦ â†’ ç­‰å¾…ä¸‹ä¸€æ¬¡æ£€æŸ¥
```

---

## ğŸ¯ å…³é”®ç‚¹

### âœ… å·²ä¿®å¤
- [x] `checkAlerts()` ç°åœ¨åœ¨æ¯æ¬¡æ•°æ®æ›´æ–°æ—¶è¢«è°ƒç”¨
- [x] æ¯10ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
- [x] é¡µé¢åŠ è½½æ—¶ç«‹å³æ£€æŸ¥ä¸€æ¬¡

### ğŸ”” è§¦å‘æ¡ä»¶
- **ä¸Šæ¶¨é¢„è­¦**ï¼šæ€»æ¶¨è·Œå¹… >= 30%ï¼ˆå½“å‰è®¾ç½®ï¼‰
- **ä¸‹è·Œé¢„è­¦**ï¼šæ€»æ¶¨è·Œå¹… <= -40%ï¼ˆå½“å‰è®¾ç½®ï¼‰

### âš ï¸ æ³¨æ„äº‹é¡¹
1. **é˜²é‡å¤è§¦å‘**ï¼šè§¦å‘ä¸€æ¬¡åï¼Œå¼€å…³è‡ªåŠ¨å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨é‡æ–°å¼€å¯
2. **æœ€å°é—´éš”**ï¼š10ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆä»£ç ä¸­æœ‰æœ€å°é—´éš”é™åˆ¶ï¼‰
3. **Telegram é€šçŸ¥**ï¼šéœ€è¦åç«¯é…ç½®æ­£ç¡®çš„ Bot Token å’Œ Chat ID

---

## ğŸ§ª å¿«é€ŸéªŒè¯è„šæœ¬

### æµ‹è¯•ä¸‹è·Œé¢„è­¦ï¼ˆå½“å‰å€¼ï¼š-35.88%ï¼‰
```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œ
alertState.lowerThreshold = -35;  // è®¾ç½®é˜ˆå€¼ä¸º -35
saveAlertSettings();  // ä¿å­˜
console.log('âœ… é˜ˆå€¼å·²è®¾ç½®ä¸º -35ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ›´æ–°ï¼ˆ10ç§’ï¼‰');
```

**ç­‰å¾…10ç§’åï¼Œåº”è¯¥è§¦å‘é¢„è­¦ï¼**

### æ¢å¤åŸé˜ˆå€¼
```javascript
// æµ‹è¯•å®Œæˆå
alertState.lowerThreshold = -40;
saveAlertSettings();
console.log('âœ… é˜ˆå€¼å·²æ¢å¤ä¸º -40');
```

---

## ğŸ“ ä¿®å¤æ–‡ä»¶

- **æ–‡ä»¶**ï¼š`templates/coin_change_tracker.html`
- **ä¿®æ”¹è¡Œæ•°**ï¼šç¬¬ 507-511 è¡Œï¼ˆåœ¨ `updateLatestData` å‡½æ•°ä¸­æ·»åŠ  `checkAlerts` è°ƒç”¨ï¼‰
- **æäº¤ä¿¡æ¯**ï¼š`fix: æ·»åŠ é¢„è­¦æ£€æŸ¥è°ƒç”¨åˆ°æ•°æ®æ›´æ–°å‡½æ•°`

---

## âœ… éªŒè¯æ¸…å•

### åŸºç¡€éªŒè¯
- [x] `checkAlerts` å‡½æ•°å·²å®šä¹‰
- [x] `updateLatestData` å‡½æ•°è°ƒç”¨ `checkAlerts`
- [x] æ¯10ç§’è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡
- [x] Flask æœåŠ¡å·²é‡å¯

### åŠŸèƒ½éªŒè¯ï¼ˆå¾…ç”¨æˆ·ç¡®è®¤ï¼‰
- [ ] è®¾ç½®è¾ƒä½çš„é˜ˆå€¼ï¼ˆ-36ï¼‰
- [ ] ç­‰å¾…10ç§’
- [ ] çœ‹åˆ°é¢„è­¦å¼¹çª—
- [ ] å¬åˆ°éŸ³æ•ˆï¼ˆå¦‚æœæœ‰å£°éŸ³ï¼‰
- [ ] æ”¶åˆ° Telegram é€šçŸ¥ï¼ˆå¦‚æœå·²é…ç½®ï¼‰
- [ ] å¼€å…³è‡ªåŠ¨å…³é—­

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **åˆ·æ–°é¡µé¢**ï¼šè®¿é—®åŸç³»ç»Ÿåœ°å€
   ```
   https://5000-idfgz76cf9poiqtgzfhan-c81df28e.sandbox.novita.ai/coin-change-tracker
   ```

2. **é™ä½é˜ˆå€¼æµ‹è¯•**ï¼š
   - ä¸‹è·Œé˜ˆå€¼æ”¹ä¸º `-36`
   - ç‚¹å‡»ä¿å­˜
   - ç­‰å¾…10ç§’

3. **è§‚å¯Ÿç»“æœ**ï¼š
   - æŸ¥çœ‹æ˜¯å¦æœ‰å¼¹çª—
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
   - æ£€æŸ¥ Telegram æ˜¯å¦æ”¶åˆ°é€šçŸ¥

4. **åé¦ˆ**ï¼š
   - å¦‚æœæˆåŠŸè§¦å‘ â†’ é—®é¢˜å·²è§£å†³ âœ…
   - å¦‚æœä»æœªè§¦å‘ â†’ æä¾›æ§åˆ¶å°æ—¥å¿—æˆªå›¾

---

ç”Ÿæˆæ—¶é—´ï¼š2026-02-09  
ç‰ˆæœ¬ï¼šé¢„è­¦åŠŸèƒ½ä¿®å¤æŠ¥å‘Š v1.0  
çŠ¶æ€ï¼šâœ… å·²ä¿®å¤ï¼Œå¾…éªŒè¯
