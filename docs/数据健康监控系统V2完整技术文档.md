# æ•°æ®å¥åº·ç›‘æ§ç³»ç»Ÿ V2.0 å®Œæ•´æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [è¿è¡Œé€»è¾‘ä¸æµç¨‹](#è¿è¡Œé€»è¾‘ä¸æµç¨‹)
4. [æ•°æ®å­˜å‚¨æ ¼å¼](#æ•°æ®å­˜å‚¨æ ¼å¼)
5. [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
6. [ä¾èµ–é¡¹æ¸…å•](#ä¾èµ–é¡¹æ¸…å•)
7. [API æ¥å£æ–‡æ¡£](#api-æ¥å£æ–‡æ¡£)
8. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
9. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿæ¦‚è¿°

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
æ•°æ®å¥åº·ç›‘æ§ç³»ç»Ÿ V2.0 æ˜¯ä¸€ä¸ª**å…¨è‡ªåŠ¨åŒ–**çš„ç³»ç»Ÿå¥åº·ç®¡ç†å¹³å°ï¼Œè´Ÿè´£ç›‘æ§ 20+ ä¸ªæ•°æ®é‡‡é›†å™¨çš„è¿è¡ŒçŠ¶æ€ï¼Œå¹¶åœ¨å‘ç°å¼‚å¸¸æ—¶è‡ªåŠ¨ä¿®å¤æˆ–å‘é€å‘Šè­¦é€šçŸ¥ã€‚

### ğŸŒŸ ä¸»è¦ç‰¹æ€§
- âœ… **å®æ—¶ç›‘æ§**ï¼šæ¯ 5 åˆ†é’Ÿæ£€æŸ¥æ‰€æœ‰é‡‡é›†å™¨çŠ¶æ€
- ğŸ”§ **è‡ªåŠ¨ä¿®å¤**ï¼šæ£€æµ‹åˆ°å¼‚å¸¸è‡ªåŠ¨é‡å¯ï¼Œæœ€å¤šé‡è¯• 3 æ¬¡
- ğŸ“± **æ™ºèƒ½å‘Šè­¦**ï¼šä¿®å¤å¤±è´¥æ—¶é€šè¿‡ Telegram å‘é€é€šçŸ¥
- ğŸ“Š **å¯è§†åŒ–ç•Œé¢**ï¼šå®æ—¶å±•ç¤ºæ‰€æœ‰ç³»ç»Ÿå¥åº·çŠ¶æ€
- ğŸ”„ **é›¶åœæœº**ï¼š24/7 ä¸é—´æ–­è¿è¡Œ
- ğŸ“ˆ **å†å²è®°å½•**ï¼šè®°å½•æ¯æ¬¡é‡å¯å’Œå¼‚å¸¸äº‹ä»¶

### ğŸ“Š ç›‘æ§èŒƒå›´
| ç³»ç»Ÿç±»å‹ | é‡‡é›†å™¨æ•°é‡ | ç›‘æ§é¡¹ |
|---------|-----------|--------|
| æ ¸å¿ƒæœåŠ¡ | 1 ä¸ª | Flask åº”ç”¨ |
| æ•°æ®é‡‡é›†å™¨ | 17 ä¸ª | çŠ¶æ€ + æ•°æ®æ–°é²œåº¦ |
| æ•°æ®ç®¡ç†å™¨ | 2 ä¸ª | JSONL å½’æ¡£çŠ¶æ€ |
| **æ€»è®¡** | **20 ä¸ª** | **40+ ç›‘æ§æŒ‡æ ‡** |

---

## ç³»ç»Ÿæ¶æ„

### ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Web æ§åˆ¶å°   â”‚  â”‚  å®æ—¶ä»ªè¡¨ç›˜   â”‚  â”‚  æ‰‹åŠ¨æ“ä½œå°   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Flask åº”ç”¨å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /data-health-monitor (ä¸»é¡µé¢)                    â”‚    â”‚
â”‚  â”‚  /api/data-health-monitor/status (çŠ¶æ€ API)       â”‚    â”‚
â”‚  â”‚  /api/data-health-monitor/logs (æ—¥å¿— API)         â”‚    â”‚
â”‚  â”‚  /api/data-health-monitor/restart (é‡å¯ API)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç³»ç»Ÿå¥åº·ç›‘æ§å™¨ V2.0 (PM2 å®ˆæŠ¤è¿›ç¨‹)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ (PM2 jlist)                       â”‚    â”‚
â”‚  â”‚  2. æ•°æ®æ–°é²œåº¦éªŒè¯ (JSONL æ–‡ä»¶æ—¶é—´æˆ³)                â”‚    â”‚
â”‚  â”‚  3. å¼‚å¸¸æ£€æµ‹ä¸è¯Šæ–­                                 â”‚    â”‚
â”‚  â”‚  4. è‡ªåŠ¨ä¿®å¤é€»è¾‘ (æœ€å¤š 3 æ¬¡é‡å¯)                    â”‚    â”‚
â”‚  â”‚  5. Telegram å‘Šè­¦é€šçŸ¥                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PM2 è¿›ç¨‹ç®¡ç†å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é‡‡é›†å™¨ 1  â”‚ â”‚ é‡‡é›†å™¨ 2  â”‚ â”‚   ...    â”‚ â”‚ é‡‡é›†å™¨ N  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å­˜å‚¨å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /data/  (å„é‡‡é›†å™¨ JSONL æ•°æ®æ–‡ä»¶)                 â”‚    â”‚
â”‚  â”‚  /logs/  (ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶)                            â”‚    â”‚
â”‚  â”‚  data_health_monitor_state.json (çŠ¶æ€å¿«ç…§)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ æ•°æ®æµå‘
```
ç”¨æˆ·è¯·æ±‚ â†’ Flask API â†’ è¯»å–çŠ¶æ€æ–‡ä»¶ â†’ è¿”å› JSON
                â†“
        å¥åº·ç›‘æ§å™¨ (æ¯ 5 åˆ†é’Ÿ)
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                       â†“
æ£€æŸ¥ PM2 è¿›ç¨‹          æ£€æŸ¥æ•°æ®æ–‡ä»¶
    â†“                       â†“
æ­£å¸¸ / å¼‚å¸¸            æ–°é²œ / è¿‡æœŸ
    â†“                       â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        å¼‚å¸¸è¯Šæ–­ä¸ä¿®å¤
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“
    è‡ªåŠ¨é‡å¯        ä¿®å¤å¤±è´¥
        â†“               â†“
    æ›´æ–°çŠ¶æ€    â†’ Telegram é€šçŸ¥
```

---

## è¿è¡Œé€»è¾‘ä¸æµç¨‹

### ğŸ”„ ä¸»å¾ªç¯æµç¨‹ (æ¯ 5 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡)

#### **æ­¥éª¤ 1: åˆå§‹åŒ–æ£€æŸ¥**
```python
# 1.1 è·å–æ‰€æœ‰ PM2 è¿›ç¨‹åˆ—è¡¨
pm2_processes = subprocess.run(['pm2', 'jlist'])

# 1.2 åˆå§‹åŒ–ç›‘æ§ç»“æœ
monitor_results = {
    'healthy': [],      # å¥åº·çš„ç³»ç»Ÿ
    'unhealthy': [],    # å¼‚å¸¸çš„ç³»ç»Ÿ
    'fixed': [],        # å·²ä¿®å¤çš„ç³»ç»Ÿ
    'failed': []        # ä¿®å¤å¤±è´¥çš„ç³»ç»Ÿ
}
```

#### **æ­¥éª¤ 2: é€ä¸ªæ£€æŸ¥é‡‡é›†å™¨**
```python
for collector_name, (data_path, max_delay) in MONITOR_CONFIG.items():
    # 2.1 æ£€æŸ¥è¿›ç¨‹æ˜¯å¦åœ¨çº¿
    process_status = check_pm2_process(collector_name)
    
    # 2.2 æ£€æŸ¥æ•°æ®æ–‡ä»¶æ–°é²œåº¦
    data_fresh = check_data_freshness(data_path, max_delay)
    
    # 2.3 ç»¼åˆåˆ¤æ–­å¥åº·çŠ¶æ€
    if process_status == 'online' and data_fresh:
        monitor_results['healthy'].append(collector_name)
    else:
        monitor_results['unhealthy'].append(collector_name)
        # è§¦å‘ä¿®å¤æµç¨‹
        repair_result = auto_repair(collector_name)
```

#### **æ­¥éª¤ 3: è‡ªåŠ¨ä¿®å¤é€»è¾‘**
```python
def auto_repair(collector_name):
    # 3.1 æ£€æŸ¥é‡å¯æ¬¡æ•°
    if restart_counter[collector_name] >= 3:
        # è¶…è¿‡ 3 æ¬¡ï¼Œæ ‡è®°ä¸ºä¿®å¤å¤±è´¥
        send_telegram_alert(collector_name, "ä¿®å¤å¤±è´¥ï¼Œå·²é‡å¯ 3 æ¬¡")
        return 'failed'
    
    # 3.2 æ‰§è¡Œé‡å¯
    subprocess.run(['pm2', 'restart', collector_name])
    restart_counter[collector_name] += 1
    
    # 3.3 ç­‰å¾… 30 ç§’éªŒè¯
    time.sleep(30)
    
    # 3.4 éªŒè¯ä¿®å¤ç»“æœ
    if check_healthy(collector_name):
        return 'fixed'
    else:
        return 'retry'
```

#### **æ­¥éª¤ 4: æ›´æ–°çŠ¶æ€æ–‡ä»¶**
```python
# 4.1 ç”ŸæˆçŠ¶æ€å¿«ç…§
state_data = {
    'timestamp': time.time(),
    'beijing_time': datetime.now(BEIJING_TZ).strftime('%Y-%m-%d %H:%M:%S'),
    'monitors': []
}

# 4.2 æ·»åŠ æ¯ä¸ªé‡‡é›†å™¨çš„è¯¦ç»†çŠ¶æ€
for collector in ALL_COLLECTORS:
    state_data['monitors'].append({
        'name': collector,
        'pm2_name': PM2_NAME_MAP[collector],
        'status': 'healthy' or 'unhealthy',
        'data_delay_minutes': delay,
        'last_restart_time': restart_time,
        'restart_count_today': count
    })

# 4.3 å†™å…¥çŠ¶æ€æ–‡ä»¶
with open('/home/user/webapp/data/data_health_monitor_state.json', 'w') as f:
    json.dump(state_data, f, ensure_ascii=False, indent=2)
```

#### **æ­¥éª¤ 5: å‘é€ Telegram é€šçŸ¥ (ä»…ä¿®å¤å¤±è´¥æ—¶)**
```python
def send_telegram_alert(collector_name, message):
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
    data = {
        'chat_id': CHAT_ID,
        'text': f"âš ï¸ ç³»ç»Ÿå‘Šè­¦\n\n"
                f"é‡‡é›†å™¨: {collector_name}\n"
                f"é—®é¢˜: {message}\n"
                f"æ—¶é—´: {beijing_time}",
        'parse_mode': 'Markdown'
    }
    requests.post(url, json=data)
```

### ğŸ“Š çŠ¶æ€åˆ¤æ–­é€»è¾‘

#### **1. è¿›ç¨‹çŠ¶æ€åˆ¤æ–­**
| PM2 çŠ¶æ€ | å¥åº·åˆ¤æ–­ | å¤„ç†æ–¹å¼ |
|---------|---------|---------|
| `online` | âœ… å¥åº· | ç»§ç»­æ£€æŸ¥æ•°æ® |
| `stopped` | âŒ å¼‚å¸¸ | ç«‹å³é‡å¯ |
| `errored` | âŒ å¼‚å¸¸ | ç«‹å³é‡å¯ |
| `not_found` | âŒ å¼‚å¸¸ | è®°å½•å‘Šè­¦ (ä¸é‡å¯) |

#### **2. æ•°æ®æ–°é²œåº¦åˆ¤æ–­**
```python
# è®¡ç®—æ•°æ®å»¶è¿Ÿ
data_delay = (å½“å‰æ—¶é—´ - æœ€æ–°æ–‡ä»¶ä¿®æ”¹æ—¶é—´) / 60  # åˆ†é’Ÿ

# åˆ¤æ–­æ˜¯å¦è¿‡æœŸ
if data_delay <= max_delay_minutes:
    status = 'fresh'  # æ•°æ®æ–°é²œ
else:
    status = 'stale'  # æ•°æ®è¿‡æœŸ
    trigger_restart()
```

#### **3. ç»¼åˆå¥åº·åˆ¤æ–­**
```python
def is_healthy(collector):
    return (
        process_status == 'online' and
        data_delay <= max_delay and
        no_error_logs_in_last_5min
    )
```

---

## æ•°æ®å­˜å‚¨æ ¼å¼

### ğŸ“ ç›®å½•ç»“æ„
```
/home/user/webapp/
â”œâ”€â”€ data/                                    # æ•°æ®å­˜å‚¨æ ¹ç›®å½•
â”‚   â”œâ”€â”€ data_health_monitor_state.json      # ç›‘æ§çŠ¶æ€å¿«ç…§ (å®æ—¶)
â”‚   â”œâ”€â”€ signal_timeline/                     # ä¿¡å·æ—¶é—´çº¿æ•°æ®
â”‚   â”‚   â””â”€â”€ signal_timeline_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ price_position_10m/                  # ä»·æ ¼ä½ç½®æ•°æ®
â”‚   â”‚   â””â”€â”€ price_position_10m_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ price_speed_10m/                     # ä»·æ ¼æ¶¨é€Ÿæ•°æ®
â”‚   â”‚   â””â”€â”€ price_speed_10m_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ sar_slope_jsonl/                     # SAR æ–œç‡æ•°æ®
â”‚   â”‚   â”œâ”€â”€ latest_sar_slope.jsonl          # æœ€æ–°å¿«ç…§
â”‚   â”‚   â””â”€â”€ sar_slope_data.jsonl            # å†å²æ•°æ®
â”‚   â”œâ”€â”€ sar_bias_stats/                      # SAR åå‘ç»Ÿè®¡
â”‚   â”‚   â””â”€â”€ bias_stats_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ liquidation_1h/                      # çˆ†ä»“æ•°æ®
â”‚   â”‚   â””â”€â”€ liquidation_1h_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ okx_day_change/                      # OKX æ—¥æ¶¨è·Œ
â”‚   â”‚   â””â”€â”€ okx_day_change_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ price_comparison/                    # ä»·æ ¼å¯¹æ¯”
â”‚   â”‚   â””â”€â”€ price_comparison_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ v1v2_ratios/                         # V1V2 æ¯”ç‡
â”‚   â”‚   â””â”€â”€ v1v2_ratios_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ panic_wash/                          # ææ…Œæ¸…æ´—
â”‚   â”‚   â””â”€â”€ panic_wash_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ coin_changes/                        # å¸ç§å˜åŒ–
â”‚   â”‚   â””â”€â”€ coin_changes_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ crypto_index/                        # åŠ å¯†æŒ‡æ•°
â”‚   â”‚   â””â”€â”€ crypto_index_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ financial_indicators/                # é‡‘èæŒ‡æ ‡
â”‚   â”‚   â””â”€â”€ financial_indicators_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ okx_trade_history/                   # äº¤æ˜“å†å²
â”‚   â”‚   â””â”€â”€ okx_trade_history_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ okx_trading_marks/                   # äº¤æ˜“æ ‡è®°
â”‚   â”‚   â””â”€â”€ okx_trading_marks_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ liquidation_alerts/                  # çˆ†ä»“å‘Šè­¦
â”‚   â”‚   â””â”€â”€ liquidation_alerts_YYYYMMDD.jsonl
â”‚   â”œâ”€â”€ price_baselines/                     # ä»·æ ¼åŸºçº¿
â”‚   â”‚   â””â”€â”€ price_baselines_YYYYMMDD.jsonl
â”‚   â””â”€â”€ dashboard_jsonl/                     # ä»ªè¡¨ç›˜æ•°æ®
â”‚       â””â”€â”€ dashboard_YYYYMMDD.jsonl
â”œâ”€â”€ logs/                                    # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ data_health_monitor.log             # ç›‘æ§æ—¥å¿—
â”œâ”€â”€ source_code/                             # æºä»£ç 
â”‚   â”œâ”€â”€ system_health_monitor_v2.py         # ç›‘æ§ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ signal_collector.py                  # ä¿¡å·é‡‡é›†å™¨
â”‚   â”œâ”€â”€ price_position_collector.py          # ä»·æ ¼ä½ç½®é‡‡é›†å™¨
â”‚   â”œâ”€â”€ sar_slope_collector.py              # SAR æ–œç‡é‡‡é›†å™¨
â”‚   â””â”€â”€ ...                                  # å…¶ä»–é‡‡é›†å™¨
â”œâ”€â”€ config/                                  # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ telegram_config.py                   # Telegram é…ç½®
â””â”€â”€ templates/                               # ç½‘é¡µæ¨¡æ¿
    â””â”€â”€ data_health_monitor.html            # ç›‘æ§é¡µé¢
```

### ğŸ“„ çŠ¶æ€æ–‡ä»¶æ ¼å¼

#### **data_health_monitor_state.json**
```json
{
  "timestamp": 1739521234.567,
  "beijing_time": "2026-02-15 18:30:00",
  "total_monitors": 20,
  "healthy_count": 18,
  "unhealthy_count": 2,
  "today_restart_count": 5,
  "monitors": [
    {
      "name": "ä¿¡å·æ—¶é—´çº¿ç³»ç»Ÿ",
      "pm2_name": "signal-collector",
      "status": "healthy",
      "process_status": "online",
      "data_delay_minutes": 3.5,
      "max_delay_minutes": 10,
      "last_data_time": "2026-02-15 18:26:30",
      "last_restart_time": "2026-02-15 15:10:00",
      "restart_count_today": 1,
      "error_message": ""
    },
    {
      "name": "ä»·æ ¼ä½ç½®ç³»ç»Ÿ",
      "pm2_name": "price-position-collector",
      "status": "unhealthy",
      "process_status": "online",
      "data_delay_minutes": 25.8,
      "max_delay_minutes": 10,
      "last_data_time": "2026-02-15 18:04:12",
      "last_restart_time": "2026-02-15 18:28:00",
      "restart_count_today": 3,
      "error_message": "æ•°æ®å»¶è¿Ÿè¶…è¿‡é˜ˆå€¼"
    }
  ]
}
```

### ğŸ“ JSONL æ•°æ®æ ¼å¼ (æŒ‰é‡‡é›†å™¨åˆ†ç±»)

#### **1. signal_timeline (ä¿¡å·æ—¶é—´çº¿)**
```jsonl
{"timestamp": 1739521234, "beijing_time": "2026-02-15 18:30:00", "symbol": "BTC", "signal_type": "golden_cross", "strength": 0.85, "price": 45678.90}
```

#### **2. price_position_10m (ä»·æ ¼ä½ç½®)**
```jsonl
{"timestamp": 1739521234, "beijing_time": "2026-02-15 18:30:00", "symbol": "BTC", "close": 45678.90, "price_position": "0.75", "rank": 15, "total_monitored": 27}
```

#### **3. sar_slope (SAR æ–œç‡)**
```jsonl
{"timestamp": 1739521234, "beijing_time": "2026-02-15 18:30:00", "symbol": "BTC", "close": 45678.90, "sar": 45123.45, "position": "bullish", "quadrant": "Q1", "duration_minutes": 65, "slope_value": 0.012, "slope_direction": "up"}
```

#### **4. sar_bias_stats (SAR åå‘ç»Ÿè®¡)**
```jsonl
{"timestamp": 1739521234, "beijing_time": "2026-02-15 18:30:00", "bullish_count": 3, "bearish_count": 1, "bullish_symbols": ["BTC", "ETH", "SOL"], "bearish_symbols": ["DOGE"], "total_monitored": 28}
```

#### **5. liquidation_1h (1å°æ—¶çˆ†ä»“)**
```jsonl
{"timestamp": 1739521234, "beijing_time": "2026-02-15 18:30:00", "total_liquidation": 12345678.90, "long_liquidation": 8234567.80, "short_liquidation": 4111111.10, "top_symbols": ["BTC", "ETH"]}
```

---

## åŠŸèƒ½è¯¦è§£

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

#### **1. å®æ—¶çŠ¶æ€ç›‘æ§**
- **åŠŸèƒ½æè¿°**ï¼šæ¯ 5 åˆ†é’Ÿæ£€æŸ¥æ‰€æœ‰é‡‡é›†å™¨çš„è¿è¡ŒçŠ¶æ€å’Œæ•°æ®æ–°é²œåº¦
- **ç›‘æ§æŒ‡æ ‡**ï¼š
  - PM2 è¿›ç¨‹çŠ¶æ€ (online/stopped/errored)
  - æ•°æ®æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
  - æ•°æ®å»¶è¿Ÿæ—¶é—´ (åˆ†é’Ÿ)
  - ä»Šæ—¥é‡å¯æ¬¡æ•°
- **åˆ¤æ–­é€»è¾‘**ï¼š
  ```python
  if process_status != 'online':
      return 'unhealthy'
  if data_delay > max_delay:
      return 'unhealthy'
  return 'healthy'
  ```

#### **2. è‡ªåŠ¨ä¿®å¤æœºåˆ¶**
- **è§¦å‘æ¡ä»¶**ï¼š
  - è¿›ç¨‹çŠ¶æ€é `online`
  - æ•°æ®å»¶è¿Ÿè¶…è¿‡é˜ˆå€¼
- **ä¿®å¤ç­–ç•¥**ï¼š
  1. ç¬¬ 1 æ¬¡ï¼šç«‹å³é‡å¯
  2. ç¬¬ 2 æ¬¡ï¼šé‡å¯åç­‰å¾… 30 ç§’éªŒè¯
  3. ç¬¬ 3 æ¬¡ï¼šé‡å¯åç­‰å¾… 60 ç§’éªŒè¯
  4. ç¬¬ 4 æ¬¡ï¼šå‘é€ Telegram å‘Šè­¦ï¼Œä¸å†é‡å¯
- **éªŒè¯æ–¹å¼**ï¼š
  - æ£€æŸ¥ PM2 çŠ¶æ€æ˜¯å¦æ¢å¤
  - ç­‰å¾… 30-60 ç§’åæ£€æŸ¥æ•°æ®æ˜¯å¦æ›´æ–°

#### **3. Telegram å‘Šè­¦é€šçŸ¥**
- **é€šçŸ¥æ—¶æœº**ï¼š
  - é‡‡é›†å™¨ä¿®å¤å¤±è´¥ (é‡å¯ 3 æ¬¡åä»å¼‚å¸¸)
  - å‘ç°ä¸¥é‡é”™è¯¯ (å¦‚æ•°æ®ç›®å½•ä¸¢å¤±)
- **é€šçŸ¥å†…å®¹**ï¼š
  ```
  âš ï¸ ç³»ç»Ÿå‘Šè­¦
  
  é‡‡é›†å™¨: price-position-collector
  çŠ¶æ€: ä¿®å¤å¤±è´¥
  åŸå› : é‡å¯ 3 æ¬¡åæ•°æ®ä»å»¶è¿Ÿ 25.8 åˆ†é’Ÿ
  æ—¶é—´: 2026-02-15 18:30:00
  
  å»ºè®®æ“ä½œï¼š
  1. æ£€æŸ¥æ—¥å¿—: pm2 logs price-position-collector
  2. æ‰‹åŠ¨é‡å¯: pm2 restart price-position-collector
  3. æ£€æŸ¥æ•°æ®ç›®å½•æ˜¯å¦æ­£å¸¸
  ```

#### **4. å¯è§†åŒ–ç›‘æ§é¢æ¿**
- **é¡µé¢è·¯ç”±**: `/data-health-monitor`
- **å®æ—¶æ•°æ®**: æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°
- **å±•ç¤ºå†…å®¹**ï¼š
  - æ€»ä½“å¥åº·åº¦ç™¾åˆ†æ¯”
  - å¥åº·/å¼‚å¸¸ç³»ç»Ÿæ•°é‡
  - ä»Šæ—¥é‡å¯æ¬¡æ•°ç»Ÿè®¡
  - æ¯ä¸ªé‡‡é›†å™¨çš„è¯¦ç»†çŠ¶æ€å¡ç‰‡
- **çŠ¶æ€é¢œè‰²**ï¼š
  - ğŸŸ¢ ç»¿è‰²ï¼šå¥åº· (æ•°æ®æ–°é²œï¼Œè¿›ç¨‹åœ¨çº¿)
  - ğŸŸ¡ é»„è‰²ï¼šè­¦å‘Š (æ•°æ®ç•¥å¾®å»¶è¿Ÿ)
  - ğŸ”´ çº¢è‰²ï¼šå¼‚å¸¸ (è¿›ç¨‹åœæ­¢æˆ–æ•°æ®ä¸¥é‡å»¶è¿Ÿ)

#### **5. æ‰‹åŠ¨æ“ä½œæ¥å£**
- **é‡å¯å•ä¸ªé‡‡é›†å™¨**ï¼š
  ```bash
  POST /api/data-health-monitor/restart
  Body: {"pm2_name": "signal-collector"}
  ```
- **æŸ¥çœ‹å®æ—¶æ—¥å¿—**ï¼š
  ```bash
  GET /api/data-health-monitor/logs?limit=100
  ```
- **è·å–çŠ¶æ€å¿«ç…§**ï¼š
  ```bash
  GET /api/data-health-monitor/status
  ```

---

## ä¾èµ–é¡¹æ¸…å•

### ğŸ Python ä¾èµ–åŒ…

#### **å¿…éœ€åŒ… (requirements.txt)**
```txt
Flask==2.3.0              # Web æ¡†æ¶
flask-cors==4.0.0         # è·¨åŸŸæ”¯æŒ
requests==2.28.0          # HTTP è¯·æ±‚
pytz==2023.3              # æ—¶åŒºå¤„ç†
numpy==1.21.0             # æ•°å€¼è®¡ç®— (éƒ¨åˆ†é‡‡é›†å™¨éœ€è¦)
```

#### **å®‰è£…å‘½ä»¤**
```bash
cd /home/user/webapp && pip3 install -r requirements.txt
```

### ğŸ“¦ Node.js ä¾èµ–åŒ…

#### **PM2 è¿›ç¨‹ç®¡ç†å™¨**
```bash
npm install -g pm2@5.3.0
```

#### **PM2 åŠŸèƒ½æ¨¡å—**
- `pm2 start` - å¯åŠ¨è¿›ç¨‹
- `pm2 restart` - é‡å¯è¿›ç¨‹
- `pm2 stop` - åœæ­¢è¿›ç¨‹
- `pm2 list` - åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹
- `pm2 jlist` - JSON æ ¼å¼è¾“å‡º
- `pm2 logs` - æŸ¥çœ‹æ—¥å¿—
- `pm2 monit` - å®æ—¶ç›‘æ§

### ğŸ”§ ç³»ç»Ÿä¾èµ–

#### **Linux å‘½ä»¤å·¥å…·**
```bash
cat, tail, grep, awk, sed, find, ls, stat
```

#### **Python ç³»ç»Ÿåº“**
```python
subprocess   # æ‰§è¡Œ PM2 å‘½ä»¤
json         # JSON æ•°æ®å¤„ç†
time         # æ—¶é—´æ“ä½œ
datetime     # æ—¥æœŸæ—¶é—´
pathlib      # è·¯å¾„æ“ä½œ
os           # ç³»ç»Ÿæ“ä½œ
sys          # ç³»ç»Ÿä¿¡æ¯
```

---

## API æ¥å£æ–‡æ¡£

### ğŸ“¡ å‰ç«¯é¡µé¢è·¯ç”±

#### **1. ç›‘æ§ä¸»é¡µ**
```
GET /data-health-monitor
```
- **åŠŸèƒ½**: å±•ç¤ºç³»ç»Ÿå¥åº·ç›‘æ§é¢æ¿
- **è¿”å›**: HTML é¡µé¢
- **ç‰¹æ€§**: 
  - æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
  - å®æ—¶æ˜¾ç¤ºæ‰€æœ‰é‡‡é›†å™¨çŠ¶æ€
  - æ”¯æŒæ‰‹åŠ¨é‡å¯æ“ä½œ

---

### ğŸ“¡ API æ¥å£

#### **2. è·å–ç³»ç»ŸçŠ¶æ€**
```
GET /api/data-health-monitor/status
```
- **åŠŸèƒ½**: è·å–æ‰€æœ‰é‡‡é›†å™¨çš„å®æ—¶çŠ¶æ€
- **è¿”å›æ ¼å¼**: 
  ```json
  {
    "timestamp": 1739521234.567,
    "beijing_time": "2026-02-15 18:30:00",
    "total_monitors": 20,
    "healthy_count": 18,
    "unhealthy_count": 2,
    "today_restart_count": 5,
    "monitors": [...]
  }
  ```

#### **3. è·å–ç›‘æ§æ—¥å¿—**
```
GET /api/data-health-monitor/logs?limit=50
```
- **å‚æ•°**:
  - `limit`: è¿”å›æœ€è¿‘ N æ¡æ—¥å¿— (é»˜è®¤ 50)
- **è¿”å›æ ¼å¼**:
  ```json
  {
    "logs": [
      "[2026-02-15 18:30:00] âœ… signal-collector: å¥åº·",
      "[2026-02-15 18:30:05] âš ï¸ price-position-collector: æ•°æ®å»¶è¿Ÿ 25.8 åˆ†é’Ÿ",
      "[2026-02-15 18:30:10] ğŸ”§ price-position-collector: æ­£åœ¨é‡å¯..."
    ]
  }
  ```

#### **4. æ‰‹åŠ¨é‡å¯é‡‡é›†å™¨**
```
POST /api/data-health-monitor/restart
Content-Type: application/json

{
  "pm2_name": "signal-collector"
}
```
- **åŠŸèƒ½**: æ‰‹åŠ¨é‡å¯æŒ‡å®šé‡‡é›†å™¨
- **è¿”å›æ ¼å¼**:
  ```json
  {
    "success": true,
    "message": "é‡‡é›†å™¨ signal-collector å·²é‡å¯"
  }
  ```

#### **5. è·å–é‡‡é›†å™¨æ—¥å¿—**
```
GET /api/data-health-monitor/service-logs?pm2_name=signal-collector&lines=50
```
- **å‚æ•°**:
  - `pm2_name`: PM2 è¿›ç¨‹å
  - `lines`: è¿”å›è¡Œæ•° (é»˜è®¤ 50)
- **è¿”å›**: é‡‡é›†å™¨çš„ PM2 æ—¥å¿—å†…å®¹

---

## é…ç½®è¯´æ˜

### âš™ï¸ ç›‘æ§é…ç½® (MONITOR_CONFIG)

#### **é…ç½®æ–‡ä»¶ä½ç½®**
```python
/home/user/webapp/source_code/system_health_monitor_v2.py
```

#### **é…ç½®æ ¼å¼**
```python
MONITOR_CONFIG = {
    'pm2_process_name': ('data_file_pattern', max_delay_minutes),
    # ç¤ºä¾‹ï¼š
    'signal-collector': ('data/signal_timeline/*.jsonl', 10),
}
```

#### **å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|-----|------|-----|
| `pm2_process_name` | string | PM2 è¿›ç¨‹åç§° (å¿…é¡»ä¸ `pm2 list` ä¸­ä¸€è‡´) |
| `data_file_pattern` | string | æ•°æ®æ–‡ä»¶è·¯å¾„æ¨¡å¼ (æ”¯æŒé€šé…ç¬¦ `*`) |
| `max_delay_minutes` | int | æœ€å¤§å…è®¸å»¶è¿Ÿ (åˆ†é’Ÿ)ï¼Œè¶…è¿‡è§†ä¸ºå¼‚å¸¸ |

#### **å»¶è¿Ÿé˜ˆå€¼å»ºè®®**
| é‡‡é›†é¢‘ç‡ | å»ºè®®é˜ˆå€¼ | è¯´æ˜ |
|---------|---------|-----|
| æ¯ 1 åˆ†é’Ÿ | 5 åˆ†é’Ÿ | å…è®¸ 4 æ¬¡å¤±è´¥ |
| æ¯ 5 åˆ†é’Ÿ | 10 åˆ†é’Ÿ | å…è®¸ 1 æ¬¡å¤±è´¥ |
| æ¯ 10 åˆ†é’Ÿ | 20 åˆ†é’Ÿ | å…è®¸ 1 æ¬¡å¤±è´¥ |
| æ¯ 1 å°æ—¶ | 120 åˆ†é’Ÿ | å…è®¸ 1 æ¬¡å¤±è´¥ |
| æ¯å¤© 1 æ¬¡ | 1500 åˆ†é’Ÿ (25 å°æ—¶) | å…è®¸è·¨å¤©å»¶è¿Ÿ |

---

### ğŸ“± Telegram é…ç½®

#### **é…ç½®æ–‡ä»¶ä½ç½®**
```python
/home/user/webapp/config/telegram_config.py
```

#### **é…ç½®å†…å®¹**
```python
# Telegram Bot Token (ä» @BotFather è·å–)
TELEGRAM_BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"

# Telegram Chat ID (å‘é€æ¶ˆæ¯çš„ç›®æ ‡)
TELEGRAM_CHAT_ID = "123456789"
```

#### **è·å–æ–¹æ³•**
1. **åˆ›å»º Bot**:
   - åœ¨ Telegram æœç´¢ `@BotFather`
   - å‘é€ `/newbot` åˆ›å»ºæ–° Bot
   - è·å– Bot Token

2. **è·å– Chat ID**:
   - åœ¨ Telegram æœç´¢ `@userinfobot`
   - å‘é€ä»»æ„æ¶ˆæ¯è·å– Chat ID

3. **é…ç½®æ–‡ä»¶**:
   ```bash
   cd /home/user/webapp/config
   nano telegram_config.py
   # å¡«å…¥ Token å’Œ Chat ID
   ```

4. **é‡å¯ç›‘æ§å™¨**:
   ```bash
   cd /home/user/webapp && pm2 restart system-health-monitor-v2
   ```

---

### ğŸŒ ç¯å¢ƒå˜é‡ (å¯é€‰)

#### **è®¾ç½®æ–¹å¼**
```bash
# åœ¨ PM2 å¯åŠ¨æ—¶è®¾ç½®
pm2 start source_code/system_health_monitor_v2.py \
  --name system-health-monitor-v2 \
  --interpreter python3 \
  --env production \
  -- --check-interval 300
```

#### **æ”¯æŒçš„ç¯å¢ƒå˜é‡**
| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|--------|-----|
| `CHECK_INTERVAL` | 300 ç§’ | æ£€æŸ¥é—´éš” (ç§’) |
| `MAX_RESTART_ATTEMPTS` | 3 | æœ€å¤§é‡å¯æ¬¡æ•° |
| `LOG_LEVEL` | INFO | æ—¥å¿—çº§åˆ« |
| `FLASK_PORT` | 9002 | Flask ç«¯å£ |

---

## PM2 è¿›ç¨‹ç®¡ç†

### ğŸ“‹ æ‰€æœ‰è¢«ç›‘æ§çš„ PM2 è¿›ç¨‹

| ID | è¿›ç¨‹å | è¯´æ˜ | æ•°æ®ç›®å½• | å»¶è¿Ÿé˜ˆå€¼ |
|----|-------|------|---------|---------|
| 0 | flask-app | Flask Web åº”ç”¨ | - | N/A |
| 1 | signal-collector | ä¿¡å·æ—¶é—´çº¿ç³»ç»Ÿ | data/signal_timeline/ | 10 åˆ†é’Ÿ |
| 2 | price-position-collector | ä»·æ ¼ä½ç½®ç³»ç»Ÿ | data/price_position_10m/ | 10 åˆ†é’Ÿ |
| 3 | price-speed-collector | ä»·æ ¼æ¶¨é€Ÿç³»ç»Ÿ | data/price_speed_10m/ | 5 åˆ†é’Ÿ |
| 4 | sar-slope-collector | SAR æ–œç‡ç³»ç»Ÿ | data/sar_slope_jsonl/ | 10 åˆ†é’Ÿ |
| 5 | sar-bias-stats-collector | SAR åå‘ç»Ÿè®¡ | data/sar_bias_stats/ | 10 åˆ†é’Ÿ |
| 6 | liquidation-1h-collector | 1 å°æ—¶çˆ†ä»“æ•°æ® | data/liquidation_1h/ | 120 åˆ†é’Ÿ |
| 7 | okx-day-change-collector | OKX æ—¥æ¶¨è·Œæ•°æ® | data/okx_day_change/ | 1500 åˆ†é’Ÿ |
| 8 | price-comparison-collector | ä»·æ ¼å¯¹æ¯”ç³»ç»Ÿ | data/price_comparison/ | 10 åˆ†é’Ÿ |
| 9 | v1v2-collector | V1V2 æ¯”ç‡ç³»ç»Ÿ | data/v1v2_ratios/ | 10 åˆ†é’Ÿ |
| 10 | panic-wash-collector | ææ…Œæ¸…æ´—æŒ‡æ•° | data/panic_wash/ | 10 åˆ†é’Ÿ |
| 11 | coin-change-tracker | 27 å¸æ¶¨è·Œå¹…è¿½è¸ª | data/coin_changes/ | 10 åˆ†é’Ÿ |
| 12 | crypto-index-collector | åŠ å¯†æŒ‡æ•°é‡‡é›†å™¨ | data/crypto_index/ | 10 åˆ†é’Ÿ |
| 13 | financial-indicators-collector | é‡‘èæŒ‡æ ‡é‡‡é›†å™¨ | data/financial_indicators/ | 1500 åˆ†é’Ÿ |
| 14 | okx-trade-history-collector | OKX äº¤æ˜“å†å² | data/okx_trade_history/ | 10 åˆ†é’Ÿ |
| 15 | okx-trading-marks-collector | OKX äº¤æ˜“æ ‡è®° | data/okx_trading_marks/ | 10 åˆ†é’Ÿ |
| 16 | liquidation-alert-monitor | çˆ†ä»“å‘Šè­¦ç›‘æ§ | data/liquidation_alerts/ | 10 åˆ†é’Ÿ |
| 17 | price-baseline-collector | ä»·æ ¼åŸºçº¿é‡‡é›†å™¨ | data/price_baselines/ | 1500 åˆ†é’Ÿ |
| 18 | gdrive-jsonl-manager | Google Drive JSONL ç®¡ç†å™¨ | data/dashboard_jsonl/ | 30 åˆ†é’Ÿ |
| 19 | dashboard-jsonl-manager | ä»ªè¡¨ç›˜ JSONL ç®¡ç†å™¨ | data/dashboard_jsonl/ | 30 åˆ†é’Ÿ |
| 24 | system-health-monitor-v2 | ç³»ç»Ÿå¥åº·ç›‘æ§å™¨ V2 | - | N/A |

### ğŸ”§ å¸¸ç”¨ PM2 å‘½ä»¤

#### **æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹**
```bash
cd /home/user/webapp && pm2 list
```

#### **æŸ¥çœ‹ç›‘æ§å™¨çŠ¶æ€**
```bash
cd /home/user/webapp && pm2 status system-health-monitor-v2
```

#### **æŸ¥çœ‹ç›‘æ§å™¨æ—¥å¿—**
```bash
cd /home/user/webapp && pm2 logs system-health-monitor-v2 --lines 50
```

#### **é‡å¯ç›‘æ§å™¨**
```bash
cd /home/user/webapp && pm2 restart system-health-monitor-v2
```

#### **åœæ­¢ç›‘æ§å™¨**
```bash
cd /home/user/webapp && pm2 stop system-health-monitor-v2
```

#### **åˆ é™¤ç›‘æ§å™¨**
```bash
cd /home/user/webapp && pm2 delete system-health-monitor-v2
```

#### **é‡æ–°åŠ è½½ç›‘æ§å™¨ (æ— åœæœº)**
```bash
cd /home/user/webapp && pm2 reload system-health-monitor-v2
```

#### **æŸ¥çœ‹ç‰¹å®šé‡‡é›†å™¨æ—¥å¿—**
```bash
cd /home/user/webapp && pm2 logs signal-collector --lines 100
```

#### **é‡å¯æ‰€æœ‰é‡‡é›†å™¨**
```bash
cd /home/user/webapp && pm2 restart all
```

---

## æ•°æ®ç›®å½•è¯¦æƒ…

### ğŸ“ æ•°æ®å­˜å‚¨ç›®å½•

```
/home/user/webapp/data/
â”œâ”€â”€ signal_timeline/                   # ä¿¡å·æ—¶é—´çº¿ (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ price_position_10m/                # ä»·æ ¼ä½ç½® (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ price_speed_10m/                   # ä»·æ ¼æ¶¨é€Ÿ (5 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ sar_slope_jsonl/                   # SAR æ–œç‡ (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ sar_bias_stats/                    # SAR åå‘ç»Ÿè®¡ (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ liquidation_1h/                    # 1 å°æ—¶çˆ†ä»“ (120 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ okx_day_change/                    # OKX æ—¥æ¶¨è·Œ (1500 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ price_comparison/                  # ä»·æ ¼å¯¹æ¯” (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ v1v2_ratios/                       # V1V2 æ¯”ç‡ (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ panic_wash/                        # ææ…Œæ¸…æ´— (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ coin_changes/                      # å¸ç§å˜åŒ– (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ crypto_index/                      # åŠ å¯†æŒ‡æ•° (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ financial_indicators/              # é‡‘èæŒ‡æ ‡ (1500 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ okx_trade_history/                 # äº¤æ˜“å†å² (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ okx_trading_marks/                 # äº¤æ˜“æ ‡è®° (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ liquidation_alerts/                # çˆ†ä»“å‘Šè­¦ (10 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ price_baselines/                   # ä»·æ ¼åŸºçº¿ (1500 åˆ†é’Ÿæ£€æŸ¥)
â”œâ”€â”€ dashboard_jsonl/                   # ä»ªè¡¨ç›˜æ•°æ® (30 åˆ†é’Ÿæ£€æŸ¥)
â””â”€â”€ data_health_monitor_state.json    # ç›‘æ§çŠ¶æ€å¿«ç…§
```

### ğŸ“Š æ–‡ä»¶å‘½åè§„åˆ™

#### **æŒ‰æ—¥æœŸå‘½å (å¤§éƒ¨åˆ†é‡‡é›†å™¨)**
```
{category}_{YYYYMMDD}.jsonl
ä¾‹å¦‚ï¼š
- signal_timeline_20260215.jsonl
- price_position_10m_20260215.jsonl
- sar_bias_stats_20260215.jsonl
```

#### **å›ºå®šåç§° (éƒ¨åˆ†ç³»ç»Ÿ)**
```
- latest_sar_slope.jsonl (SAR æ–œç‡æœ€æ–°å¿«ç…§)
- sar_slope_data.jsonl (SAR æ–œç‡å†å²æ•°æ®)
```

---

## æ•…éšœæ’æŸ¥

### ğŸ” å¸¸è§é—®é¢˜

#### **é—®é¢˜ 1: ç›‘æ§å™¨æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿå¼‚å¸¸**
- **åŸå› **: ç›‘æ§å™¨è‡ªèº«æœªå¯åŠ¨æˆ–é…ç½®é”™è¯¯
- **æ’æŸ¥æ­¥éª¤**:
  ```bash
  # 1. æ£€æŸ¥ç›‘æ§å™¨çŠ¶æ€
  cd /home/user/webapp && pm2 status system-health-monitor-v2
  
  # 2. æŸ¥çœ‹æ—¥å¿—
  cd /home/user/webapp && pm2 logs system-health-monitor-v2 --lines 50
  
  # 3. é‡å¯ç›‘æ§å™¨
  cd /home/user/webapp && pm2 restart system-health-monitor-v2
  ```

#### **é—®é¢˜ 2: é‡‡é›†å™¨ä¸€ç›´é‡å¯å¤±è´¥**
- **åŸå› **: æ•°æ®ç›®å½•æƒé™é—®é¢˜ / API å¯†é’¥å¤±æ•ˆ / ç½‘ç»œé—®é¢˜
- **æ’æŸ¥æ­¥éª¤**:
  ```bash
  # 1. æŸ¥çœ‹é‡‡é›†å™¨æ—¥å¿—
  cd /home/user/webapp && pm2 logs {collector-name} --lines 100
  
  # 2. æ£€æŸ¥æ•°æ®ç›®å½•
  cd /home/user/webapp && ls -lh data/{data_dir}/
  
  # 3. æ‰‹åŠ¨è¿è¡Œé‡‡é›†å™¨
  cd /home/user/webapp && python3 source_code/{collector_script}.py
  
  # 4. æ£€æŸ¥ç½‘ç»œè¿æ¥
  curl -I https://www.okx.com/api/v5/market/tickers
  ```

#### **é—®é¢˜ 3: Telegram é€šçŸ¥æœªæ”¶åˆ°**
- **åŸå› **: Bot Token æˆ– Chat ID é…ç½®é”™è¯¯
- **æ’æŸ¥æ­¥éª¤**:
  ```bash
  # 1. æ£€æŸ¥é…ç½®æ–‡ä»¶
  cat /home/user/webapp/config/telegram_config.py
  
  # 2. æµ‹è¯• Telegram API
  curl -X POST "https://api.telegram.org/bot{YOUR_TOKEN}/sendMessage" \
    -d "chat_id={YOUR_CHAT_ID}" \
    -d "text=æµ‹è¯•æ¶ˆæ¯"
  
  # 3. æŸ¥çœ‹ç›‘æ§å™¨æ—¥å¿—ä¸­çš„ Telegram é”™è¯¯
  cd /home/user/webapp && pm2 logs system-health-monitor-v2 | grep -i telegram
  ```

#### **é—®é¢˜ 4: çŠ¶æ€æ–‡ä»¶ä¸æ›´æ–°**
- **åŸå› **: ç›‘æ§å™¨å†™å…¥æƒé™é—®é¢˜
- **æ’æŸ¥æ­¥éª¤**:
  ```bash
  # 1. æ£€æŸ¥æ–‡ä»¶æƒé™
  ls -lh /home/user/webapp/data/data_health_monitor_state.json
  
  # 2. ä¿®å¤æƒé™
  chmod 664 /home/user/webapp/data/data_health_monitor_state.json
  
  # 3. æŸ¥çœ‹ç£ç›˜ç©ºé—´
  df -h /home/user/webapp/data/
  ```

---

## ç³»ç»Ÿç»´æŠ¤

### ğŸ”§ æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡

#### **æ¯æ—¥æ£€æŸ¥**
```bash
# 1. æŸ¥çœ‹ç³»ç»Ÿå¥åº·åº¦
curl http://localhost:9002/api/data-health-monitor/status | jq .

# 2. æ£€æŸ¥ä»Šæ—¥é‡å¯æ¬¡æ•°
cd /home/user/webapp && pm2 logs system-health-monitor-v2 --lines 20 | grep "é‡å¯"
```

#### **æ¯å‘¨æ£€æŸ¥**
```bash
# 1. æ¸…ç†è¿‡æœŸæ—¥å¿—
cd /home/user/webapp && find logs/ -name "*.log" -mtime +7 -delete

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /home/user/webapp/data/

# 3. å¤‡ä»½çŠ¶æ€æ–‡ä»¶
cp /home/user/webapp/data/data_health_monitor_state.json \
   /home/user/webapp/backups/state_$(date +%Y%m%d).json
```

#### **æ¯æœˆæ£€æŸ¥**
```bash
# 1. æ›´æ–°ä¾èµ–åŒ…
cd /home/user/webapp && pip3 install --upgrade -r requirements.txt

# 2. æ£€æŸ¥ PM2 ç‰ˆæœ¬
pm2 --version

# 3. æ¸…ç†æ—§æ•°æ® (ä¿ç•™ 30 å¤©)
cd /home/user/webapp && find data/ -name "*.jsonl" -mtime +30 -delete
```

---

## ç‰ˆæœ¬å†å²

### ğŸ“ æ›´æ–°æ—¥å¿—

#### **V2.0 (2026-02-15)**
- âœ… å…¨æ–°æ¶æ„ï¼Œæ”¯æŒ 20+ é‡‡é›†å™¨ç›‘æ§
- âœ… è‡ªåŠ¨ä¿®å¤æœºåˆ¶ (æœ€å¤š 3 æ¬¡é‡å¯)
- âœ… Telegram å‘Šè­¦é€šçŸ¥
- âœ… å¯è§†åŒ–ç›‘æ§é¢æ¿
- âœ… RESTful API æ¥å£
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… æ‰‹åŠ¨æ“ä½œæ¥å£

#### **V1.0 (2026-01-01)**
- åŸºç¡€ç›‘æ§åŠŸèƒ½
- ç®€å•çš„çŠ¶æ€æ£€æŸ¥
- æ‰‹åŠ¨é‡å¯æ“ä½œ

---

## è”ç³»ä¸æ”¯æŒ

### ğŸ“® è·å–å¸®åŠ©
- **é—®é¢˜åé¦ˆ**: é€šè¿‡ Telegram å‘é€å‘Šè­¦
- **æ—¥å¿—æŸ¥çœ‹**: `pm2 logs system-health-monitor-v2`
- **å®æ—¶ç›‘æ§**: https://9002-{sandbox-id}.sandbox.novita.ai/data-health-monitor

### ğŸ”— ç›¸å…³é“¾æ¥
- Flask æ–‡æ¡£: https://flask.palletsprojects.com/
- PM2 æ–‡æ¡£: https://pm2.keymetrics.io/docs/
- Telegram Bot API: https://core.telegram.org/bots/api

---

**æ–‡æ¡£æœ€åæ›´æ–°**: 2026-02-15 18:30:00
**æ–‡æ¡£ç‰ˆæœ¬**: V2.0.0
**ç³»ç»Ÿç‰ˆæœ¬**: V2.0.0
