# SAR æ–œç‡ç›‘æ§ç³»ç»Ÿå®Œæ•´æŠ€æœ¯æ–‡æ¡£

## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
4. [è¿è¡Œæµç¨‹](#è¿è¡Œæµç¨‹)
5. [æ•°æ®å­˜å‚¨æ ¼å¼](#æ•°æ®å­˜å‚¨æ ¼å¼)
6. [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
7. [æŠ€æœ¯ä¾èµ–](#æŠ€æœ¯ä¾èµ–)
8. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
9. [éƒ¨ç½²ä¸é…ç½®](#éƒ¨ç½²ä¸é…ç½®)
10. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿæ¦‚è¿°

### ğŸ¯ ç³»ç»Ÿå®šä½

**SAR æ–œç‡ç›‘æ§ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªå®æ—¶åŠ å¯†è´§å¸è¶‹åŠ¿åˆ†æå·¥å…·ï¼ŒåŸºäº **æŠ›ç‰©çº¿è½¬å‘æŒ‡æ ‡ (Parabolic SAR)** å’Œ **æ–œç‡åˆ†æ**ï¼Œä¸ºäº¤æ˜“è€…æä¾›ï¼š

- âœ… **å®æ—¶è¶‹åŠ¿åˆ¤æ–­**ï¼š29ç§ä¸»æµåŠ å¯†è´§å¸çš„å¤šç©ºè¶‹åŠ¿
- âœ… **è±¡é™å®šä½**ï¼š4ä¸ªè±¡é™ç²¾å‡†å®šä½å½“å‰å¸‚åœºä½ç½®
- âœ… **æŒç»­æ—¶é•¿è¿½è¸ª**ï¼šè¶‹åŠ¿æŒç»­æ—¶é—´å®æ—¶ç›‘æ§
- âœ… **æ–œç‡å˜åŒ–**ï¼šSAR çº¿çš„æ–œç‡æ–¹å‘ï¼ˆä¸Šå‡/ä¸‹é™ï¼‰
- âœ… **å†å²æ•°æ®æŸ¥è¯¢**ï¼šå®Œæ•´çš„å†å²è¶‹åŠ¿æ•°æ®å½’æ¡£

### ğŸ“Š ç›‘æ§å¸ç§ï¼ˆ29ä¸ªï¼‰

```
AAVE, APT, BCH, BNB, BTC, CFX, CRO, CRV,
DOGE, DOT, ETC, ETH, FIL, HBAR, LDO, LINK,
LTC, NEAR, OKB, SOL, STX, SUI, TAO, TON,
TRX, UNI, XLM, XRP, ADA
```

**æ³¨æ„**ï¼šå·²ç§»é™¤ MATICï¼ˆæ›´åä¸º POLï¼Œäº¤æ˜“æ‰€ä¸æ”¯æŒï¼‰

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1. SAR æŒ‡æ ‡ï¼ˆParabolic Stop and Reverseï¼‰

#### ğŸ“– å®šä¹‰

æŠ›ç‰©çº¿è½¬å‘æŒ‡æ ‡æ˜¯ä¸€ä¸ª**è¶‹åŠ¿è¿½è¸ª**å’Œ**æ­¢æŸç‚¹ä½**æŒ‡æ ‡ï¼Œç”±æŠ€æœ¯åˆ†æå¤§å¸ˆ **J. Welles Wilder Jr.** å‘æ˜ã€‚

#### ğŸ§® è®¡ç®—æ–¹æ³•

SAR çš„è®¡ç®—åŸºäºä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ï¼š

| å‚æ•° | ç¬¦å· | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| åŠ é€Ÿå› å­èµ·å§‹å€¼ | AF Start | 0.02 | åˆå§‹åŠ é€Ÿåº¦ |
| åŠ é€Ÿå› å­å¢é‡ | AF Increment | 0.02 | æ¯æ¬¡æ–°æå€¼ç‚¹çš„å¢é‡ |
| åŠ é€Ÿå› å­æœ€å¤§å€¼ | AF Max | 0.20 | åŠ é€Ÿå› å­ä¸Šé™ |

#### å…¬å¼

```
SAR(t) = SAR(t-1) + AF Ã— (EP - SAR(t-1))
```

**å‚æ•°è¯´æ˜**ï¼š
- `SAR(t)` = å½“å‰å‘¨æœŸçš„SARå€¼
- `SAR(t-1)` = å‰ä¸€å‘¨æœŸçš„SARå€¼
- `AF` = åŠ é€Ÿå› å­ï¼ˆ0.02 ~ 0.20ï¼‰
- `EP` = æå€¼ç‚¹ï¼ˆExtreme Pointï¼‰
  - ä¸Šå‡è¶‹åŠ¿ï¼šå‰æœŸæœ€é«˜ä»·
  - ä¸‹é™è¶‹åŠ¿ï¼šå‰æœŸæœ€ä½ä»·

#### ğŸ”„ è¶‹åŠ¿åˆ¤æ–­è§„åˆ™

| æ¡ä»¶ | è¶‹åŠ¿ | SARä½ç½® | è¯´æ˜ |
|------|------|---------|------|
| ä»·æ ¼ > SAR | **ä¸Šå‡è¶‹åŠ¿** (Bullish) | SARåœ¨ä»·æ ¼ä¸‹æ–¹ | å¤šå¤´ä¿¡å· |
| ä»·æ ¼ < SAR | **ä¸‹é™è¶‹åŠ¿** (Bearish) | SARåœ¨ä»·æ ¼ä¸Šæ–¹ | ç©ºå¤´ä¿¡å· |
| ä»·æ ¼çªç ´SAR | **è¶‹åŠ¿åè½¬** | SARè·³è·ƒåˆ°å¦ä¸€ä¾§ | ä¹°å–ä¿¡å· |

#### ğŸ“ SAR çº¦æŸè§„åˆ™

ä¸ºé˜²æ­¢SARå€¼è¿‡äºæ¥è¿‘ä»·æ ¼ï¼Œç³»ç»Ÿè®¾ç½®çº¦æŸï¼š

**ä¸Šå‡è¶‹åŠ¿**ï¼š
```
SAR(t) = min(SAR(t), Low(t-1), Low(t-2))
```
SARä¸èƒ½é«˜äºå‰ä¸¤æœŸçš„æœ€ä½ä»·

**ä¸‹é™è¶‹åŠ¿**ï¼š
```
SAR(t) = max(SAR(t), High(t-1), High(t-2))
```
SARä¸èƒ½ä½äºå‰ä¸¤æœŸçš„æœ€é«˜ä»·

---

### 2. å››è±¡é™ç³»ç»Ÿ

ç³»ç»Ÿå°†å¸‚åœºåˆ’åˆ†ä¸º**4ä¸ªè±¡é™**ï¼Œç²¾å‡†å®šä½å½“å‰çŠ¶æ€ï¼š

| è±¡é™ | è‹±æ–‡ä»£å· | ä»·æ ¼ä½ç½® | SARè¶‹åŠ¿ | å¸‚åœºå«ä¹‰ | æ“ä½œå»ºè®® |
|------|---------|---------|---------|---------|---------|
| **ç¬¬ä¸€è±¡é™** | Q1 | ä»·æ ¼ > SAR | Bullish | ğŸŸ¢ å¼ºåŠ¿ä¸Šæ¶¨ | æŒæœ‰å¤šå• |
| **ç¬¬äºŒè±¡é™** | Q2 | ä»·æ ¼ < SAR | Bullish | ğŸŸ¡ å³å°†åè½¬ï¼ˆå¤šâ†’ç©ºï¼‰ | è­¦æƒ•åšç©º |
| **ç¬¬ä¸‰è±¡é™** | Q3 | ä»·æ ¼ < SAR | Bearish | ğŸ”´ å¼ºåŠ¿ä¸‹è·Œ | æŒæœ‰ç©ºå• |
| **ç¬¬å››è±¡é™** | Q4 | ä»·æ ¼ > SAR | Bearish | ğŸŸ¡ å³å°†åè½¬ï¼ˆç©ºâ†’å¤šï¼‰ | è­¦æƒ•åšå¤š |

#### ğŸ“Š è±¡é™ç¤ºæ„å›¾

```
         ä»·æ ¼ vs SAR
            â†‘
    Q2      |      Q1
  (å¤šâ†’ç©º)   |   (å¼ºåŠ¿ä¸Šæ¶¨)
ä»·æ ¼<SAR    |   ä»·æ ¼>SAR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¶‹åŠ¿
  (å¼ºåŠ¿ä¸‹è·Œ) |   (ç©ºâ†’å¤š)
    Q3      |      Q4
ä»·æ ¼<SAR    |   ä»·æ ¼>SAR
            â†“
```

#### ğŸ¯ äº¤æ˜“ä¿¡å·

- **Q1 â†’ Q2**ï¼šä»·æ ¼è·Œç ´SARï¼Œå³å°†åšç©ºä¿¡å·
- **Q2 â†’ Q3**ï¼šè¶‹åŠ¿åè½¬ç¡®è®¤ï¼Œåšç©ºä¿¡å·
- **Q3 â†’ Q4**ï¼šä»·æ ¼çªç ´SARï¼Œå³å°†åšå¤šä¿¡å·
- **Q4 â†’ Q1**ï¼šè¶‹åŠ¿åè½¬ç¡®è®¤ï¼Œåšå¤šä¿¡å·

---

### 3. SAR æ–œç‡åˆ†æ

#### ğŸ“ˆ æ–œç‡å®šä¹‰

**æ–œç‡**è¡¨ç¤º SAR çº¿çš„å˜åŒ–é€Ÿåº¦å’Œæ–¹å‘ï¼š

```python
slope = (SARå€¼å˜åŒ–é‡) / (æ—¶é—´çª—å£)
```

#### ğŸ§® è®¡ç®—æ–¹æ³•

ä½¿ç”¨**çº¿æ€§å›å½’**è®¡ç®—æœ€è¿‘Nä¸ªå‘¨æœŸçš„SARæ–œç‡ï¼š

```python
def calculate_slope(sar_values, window=5):
    recent_sar = sar_values[-window:]  # æœ€è¿‘5ä¸ªå‘¨æœŸ
    x = np.arange(len(recent_sar))      # æ—¶é—´åºåˆ— [0,1,2,3,4]
    
    # çº¿æ€§æ‹Ÿåˆ: y = slope * x + intercept
    coefficients = np.polyfit(x, recent_sar, 1)
    slope = coefficients[0]  # æå–æ–œç‡
    
    return float(slope)
```

#### ğŸ“Š æ–œç‡å«ä¹‰

| æ–œç‡å€¼ | æ–¹å‘ | è¶‹åŠ¿å«ä¹‰ | äº¤æ˜“å«ä¹‰ |
|--------|------|---------|---------|
| > 0 | **UP** â¬†ï¸ | SARä¸Šå‡ | ç©ºå¤´åŠ›é‡å‡å¼± / å¤šå¤´åŠ›é‡å¢å¼º |
| < 0 | **DOWN** â¬‡ï¸ | SARä¸‹é™ | å¤šå¤´åŠ›é‡å‡å¼± / ç©ºå¤´åŠ›é‡å¢å¼º |
| â‰ˆ 0 | **FLAT** â¡ï¸ | SARå¹³ç¨³ | è¶‹åŠ¿çŠ¹è±«ï¼Œç­‰å¾…çªç ´ |

#### ğŸ¯ æ–œç‡ä¸è¶‹åŠ¿ç»“åˆ

| SAR Position | Slope | å¸‚åœºçŠ¶æ€ | æ“ä½œå»ºè®® |
|-------------|-------|---------|---------|
| Bullish | UP â¬†ï¸ | ğŸŸ¢ åŠ é€Ÿä¸Šæ¶¨ | è¿½æ¶¨/æŒæœ‰å¤šå• |
| Bullish | DOWN â¬‡ï¸ | ğŸŸ¡ ä¸Šæ¶¨æ”¾ç¼“ | è­¦æƒ•åè½¬ |
| Bearish | UP â¬†ï¸ | ğŸŸ¡ ä¸‹è·Œæ”¾ç¼“ | è­¦æƒ•åè½¬ |
| Bearish | DOWN â¬‡ï¸ | ğŸ”´ åŠ é€Ÿä¸‹è·Œ | è¿½ç©º/æŒæœ‰ç©ºå• |

---

### 4. æŒç»­æ—¶é•¿ï¼ˆDurationï¼‰

#### ğŸ“… å®šä¹‰

**æŒç»­æ—¶é•¿**æŒ‡å½“å‰è¶‹åŠ¿ï¼ˆBullish/Bearishï¼‰å·²ç»æŒç»­çš„åˆ†é’Ÿæ•°ã€‚

#### ğŸ”„ è®¡ç®—é€»è¾‘

```python
if å½“å‰è¶‹åŠ¿ == ä¸Šä¸€æ¬¡è¶‹åŠ¿:
    duration_minutes = ä¸Šæ¬¡æŒç»­æ—¶é•¿ + 1  # ç´¯åŠ 
else:
    duration_minutes = 1  # æ–°è¶‹åŠ¿å¼€å§‹ï¼Œé‡ç½®ä¸º1
```

#### ğŸ“Š æ—¶é•¿å«ä¹‰

| æŒç»­æ—¶é•¿ | å¸‚åœºå«ä¹‰ | æ“ä½œå»ºè®® |
|---------|---------|---------|
| 1-10 åˆ†é’Ÿ | ğŸ†• æ–°è¶‹åŠ¿åˆšå¼€å§‹ | è§‚å¯Ÿç¡®è®¤ |
| 10-30 åˆ†é’Ÿ | âœ… è¶‹åŠ¿åˆæ­¥ç¡®è®¤ | å¯ä»¥å…¥åœº |
| 30-60 åˆ†é’Ÿ | ğŸ’ª è¶‹åŠ¿ç¨³å›º | æŒæœ‰ä»“ä½ |
| 60-120 åˆ†é’Ÿ | âš ï¸ è¶‹åŠ¿æˆç†Ÿ | æ³¨æ„è·åˆ©äº†ç»“ |
| 120+ åˆ†é’Ÿ | ğŸš¨ è¶‹åŠ¿åæœŸ | è­¦æƒ•åè½¬ |

#### ğŸ¯ é‡è¦é˜ˆå€¼

ç³»ç»Ÿè®¾ç½®**80åˆ†é’Ÿ**ä¸ºé‡è¦é˜ˆå€¼ï¼š

```
æŒç»­æ—¶é•¿ â‰¥ 80 åˆ†é’Ÿ â†’ æ ‡è®°ä¸º "æˆç†Ÿè¶‹åŠ¿"
```

ç”¨äºç»Ÿè®¡é¡µé¢çš„"80+å¸ç§æ•°é‡"æŒ‡æ ‡ã€‚

---

## ç³»ç»Ÿæ¶æ„

### ğŸ“ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SAR æ–œç‡ç›‘æ§ç³»ç»Ÿ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚ æ•°æ®é‡‡é›†å±‚ â”‚         â”‚ æ•°æ®å­˜å‚¨å±‚ â”‚       â”‚  APIæœåŠ¡å±‚  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚ OKX API          â”‚      â”‚              â”‚ Flask REST  â”‚
   â”‚ - è·å–Kçº¿æ•°æ®    â”‚      â”‚              â”‚  API        â”‚
   â”‚ - 1åˆ†é’Ÿçº§åˆ«      â”‚      â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚ - 100æ ¹Kçº¿       â”‚      â”‚                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                              â”‚              â”‚  å‰ç«¯å±•ç¤º   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”         â”‚ - è¡¨æ ¼è§†å›¾  â”‚
   â”‚ SAR è®¡ç®—å¼•æ“   â”‚    â”‚ JSONL  â”‚         â”‚ - ç»Ÿè®¡å¡ç‰‡  â”‚
   â”‚ - calculate_sar â”‚    â”‚ æ–‡ä»¶   â”‚         â”‚ - å›¾è¡¨å±•ç¤º  â”‚
   â”‚ - è¶‹åŠ¿åˆ¤æ–­      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ - è±¡é™å®šä½      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ–œç‡è®¡ç®—å¼•æ“   â”‚
   â”‚ - çº¿æ€§æ‹Ÿåˆ      â”‚
   â”‚ - çª—å£=5       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PM2 å®ˆæŠ¤è¿›ç¨‹   â”‚
   â”‚ - è‡ªåŠ¨é‡å¯      â”‚
   â”‚ - æ—¥å¿—ç®¡ç†      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ”„ æ•°æ®æµè½¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OKX API  â”‚  æ¯5åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â”€â–º è·å–100æ ¹1åˆ†é’ŸKçº¿æ•°æ®
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kçº¿æ•°æ®é¢„å¤„ç†   â”‚
â”‚  - highæ•°ç»„      â”‚
â”‚  - lowæ•°ç»„       â”‚
â”‚  - closeæ•°ç»„     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAR æŒ‡æ ‡è®¡ç®—    â”‚
â”‚  - sar_values[]  â”‚
â”‚  - trends[]      â”‚
â”‚  - eps[]         â”‚
â”‚  - afs[]         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â”€â–º æ–œç‡è®¡ç®— (window=5)
      â”‚
      â”œâ”€â”€â–º è±¡é™åˆ¤æ–­
      â”‚
      â”œâ”€â”€â–º æŒç»­æ—¶é•¿è®¡ç®—
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å»ºæ•°æ®è®°å½•    â”‚
â”‚  - timestamp     â”‚
â”‚  - position      â”‚
â”‚  - quadrant      â”‚
â”‚  - slope_value   â”‚
â”‚  - duration_min  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿å­˜åˆ° JSONL     â”‚
â”‚ - è¿½åŠ å†™å…¥æ¨¡å¼   â”‚
â”‚ - æ¯è¡Œä¸€æ¡è®°å½•   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask API       â”‚
â”‚  è¯»å–å¹¶æä¾›æ•°æ®  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯é¡µé¢å±•ç¤º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¿è¡Œæµç¨‹

### ğŸš€ ç³»ç»Ÿå¯åŠ¨æµç¨‹

#### 1. PM2 è¿›ç¨‹å¯åŠ¨

```bash
# å¯åŠ¨ SAR æ–œç‡é‡‡é›†å™¨
pm2 start source_code/sar_slope_collector.py \
    --name sar-slope-collector \
    --interpreter python3 \
    --cron-restart="0 */6 * * *"  # æ¯6å°æ—¶è‡ªåŠ¨é‡å¯
```

#### 2. åˆå§‹åŒ–é˜¶æ®µ

```python
# é…ç½®åŠ è½½
DATA_DIR = Path('/home/user/webapp/data/sar_jsonl')
DATA_DIR.mkdir(parents=True, exist_ok=True)

# å¸ç§åˆ—è¡¨åŠ è½½
SYMBOLS = ['AAVE', 'APT', ..., 'ADA']  # 29ä¸ªå¸ç§

# SARå‚æ•°è®¾ç½®
SAR_AF_START = 0.02
SAR_AF_INCREMENT = 0.02
SAR_AF_MAX = 0.2
```

#### 3. ä¸»å¾ªç¯æ‰§è¡Œ

```python
while True:
    # Step 1: éå†æ‰€æœ‰å¸ç§
    for symbol in SYMBOLS:
        process_symbol(symbol)
        time.sleep(0.1)  # é¿å…è¯·æ±‚è¿‡å¿«
    
    # Step 2: ç»Ÿè®¡ç»“æœ
    print(f"æˆåŠŸ: {success_count}/{len(SYMBOLS)}")
    print(f"å¤šå¤´: {bullish_count}, ç©ºå¤´: {bearish_count}")
    
    # Step 3: ç­‰å¾…ä¸‹æ¬¡é‡‡é›†ï¼ˆ5åˆ†é’Ÿï¼‰
    time.sleep(300)
```

---

### ğŸ“Š å•å¸ç§å¤„ç†æµç¨‹

#### å®Œæ•´æµç¨‹å›¾

```
å¼€å§‹å¤„ç†å¸ç§ (e.g., BTC)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è·å–Kçº¿æ•°æ®      â”‚
â”‚  - OKX APIè°ƒç”¨      â”‚
â”‚  - ä¼˜å…ˆæ°¸ç»­åˆçº¦     â”‚
â”‚  - å¤±è´¥åˆ™å°è¯•ç°è´§   â”‚
â”‚  - è·å–100æ ¹Kçº¿     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ•°æ®é¢„å¤„ç†       â”‚
â”‚  - æå– high[]      â”‚
â”‚  - æå– low[]       â”‚
â”‚  - æå– close[]     â”‚
â”‚  - è½¬ä¸º numpyæ•°ç»„   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è®¡ç®— SAR æŒ‡æ ‡    â”‚
â”‚  - calculate_sar()  â”‚
â”‚  - è¿”å›100ä¸ªSARå€¼   â”‚
â”‚  - è¶‹åŠ¿æ•°ç»„         â”‚
â”‚  - EP/AFæ•°ç»„        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æå–æœ€æ–°å€¼       â”‚
â”‚  - sar_values[-1]   â”‚
â”‚  - close[-1]        â”‚
â”‚  - trends[-1]       â”‚
â”‚  - timestamp        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è®¡ç®—æ–œç‡         â”‚
â”‚  - å–æœ€è¿‘5ä¸ªSARå€¼   â”‚
â”‚  - çº¿æ€§æ‹Ÿåˆ         â”‚
â”‚  - æå–æ–œç‡ç³»æ•°     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. åˆ¤æ–­è±¡é™         â”‚
â”‚  - get_quadrant()   â”‚
â”‚  - åŸºäºä»·æ ¼/SAR     â”‚
â”‚  - åŸºäºè¶‹åŠ¿æ–¹å‘     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. è®¡ç®—æŒç»­æ—¶é•¿     â”‚
â”‚  - è¯»å–ä¸Šæ¬¡è®°å½•     â”‚
â”‚  - æ¯”è¾ƒè¶‹åŠ¿æ˜¯å¦å˜åŒ– â”‚
â”‚  - ç´¯åŠ æˆ–é‡ç½®ä¸º1    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è®¡ç®—SARå·®å€¼      â”‚
â”‚  - ç»å¯¹å·®å€¼         â”‚
â”‚  - ç™¾åˆ†æ¯”å·®å€¼       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. æ„å»ºæ•°æ®è®°å½•     â”‚
â”‚  - 12ä¸ªå­—æ®µ         â”‚
â”‚  - JSONæ ¼å¼         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. è¿½åŠ å†™å…¥JSONL   â”‚
â”‚  - æ‰“å¼€æ–‡ä»¶(è¿½åŠ )   â”‚
â”‚  - å†™å…¥ä¸€è¡ŒJSON     â”‚
â”‚  - è‡ªåŠ¨æ¢è¡Œ         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
  å¤„ç†å®Œæˆ âœ…
```

---

### ğŸ” è¯¦ç»†æ­¥éª¤è¯´æ˜

#### Step 1: è·å–Kçº¿æ•°æ®

```python
def get_klines(symbol, limit=100):
    # ä¼˜å…ˆå°è¯•æ°¸ç»­åˆçº¦
    url = f"https://www.okx.com/api/v5/market/candles?instId={symbol}-USDT-SWAP&bar=1m&limit={limit}"
    response = requests.get(url, timeout=10)
    
    # å¤±è´¥åˆ™å°è¯•ç°è´§
    if response.json().get('code') != '0':
        url = f"https://www.okx.com/api/v5/market/candles?instId={symbol}-USDT&bar=1m&limit={limit}"
        response = requests.get(url, timeout=10)
    
    # è§£ææ•°æ®
    klines = []
    for candle in reversed(data['data']):  # åè½¬ä¸ºæ—¶é—´å‡åº
        klines.append({
            'timestamp': int(candle[0]),
            'open': float(candle[1]),
            'high': float(candle[2]),
            'low': float(candle[3]),
            'close': float(candle[4]),
            'volume': float(candle[5])
        })
    
    return klines
```

#### Step 2: SAR è®¡ç®—

```python
def calculate_sar(high, low, close):
    length = len(high)
    sar = np.zeros(length)
    trend = np.zeros(length)
    ep = np.zeros(length)
    af = np.zeros(length)
    
    # åˆå§‹åŒ–
    sar[0] = low[0]
    trend[0] = 1  # å‡è®¾åˆå§‹ä¸Šå‡
    ep[0] = high[0]
    af[0] = 0.02
    
    for i in range(1, length):
        # è®¡ç®—å½“å‰SAR
        sar[i] = sar[i-1] + af[i-1] * (ep[i-1] - sar[i-1])
        
        # åˆ¤æ–­è¶‹åŠ¿åè½¬...
        # (è¯¦ç»†é€»è¾‘è§æºç )
    
    return sar, trend, ep, af
```

#### Step 3: æ–œç‡è®¡ç®—

```python
def calculate_slope(sar_values, window=5):
    recent_sar = sar_values[-5:]  # æœ€è¿‘5ä¸ªå€¼
    x = [0, 1, 2, 3, 4]            # æ—¶é—´åºåˆ—
    
    # çº¿æ€§æ‹Ÿåˆ: y = slope * x + intercept
    coefficients = np.polyfit(x, recent_sar, 1)
    slope = coefficients[0]
    
    return slope
```

#### Step 4: æ•°æ®è®°å½•æ„å»º

```python
record = {
    'symbol': 'BTC',
    'timestamp': 1770711600000,
    'beijing_time': '2026-02-10 16:20:00',
    'close': 70195.90,
    'sar': 69850.12,
    'position': 'bullish',
    'quadrant': 'Q1',
    'duration_minutes': 45,
    'slope_value': 12.5678,
    'slope_direction': 'up',
    'sar_diff_abs': 345.78,
    'sar_diff_pct': 0.49
}
```

#### Step 5: å†™å…¥ JSONL

```python
def save_to_jsonl(symbol, data):
    file_path = f"/home/user/webapp/data/sar_jsonl/{symbol}.jsonl"
    
    with open(file_path, 'a', encoding='utf-8') as f:
        f.write(json.dumps(data, ensure_ascii=False) + '\n')
```

---

## æ•°æ®å­˜å‚¨æ ¼å¼

### ğŸ“ ç›®å½•ç»“æ„

```
/home/user/webapp/data/
â”œâ”€â”€ sar_jsonl/                    # åŸå§‹SARæ•°æ®ï¼ˆæŒ‰å¸ç§åˆ†æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ AAVE.jsonl               # AAVEçš„å†å²è®°å½•
â”‚   â”œâ”€â”€ BTC.jsonl                # BTCçš„å†å²è®°å½•
â”‚   â”œâ”€â”€ ETH.jsonl                # ETHçš„å†å²è®°å½•
â”‚   â””â”€â”€ ...                      # å…¶ä»–27ä¸ªå¸ç§
â”‚
â”œâ”€â”€ sar_slope_jsonl/             # æ±‡æ€»æ•°æ®ï¼ˆè·¨å¸ç§ï¼‰
â”‚   â”œâ”€â”€ latest_sar_slope.jsonl   # æœ€æ–°æ•°æ®å¿«ç…§ï¼ˆ29è¡Œï¼‰
â”‚   â”œâ”€â”€ sar_slope_data.jsonl     # å®Œæ•´å†å²æ•°æ®ï¼ˆç™¾ä¸‡è¡Œçº§åˆ«ï¼‰
â”‚   â””â”€â”€ sar_slope_summary.jsonl  # ç»Ÿè®¡æ‘˜è¦ï¼ˆæ¯æ¬¡é‡‡é›†1è¡Œï¼‰
â”‚
â””â”€â”€ sar_slope/                   # å¤‡ç”¨ç›®å½•ï¼ˆæœªä½¿ç”¨ï¼‰
```

---

### ğŸ“„ JSONL æ–‡ä»¶æ ¼å¼è¯¦è§£

#### 1. åŸå§‹æ•°æ®æ–‡ä»¶ï¼ˆ`data/sar_jsonl/*.jsonl`ï¼‰

**æ–‡ä»¶å‘½å**ï¼š`{SYMBOL}.jsonl`ï¼ˆå¦‚`BTC.jsonl`ï¼‰

**æ•°æ®æ ¼å¼**ï¼š

```json
{
  "symbol": "BTC",
  "timestamp": 1770711600000,
  "beijing_time": "2026-02-10 16:20:00",
  "close": 70195.9,
  "sar": 69850.123456,
  "position": "bullish",
  "quadrant": "Q1",
  "duration_minutes": 45,
  "slope_value": 12.5678,
  "slope_direction": "up",
  "sar_diff_abs": 345.777,
  "sar_diff_pct": 0.4925
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `symbol` | string | å¸ç§ç¬¦å· | `"BTC"` |
| `timestamp` | int | Unixæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ | `1770711600000` |
| `beijing_time` | string | åŒ—äº¬æ—¶é—´ï¼ˆå¯è¯»ï¼‰ | `"2026-02-10 16:20:00"` |
| `close` | float | å½“å‰æ”¶ç›˜ä»· | `70195.9` |
| `sar` | float | SARæŒ‡æ ‡å€¼ï¼ˆ8ä½ç²¾åº¦ï¼‰ | `69850.12345678` |
| `position` | string | è¶‹åŠ¿æ–¹å‘ | `"bullish"` / `"bearish"` |
| `quadrant` | string | è±¡é™å®šä½ | `"Q1"` / `"Q2"` / `"Q3"` / `"Q4"` |
| `duration_minutes` | int | è¶‹åŠ¿æŒç»­æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ | `45` |
| `slope_value` | float | SARæ–œç‡ï¼ˆ4ä½ç²¾åº¦ï¼‰ | `12.5678` |
| `slope_direction` | string | æ–œç‡æ–¹å‘ | `"up"` / `"down"` |
| `sar_diff_abs` | float | SARç»å¯¹å·®å€¼ | `345.777` |
| `sar_diff_pct` | float | SARç™¾åˆ†æ¯”å·®å€¼(%) | `0.4925` |

**å­˜å‚¨ç‰¹ç‚¹**ï¼š
- æ¯ä¸ªå¸ç§ç‹¬ç«‹æ–‡ä»¶
- è¿½åŠ å†™å…¥æ¨¡å¼ï¼ˆappendï¼‰
- æ¯è¡Œä¸€æ¡JSONè®°å½•
- æŒ‰æ—¶é—´é¡ºåºæ’åˆ—
- UTF-8ç¼–ç 

---

#### 2. æœ€æ–°æ•°æ®å¿«ç…§ï¼ˆ`sar_slope_jsonl/latest_sar_slope.jsonl`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨æ‰€æœ‰å¸ç§çš„æœ€æ–°ä¸€æ¡è®°å½•ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢ã€‚

**æ•°æ®æ ¼å¼**ï¼š

```json
{
  "symbol": "BTC",
  "datetime": "2026-02-10 16:20:00",
  "sar_value": 69850.12345678,
  "sar_position": "bullish",
  "sar_quadrant": "Q1",
  "position_duration": 45,
  "slope_value": 12.5678,
  "slope_direction": "up",
  "price": 70195.9,
  "timestamp": 1770711600000
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `symbol` | string | å¸ç§ç¬¦å· |
| `datetime` | string | åŒ—äº¬æ—¶é—´ |
| `sar_value` | float | SARå€¼ |
| `sar_position` | string | è¶‹åŠ¿ï¼ˆbullish/bearishï¼‰ |
| `sar_quadrant` | string | è±¡é™ï¼ˆQ1/Q2/Q3/Q4ï¼‰ |
| `position_duration` | int | æŒç»­æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| `slope_value` | float | æ–œç‡å€¼ |
| `slope_direction` | string | æ–œç‡æ–¹å‘ï¼ˆup/downï¼‰ |
| `price` | float | å½“å‰ä»·æ ¼ |
| `timestamp` | int | Unixæ—¶é—´æˆ³ |

**å­˜å‚¨ç‰¹ç‚¹**ï¼š
- å…¨é‡è¦†ç›–å†™å…¥ï¼ˆæ¯æ¬¡é‡å†™æ•´ä¸ªæ–‡ä»¶ï¼‰
- å›ºå®š29è¡Œï¼ˆå¯¹åº”29ä¸ªå¸ç§ï¼‰
- ç”¨äºå‰ç«¯é¦–å±å¿«é€ŸåŠ è½½

---

#### 3. å®Œæ•´å†å²æ•°æ®ï¼ˆ`sar_slope_jsonl/sar_slope_data.jsonl`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨æ‰€æœ‰å¸ç§çš„å®Œæ•´å†å²è®°å½•ï¼Œç”¨äºå†å²æŸ¥è¯¢å’Œå›¾è¡¨å±•ç¤ºã€‚

**æ•°æ®æ ¼å¼**ï¼š

```json
{
  "timestamp": 1770711600000,
  "collection_time": "2026-02-10 16:25:46",
  "datetime": "2026-02-10 16:20:00",
  "position_duration": 45,
  "price": 70195.9,
  "sar_position": "bullish",
  "sar_quadrant": "Q1",
  "sar_value": 69850.12345678,
  "slope_direction": "up",
  "slope_value": 12.5678,
  "symbol": "BTC"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `timestamp` | int | Kçº¿æ—¶é—´æˆ³ |
| `collection_time` | string | é‡‡é›†æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ |
| `datetime` | string | Kçº¿æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ |
| `position_duration` | int | æŒç»­æ—¶é•¿ |
| `price` | float | ä»·æ ¼ |
| `sar_position` | string | è¶‹åŠ¿ |
| `sar_quadrant` | string | è±¡é™ |
| `sar_value` | float | SARå€¼ |
| `slope_direction` | string | æ–œç‡æ–¹å‘ |
| `slope_value` | float | æ–œç‡å€¼ |
| `symbol` | string | å¸ç§ |

**å­˜å‚¨ç‰¹ç‚¹**ï¼š
- è¿½åŠ å†™å…¥
- å¤šå¸ç§æ··åˆå­˜å‚¨
- æ–‡ä»¶ä½“ç§¯å¤§ï¼ˆ114MB+ï¼‰
- ç”¨äºå†å²æ•°æ®æŸ¥è¯¢

---

#### 4. ç»Ÿè®¡æ‘˜è¦æ–‡ä»¶ï¼ˆ`sar_slope_jsonl/sar_slope_summary.jsonl`ï¼‰

**ç”¨é€”**ï¼šæ¯æ¬¡é‡‡é›†çš„å…¨å±€ç»Ÿè®¡ä¿¡æ¯ã€‚

**æ•°æ®æ ¼å¼**ï¼š

```json
{
  "timestamp": 1769525240.377,
  "collection_time": "2026-01-27 22:47:20",
  "total_symbols": 29,
  "bullish_count": 18,
  "bearish_count": 11,
  "bullish_80_plus_count": 3,
  "bearish_80_plus_count": 2,
  "bullish_80_plus_coins": ["BTC", "ETH", "SOL"],
  "bearish_80_plus_coins": ["DOGE", "XRP"],
  "data_count": 29
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `timestamp` | float | é‡‡é›†æ—¶é—´æˆ³ |
| `collection_time` | string | é‡‡é›†æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ |
| `total_symbols` | int | æ€»å¸ç§æ•° |
| `bullish_count` | int | å¤šå¤´å¸ç§æ•° |
| `bearish_count` | int | ç©ºå¤´å¸ç§æ•° |
| `bullish_80_plus_count` | int | å¤šå¤´æŒç»­â‰¥80åˆ†é’Ÿçš„å¸ç§æ•° |
| `bearish_80_plus_count` | int | ç©ºå¤´æŒç»­â‰¥80åˆ†é’Ÿçš„å¸ç§æ•° |
| `bullish_80_plus_coins` | array | å¤šå¤´80+å¸ç§åˆ—è¡¨ |
| `bearish_80_plus_coins` | array | ç©ºå¤´80+å¸ç§åˆ—è¡¨ |
| `data_count` | int | æˆåŠŸé‡‡é›†çš„å¸ç§æ•° |

**å­˜å‚¨ç‰¹ç‚¹**ï¼š
- è¿½åŠ å†™å…¥
- æ¯æ¬¡é‡‡é›†1è¡Œ
- ç”¨äºè¶‹åŠ¿ç»Ÿè®¡å’Œå†å²å›æº¯

---

## åŠŸèƒ½è¯¦è§£

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

#### 1. å®æ—¶è¶‹åŠ¿ç›‘æ§

**åŠŸèƒ½æè¿°**ï¼š
- å®æ—¶æ˜¾ç¤º29ç§åŠ å¯†è´§å¸çš„å½“å‰è¶‹åŠ¿ï¼ˆBullish/Bearishï¼‰
- ä»¥å¡ç‰‡å½¢å¼å±•ç¤ºï¼Œæ”¯æŒå¿«é€Ÿæµè§ˆ

**æŠ€æœ¯å®ç°**ï¼š
```javascript
// å‰ç«¯æ¯10ç§’è‡ªåŠ¨åˆ·æ–°
setInterval(() => {
    fetch('/api/sar-slope/latest-jsonl')
        .then(res => res.json())
        .then(data => renderCards(data));
}, 10000);
```

**å±•ç¤ºæ•ˆæœ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BTC   ğŸŸ¢    â”‚  â”‚   ETH   ğŸŸ¢    â”‚  â”‚   SOL   ğŸ”´    â”‚
â”‚  Bullish Q1   â”‚  â”‚  Bullish Q1   â”‚  â”‚  Bearish Q3   â”‚
â”‚  æŒç»­ 45 åˆ†é’Ÿ  â”‚  â”‚  æŒç»­ 32 åˆ†é’Ÿ  â”‚  â”‚  æŒç»­ 18 åˆ†é’Ÿ  â”‚
â”‚  æ–œç‡ â¬†ï¸ 12.56 â”‚  â”‚  æ–œç‡ â¬†ï¸ 8.34  â”‚  â”‚  æ–œç‡ â¬‡ï¸ -5.21â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2. è±¡é™å®šä½ç³»ç»Ÿ

**åŠŸèƒ½æè¿°**ï¼š
- 4ä¸ªè±¡é™ç²¾å‡†å®šä½å½“å‰å¸‚åœºä½ç½®
- é¢œè‰²åŒºåˆ†ï¼šQ1ç»¿è‰²ã€Q2é»„è‰²ã€Q3çº¢è‰²ã€Q4é»„è‰²

**æŠ€æœ¯å®ç°**ï¼š
```python
def get_quadrant(price, sar, trend):
    if trend == 1:  # bullish
        return "Q1" if price > sar else "Q2"
    else:  # bearish
        return "Q3" if price < sar else "Q4"
```

**å±•ç¤ºæ•ˆæœ**ï¼š
```
Q1 (ç»¿è‰²)  â†â†’  Q2 (é»„è‰²)
    â†•            â†•
Q4 (é»„è‰²)  â†â†’  Q3 (çº¢è‰²)
```

---

#### 3. æŒç»­æ—¶é•¿è¿½è¸ª

**åŠŸèƒ½æè¿°**ï¼š
- è¿½è¸ªæ¯ä¸ªå¸ç§å½“å‰è¶‹åŠ¿å·²æŒç»­çš„åˆ†é’Ÿæ•°
- æ ‡è®°æŒç»­â‰¥80åˆ†é’Ÿçš„"æˆç†Ÿè¶‹åŠ¿"

**æŠ€æœ¯å®ç°**ï¼š
```python
if last_position == current_position:
    duration_minutes += 1  # ç´¯åŠ 
else:
    duration_minutes = 1   # é‡ç½®
```

**å±•ç¤ºæ•ˆæœ**ï¼š
```
BTC: Bullish æŒç»­ 85 åˆ†é’Ÿ âš ï¸ (æˆç†Ÿè¶‹åŠ¿)
ETH: Bullish æŒç»­ 32 åˆ†é’Ÿ âœ… (ç¨³å›ºè¶‹åŠ¿)
SOL: Bearish æŒç»­ 8 åˆ†é’Ÿ  ğŸ†• (æ–°è¶‹åŠ¿)
```

---

#### 4. æ–œç‡å˜åŒ–ç›‘æ§

**åŠŸèƒ½æè¿°**ï¼š
- æ˜¾ç¤ºSARçº¿çš„å˜åŒ–æ–¹å‘ï¼ˆUP/DOWNï¼‰
- ç»“åˆè¶‹åŠ¿åˆ¤æ–­åŠ é€Ÿ/å‡é€ŸçŠ¶æ€

**æŠ€æœ¯å®ç°**ï¼š
```python
slope_value = calculate_slope(sar_values, window=5)
slope_direction = 'up' if slope_value > 0 else 'down'
```

**å±•ç¤ºæ•ˆæœ**ï¼š
```
BTC: Bullish + UP â¬†ï¸   â†’ ğŸŸ¢ åŠ é€Ÿä¸Šæ¶¨
ETH: Bullish + DOWN â¬‡ï¸ â†’ ğŸŸ¡ ä¸Šæ¶¨æ”¾ç¼“
SOL: Bearish + DOWN â¬‡ï¸ â†’ ğŸ”´ åŠ é€Ÿä¸‹è·Œ
```

---

#### 5. å†å²æ•°æ®æŸ¥è¯¢

**åŠŸèƒ½æè¿°**ï¼š
- ç‚¹å‡»å¸ç§å¡ç‰‡æŸ¥çœ‹è¯¦ç»†å†å²
- æ˜¾ç¤ºè¿‡å»24å°æ—¶çš„è¶‹åŠ¿å˜åŒ–
- å›¾è¡¨å±•ç¤ºä»·æ ¼ã€SARã€æ–œç‡

**æŠ€æœ¯å®ç°**ï¼š
```javascript
function viewDetail(symbol) {
    window.location.href = `/sar-slope-detail?symbol=${symbol}`;
}
```

**å±•ç¤ºæ•ˆæœ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BTC å†å²è¶‹åŠ¿ (æœ€è¿‘24å°æ—¶)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´          è¶‹åŠ¿    è±¡é™  æŒç»­    â”‚
â”‚  16:20  ğŸŸ¢ Bullish  Q1   45åˆ†é’Ÿ    â”‚
â”‚  16:15  ğŸŸ¢ Bullish  Q1   40åˆ†é’Ÿ    â”‚
â”‚  16:10  ğŸŸ¢ Bullish  Q1   35åˆ†é’Ÿ    â”‚
â”‚  ...                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Š ç»Ÿè®¡åŠŸèƒ½

#### 1. å…¨å±€ç»Ÿè®¡å¡ç‰‡

**æ˜¾ç¤ºå†…å®¹**ï¼š
- å¤šå¤´å¸ç§æ•°é‡
- ç©ºå¤´å¸ç§æ•°é‡
- å¤šå¤´80+å¸ç§æ•°
- ç©ºå¤´80+å¸ç§æ•°

**æ•°æ®æ¥æº**ï¼š
```
GET /api/sar-slope/latest-jsonl
```

**å±•ç¤ºæ•ˆæœ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤šå¤´å¸ç§     â”‚  â”‚ ç©ºå¤´å¸ç§     â”‚
â”‚    18       â”‚  â”‚    11       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤šå¤´80+      â”‚  â”‚ ç©ºå¤´80+      â”‚
â”‚    3        â”‚  â”‚    2        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2. è¶‹åŠ¿åˆ†å¸ƒé¥¼å›¾

**åŠŸèƒ½æè¿°**ï¼š
- é¥¼å›¾å±•ç¤ºå¤šç©ºåˆ†å¸ƒ
- å®æ—¶æ›´æ–°æ¯”ä¾‹

**æŠ€æœ¯å®ç°**ï¼š
```javascript
// ECharts é…ç½®
{
    series: [{
        type: 'pie',
        data: [
            { value: bullish_count, name: 'å¤šå¤´' },
            { value: bearish_count, name: 'ç©ºå¤´' }
        ]
    }]
}
```

---

### ğŸ” é«˜çº§åŠŸèƒ½

#### 1. è¶‹åŠ¿åè½¬æé†’

**åŠŸèƒ½æè¿°**ï¼š
- è‡ªåŠ¨æ£€æµ‹è±¡é™å˜åŒ–ï¼ˆQ1â†’Q2ã€Q3â†’Q4ç­‰ï¼‰
- æ ‡è®°å³å°†åè½¬çš„å¸ç§

**åˆ¤æ–­é€»è¾‘**ï¼š
```python
if quadrant in ['Q2', 'Q4']:
    alert = "âš ï¸ å³å°†åè½¬"
```

---

#### 2. æˆç†Ÿè¶‹åŠ¿æ ‡è®°

**åŠŸèƒ½æè¿°**ï¼š
- æ ‡è®°æŒç»­â‰¥80åˆ†é’Ÿçš„è¶‹åŠ¿
- æç¤ºç”¨æˆ·è­¦æƒ•åè½¬

**åˆ¤æ–­é€»è¾‘**ï¼š
```python
if duration_minutes >= 80:
    badge = "ğŸš¨ æˆç†Ÿè¶‹åŠ¿"
```

---

#### 3. SARå·®å€¼ç›‘æ§

**åŠŸèƒ½æè¿°**ï¼š
- æ˜¾ç¤ºä»·æ ¼ä¸SARçš„è·ç¦»
- ç»å¯¹å€¼å’Œç™¾åˆ†æ¯”åŒæŒ‡æ ‡

**è®¡ç®—æ–¹æ³•**ï¼š
```python
sar_diff_abs = abs(price - sar)
sar_diff_pct = (sar_diff_abs / price) * 100
```

**åº”ç”¨åœºæ™¯**ï¼š
- SARå·®å€¼è¶Šå¤§ â†’ è¶‹åŠ¿è¶Šå¼º
- SARå·®å€¼æ¥è¿‘0 â†’ å³å°†åè½¬

---

## æŠ€æœ¯ä¾èµ–

### ğŸ Python ä¾èµ–åŒ…

#### æ ¸å¿ƒä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” | å®‰è£…å‘½ä»¤ |
|------|------|------|---------|
| `numpy` | â‰¥1.20.0 | æ•°å€¼è®¡ç®—ã€æ•°ç»„å¤„ç† | `pip install numpy` |
| `requests` | â‰¥2.25.0 | HTTPè¯·æ±‚ã€APIè°ƒç”¨ | `pip install requests` |
| `pytz` | â‰¥2021.1 | æ—¶åŒºå¤„ç†ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ | `pip install pytz` |
| `flask` | â‰¥2.0.0 | Webæ¡†æ¶ã€APIæœåŠ¡ | `pip install flask` |

#### å®Œæ•´ä¾èµ–åˆ—è¡¨

```bash
# requirements.txt
numpy==1.24.3
requests==2.31.0
pytz==2023.3
flask==2.3.2
flask-cors==4.0.0
```

å®‰è£…å‘½ä»¤ï¼š
```bash
cd /home/user/webapp
pip3 install -r requirements.txt
```

---

### ğŸ“¦ Node.js ä¾èµ–åŒ…

#### PM2 è¿›ç¨‹ç®¡ç†å™¨

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” | å®‰è£…å‘½ä»¤ |
|------|------|------|---------|
| `pm2` | â‰¥5.0.0 | è¿›ç¨‹å®ˆæŠ¤ã€è‡ªåŠ¨é‡å¯ | `npm install -g pm2` |

#### PM2 åŠŸèƒ½è¯´æ˜

```bash
# è¿›ç¨‹ç®¡ç†
pm2 start     # å¯åŠ¨è¿›ç¨‹
pm2 stop      # åœæ­¢è¿›ç¨‹
pm2 restart   # é‡å¯è¿›ç¨‹
pm2 delete    # åˆ é™¤è¿›ç¨‹

# ç›‘æ§
pm2 list      # æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
pm2 logs      # æŸ¥çœ‹æ—¥å¿—
pm2 monit     # å®æ—¶ç›‘æ§

# æŒä¹…åŒ–
pm2 save      # ä¿å­˜è¿›ç¨‹åˆ—è¡¨
pm2 startup   # å¼€æœºè‡ªå¯
```

---

### ğŸ—„ï¸ æ•°æ®åº“ï¼ˆæœªä½¿ç”¨ï¼‰

**æ³¨æ„**ï¼šSARæ–œç‡ç³»ç»Ÿ**ä¸ä¾èµ–SQLiteæ•°æ®åº“**ï¼Œå…¨éƒ¨ä½¿ç”¨JSONLæ–‡ä»¶å­˜å‚¨ã€‚

---

### ğŸŒ å¤–éƒ¨API

#### OKX API

**ç”¨é€”**ï¼šè·å–åŠ å¯†è´§å¸Kçº¿æ•°æ®

**ç«¯ç‚¹**ï¼š
```
# æ°¸ç»­åˆçº¦
https://www.okx.com/api/v5/market/candles?instId={symbol}-USDT-SWAP&bar=1m&limit=100

# ç°è´§
https://www.okx.com/api/v5/market/candles?instId={symbol}-USDT&bar=1m&limit=100
```

**å‚æ•°**ï¼š
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `instId` | äº¤æ˜“å¯¹ID | `BTC-USDT-SWAP` |
| `bar` | Kçº¿å‘¨æœŸ | `1m`ï¼ˆ1åˆ†é’Ÿï¼‰ |
| `limit` | æ•°é‡ | `100`ï¼ˆæœ€å¤š100æ ¹ï¼‰ |

**è¿”å›æ ¼å¼**ï¼š
```json
{
  "code": "0",
  "msg": "",
  "data": [
    [
      "1770711600000",  // æ—¶é—´æˆ³
      "70195.9",        // å¼€ç›˜ä»·
      "70250.0",        // æœ€é«˜ä»·
      "70100.0",        // æœ€ä½ä»·
      "70200.0",        // æ”¶ç›˜ä»·
      "123.45"          // æˆäº¤é‡
    ]
  ]
}
```

**é¢‘ç‡é™åˆ¶**ï¼š
- å…¬å¼€æ¥å£ï¼š20æ¬¡/2ç§’
- ç³»ç»Ÿè®¾ç½®ï¼šæ¯å¸ç§é—´éš”0.1ç§’

---

### ğŸ”§ ç³»ç»Ÿå·¥å…·

| å·¥å…· | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `Python 3` | â‰¥3.8 | è„šæœ¬è¿è¡Œç¯å¢ƒ |
| `jq` | â‰¥1.6 | JSONå‘½ä»¤è¡Œå¤„ç† |
| `curl` | â‰¥7.0 | HTTPæµ‹è¯•å·¥å…· |
| `systemd` | - | PM2å¼€æœºè‡ªå¯ |

---

## APIæ¥å£æ–‡æ¡£

### ğŸ”— è·¯ç”±åˆ—è¡¨

| è·¯ç”± | æ–¹æ³• | æè¿° | å“åº”æ ¼å¼ |
|------|------|------|---------|
| `/sar-slope` | GET | SARæ–œç‡ä¸»é¡µé¢ | HTML |
| `/api/sar-slope/latest` | GET | æœ€æ–°æ•°æ®ï¼ˆæ•°æ®åº“æŸ¥è¯¢ï¼‰ | JSON |
| `/api/sar-slope/latest-jsonl` | GET | æœ€æ–°æ•°æ®ï¼ˆJSONLè¯»å–ï¼‰â­ | JSON |
| `/api/sar-slope/history/<symbol>` | GET | å•å¸ç§å†å²æ•°æ® | JSON |
| `/api/sar-slope/position-changes/<symbol>` | GET | è¶‹åŠ¿å˜åŒ–è®°å½• | JSON |
| `/api/sar-slope/collector-status` | GET | é‡‡é›†å™¨çŠ¶æ€ | JSON |

---

### ğŸ“– API è¯¦ç»†è¯´æ˜

#### 1. è·å–æœ€æ–°æ•°æ®ï¼ˆJSONLç‰ˆæœ¬ï¼‰â­

**ç«¯ç‚¹**ï¼š
```
GET /api/sar-slope/latest-jsonl
```

**è¯´æ˜**ï¼šä»JSONLæ–‡ä»¶è¯»å–æ‰€æœ‰å¸ç§çš„æœ€æ–°æ•°æ®ï¼Œæ€§èƒ½æœ€ä¼˜ã€‚

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X GET "https://your-domain.com/api/sar-slope/latest-jsonl"
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "symbol": "BTC",
      "datetime": "2026-02-10 16:20:00",
      "sar_value": 69850.12345678,
      "sar_position": "bullish",
      "sar_quadrant": "Q1",
      "position_duration": 45,
      "slope_value": 12.5678,
      "slope_direction": "up",
      "price": 70195.9,
      "timestamp": 1770711600000
    },
    {
      "symbol": "ETH",
      ...
    }
  ],
  "total": 29,
  "timestamp": "2026-02-10 16:25:30"
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `success`: æ˜¯å¦æˆåŠŸ
- `data`: æ•°æ®æ•°ç»„ï¼ˆ29ä¸ªå¸ç§ï¼‰
- `total`: å¸ç§æ€»æ•°
- `timestamp`: å“åº”æ—¶é—´

---

#### 2. è·å–å•å¸ç§å†å²æ•°æ®

**ç«¯ç‚¹**ï¼š
```
GET /api/sar-slope/history/<symbol>
```

**è¯´æ˜**ï¼šæŸ¥è¯¢æŒ‡å®šå¸ç§çš„å†å²è®°å½•ï¼ˆé»˜è®¤æœ€è¿‘24å°æ—¶ï¼‰ã€‚

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `symbol` | string | æ˜¯ | å¸ç§ç¬¦å·ï¼ˆè·¯å¾„å‚æ•°ï¼‰ |
| `hours` | int | å¦ | æŸ¥è¯¢æ—¶é•¿ï¼ˆé»˜è®¤24å°æ—¶ï¼‰ |
| `limit` | int | å¦ | è¿”å›æ•°é‡ï¼ˆé»˜è®¤1000æ¡ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
# è·å–BTCæœ€è¿‘24å°æ—¶æ•°æ®
curl -X GET "https://your-domain.com/api/sar-slope/history/BTC"

# è·å–BTCæœ€è¿‘48å°æ—¶æ•°æ®
curl -X GET "https://your-domain.com/api/sar-slope/history/BTC?hours=48"

# é™åˆ¶è¿”å›500æ¡
curl -X GET "https://your-domain.com/api/sar-slope/history/BTC?limit=500"
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "symbol": "BTC",
  "data": [
    {
      "timestamp": 1770711600000,
      "datetime": "2026-02-10 16:20:00",
      "price": 70195.9,
      "sar_value": 69850.12,
      "sar_position": "bullish",
      "sar_quadrant": "Q1",
      "position_duration": 45,
      "slope_value": 12.5678,
      "slope_direction": "up"
    },
    ...
  ],
  "count": 288,  // 24å°æ—¶ Ã— 12æ¬¡/å°æ—¶
  "query_hours": 24
}
```

---

#### 3. è·å–è¶‹åŠ¿å˜åŒ–è®°å½•

**ç«¯ç‚¹**ï¼š
```
GET /api/sar-slope/position-changes/<symbol>
```

**è¯´æ˜**ï¼šåªè¿”å›è¶‹åŠ¿å‘ç”Ÿå˜åŒ–çš„è®°å½•ï¼ˆBullish â†” Bearishï¼‰ã€‚

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `symbol` | string | æ˜¯ | å¸ç§ç¬¦å· |
| `hours` | int | å¦ | æŸ¥è¯¢æ—¶é•¿ï¼ˆé»˜è®¤24å°æ—¶ï¼‰ |
| `limit` | int | å¦ | è¿”å›æ•°é‡ï¼ˆé»˜è®¤100æ¡ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X GET "https://your-domain.com/api/sar-slope/position-changes/BTC"
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "symbol": "BTC",
  "changes": [
    {
      "timestamp": 1770705000000,
      "datetime": "2026-02-10 14:30:00",
      "from_position": "bearish",
      "to_position": "bullish",
      "duration_before_change": 85  // å‰ä¸€è¶‹åŠ¿æŒç»­æ—¶é•¿
    },
    {
      "timestamp": 1770690000000,
      "datetime": "2026-02-10 10:20:00",
      "from_position": "bullish",
      "to_position": "bearish",
      "duration_before_change": 120
    }
  ],
  "count": 5,
  "query_hours": 24
}
```

---

#### 4. è·å–é‡‡é›†å™¨çŠ¶æ€

**ç«¯ç‚¹**ï¼š
```
GET /api/sar-slope/collector-status
```

**è¯´æ˜**ï¼šæŸ¥è¯¢é‡‡é›†å™¨è¿è¡ŒçŠ¶æ€å’Œæ•°æ®ç»Ÿè®¡ã€‚

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X GET "https://your-domain.com/api/sar-slope/collector-status"
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "collector_status": {
    "is_running": true,
    "last_collection_time": "2026-02-10 16:25:30",
    "seconds_since_last_collection": 15,
    "collection_interval": 300,  // 5åˆ†é’Ÿ
    "next_collection_in": 285    // è¿˜å‰©285ç§’
  },
  "data_stats": {
    "total_records": 1250000,    // æ€»è®°å½•æ•°
    "symbols_tracked": 29,        // è¿½è¸ªå¸ç§æ•°
    "earliest_record": "2026-01-17 19:00:00",
    "latest_record": "2026-02-10 16:25:30",
    "data_span_days": 24,
    "avg_records_per_symbol": 43103
  },
  "position_distribution": {
    "bullish_count": 18,
    "bearish_count": 11,
    "bullish_80_plus": 3,
    "bearish_80_plus": 2
  }
}
```

---

## éƒ¨ç½²ä¸é…ç½®

### ğŸš€ éƒ¨ç½²æ­¥éª¤

#### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…Pythonä¾èµ–
cd /home/user/webapp
pip3 install numpy requests pytz flask flask-cors

# å®‰è£…PM2
npm install -g pm2

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /home/user/webapp/data/sar_jsonl
mkdir -p /home/user/webapp/data/sar_slope_jsonl
mkdir -p /home/user/webapp/logs
```

---

#### 2. PM2 é…ç½®

**é…ç½®æ–‡ä»¶**ï¼š`ecosystem.config.js`

```javascript
module.exports = {
  apps: [
    {
      name: 'sar-slope-collector',
      script: '/home/user/webapp/source_code/sar_slope_collector.py',
      interpreter: 'python3',
      cwd: '/home/user/webapp',
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '500M',
      env: {
        PYTHONUNBUFFERED: '1'
      },
      error_file: '/home/user/webapp/logs/sar-slope-error.log',
      out_file: '/home/user/webapp/logs/sar-slope-out.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss',
      cron_restart: '0 */6 * * *',  // æ¯6å°æ—¶è‡ªåŠ¨é‡å¯
      min_uptime: '10s',
      max_restarts: 10
    }
  ]
};
```

**å¯åŠ¨å‘½ä»¤**ï¼š
```bash
# å¯åŠ¨é‡‡é›†å™¨
pm2 start ecosystem.config.js --only sar-slope-collector

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs sar-slope-collector

# é‡å¯
pm2 restart sar-slope-collector

# åœæ­¢
pm2 stop sar-slope-collector
```

---

#### 3. Flask è·¯ç”±é…ç½®

åœ¨ `app.py` ä¸­æ·»åŠ è·¯ç”±ï¼š

```python
# ä¸»é¡µé¢
@app.route('/sar-slope')
def sar_slope_page():
    response = make_response(render_template('sar_slope.html'))
    response.headers['Cache-Control'] = 'no-cache, no-store, must-revalidate'
    response.headers['Pragma'] = 'no-cache'
    return response

# APIç«¯ç‚¹
@app.route('/api/sar-slope/latest-jsonl')
def sar_slope_latest_jsonl():
    try:
        jsonl_file = '/home/user/webapp/data/sar_slope_jsonl/latest_sar_slope.jsonl'
        
        if not os.path.exists(jsonl_file):
            return jsonify({'success': False, 'message': 'Data not found'})
        
        data = []
        with open(jsonl_file, 'r', encoding='utf-8') as f:
            for line in f:
                if line.strip():
                    data.append(json.loads(line))
        
        return jsonify({
            'success': True,
            'data': data,
            'total': len(data),
            'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        })
    except Exception as e:
        return jsonify({'success': False, 'message': str(e)})
```

---

#### 4. ç¯å¢ƒå˜é‡é…ç½®

**æ–‡ä»¶**ï¼š`.env`ï¼ˆå¯é€‰ï¼‰

```bash
# Flaské…ç½®
FLASK_ENV=production
FLASK_DEBUG=0

# æ•°æ®ç›®å½•
DATA_DIR=/home/user/webapp/data
LOG_DIR=/home/user/webapp/logs

# SARå‚æ•°
SAR_AF_START=0.02
SAR_AF_INCREMENT=0.02
SAR_AF_MAX=0.20

# é‡‡é›†é—´éš”ï¼ˆç§’ï¼‰
COLLECTION_INTERVAL=300

# OKX API
OKX_API_BASE=https://www.okx.com/api/v5
```

---

### ğŸ“‚ ç›®å½•æƒé™

```bash
# ç¡®ä¿ç›®å½•å¯å†™
chmod 755 /home/user/webapp/data
chmod 755 /home/user/webapp/logs

# ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ
chmod +x /home/user/webapp/source_code/sar_slope_collector.py
```

---

### ğŸ” å®‰å…¨é…ç½®

#### 1. CORSé…ç½®

```python
from flask_cors import CORS

app = Flask(__name__)
CORS(app, resources={
    r"/api/*": {
        "origins": ["https://your-domain.com"],
        "methods": ["GET", "POST"],
        "allow_headers": ["Content-Type"]
    }
})
```

#### 2. Rate Limiting

```python
from flask_limiter import Limiter

limiter = Limiter(
    app,
    key_func=lambda: request.remote_addr,
    default_limits=["200 per day", "50 per hour"]
)

@app.route('/api/sar-slope/latest-jsonl')
@limiter.limit("30 per minute")
def sar_slope_latest_jsonl():
    ...
```

---

## æ•…éšœæ’æŸ¥

### ğŸ” å¸¸è§é—®é¢˜

#### 1. é‡‡é›†å™¨æœªè¿è¡Œ

**ç—‡çŠ¶**ï¼š
- PM2æ˜¾ç¤ºçŠ¶æ€ä¸º`stopped`
- æœ€æ–°æ•°æ®ä¸æ›´æ–°

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
pm2 status | grep sar-slope
pm2 logs sar-slope-collector --lines 50
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡å¯é‡‡é›†å™¨
pm2 restart sar-slope-collector

# å¦‚æœåå¤é‡å¯
pm2 delete sar-slope-collector
pm2 start ecosystem.config.js --only sar-slope-collector
```

---

#### 2. JSONLæ–‡ä»¶ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼š
- APIè¿”å› `"message": "Data not found"`
- é¡µé¢æ˜¾ç¤ºç©ºç™½

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
ls -lh /home/user/webapp/data/sar_slope_jsonl/
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åˆ›å»ºç›®å½•
mkdir -p /home/user/webapp/data/sar_slope_jsonl

# æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡é‡‡é›†
cd /home/user/webapp
python3 source_code/sar_slope_collector.py
```

---

#### 3. Kçº¿æ•°æ®è·å–å¤±è´¥

**ç—‡çŠ¶**ï¼š
- æ—¥å¿—æ˜¾ç¤º `[è­¦å‘Š] XXX Kçº¿æ•°æ®è·å–å¤±è´¥`
- æŸäº›å¸ç§æ•°æ®ç¼ºå¤±

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f /home/user/webapp/logs/sar-slope-out.log

# æµ‹è¯•API
curl "https://www.okx.com/api/v5/market/candles?instId=BTC-USDT-SWAP&bar=1m&limit=100"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping www.okx.com

# æ£€æŸ¥æ˜¯å¦è¢«é™æµ
# OKXé™åˆ¶ï¼š20æ¬¡/2ç§’ï¼Œç³»ç»Ÿå·²è®¾ç½®0.1ç§’é—´éš”

# å¦‚æœæ°¸ç»­åˆçº¦å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•ç°è´§
```

---

#### 4. å†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶**ï¼š
- PM2æ˜¾ç¤ºå†…å­˜ä½¿ç”¨>500MB
- ç³»ç»Ÿé¢‘ç¹é‡å¯

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
pm2 monit
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é™ä½max_memory_restart
pm2 set pm2:max_memory_restart 300M

# æˆ–å¢åŠ ç³»ç»Ÿå†…å­˜é™åˆ¶
# ç¼–è¾‘ ecosystem.config.js
max_memory_restart: '300M'
```

---

#### 5. æ•°æ®åº“ç›¸å…³é”™è¯¯

**è¯´æ˜**ï¼š
SARæ–œç‡ç³»ç»Ÿ**ä¸ä½¿ç”¨æ•°æ®åº“**ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨JSONLæ–‡ä»¶ä¸­ã€‚

å¦‚æœçœ‹åˆ°æ•°æ®åº“ç›¸å…³é”™è¯¯ï¼Œå¯èƒ½æ˜¯ï¼š
- ä½¿ç”¨äº†é”™è¯¯çš„APIç«¯ç‚¹ï¼ˆ`/api/sar-slope/latest` ä½¿ç”¨æ•°æ®åº“ï¼‰
- å»ºè®®ä½¿ç”¨ `/api/sar-slope/latest-jsonl`ï¼ˆè¯»å–JSONLï¼‰

---

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–

#### 1. JSONLæ–‡ä»¶è¿‡å¤§

**é—®é¢˜**ï¼š
- `sar_slope_data.jsonl` è¶…è¿‡1GB
- æŸ¥è¯¢å˜æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŒ‰æœˆå½’æ¡£
cd /home/user/webapp/data/sar_slope_jsonl
mv sar_slope_data.jsonl sar_slope_data_2026_01.jsonl
touch sar_slope_data.jsonl

# æˆ–ä½¿ç”¨logrotateå®šæœŸåˆ‡å‰²
```

#### 2. APIå“åº”æ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `/latest-jsonl` ä»£æ›¿ `/latest`
- æ·»åŠ Redisç¼“å­˜å±‚
- å¯ç”¨gzipå‹ç¼©

```python
from flask_compress import Compress
Compress(app)
```

---

### ğŸ› ï¸ ç»´æŠ¤ä»»åŠ¡

#### æ¯æ—¥ä»»åŠ¡

```bash
# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs sar-slope-collector --lines 100

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /home/user/webapp/data
```

#### æ¯å‘¨ä»»åŠ¡

```bash
# æ¸…ç†æ—§æ—¥å¿—
pm2 flush sar-slope-collector

# å¤‡ä»½æ•°æ®
tar -czf sar_data_backup_$(date +%Y%m%d).tar.gz data/sar_slope_jsonl/

# æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
wc -l data/sar_slope_jsonl/*.jsonl
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### å½“å‰ç³»ç»ŸçŠ¶æ€

```
é‡‡é›†å™¨çŠ¶æ€ï¼šè¿è¡Œä¸­ âœ…
é‡‡é›†å¸ç§ï¼š29ä¸ª
é‡‡é›†é—´éš”ï¼š5åˆ†é’Ÿï¼ˆ300ç§’ï¼‰
æ•°æ®æ–‡ä»¶ï¼š
  - latest_sar_slope.jsonl: 6.6 KB (29è¡Œ)
  - sar_slope_data.jsonl: 114 MB (ç™¾ä¸‡è¡Œ)
  - sar_slope_summary.jsonl: 1.9 MB (æ•°åƒè¡Œ)
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **ç³»ç»Ÿé¡µé¢**ï¼šhttps://your-domain.com/sar-slope
- **OKX APIæ–‡æ¡£**ï¼šhttps://www.okx.com/docs-v5/zh/
- **PM2æ–‡æ¡£**ï¼šhttps://pm2.keymetrics.io/docs/
- **SARæŒ‡æ ‡ä»‹ç»**ï¼šhttps://en.wikipedia.org/wiki/Parabolic_SAR

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-17)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… SARæŒ‡æ ‡è®¡ç®—
- âœ… 29ç§å¸ç§ç›‘æ§
- âœ… JSONLæ•°æ®å­˜å‚¨

### v1.1.0 (2026-01-27)
- âœ… æ–°å¢æ–œç‡è®¡ç®—
- âœ… æ–°å¢å››è±¡é™ç³»ç»Ÿ
- âœ… æ–°å¢80+æˆç†Ÿè¶‹åŠ¿æ ‡è®°

### v1.2.0 (2026-02-10)
- âœ… ä¼˜åŒ–JSONLè¯»å–æ€§èƒ½
- âœ… æ–°å¢ `/latest-jsonl` API
- âœ… æ–°å¢è¶‹åŠ¿å˜åŒ–è®°å½•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0  
**æ›´æ–°æ—¶é—´**ï¼š2026-02-15 15:00  
**ä½œè€…**ï¼šGenSpark AI Developer  
**æ–‡ä»¶è·¯å¾„**ï¼š`/home/user/webapp/docs/SARæ–œç‡ç›‘æ§ç³»ç»Ÿå®Œæ•´æ–‡æ¡£.md`
