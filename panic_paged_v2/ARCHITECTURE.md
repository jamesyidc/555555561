# Panic Paged V2 - æ•°æ®æ ¼å¼ä¸ä¸šåŠ¡é€»è¾‘å®Œæ•´è¯´æ˜

## ğŸ“Œ ç³»ç»Ÿè¯´æ˜

è¿™æ˜¯ä¸€ä¸ª**å®Œå…¨åç«¯é©±åŠ¨**çš„ææ…ŒæŒ‡æ•°ç›‘æ§ç³»ç»Ÿï¼Œå…·æœ‰ï¼š
- âœ… ç‹¬ç«‹çš„æ•°æ®é‡‡é›†å™¨ï¼ˆPM2ç®¡ç†ï¼‰
- âœ… ç‹¬ç«‹çš„JSONLå­˜å‚¨ï¼ˆ24hå’Œ1håˆ†å¼€ï¼‰
- âœ… å®Œæ•´çš„APIæ¥å£
- âœ… å‰ç«¯ç¿»é¡µæŸ¥çœ‹åŠŸèƒ½

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
/home/user/webapp/panic_paged_v2/
â”‚
â”œâ”€â”€ collector_24h.py          # 24å°æ—¶æ•°æ®é‡‡é›†å™¨ï¼ˆPM2å®ˆæŠ¤è¿›ç¨‹ï¼‰
â”œâ”€â”€ collector_1h.py           # 1å°æ—¶æ•°æ®é‡‡é›†å™¨ï¼ˆPM2å®ˆæŠ¤è¿›ç¨‹ï¼‰
â”œâ”€â”€ data_manager.py           # æ•°æ®ç®¡ç†å™¨ï¼ˆAPIä½¿ç”¨ï¼‰
â”œâ”€â”€ api_routes.py             # Flask APIè·¯ç”±å®šä¹‰
â”œâ”€â”€ ecosystem.config.json     # PM2é…ç½®æ–‡ä»¶
â”œâ”€â”€ deploy.sh                 # å¿«é€Ÿéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ README.md                 # å®Œæ•´æ–‡æ¡£
â”‚
â””â”€â”€ data/                     # æ•°æ®ç›®å½•
    â”œâ”€â”€ panic_24h_20260210.jsonl   # 2æœˆ10æ—¥çš„24å°æ—¶æ•°æ®
    â”œâ”€â”€ panic_24h_20260211.jsonl   # 2æœˆ11æ—¥çš„24å°æ—¶æ•°æ®
    â”œâ”€â”€ panic_1h_20260210.jsonl    # 2æœˆ10æ—¥çš„1å°æ—¶æ•°æ®
    â””â”€â”€ panic_1h_20260211.jsonl    # 2æœˆ11æ—¥çš„1å°æ—¶æ•°æ®
```

---

## ğŸ“Š æ•°æ®æ ¼å¼è¯¦è§£

### 1. 24å°æ—¶æ•°æ®æ–‡ä»¶æ ¼å¼

**æ–‡ä»¶å‘½å**: `panic_24h_YYYYMMDD.jsonl`

**ç¤ºä¾‹æ–‡ä»¶å**: `panic_24h_20260211.jsonl`

**æ–‡ä»¶å†…å®¹** (JSONLæ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªJSONè®°å½•):

```jsonl
{"timestamp": 1770788797429, "beijing_time": "2026-02-11 13:46:37", "liquidation_24h": 14440.03, "liquidation_count_24h": 6.64, "open_interest": 56.78, "panic_index": 0.1169, "panic_level": "ä¸­ç­‰ææ…Œ"}
{"timestamp": 1770788857429, "beijing_time": "2026-02-11 13:47:37", "liquidation_24h": 14450.12, "liquidation_count_24h": 6.65, "open_interest": 56.79, "panic_index": 0.1171, "panic_level": "ä¸­ç­‰ææ…Œ"}
{"timestamp": 1770788917429, "beijing_time": "2026-02-11 13:48:37", "liquidation_24h": 14460.28, "liquidation_count_24h": 6.66, "open_interest": 56.80, "panic_index": 0.1172, "panic_level": "ä¸­ç­‰ææ…Œ"}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | æ•°æ®ç±»å‹ | å•ä½ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|----------|------|------|--------|
| `timestamp` | integer | æ¯«ç§’ | Unixæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ | 1770788797429 |
| `beijing_time` | string | - | åŒ—äº¬æ—¶é—´ï¼Œæ ¼å¼ï¼šYYYY-MM-DD HH:mm:ss | "2026-02-11 13:46:37" |
| `liquidation_24h` | float | ä¸‡ç¾å…ƒ | 24å°æ—¶çˆ†ä»“é‡‘é¢ | 14440.03 |
| `liquidation_count_24h` | float | ä¸‡äºº | 24å°æ—¶çˆ†ä»“äººæ•° | 6.64 |
| `open_interest` | float | äº¿ç¾å…ƒ | å…¨ç½‘æŒä»“é‡ | 56.78 |
| `panic_index` | float | æ— é‡çº² | ææ…Œæ¸…æ´—æŒ‡æ•°ï¼ˆ0-1ä¹‹é—´ï¼‰ | 0.1169 |
| `panic_level` | string | - | ææ…Œç­‰çº§ | "ä¸­ç­‰ææ…Œ" |

**ææ…Œç­‰çº§åˆ¤æ–­**:
- `panic_index > 0.15` â†’ "é«˜ææ…Œ"
- `0.08 < panic_index â‰¤ 0.15` â†’ "ä¸­ç­‰ææ…Œ"
- `panic_index â‰¤ 0.08` â†’ "ä½ææ…Œ"

---

### 2. 1å°æ—¶æ•°æ®æ–‡ä»¶æ ¼å¼

**æ–‡ä»¶å‘½å**: `panic_1h_YYYYMMDD.jsonl`

**ç¤ºä¾‹æ–‡ä»¶å**: `panic_1h_20260211.jsonl`

**æ–‡ä»¶å†…å®¹** (JSONLæ ¼å¼):

```jsonl
{"timestamp": 1770788797429, "beijing_time": "2026-02-11 13:46:37", "liquidation_1h": 3734.63}
{"timestamp": 1770788857429, "beijing_time": "2026-02-11 13:47:37", "liquidation_1h": 3735.12}
{"timestamp": 1770788917429, "beijing_time": "2026-02-11 13:48:37", "liquidation_1h": 3736.45}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | æ•°æ®ç±»å‹ | å•ä½ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|----------|------|------|--------|
| `timestamp` | integer | æ¯«ç§’ | Unixæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ | 1770788797429 |
| `beijing_time` | string | - | åŒ—äº¬æ—¶é—´ | "2026-02-11 13:46:37" |
| `liquidation_1h` | float | ä¸‡ç¾å…ƒ | 1å°æ—¶çˆ†ä»“é‡‘é¢ | 3734.63 |

---

## ğŸ”„ ä¸šåŠ¡é€»è¾‘è¯´æ˜

### 1. æ•°æ®é‡‡é›†æµç¨‹

#### 24å°æ—¶æ•°æ®é‡‡é›†å™¨ (collector_24h.py)

```
å¯åŠ¨ â†’ æ¯60ç§’å¾ªç¯ â†’ è¯·æ±‚API â†’ è§£ææ•°æ® â†’ å•ä½è½¬æ¢ â†’ è®¡ç®—ææ…ŒæŒ‡æ•° â†’ ä¿å­˜åˆ°JSONL
```

**è¯¦ç»†æ­¥éª¤**:

1. **è·å–æ•°æ®æº**
   - API: `https://history.btc126.com/baocang/`
   - æ–¹æ³•: GETè¯·æ±‚

2. **æ•°æ®æå–**
   - æå–24å°æ—¶çˆ†ä»“é‡‘é¢ï¼ˆåŸå§‹å€¼ï¼‰
   - æå–24å°æ—¶çˆ†ä»“äººæ•°ï¼ˆåŸå§‹å€¼ï¼‰
   - æå–å…¨ç½‘æŒä»“é‡ï¼ˆåŸå§‹å€¼ï¼‰

3. **å•ä½è½¬æ¢**
   ```python
   liquidation_24h = åŸå§‹å€¼ / 10000      # ä¸‡ç¾å…ƒ
   liquidation_count_24h = åŸå§‹å€¼ / 10000  # ä¸‡äºº
   open_interest = åŸå§‹å€¼ / 100000000     # äº¿ç¾å…ƒ
   ```

4. **è®¡ç®—ææ…ŒæŒ‡æ•°**
   ```python
   panic_index = liquidation_count_24h / open_interest
   ```
   å…¬å¼: **ææ…ŒæŒ‡æ•° = 24å°æ—¶çˆ†ä»“äººæ•°(ä¸‡äºº) Ã· å…¨ç½‘æŒä»“é‡(äº¿ç¾å…ƒ)**

5. **åˆ¤æ–­ææ…Œç­‰çº§**
   ```python
   if panic_index > 0.15:
       panic_level = "é«˜ææ…Œ"
   elif panic_index > 0.08:
       panic_level = "ä¸­ç­‰ææ…Œ"
   else:
       panic_level = "ä½ææ…Œ"
   ```

6. **ä¿å­˜æ•°æ®**
   - è·å–åŒ—äº¬æ—¶é—´
   - ç”Ÿæˆæ–‡ä»¶å: `panic_24h_YYYYMMDD.jsonl`
   - è¿½åŠ å†™å…¥JSONL

#### 1å°æ—¶æ•°æ®é‡‡é›†å™¨ (collector_1h.py)

```
å¯åŠ¨ â†’ æ¯60ç§’å¾ªç¯ â†’ è¯·æ±‚API â†’ è§£ææ•°æ® â†’ å•ä½è½¬æ¢ â†’ ä¿å­˜åˆ°JSONL
```

**è¯¦ç»†æ­¥éª¤**:

1. **è·å–æ•°æ®æº**
   - åŒ24å°æ—¶é‡‡é›†å™¨

2. **æ•°æ®æå–**
   - æå–1å°æ—¶çˆ†ä»“é‡‘é¢ï¼ˆåŸå§‹å€¼ï¼‰

3. **å•ä½è½¬æ¢**
   ```python
   liquidation_1h = åŸå§‹å€¼ / 10000  # ä¸‡ç¾å…ƒ
   ```

4. **ä¿å­˜æ•°æ®**
   - è·å–åŒ—äº¬æ—¶é—´
   - ç”Ÿæˆæ–‡ä»¶å: `panic_1h_YYYYMMDD.jsonl`
   - è¿½åŠ å†™å…¥JSONL

---

### 2. æ•°æ®ç®¡ç†é€»è¾‘

#### æ•°æ®ç®¡ç†å™¨ (data_manager.py)

**ä¸»è¦åŠŸèƒ½**:

| æ–¹æ³• | åŠŸèƒ½ | è¿”å› |
|------|------|------|
| `get_24h_data_by_date(date)` | è·å–æŒ‡å®šæ—¥æœŸçš„24hæ•°æ® | è®°å½•æ•°ç»„ |
| `get_1h_data_by_date(date)` | è·å–æŒ‡å®šæ—¥æœŸçš„1hæ•°æ® | è®°å½•æ•°ç»„ |
| `get_24h_latest()` | è·å–æœ€æ–°24hæ•°æ® | å•æ¡è®°å½• |
| `get_1h_latest()` | è·å–æœ€æ–°1hæ•°æ® | å•æ¡è®°å½• |
| `get_24h_date_range(start, end)` | è·å–æ—¥æœŸèŒƒå›´æ•°æ® | å­—å…¸ |
| `get_1h_date_range(start, end)` | è·å–æ—¥æœŸèŒƒå›´æ•°æ® | å­—å…¸ |
| `get_available_dates()` | è·å–å¯ç”¨æ—¥æœŸåˆ—è¡¨ | å­—å…¸ |

**è¯»å–é€»è¾‘**:

```python
def _read_jsonl(file_path):
    """è¯»å–JSONLæ–‡ä»¶"""
    records = []
    with open(file_path, 'r', encoding='utf-8') as f:
        for line in f:
            if line.strip():
                records.append(json.loads(line))
    return records
```

---

### 3. APIæ¥å£é€»è¾‘

#### APIè·¯ç”± (api_routes.py)

**æ¥å£è®¾è®¡åŸåˆ™**:
- âœ… RESTfulé£æ ¼
- âœ… ç»Ÿä¸€è¿”å›æ ¼å¼
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ”¯æŒæ—¥æœŸå‚æ•°

**è¿”å›æ ¼å¼**:

æˆåŠŸ:
```json
{
  "success": true,
  "data": { ... }
}
```

å¤±è´¥:
```json
{
  "success": false,
  "error": "é”™è¯¯ä¿¡æ¯"
}
```

**æ¥å£åˆ—è¡¨**:

| æ¥å£ | æ–¹æ³• | å‚æ•° | åŠŸèƒ½ |
|------|------|------|------|
| `/api/panic-paged/24h/latest` | GET | æ—  | è·å–æœ€æ–°24hæ•°æ® |
| `/api/panic-paged/1h/latest` | GET | æ—  | è·å–æœ€æ–°1hæ•°æ® |
| `/api/panic-paged/24h/by-date` | GET | date | è·å–æŒ‡å®šæ—¥æœŸ24hæ•°æ® |
| `/api/panic-paged/1h/by-date` | GET | date | è·å–æŒ‡å®šæ—¥æœŸ1hæ•°æ® |
| `/api/panic-paged/available-dates` | GET | æ—  | è·å–å¯ç”¨æ—¥æœŸåˆ—è¡¨ |
| `/api/panic-paged/24h/date-range` | GET | start_date, end_date | è·å–æ—¥æœŸèŒƒå›´24hæ•°æ® |
| `/api/panic-paged/1h/date-range` | GET | start_date, end_date | è·å–æ—¥æœŸèŒƒå›´1hæ•°æ® |

---

## ğŸš€ PM2é…ç½®è¯¦è§£

### ecosystem.config.json

```json
{
  "apps": [
    {
      "name": "panic-paged-v2-collector-24h",
      "script": "collector_24h.py",
      "interpreter": "python3",
      "cwd": "/home/user/webapp/panic_paged_v2",
      "autorestart": true,
      "watch": false,
      "max_memory_restart": "200M",
      "error_file": "/home/user/webapp/logs/panic-paged-v2-24h-error.log",
      "out_file": "/home/user/webapp/logs/panic-paged-v2-24h-out.log"
    },
    {
      "name": "panic-paged-v2-collector-1h",
      "script": "collector_1h.py",
      "interpreter": "python3",
      ...
    }
  ]
}
```

**é…ç½®è¯´æ˜**:

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `name` | PM2è¿›ç¨‹åç§° |
| `script` | è¦æ‰§è¡Œçš„è„šæœ¬ |
| `interpreter` | Pythonè§£é‡Šå™¨ |
| `cwd` | å·¥ä½œç›®å½• |
| `autorestart` | è‡ªåŠ¨é‡å¯ï¼ˆå´©æºƒæ—¶ï¼‰ |
| `watch` | æ–‡ä»¶ç›‘å¬ï¼ˆå…³é—­ï¼‰ |
| `max_memory_restart` | å†…å­˜é™åˆ¶ |
| `error_file` | é”™è¯¯æ—¥å¿—è·¯å¾„ |
| `out_file` | æ ‡å‡†è¾“å‡ºè·¯å¾„ |

---

## ğŸ“ˆ æ•°æ®æµå‘å›¾

```
æ•°æ®æº (BTC126 API)
    â†“
é‡‡é›†å™¨ (collector_24h.py / collector_1h.py)
    â†“ (æ¯60ç§’)
JSONLæ–‡ä»¶ (data/panic_24h_*.jsonl / panic_1h_*.jsonl)
    â†“
æ•°æ®ç®¡ç†å™¨ (data_manager.py)
    â†“
Flask API (api_routes.py)
    â†“
å‰ç«¯é¡µé¢ (panic_paged_v2.html)
    â†“
ç”¨æˆ·æµè§ˆå™¨
```

---

## ğŸ” å…³é”®ä¸šåŠ¡é€»è¾‘

### 1. ä¸ºä»€ä¹ˆ24hå’Œ1hæ•°æ®è¦åˆ†å¼€ï¼Ÿ

**åŸå› **:
- 24hæ•°æ®åŒ…å«æ›´å¤šå­—æ®µï¼ˆææ…ŒæŒ‡æ•°ã€æŒä»“é‡ç­‰ï¼‰
- 1hæ•°æ®åªæœ‰çˆ†ä»“é‡‘é¢ï¼Œæ›´ç®€æ´
- ç‹¬ç«‹å­˜å‚¨ä¾¿äºæ•°æ®ç®¡ç†å’ŒæŸ¥è¯¢ä¼˜åŒ–
- å‰ç«¯å¯ä»¥ç‹¬ç«‹ç¿»é¡µï¼Œäº’ä¸å¹²æ‰°

### 2. ä¸ºä»€ä¹ˆæŒ‰æ—¥æœŸåˆ†æ–‡ä»¶å­˜å‚¨ï¼Ÿ

**åŸå› **:
- æ¯å¤©çº¦äº§ç”Ÿ1440æ¡è®°å½•ï¼ˆæ¯åˆ†é’Ÿ1æ¡ï¼‰
- å•æ–‡ä»¶çº¦100-200KBï¼Œä¾¿äºè¯»å–
- æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶ä¾¿äºæ•°æ®å½’æ¡£å’Œæ¸…ç†
- æŸ¥è¯¢æŒ‡å®šæ—¥æœŸæ•°æ®æ—¶åªéœ€è¯»å–ä¸€ä¸ªæ–‡ä»¶

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨JSONLè€Œä¸æ˜¯JSONï¼Ÿ

**åŸå› **:
- JSONLå¯ä»¥è¿½åŠ å†™å…¥ï¼Œä¸éœ€è¦è¯»å–æ•´ä¸ªæ–‡ä»¶
- æ¯æ¡è®°å½•ç‹¬ç«‹ï¼ŒæŸåä¸ä¼šå½±å“å…¶ä»–è®°å½•
- ä¾¿äºæµå¼å¤„ç†å’Œé€è¡Œè§£æ
- èŠ‚çœå†…å­˜ï¼Œé€‚åˆå¤§é‡æ•°æ®

### 4. ææ…ŒæŒ‡æ•°è®¡ç®—é€»è¾‘

**å…¬å¼**:
```
ææ…ŒæŒ‡æ•° = 24å°æ—¶çˆ†ä»“äººæ•°(ä¸‡äºº) / å…¨ç½‘æŒä»“é‡(äº¿ç¾å…ƒ)
```

**ç¤ºä¾‹**:
```
6.64ä¸‡äºº / 56.78äº¿ç¾å…ƒ = 0.1169
```

**å«ä¹‰**:
- æŒ‡æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºçˆ†ä»“äººæ•°ç›¸å¯¹æŒä»“é‡è¶Šå¤šï¼Œå¸‚åœºææ…Œç¨‹åº¦è¶Šé«˜
- 0.15ä»¥ä¸Šä¸ºé«˜ææ…Œ
- 0.08-0.15ä¸ºä¸­ç­‰ææ…Œ
- 0.08ä»¥ä¸‹ä¸ºä½ææ…Œ

---

## ğŸ› ï¸ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²

```bash
cd /home/user/webapp/panic_paged_v2
./deploy.sh
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. åˆ›å»ºç›®å½•
mkdir -p data logs

# 2. å¯åŠ¨PM2é‡‡é›†å™¨
pm2 start ecosystem.config.json
pm2 save

# 3. é›†æˆåˆ°Flask (æ‰‹åŠ¨ç¼–è¾‘app.py)
# æ·»åŠ : from panic_paged_v2.api_routes import register_panic_paged_routes
# æ·»åŠ : register_panic_paged_routes(app)

# 4. é‡å¯Flask
pm2 restart flask-app

# 5. éªŒè¯
curl http://localhost:5000/api/panic-paged/available-dates
```

---

## ğŸ“ æ€»ç»“

**Panic Paged V2** å®Œæ•´ç³»ç»Ÿæ¶æ„:

- âœ… **2ä¸ªç‹¬ç«‹é‡‡é›†å™¨** (PM2å®ˆæŠ¤)
- âœ… **2ç§æ•°æ®ç±»å‹** (24hå’Œ1håˆ†å¼€)
- âœ… **æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶** (JSONLæ ¼å¼)
- âœ… **7ä¸ªAPIæ¥å£** (RESTfulè®¾è®¡)
- âœ… **å®Œæ•´æ–‡æ¡£** (æ•°æ®æ ¼å¼ã€ä¸šåŠ¡é€»è¾‘ã€éƒ¨ç½²æ­¥éª¤)

**å…³é”®ç‰¹ç‚¹**:
- åç«¯é©±åŠ¨ï¼Œå‰ç«¯åªè´Ÿè´£å±•ç¤ºå’Œç¿»é¡µ
- æ•°æ®é‡‡é›†å’Œå­˜å‚¨å®Œå…¨ç‹¬ç«‹
- PM2ç®¡ç†ï¼Œè‡ªåŠ¨é‡å¯ï¼Œæ—¥å¿—å®Œå–„
- APIè®¾è®¡è§„èŒƒï¼Œæ˜“äºæ‰©å±•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¶é—´**: 2026-02-11 15:00  
**ä½œè€…**: AI Assistant
